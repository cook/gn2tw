const long g_twHtmlTxtLen = 351972;
char* g_twHtmlTxt = "<!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Strict//EN\" \"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd\">\n"
"<html xmlns=\"http://www.w3.org/1999/xhtml\" xml:lang=\"en\" lang=\"en\">\n"
"<head>\n"
"<script id=\"versionArea\" type=\"text/javascript\">\n"
"//<![CDATA[\n"
"var version = {title: \"TiddlyWiki\", major: 2, minor: 5, revision: 3, date: new Date(\"Aug 18, 2009\"), extensions: {}};\n"
"//]]>\n"
"</script>\n"
"<meta http-equiv=\"Content-Type\" content=\"text/html;charset=utf-8\" />\n"
"<meta name=\"copyright\" content=\"\n"
"TiddlyWiki created by Jeremy Ruston, (jeremy [at] osmosoft [dot] com)\n"
"\n"
"Copyright (c) UnaMesa Association 2004-2009\n"
"\n"
"Redistribution and use in source and binary forms, with or without modification,\n"
"are permitted provided that the following conditions are met:\n"
"\n"
"Redistributions of source code must retain the above copyright notice, this\n"
"list of conditions and the following disclaimer.\n"
"\n"
"Redistributions in binary form must reproduce the above copyright notice, this\n"
"list of conditions and the following disclaimer in the documentation and/or other\n"
"materials provided with the distribution.\n"
"\n"
"Neither the name of the UnaMesa Association nor the names of its contributors may be\n"
"used to endorse or promote products derived from this software without specific\n"
"prior written permission.\n"
"\n"
"THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS 'AS IS' AND ANY\n"
"EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES\n"
"OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT\n"
"SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,\n"
"INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED\n"
"TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR\n"
"BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN\n"
"CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN\n"
"ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH\n"
"DAMAGE.\n"
"\" />\n"
"<!--PRE-HEAD-START-->\n"
"<!--{{{-->\n"
"<link rel='alternate' type='application/rss+xml' title='RSS' href='index.xml' />\n"
"<!--}}}-->\n"
"<!--PRE-HEAD-END-->\n"
"<title>\n"
"\n"
"</title>\n"
"<style id=\"styleArea\" type=\"text/css\">\n"
"#saveTest {display:none;}\n"
"#messageArea {display:none;}\n"
"#copyright {display:none;}\n"
"#storeArea {display:none;}\n"
"#storeArea div {padding:0.5em; margin:1em 0em 0em 0em; border-color:#fff #666 #444 #ddd; border-style:solid; border-width:2px; overflow:auto;}\n"
"#shadowArea {display:none;}\n"
"#javascriptWarning {width:100%; text-align:center; font-weight:bold; background-color:#dd1100; color:#fff; padding:1em 0em;}\n"
"</style>\n"
"<!--POST-HEAD-START-->\n"
"<!--POST-HEAD-END-->\n"
"</head>\n"
"<body onload=\"main();\" onunload=\"if(window.unload) unload();\">\n"
"<!--PRE-BODY-START-->\n"
"<!--PRE-BODY-END-->\n"
"<div id=\"copyright\">\n"
"Welcome to TiddlyWiki created by Jeremy Ruston, Copyright &copy; 2007 UnaMesa Association\n"
"</div>\n"
"<noscript>\n"
"<div id=\"javascriptWarning\">\n"
"This page requires JavaScript to function properly.<br /><br />If you are using Microsoft Internet Explorer you may need to click on the yellow bar above and select 'Allow Blocked Content'. You must then click 'Yes' on the following security warning.\n"
"</div>\n"
"</noscript>\n"
"<div id=\"saveTest\"></div>\n"
"<div id=\"backstageCloak\"></div>\n"
"<div id=\"backstageButton\"></div>\n"
"<div id=\"backstageArea\"><div id=\"backstageToolbar\"></div></div>\n"
"<div id=\"backstage\">\n"
"	<div id=\"backstagePanel\"></div>\n"
"</div>\n"
"<div id=\"contentWrapper\"></div>\n"
"<div id=\"contentStash\"></div>\n"
"<div id=\"shadowArea\">\n"
"<div title=\"MarkupPreHead\">\n"
"<pre>&lt;!--{{{--&gt;\n"
"&lt;link rel='alternate' type='application/rss+xml' title='RSS' href='index.xml' /&gt;\n"
"&lt;!--}}}--&gt;\n"
"</pre>\n"
"</div>\n"
"<div title=\"ColorPalette\">\n"
"<pre>Background: #fff\n"
"Foreground: #000\n"
"PrimaryPale: #8cf\n"
"PrimaryLight: #18f\n"
"PrimaryMid: #04b\n"
"PrimaryDark: #014\n"
"SecondaryPale: #ffc\n"
"SecondaryLight: #fe8\n"
"SecondaryMid: #db4\n"
"SecondaryDark: #841\n"
"TertiaryPale: #eee\n"
"TertiaryLight: #ccc\n"
"TertiaryMid: #999\n"
"TertiaryDark: #666\n"
"Error: #f88\n"
"</pre>\n"
"</div>\n"
"<div title=\"StyleSheetColors\">\n"
"<pre>/*{{{*/\n"
"body {background:[[ColorPalette::Background]]; color:[[ColorPalette::Foreground]];}\n"
"\n"
"a {color:[[ColorPalette::PrimaryMid]];}\n"
"a:hover {background-color:[[ColorPalette::PrimaryMid]]; color:[[ColorPalette::Background]];}\n"
"a img {border:0;}\n"
"\n"
"h1,h2,h3,h4,h5,h6 {color:[[ColorPalette::SecondaryDark]]; background:transparent;}\n"
"h1 {border-bottom:2px solid [[ColorPalette::TertiaryLight]];}\n"
"h2,h3 {border-bottom:1px solid [[ColorPalette::TertiaryLight]];}\n"
"\n"
".button {color:[[ColorPalette::PrimaryDark]]; border:1px solid [[ColorPalette::Background]];}\n"
".button:hover {color:[[ColorPalette::PrimaryDark]]; background:[[ColorPalette::SecondaryLight]]; border-color:[[ColorPalette::SecondaryMid]];}\n"
".button:active {color:[[ColorPalette::Background]]; background:[[ColorPalette::SecondaryMid]]; border:1px solid [[ColorPalette::SecondaryDark]];}\n"
"\n"
".header {background:[[ColorPalette::PrimaryMid]];}\n"
".headerShadow {color:[[ColorPalette::Foreground]];}\n"
".headerShadow a {font-weight:normal; color:[[ColorPalette::Foreground]];}\n"
".headerForeground {color:[[ColorPalette::Background]];}\n"
".headerForeground a {font-weight:normal; color:[[ColorPalette::PrimaryPale]];}\n"
"\n"
".tabSelected{color:[[ColorPalette::PrimaryDark]];\n"
"	background:[[ColorPalette::TertiaryPale]];\n"
"	border-left:1px solid [[ColorPalette::TertiaryLight]];\n"
"	border-top:1px solid [[ColorPalette::TertiaryLight]];\n"
"	border-right:1px solid [[ColorPalette::TertiaryLight]];\n"
"}\n"
".tabUnselected {color:[[ColorPalette::Background]]; background:[[ColorPalette::TertiaryMid]];}\n"
".tabContents {color:[[ColorPalette::PrimaryDark]]; background:[[ColorPalette::TertiaryPale]]; border:1px solid [[ColorPalette::TertiaryLight]];}\n"
".tabContents .button {border:0;}\n"
"\n"
"#sidebar {}\n"
"#sidebarOptions input {border:1px solid [[ColorPalette::PrimaryMid]];}\n"
"#sidebarOptions .sliderPanel {background:[[ColorPalette::PrimaryPale]];}\n"
"#sidebarOptions .sliderPanel a {border:none;color:[[ColorPalette::PrimaryMid]];}\n"
"#sidebarOptions .sliderPanel a:hover {color:[[ColorPalette::Background]]; background:[[ColorPalette::PrimaryMid]];}\n"
"#sidebarOptions .sliderPanel a:active {color:[[ColorPalette::PrimaryMid]]; background:[[ColorPalette::Background]];}\n"
"\n"
".wizard {background:[[ColorPalette::PrimaryPale]]; border:1px solid [[ColorPalette::PrimaryMid]];}\n"
".wizard h1 {color:[[ColorPalette::PrimaryDark]]; border:none;}\n"
".wizard h2 {color:[[ColorPalette::Foreground]]; border:none;}\n"
".wizardStep {background:[[ColorPalette::Background]]; color:[[ColorPalette::Foreground]];\n"
"	border:1px solid [[ColorPalette::PrimaryMid]];}\n"
".wizardStep.wizardStepDone {background:[[ColorPalette::TertiaryLight]];}\n"
".wizardFooter {background:[[ColorPalette::PrimaryPale]];}\n"
".wizardFooter .status {background:[[ColorPalette::PrimaryDark]]; color:[[ColorPalette::Background]];}\n"
".wizard .button {color:[[ColorPalette::Foreground]]; background:[[ColorPalette::SecondaryLight]]; border: 1px solid;\n"
"	border-color:[[ColorPalette::SecondaryPale]] [[ColorPalette::SecondaryDark]] [[ColorPalette::SecondaryDark]] [[ColorPalette::SecondaryPale]];}\n"
".wizard .button:hover {color:[[ColorPalette::Foreground]]; background:[[ColorPalette::Background]];}\n"
".wizard .button:active {color:[[ColorPalette::Background]]; background:[[ColorPalette::Foreground]]; border: 1px solid;\n"
"	border-color:[[ColorPalette::PrimaryDark]] [[ColorPalette::PrimaryPale]] [[ColorPalette::PrimaryPale]] [[ColorPalette::PrimaryDark]];}\n"
"\n"
".wizard .notChanged {background:transparent;}\n"
".wizard .changedLocally {background:#80ff80;}\n"
".wizard .changedServer {background:#8080ff;}\n"
".wizard .changedBoth {background:#ff8080;}\n"
".wizard .notFound {background:#ffff80;}\n"
".wizard .putToServer {background:#ff80ff;}\n"
".wizard .gotFromServer {background:#80ffff;}\n"
"\n"
"#messageArea {border:1px solid [[ColorPalette::SecondaryMid]]; background:[[ColorPalette::SecondaryLight]]; color:[[ColorPalette::Foreground]];}\n"
"#messageArea .button {color:[[ColorPalette::PrimaryMid]]; background:[[ColorPalette::SecondaryPale]]; border:none;}\n"
"\n"
".popupTiddler {background:[[ColorPalette::TertiaryPale]]; border:2px solid [[ColorPalette::TertiaryMid]];}\n"
"\n"
".popup {background:[[ColorPalette::TertiaryPale]]; color:[[ColorPalette::TertiaryDark]]; border-left:1px solid [[ColorPalette::TertiaryMid]]; border-top:1px solid [[ColorPalette::TertiaryMid]]; border-right:2px solid [[ColorPalette::TertiaryDark]]; border-bottom:2px solid [[ColorPalette::TertiaryDark]];}\n"
".popup hr {color:[[ColorPalette::PrimaryDark]]; background:[[ColorPalette::PrimaryDark]]; border-bottom:1px;}\n"
".popup li.disabled {color:[[ColorPalette::TertiaryMid]];}\n"
".popup li a, .popup li a:visited {color:[[ColorPalette::Foreground]]; border: none;}\n"
".popup li a:hover {background:[[ColorPalette::SecondaryLight]]; color:[[ColorPalette::Foreground]]; border: none;}\n"
".popup li a:active {background:[[ColorPalette::SecondaryPale]]; color:[[ColorPalette::Foreground]]; border: none;}\n"
".popupHighlight {background:[[ColorPalette::Background]]; color:[[ColorPalette::Foreground]];}\n"
".listBreak div {border-bottom:1px solid [[ColorPalette::TertiaryDark]];}\n"
"\n"
".tiddler .defaultCommand {font-weight:bold;}\n"
"\n"
".shadow .title {color:[[ColorPalette::TertiaryDark]];}\n"
"\n"
".title {color:[[ColorPalette::SecondaryDark]];}\n"
".subtitle {color:[[ColorPalette::TertiaryDark]];}\n"
"\n"
".toolbar {color:[[ColorPalette::PrimaryMid]];}\n"
".toolbar a {color:[[ColorPalette::TertiaryLight]];}\n"
".selected .toolbar a {color:[[ColorPalette::TertiaryMid]];}\n"
".selected .toolbar a:hover {color:[[ColorPalette::Foreground]];}\n"
"\n"
".tagging, .tagged {border:1px solid [[ColorPalette::TertiaryPale]]; background-color:[[ColorPalette::TertiaryPale]];}\n"
".selected .tagging, .selected .tagged {background-color:[[ColorPalette::TertiaryLight]]; border:1px solid [[ColorPalette::TertiaryMid]];}\n"
".tagging .listTitle, .tagged .listTitle {color:[[ColorPalette::PrimaryDark]];}\n"
".tagging .button, .tagged .button {border:none;}\n"
"\n"
".footer {color:[[ColorPalette::TertiaryLight]];}\n"
".selected .footer {color:[[ColorPalette::TertiaryMid]];}\n"
"\n"
".sparkline {background:[[ColorPalette::PrimaryPale]]; border:0;}\n"
".sparktick {background:[[ColorPalette::PrimaryDark]];}\n"
"\n"
".error, .errorButton {color:[[ColorPalette::Foreground]]; background:[[ColorPalette::Error]];}\n"
".warning {color:[[ColorPalette::Foreground]]; background:[[ColorPalette::SecondaryPale]];}\n"
".lowlight {background:[[ColorPalette::TertiaryLight]];}\n"
"\n"
".zoomer {background:none; color:[[ColorPalette::TertiaryMid]]; border:3px solid [[ColorPalette::TertiaryMid]];}\n"
"\n"
".imageLink, #displayArea .imageLink {background:transparent;}\n"
"\n"
".annotation {background:[[ColorPalette::SecondaryLight]]; color:[[ColorPalette::Foreground]]; border:2px solid [[ColorPalette::SecondaryMid]];}\n"
"\n"
".viewer .listTitle {list-style-type:none; margin-left:-2em;}\n"
".viewer .button {border:1px solid [[ColorPalette::SecondaryMid]];}\n"
".viewer blockquote {border-left:3px solid [[ColorPalette::TertiaryDark]];}\n"
"\n"
".viewer table, table.twtable {border:2px solid [[ColorPalette::TertiaryDark]];}\n"
".viewer th, .viewer thead td, .twtable th, .twtable thead td {background:[[ColorPalette::SecondaryMid]]; border:1px solid [[ColorPalette::TertiaryDark]]; color:[[ColorPalette::Background]];}\n"
".viewer td, .viewer tr, .twtable td, .twtable tr {border:1px solid [[ColorPalette::TertiaryDark]];}\n"
"\n"
".viewer pre {border:1px solid [[ColorPalette::SecondaryLight]]; background:[[ColorPalette::SecondaryPale]];}\n"
".viewer code {color:[[ColorPalette::SecondaryDark]];}\n"
".viewer hr {border:0; border-top:dashed 1px [[ColorPalette::TertiaryDark]]; color:[[ColorPalette::TertiaryDark]];}\n"
"\n"
".highlight, .marked {background:[[ColorPalette::SecondaryLight]];}\n"
"\n"
".editor input {border:1px solid [[ColorPalette::PrimaryMid]];}\n"
".editor textarea {border:1px solid [[ColorPalette::PrimaryMid]]; width:100%;}\n"
".editorFooter {color:[[ColorPalette::TertiaryMid]];}\n"
"\n"
"#backstageArea {background:[[ColorPalette::Foreground]]; color:[[ColorPalette::TertiaryMid]];}\n"
"#backstageArea a {background:[[ColorPalette::Foreground]]; color:[[ColorPalette::Background]]; border:none;}\n"
"#backstageArea a:hover {background:[[ColorPalette::SecondaryLight]]; color:[[ColorPalette::Foreground]]; }\n"
"#backstageArea a.backstageSelTab {background:[[ColorPalette::Background]]; color:[[ColorPalette::Foreground]];}\n"
"#backstageButton a {background:none; color:[[ColorPalette::Background]]; border:none;}\n"
"#backstageButton a:hover {background:[[ColorPalette::Foreground]]; color:[[ColorPalette::Background]]; border:none;}\n"
"#backstagePanel {background:[[ColorPalette::Background]]; border-color: [[ColorPalette::Background]] [[ColorPalette::TertiaryDark]] [[ColorPalette::TertiaryDark]] [[ColorPalette::TertiaryDark]];}\n"
".backstagePanelFooter .button {border:none; color:[[ColorPalette::Background]];}\n"
".backstagePanelFooter .button:hover {color:[[ColorPalette::Foreground]];}\n"
"#backstageCloak {background:[[ColorPalette::Foreground]]; opacity:0.6; filter:'alpha(opacity=60)';}\n"
"/*}}}*/</pre>\n"
"</div>\n"
"<div title=\"StyleSheetLayout\">\n"
"<pre>/*{{{*/\n"
"* html .tiddler {height:1%;}\n"
"\n"
"body {font-size:.75em; font-family:arial,helvetica; margin:0; padding:0;}\n"
"\n"
"h1,h2,h3,h4,h5,h6 {font-weight:bold; text-decoration:none;}\n"
"h1,h2,h3 {padding-bottom:1px; margin-top:1.2em;margin-bottom:0.3em;}\n"
"h4,h5,h6 {margin-top:1em;}\n"
"h1 {font-size:1.35em;}\n"
"h2 {font-size:1.25em;}\n"
"h3 {font-size:1.1em;}\n"
"h4 {font-size:1em;}\n"
"h5 {font-size:.9em;}\n"
"\n"
"hr {height:1px;}\n"
"\n"
"a {text-decoration:none;}\n"
"\n"
"dt {font-weight:bold;}\n"
"\n"
"ol {list-style-type:decimal;}\n"
"ol ol {list-style-type:lower-alpha;}\n"
"ol ol ol {list-style-type:lower-roman;}\n"
"ol ol ol ol {list-style-type:decimal;}\n"
"ol ol ol ol ol {list-style-type:lower-alpha;}\n"
"ol ol ol ol ol ol {list-style-type:lower-roman;}\n"
"ol ol ol ol ol ol ol {list-style-type:decimal;}\n"
"\n"
".txtOptionInput {width:11em;}\n"
"\n"
"#contentWrapper .chkOptionInput {border:0;}\n"
"\n"
".externalLink {text-decoration:underline;}\n"
"\n"
".indent {margin-left:3em;}\n"
".outdent {margin-left:3em; text-indent:-3em;}\n"
"code.escaped {white-space:nowrap;}\n"
"\n"
".tiddlyLinkExisting {font-weight:bold;}\n"
".tiddlyLinkNonExisting {font-style:italic;}\n"
"\n"
"/* the 'a' is required for IE, otherwise it renders the whole tiddler in bold */\n"
"a.tiddlyLinkNonExisting.shadow {font-weight:bold;}\n"
"\n"
"#mainMenu .tiddlyLinkExisting,\n"
"	#mainMenu .tiddlyLinkNonExisting,\n"
"	#sidebarTabs .tiddlyLinkNonExisting {font-weight:normal; font-style:normal;}\n"
"#sidebarTabs .tiddlyLinkExisting {font-weight:bold; font-style:normal;}\n"
"\n"
".header {position:relative;}\n"
".header a:hover {background:transparent;}\n"
".headerShadow {position:relative; padding:4.5em 0 1em 1em; left:-1px; top:-1px;}\n"
".headerForeground {position:absolute; padding:4.5em 0 1em 1em; left:0px; top:0px;}\n"
"\n"
".siteTitle {font-size:3em;}\n"
".siteSubtitle {font-size:1.2em;}\n"
"\n"
"#mainMenu {position:absolute; left:0; width:10em; text-align:right; line-height:1.6em; padding:1.5em 0.5em 0.5em 0.5em; font-size:1.1em;}\n"
"\n"
"#sidebar {position:absolute; right:3px; width:16em; font-size:.9em;}\n"
"#sidebarOptions {padding-top:0.3em;}\n"
"#sidebarOptions a {margin:0 0.2em; padding:0.2em 0.3em; display:block;}\n"
"#sidebarOptions input {margin:0.4em 0.5em;}\n"
"#sidebarOptions .sliderPanel {margin-left:1em; padding:0.5em; font-size:.85em;}\n"
"#sidebarOptions .sliderPanel a {font-weight:bold; display:inline; padding:0;}\n"
"#sidebarOptions .sliderPanel input {margin:0 0 0.3em 0;}\n"
"#sidebarTabs .tabContents {width:15em; overflow:hidden;}\n"
"\n"
".wizard {padding:0.1em 1em 0 2em;}\n"
".wizard h1 {font-size:2em; font-weight:bold; background:none; padding:0; margin:0.4em 0 0.2em;}\n"
".wizard h2 {font-size:1.2em; font-weight:bold; background:none; padding:0; margin:0.4em 0 0.2em;}\n"
".wizardStep {padding:1em 1em 1em 1em;}\n"
".wizard .button {margin:0.5em 0 0; font-size:1.2em;}\n"
".wizardFooter {padding:0.8em 0.4em 0.8em 0;}\n"
".wizardFooter .status {padding:0 0.4em; margin-left:1em;}\n"
".wizard .button {padding:0.1em 0.2em;}\n"
"\n"
"#messageArea {position:fixed; top:2em; right:0; margin:0.5em; padding:0.5em; z-index:2000; _position:absolute;}\n"
".messageToolbar {display:block; text-align:right; padding:0.2em;}\n"
"#messageArea a {text-decoration:underline;}\n"
"\n"
".tiddlerPopupButton {padding:0.2em;}\n"
".popupTiddler {position: absolute; z-index:300; padding:1em; margin:0;}\n"
"\n"
".popup {position:absolute; z-index:300; font-size:.9em; padding:0; list-style:none; margin:0;}\n"
".popup .popupMessage {padding:0.4em;}\n"
".popup hr {display:block; height:1px; width:auto; padding:0; margin:0.2em 0;}\n"
".popup li.disabled {padding:0.4em;}\n"
".popup li a {display:block; padding:0.4em; font-weight:normal; cursor:pointer;}\n"
".listBreak {font-size:1px; line-height:1px;}\n"
".listBreak div {margin:2px 0;}\n"
"\n"
".tabset {padding:1em 0 0 0.5em;}\n"
".tab {margin:0 0 0 0.25em; padding:2px;}\n"
".tabContents {padding:0.5em;}\n"
".tabContents ul, .tabContents ol {margin:0; padding:0;}\n"
".txtMainTab .tabContents li {list-style:none;}\n"
".tabContents li.listLink { margin-left:.75em;}\n"
"\n"
"#contentWrapper {display:block;}\n"
"#splashScreen {display:none;}\n"
"\n"
"#displayArea {margin:1em 17em 0 14em;}\n"
"\n"
".toolbar {text-align:right; font-size:.9em;}\n"
"\n"
".tiddler {padding:1em 1em 0;}\n"
"\n"
".missing .viewer,.missing .title {font-style:italic;}\n"
"\n"
".title {font-size:1.6em; font-weight:bold;}\n"
"\n"
".missing .subtitle {display:none;}\n"
".subtitle {font-size:1.1em;}\n"
"\n"
".tiddler .button {padding:0.2em 0.4em;}\n"
"\n"
".tagging {margin:0.5em 0.5em 0.5em 0; float:left; display:none;}\n"
".isTag .tagging {display:block;}\n"
".tagged {margin:0.5em; float:right;}\n"
".tagging, .tagged {font-size:0.9em; padding:0.25em;}\n"
".tagging ul, .tagged ul {list-style:none; margin:0.25em; padding:0;}\n"
".tagClear {clear:both;}\n"
"\n"
".footer {font-size:.9em;}\n"
".footer li {display:inline;}\n"
"\n"
".annotation {padding:0.5em; margin:0.5em;}\n"
"\n"
"* html .viewer pre {width:99%; padding:0 0 1em 0;}\n"
".viewer {line-height:1.4em; padding-top:0.5em;}\n"
".viewer .button {margin:0 0.25em; padding:0 0.25em;}\n"
".viewer blockquote {line-height:1.5em; padding-left:0.8em;margin-left:2.5em;}\n"
".viewer ul, .viewer ol {margin-left:0.5em; padding-left:1.5em;}\n"
"\n"
".viewer table, table.twtable {border-collapse:collapse; margin:0.8em 1.0em;}\n"
".viewer th, .viewer td, .viewer tr,.viewer caption,.twtable th, .twtable td, .twtable tr,.twtable caption {padding:3px;}\n"
"table.listView {font-size:0.85em; margin:0.8em 1.0em;}\n"
"table.listView th, table.listView td, table.listView tr {padding:0px 3px 0px 3px;}\n"
"\n"
".viewer pre {padding:0.5em; margin-left:0.5em; font-size:1.2em; line-height:1.4em; overflow:auto;}\n"
".viewer code {font-size:1.2em; line-height:1.4em;}\n"
"\n"
".editor {font-size:1.1em;}\n"
".editor input, .editor textarea {display:block; width:100%; font:inherit;}\n"
".editorFooter {padding:0.25em 0; font-size:.9em;}\n"
".editorFooter .button {padding-top:0px; padding-bottom:0px;}\n"
"\n"
".fieldsetFix {border:0; padding:0; margin:1px 0px;}\n"
"\n"
".sparkline {line-height:1em;}\n"
".sparktick {outline:0;}\n"
"\n"
".zoomer {font-size:1.1em; position:absolute; overflow:hidden;}\n"
".zoomer div {padding:1em;}\n"
"\n"
"* html #backstage {width:99%;}\n"
"* html #backstageArea {width:99%;}\n"
"#backstageArea {display:none; position:relative; overflow: hidden; z-index:150; padding:0.3em 0.5em;}\n"
"#backstageToolbar {position:relative;}\n"
"#backstageArea a {font-weight:bold; margin-left:0.5em; padding:0.3em 0.5em;}\n"
"#backstageButton {display:none; position:absolute; z-index:175; top:0; right:0;}\n"
"#backstageButton a {padding:0.1em 0.4em; margin:0.1em;}\n"
"#backstage {position:relative; width:100%; z-index:50;}\n"
"#backstagePanel {display:none; z-index:100; position:absolute; width:90%; margin-left:3em; padding:1em;}\n"
".backstagePanelFooter {padding-top:0.2em; float:right;}\n"
".backstagePanelFooter a {padding:0.2em 0.4em;}\n"
"#backstageCloak {display:none; z-index:20; position:absolute; width:100%; height:100px;}\n"
"\n"
".whenBackstage {display:none;}\n"
".backstageVisible .whenBackstage {display:block;}\n"
"/*}}}*/\n"
"</pre>\n"
"</div>\n"
"<div title=\"StyleSheetLocale\">\n"
"<pre>/***\n"
"StyleSheet for use when a translation requires any css style changes.\n"
"This StyleSheet can be used directly by languages such as Chinese, Japanese and Korean which need larger font sizes.\n"
"***/\n"
"/*{{{*/\n"
"body {font-size:0.8em;}\n"
"#sidebarOptions {font-size:1.05em;}\n"
"#sidebarOptions a {font-style:normal;}\n"
"#sidebarOptions .sliderPanel {font-size:0.95em;}\n"
".subtitle {font-size:0.8em;}\n"
".viewer table.listView {font-size:0.95em;}\n"
"/*}}}*/</pre>\n"
"</div>\n"
"<div title=\"StyleSheetPrint\">\n"
"<pre>/*{{{*/\n"
"@media print {\n"
"#mainMenu, #sidebar, #messageArea, .toolbar, #backstageButton, #backstageArea {display: none !important;}\n"
"#displayArea {margin: 1em 1em 0em;}\n"
"noscript {display:none;} /* Fixes a feature in Firefox 1.5.0.2 where print preview displays the noscript content */\n"
"}\n"
"/*}}}*/</pre>\n"
"</div>\n"
"<div title=\"PageTemplate\">\n"
"<pre>&lt;!--{{{--&gt;\n"
"&lt;div class='header' macro='gradient vert [[ColorPalette::PrimaryLight]] [[ColorPalette::PrimaryMid]]'&gt;\n"
"&lt;div class='headerShadow'&gt;\n"
"&lt;span class='siteTitle' refresh='content' tiddler='SiteTitle'&gt;&lt;/span&gt;&amp;nbsp;\n"
"&lt;span class='siteSubtitle' refresh='content' tiddler='SiteSubtitle'&gt;&lt;/span&gt;\n"
"&lt;/div&gt;\n"
"&lt;div class='headerForeground'&gt;\n"
"&lt;span class='siteTitle' refresh='content' tiddler='SiteTitle'&gt;&lt;/span&gt;&amp;nbsp;\n"
"&lt;span class='siteSubtitle' refresh='content' tiddler='SiteSubtitle'&gt;&lt;/span&gt;\n"
"&lt;/div&gt;\n"
"&lt;/div&gt;\n"
"&lt;div id='mainMenu' refresh='content' tiddler='MainMenu'&gt;&lt;/div&gt;\n"
"&lt;div id='sidebar'&gt;\n"
"&lt;div id='sidebarOptions' refresh='content' tiddler='SideBarOptions'&gt;&lt;/div&gt;\n"
"&lt;div id='sidebarTabs' refresh='content' force='true' tiddler='SideBarTabs'&gt;&lt;/div&gt;\n"
"&lt;/div&gt;\n"
"&lt;div id='displayArea'&gt;\n"
"&lt;div id='messageArea'&gt;&lt;/div&gt;\n"
"&lt;div id='tiddlerDisplay'&gt;&lt;/div&gt;\n"
"&lt;/div&gt;\n"
"&lt;!--}}}--&gt;</pre>\n"
"</div>\n"
"<div title=\"ViewTemplate\">\n"
"<pre>&lt;!--{{{--&gt;\n"
"&lt;div class='toolbar' macro='toolbar [[ToolbarCommands::ViewToolbar]]'&gt;&lt;/div&gt;\n"
"&lt;div class='title' macro='view title'&gt;&lt;/div&gt;\n"
"&lt;div class='subtitle'&gt;&lt;span macro='view modifier link'&gt;&lt;/span&gt;, &lt;span macro='view modified date'&gt;&lt;/span&gt; (&lt;span macro='message views.wikified.createdPrompt'&gt;&lt;/span&gt; &lt;span macro='view created date'&gt;&lt;/span&gt;)&lt;/div&gt;\n"
"&lt;div class='tagging' macro='tagging'&gt;&lt;/div&gt;\n"
"&lt;div class='tagged' macro='tags'&gt;&lt;/div&gt;\n"
"&lt;div class='viewer' macro='view text wikified'&gt;&lt;/div&gt;\n"
"&lt;div class='tagClear'&gt;&lt;/div&gt;\n"
"&lt;!--}}}--&gt;</pre>\n"
"</div>\n"
"<div title=\"EditTemplate\">\n"
"<pre>&lt;!--{{{--&gt;\n"
"&lt;div class='toolbar' macro='toolbar [[ToolbarCommands::EditToolbar]]'&gt;&lt;/div&gt;\n"
"&lt;div class='title' macro='view title'&gt;&lt;/div&gt;\n"
"&lt;div class='editor' macro='edit title'&gt;&lt;/div&gt;\n"
"&lt;div macro='annotations'&gt;&lt;/div&gt;\n"
"&lt;div class='editor' macro='edit text'&gt;&lt;/div&gt;\n"
"&lt;div class='editor' macro='edit tags'&gt;&lt;/div&gt;&lt;div class='editorFooter'&gt;&lt;span macro='message views.editor.tagPrompt'&gt;&lt;/span&gt;&lt;span macro='tagChooser excludeLists'&gt;&lt;/span&gt;&lt;/div&gt;\n"
"&lt;!--}}}--&gt;</pre>\n"
"</div>\n"
"<div title=\"GettingStarted\">\n"
"<pre>To get started with this blank [[TiddlyWiki]], you'll need to modify the following tiddlers:\n"
"* [[SiteTitle]] &amp; [[SiteSubtitle]]: The title and subtitle of the site, as shown above (after saving, they will also appear in the browser title bar)\n"
"* [[MainMenu]]: The menu (usually on the left)\n"
"* [[DefaultTiddlers]]: Contains the names of the tiddlers that you want to appear when the TiddlyWiki is opened\n"
"You'll also need to enter your username for signing your edits: &lt;&lt;option txtUserName&gt;&gt;</pre>\n"
"</div>\n"
"<div title=\"OptionsPanel\">\n"
"<pre>These [[InterfaceOptions]] for customising [[TiddlyWiki]] are saved in your browser\n"
"\n"
"Your username for signing your edits. Write it as a [[WikiWord]] (eg [[JoeBloggs]])\n"
"\n"
"&lt;&lt;option txtUserName&gt;&gt;\n"
"&lt;&lt;option chkSaveBackups&gt;&gt; [[SaveBackups]]\n"
"&lt;&lt;option chkAutoSave&gt;&gt; [[AutoSave]]\n"
"&lt;&lt;option chkRegExpSearch&gt;&gt; [[RegExpSearch]]\n"
"&lt;&lt;option chkCaseSensitiveSearch&gt;&gt; [[CaseSensitiveSearch]]\n"
"&lt;&lt;option chkAnimate&gt;&gt; [[EnableAnimations]]\n"
"\n"
"----\n"
"Also see [[AdvancedOptions]]</pre>\n"
"</div>\n"
"<div title=\"ImportTiddlers\">\n"
"<pre>&lt;&lt;importTiddlers&gt;&gt;</pre>\n"
"</div>\n"
"</div>\n"
"<!--POST-SHADOWAREA-->\n"
"<div id=\"storeArea\">\n"
"</div>\n"
"<!--POST-STOREAREA-->\n"
"<!--POST-BODY-START-->\n"
"<!--POST-BODY-END-->\n"
"<script id=\"jsArea\" type=\"text/javascript\">\n"
"//<![CDATA[\n"
"//\n"
"// Please note:\n"
"//\n"
"// * This code is designed to be readable but for compactness it only includes brief comments. You can see fuller comments\n"
"//   in the project Subversion repository at http://svn.tiddlywiki.org/Trunk/core/\n"
"//\n"
"// * You should never need to modify this source code directly. TiddlyWiki is carefully designed to allow deep customisation\n"
"//   without changing the core code. Please consult the development group at http://groups.google.com/group/TiddlyWikiDev\n"
"//\n"
"\n"
"//--\n"
"//-- Configuration repository\n"
"//--\n"
"\n"
"// Miscellaneous options\n"
"var config = {\n"
"	numRssItems: 20, // Number of items in the RSS feed\n"
"	animDuration: 400, // Duration of UI animations in milliseconds\n"
"	cascadeFast: 20, // Speed for cascade animations (higher == slower)\n"
"	cascadeSlow: 60, // Speed for EasterEgg cascade animations\n"
"	cascadeDepth: 5, // Depth of cascade animation\n"
"	locale: \"en\" // W3C language tag\n"
"};\n"
"\n"
"// Hashmap of alternative parsers for the wikifier\n"
"config.parsers = {};\n"
"\n"
"// Adaptors\n"
"config.adaptors = {};\n"
"config.defaultAdaptor = null;\n"
"\n"
"// Backstage tasks\n"
"config.tasks = {};\n"
"\n"
"// Annotations\n"
"config.annotations = {};\n"
"\n"
"// Custom fields to be automatically added to new tiddlers\n"
"config.defaultCustomFields = {};\n"
"\n"
"// Messages\n"
"config.messages = {\n"
"	messageClose: {},\n"
"	dates: {},\n"
"	tiddlerPopup: {}\n"
"};\n"
"\n"
"// Options that can be set in the options panel and/or cookies\n"
"config.options = {\n"
"	chkRegExpSearch: false,\n"
"	chkCaseSensitiveSearch: false,\n"
"	chkIncrementalSearch: true,\n"
"	chkAnimate: true,\n"
"	chkSaveBackups: true,\n"
"	chkAutoSave: false,\n"
"	chkGenerateAnRssFeed: false,\n"
"	chkSaveEmptyTemplate: false,\n"
"	chkOpenInNewWindow: true,\n"
"	chkToggleLinks: false,\n"
"	chkHttpReadOnly: true,\n"
"	chkForceMinorUpdate: false,\n"
"	chkConfirmDelete: true,\n"
"	chkInsertTabs: false,\n"
"	chkUsePreForStorage: true, // Whether to use <pre> format for storage\n"
"	chkDisplayInstrumentation: false,\n"
"	txtBackupFolder: \"\",\n"
"	txtEditorFocus: \"text\",\n"
"	txtMainTab: \"tabTimeline\",\n"
"	txtMoreTab: \"moreTabAll\",\n"
"	txtMaxEditRows: \"30\",\n"
"	txtFileSystemCharSet: \"UTF-8\",\n"
"	txtTheme: \"\"\n"
"	};\n"
"config.optionsDesc = {};\n"
"\n"
"// Default tiddler templates\n"
"var DEFAULT_VIEW_TEMPLATE = 1;\n"
"var DEFAULT_EDIT_TEMPLATE = 2;\n"
"config.tiddlerTemplates = {\n"
"	1: \"ViewTemplate\",\n"
"	2: \"EditTemplate\"\n"
"};\n"
"\n"
"// More messages (rather a legacy layout that should not really be like this)\n"
"config.views = {\n"
"	wikified: {\n"
"		tag: {}\n"
"	},\n"
"	editor: {\n"
"		tagChooser: {}\n"
"	}\n"
"};\n"
"\n"
"// Backstage tasks\n"
"config.backstageTasks = [\"save\",\"sync\",\"importTask\",\"tweak\",\"upgrade\",\"plugins\"];\n"
"\n"
"// Extensions\n"
"config.extensions = {};\n"
"\n"
"// Macros; each has a 'handler' member that is inserted later\n"
"config.macros = {\n"
"	today: {},\n"
"	version: {},\n"
"	search: {sizeTextbox: 15},\n"
"	tiddler: {},\n"
"	tag: {},\n"
"	tags: {},\n"
"	tagging: {},\n"
"	timeline: {},\n"
"	allTags: {},\n"
"	list: {\n"
"		all: {},\n"
"		missing: {},\n"
"		orphans: {},\n"
"		shadowed: {},\n"
"		touched: {},\n"
"		filter: {}\n"
"	},\n"
"	closeAll: {},\n"
"	permaview: {},\n"
"	saveChanges: {},\n"
"	slider: {},\n"
"	option: {},\n"
"	options: {},\n"
"	newTiddler: {},\n"
"	newJournal: {},\n"
"	tabs: {},\n"
"	gradient: {},\n"
"	message: {},\n"
"	view: {defaultView: \"text\"},\n"
"	edit: {},\n"
"	tagChooser: {},\n"
"	toolbar: {},\n"
"	plugins: {},\n"
"	refreshDisplay: {},\n"
"	importTiddlers: {},\n"
"	upgrade: {\n"
"		source: \"http://www.tiddlywiki.com/upgrade/\",\n"
"		backupExtension: \"pre.core.upgrade\"\n"
"	},\n"
"	sync: {},\n"
"	annotations: {}\n"
"};\n"
"\n"
"// Commands supported by the toolbar macro\n"
"config.commands = {\n"
"	closeTiddler: {},\n"
"	closeOthers: {},\n"
"	editTiddler: {},\n"
"	saveTiddler: {hideReadOnly: true},\n"
"	cancelTiddler: {},\n"
"	deleteTiddler: {hideReadOnly: true},\n"
"	permalink: {},\n"
"	references: {type: \"popup\"},\n"
"	jump: {type: \"popup\"},\n"
"	syncing: {type: \"popup\"},\n"
"	fields: {type: \"popup\"}\n"
"};\n"
"\n"
"// Browser detection... In a very few places, there's nothing else for it but to know what browser we're using.\n"
"config.userAgent = navigator.userAgent.toLowerCase();\n"
"config.browser = {\n"
"	isIE: config.userAgent.indexOf(\"msie\") != -1 && config.userAgent.indexOf(\"opera\") == -1,\n"
"	isGecko: config.userAgent.indexOf(\"gecko\") != -1,\n"
"	ieVersion: /MSIE (\\d.\\d)/i.exec(config.userAgent), // config.browser.ieVersion[1], if it exists, will be the IE version string, eg \"6.0\"\n"
"	isSafari: config.userAgent.indexOf(\"applewebkit\") != -1,\n"
"	isBadSafari: !((new RegExp(\"[\\u0150\\u0170]\",\"g\")).test(\"\\u0150\")),\n"
"	firefoxDate: /gecko\\/(\\d{8})/i.exec(config.userAgent), // config.browser.firefoxDate[1], if it exists, will be Firefox release date as \"YYYYMMDD\"\n"
"	isOpera: config.userAgent.indexOf(\"opera\") != -1,\n"
"	isLinux: config.userAgent.indexOf(\"linux\") != -1,\n"
"	isUnix: config.userAgent.indexOf(\"x11\") != -1,\n"
"	isMac: config.userAgent.indexOf(\"mac\") != -1,\n"
"	isWindows: config.userAgent.indexOf(\"win\") != -1\n"
"};\n"
"\n"
"// Basic regular expressions\n"
"config.textPrimitives = {\n"
"	upperLetter: \"[A-Z\\u00c0-\\u00de\\u0150\\u0170]\",\n"
"	lowerLetter: \"[a-z0-9_\\\\-\\u00df-\\u00ff\\u0151\\u0171]\",\n"
"	anyLetter:   \"[A-Za-z0-9_\\\\-\\u00c0-\\u00de\\u00df-\\u00ff\\u0150\\u0170\\u0151\\u0171]\",\n"
"	anyLetterStrict: \"[A-Za-z0-9\\u00c0-\\u00de\\u00df-\\u00ff\\u0150\\u0170\\u0151\\u0171]\"\n"
"};\n"
"if(config.browser.isBadSafari) {\n"
"	config.textPrimitives = {\n"
"		upperLetter: \"[A-Z\\u00c0-\\u00de]\",\n"
"		lowerLetter: \"[a-z0-9_\\\\-\\u00df-\\u00ff]\",\n"
"		anyLetter:   \"[A-Za-z0-9_\\\\-\\u00c0-\\u00de\\u00df-\\u00ff]\",\n"
"		anyLetterStrict: \"[A-Za-z0-9\\u00c0-\\u00de\\u00df-\\u00ff]\"\n"
"	};\n"
"}\n"
"config.textPrimitives.sliceSeparator = \"::\";\n"
"config.textPrimitives.sectionSeparator = \"##\";\n"
"config.textPrimitives.urlPattern = \"(?:file|http|https|mailto|ftp|irc|news|data):[^\\\\s'\\\"]+(?:/|\\\\b)\";\n"
"config.textPrimitives.unWikiLink = \"~\";\n"
"config.textPrimitives.wikiLink = \"(?:(?:\" + config.textPrimitives.upperLetter + \"+\" +\n"
"	config.textPrimitives.lowerLetter + \"+\" +\n"
"	config.textPrimitives.upperLetter +\n"
"	config.textPrimitives.anyLetter + \"*)|(?:\" +\n"
"	config.textPrimitives.upperLetter + \"{2,}\" +\n"
"	config.textPrimitives.lowerLetter + \"+))\";\n"
"\n"
"config.textPrimitives.cssLookahead = \"(?:(\" + config.textPrimitives.anyLetter + \"+)\\\\(([^\\\\)\\\\|\\\\n]+)(?:\\\\):))|(?:(\" + config.textPrimitives.anyLetter + \"+):([^;\\\\|\\\\n]+);)\";\n"
"config.textPrimitives.cssLookaheadRegExp = new RegExp(config.textPrimitives.cssLookahead,\"mg\");\n"
"\n"
"config.textPrimitives.brackettedLink = \"\\\\[\\\\[([^\\\\]]+)\\\\]\\\\]\";\n"
"config.textPrimitives.titledBrackettedLink = \"\\\\[\\\\[([^\\\\[\\\\]\\\\|]+)\\\\|([^\\\\[\\\\]\\\\|]+)\\\\]\\\\]\";\n"
"config.textPrimitives.tiddlerForcedLinkRegExp = new RegExp(\"(?:\" + config.textPrimitives.titledBrackettedLink + \")|(?:\" +\n"
"	config.textPrimitives.brackettedLink + \")|(?:\" +\n"
"	config.textPrimitives.urlPattern + \")\",\"mg\");\n"
"config.textPrimitives.tiddlerAnyLinkRegExp = new RegExp(\"(\"+ config.textPrimitives.wikiLink + \")|(?:\" +\n"
"	config.textPrimitives.titledBrackettedLink + \")|(?:\" +\n"
"	config.textPrimitives.brackettedLink + \")|(?:\" +\n"
"	config.textPrimitives.urlPattern + \")\",\"mg\");\n"
"\n"
"config.glyphs = {\n"
"	browsers: [\n"
"		function() {return config.browser.isIE;},\n"
"		function() {return true;}\n"
"	],\n"
"	currBrowser: null,\n"
"	codes: {\n"
"		downTriangle: [\"\\u25BC\",\"\\u25BE\"],\n"
"		downArrow: [\"\\u2193\",\"\\u2193\"],\n"
"		bentArrowLeft: [\"\\u2190\",\"\\u21A9\"],\n"
"		bentArrowRight: [\"\\u2192\",\"\\u21AA\"]\n"
"	}\n"
"};\n"
"\n"
"//--\n"
"//-- Shadow tiddlers\n"
"//--\n"
"\n"
"config.shadowTiddlers = {\n"
"	StyleSheet: \"\",\n"
"	MarkupPreHead: \"\",\n"
"	MarkupPostHead: \"\",\n"
"	MarkupPreBody: \"\",\n"
"	MarkupPostBody: \"\",\n"
"	TabTimeline: '<<timeline>>',\n"
"	TabAll: '<<list all>>',\n"
"	TabTags: '<<allTags excludeLists>>',\n"
"	TabMoreMissing: '<<list missing>>',\n"
"	TabMoreOrphans: '<<list orphans>>',\n"
"	TabMoreShadowed: '<<list shadowed>>',\n"
"	AdvancedOptions: '<<options>>',\n"
"	PluginManager: '<<plugins>>',\n"
"	ToolbarCommands: '|~ViewToolbar|closeTiddler closeOthers +editTiddler > fields syncing permalink references jump|\\n|~EditToolbar|+saveTiddler -cancelTiddler deleteTiddler|'\n"
"};\n"
"\n"
"//--\n"
"//-- Translateable strings\n"
"//--\n"
"\n"
"// Strings in \"double quotes\" should be translated; strings in 'single quotes' should be left alone\n"
"\n"
"merge(config.options,{\n"
"	txtUserName: \"YourName\"});\n"
"\n"
"merge(config.tasks,{\n"
"	save: {text: \"save\", tooltip: \"Save your changes to this TiddlyWiki\", action: saveChanges},\n"
"	sync: {text: \"sync\", tooltip: \"Synchronise changes with other TiddlyWiki files and servers\", content: '<<sync>>'},\n"
"	importTask: {text: \"import\", tooltip: \"Import tiddlers and plugins from other TiddlyWiki files and servers\", content: '<<importTiddlers>>'},\n"
"	tweak: {text: \"tweak\", tooltip: \"Tweak the appearance and behaviour of TiddlyWiki\", content: '<<options>>'},\n"
"	upgrade: {text: \"upgrade\", tooltip: \"Upgrade TiddlyWiki core code\", content: '<<upgrade>>'},\n"
"	plugins: {text: \"plugins\", tooltip: \"Manage installed plugins\", content: '<<plugins>>'}\n"
"});\n"
"\n"
"// Options that can be set in the options panel and/or cookies\n"
"merge(config.optionsDesc,{\n"
"	txtUserName: \"Username for signing your edits\",\n"
"	chkRegExpSearch: \"Enable regular expressions for searches\",\n"
"	chkCaseSensitiveSearch: \"Case-sensitive searching\",\n"
"	chkIncrementalSearch: \"Incremental key-by-key searching\",\n"
"	chkAnimate: \"Enable animations\",\n"
"	chkSaveBackups: \"Keep backup file when saving changes\",\n"
"	chkAutoSave: \"Automatically save changes\",\n"
"	chkGenerateAnRssFeed: \"Generate an RSS feed when saving changes\",\n"
"	chkSaveEmptyTemplate: \"Generate an empty template when saving changes\",\n"
"	chkOpenInNewWindow: \"Open external links in a new window\",\n"
"	chkToggleLinks: \"Clicking on links to open tiddlers causes them to close\",\n"
"	chkHttpReadOnly: \"Hide editing features when viewed over HTTP\",\n"
"	chkForceMinorUpdate: \"Don't update modifier username and date when editing tiddlers\",\n"
"	chkConfirmDelete: \"Require confirmation before deleting tiddlers\",\n"
"	chkInsertTabs: \"Use the tab key to insert tab characters instead of moving between fields\",\n"
"	txtBackupFolder: \"Name of folder to use for backups\",\n"
"	txtMaxEditRows: \"Maximum number of rows in edit boxes\",\n"
"	txtTheme: \"Name of the theme to use\",\n"
"	txtFileSystemCharSet: \"Default character set for saving changes (Firefox/Mozilla only)\"});\n"
"\n"
"merge(config.messages,{\n"
"	customConfigError: \"Problems were encountered loading plugins. See PluginManager for details\",\n"
"	pluginError: \"Error: %0\",\n"
"	pluginDisabled: \"Not executed because disabled via 'systemConfigDisable' tag\",\n"
"	pluginForced: \"Executed because forced via 'systemConfigForce' tag\",\n"
"	pluginVersionError: \"Not executed because this plugin needs a newer version of TiddlyWiki\",\n"
"	nothingSelected: \"Nothing is selected. You must select one or more items first\",\n"
"	savedSnapshotError: \"It appears that this TiddlyWiki has been incorrectly saved. Please see http://www.tiddlywiki.com/#Download for details\",\n"
"	subtitleUnknown: \"(unknown)\",\n"
"	undefinedTiddlerToolTip: \"The tiddler '%0' doesn't yet exist\",\n"
"	shadowedTiddlerToolTip: \"The tiddler '%0' doesn't yet exist, but has a pre-defined shadow value\",\n"
"	tiddlerLinkTooltip: \"%0 - %1, %2\",\n"
"	externalLinkTooltip: \"External link to %0\",\n"
"	noTags: \"There are no tagged tiddlers\",\n"
"	notFileUrlError: \"You need to save this TiddlyWiki to a file before you can save changes\",\n"
"	cantSaveError: \"It's not possible to save changes. Possible reasons include:\\n- your browser doesn't support saving (Firefox, Internet Explorer, Safari and Opera all work if properly configured)\\n- the pathname to your TiddlyWiki file contains illegal characters\\n- the TiddlyWiki HTML file has been moved or renamed\",\n"
"	invalidFileError: \"The original file '%0' does not appear to be a valid TiddlyWiki\",\n"
"	backupSaved: \"Backup saved\",\n"
"	backupFailed: \"Failed to save backup file\",\n"
"	rssSaved: \"RSS feed saved\",\n"
"	rssFailed: \"Failed to save RSS feed file\",\n"
"	emptySaved: \"Empty template saved\",\n"
"	emptyFailed: \"Failed to save empty template file\",\n"
"	mainSaved: \"Main TiddlyWiki file saved\",\n"
"	mainFailed: \"Failed to save main TiddlyWiki file. Your changes have not been saved\",\n"
"	macroError: \"Error in macro <<\\%0>>\",\n"
"	macroErrorDetails: \"Error while executing macro <<\\%0>>:\\n%1\",\n"
"	missingMacro: \"No such macro\",\n"
"	overwriteWarning: \"A tiddler named '%0' already exists. Choose OK to overwrite it\",\n"
"	unsavedChangesWarning: \"WARNING! There are unsaved changes in TiddlyWiki\\n\\nChoose OK to save\\nChoose CANCEL to discard\",\n"
"	confirmExit: \"--------------------------------\\n\\nThere are unsaved changes in TiddlyWiki. If you continue you will lose those changes\\n\\n--------------------------------\",\n"
"	saveInstructions: \"SaveChanges\",\n"
"	unsupportedTWFormat: \"Unsupported TiddlyWiki format '%0'\",\n"
"	tiddlerSaveError: \"Error when saving tiddler '%0'\",\n"
"	tiddlerLoadError: \"Error when loading tiddler '%0'\",\n"
"	wrongSaveFormat: \"Cannot save with storage format '%0'. Using standard format for save.\",\n"
"	invalidFieldName: \"Invalid field name %0\",\n"
"	fieldCannotBeChanged: \"Field '%0' cannot be changed\",\n"
"	loadingMissingTiddler: \"Attempting to retrieve the tiddler '%0' from the '%1' server at:\\n\\n'%2' in the workspace '%3'\",\n"
"	upgradeDone: \"The upgrade to version %0 is now complete\\n\\nClick 'OK' to reload the newly upgraded TiddlyWiki\"});\n"
"\n"
"merge(config.messages.messageClose,{\n"
"	text: \"close\",\n"
"	tooltip: \"close this message area\"});\n"
"\n"
"config.messages.backstage = {\n"
"	open: {text: \"backstage\", tooltip: \"Open the backstage area to perform authoring and editing tasks\"},\n"
"	close: {text: \"close\", tooltip: \"Close the backstage area\"},\n"
"	prompt: \"backstage: \",\n"
"	decal: {\n"
"		edit: {text: \"edit\", tooltip: \"Edit the tiddler '%0'\"}\n"
"	}\n"
"};\n"
"\n"
"config.messages.listView = {\n"
"	tiddlerTooltip: \"Click for the full text of this tiddler\",\n"
"	previewUnavailable: \"(preview not available)\"\n"
"};\n"
"\n"
"config.messages.dates.months = [\"January\", \"February\", \"March\", \"April\", \"May\", \"June\", \"July\", \"August\", \"September\", \"October\", \"November\",\"December\"];\n"
"config.messages.dates.days = [\"Sunday\", \"Monday\", \"Tuesday\", \"Wednesday\", \"Thursday\", \"Friday\", \"Saturday\"];\n"
"config.messages.dates.shortMonths = [\"Jan\", \"Feb\", \"Mar\", \"Apr\", \"May\", \"Jun\", \"Jul\", \"Aug\", \"Sep\", \"Oct\", \"Nov\", \"Dec\"];\n"
"config.messages.dates.shortDays = [\"Sun\", \"Mon\", \"Tue\", \"Wed\", \"Thu\", \"Fri\", \"Sat\"];\n"
"// suffixes for dates, eg \"1st\",\"2nd\",\"3rd\"...\"30th\",\"31st\"\n"
"config.messages.dates.daySuffixes = [\"st\",\"nd\",\"rd\",\"th\",\"th\",\"th\",\"th\",\"th\",\"th\",\"th\",\n"
"		\"th\",\"th\",\"th\",\"th\",\"th\",\"th\",\"th\",\"th\",\"th\",\"th\",\n"
"		\"st\",\"nd\",\"rd\",\"th\",\"th\",\"th\",\"th\",\"th\",\"th\",\"th\",\n"
"		\"st\"];\n"
"config.messages.dates.am = \"am\";\n"
"config.messages.dates.pm = \"pm\";\n"
"\n"
"merge(config.messages.tiddlerPopup,{\n"
"	});\n"
"\n"
"merge(config.views.wikified.tag,{\n"
"	labelNoTags: \"no tags\",\n"
"	labelTags: \"tags: \",\n"
"	openTag: \"Open tag '%0'\",\n"
"	tooltip: \"Show tiddlers tagged with '%0'\",\n"
"	openAllText: \"Open all\",\n"
"	openAllTooltip: \"Open all of these tiddlers\",\n"
"	popupNone: \"No other tiddlers tagged with '%0'\"});\n"
"\n"
"merge(config.views.wikified,{\n"
"	defaultText: \"The tiddler '%0' doesn't yet exist. Double-click to create it\",\n"
"	defaultModifier: \"(missing)\",\n"
"	shadowModifier: \"(built-in shadow tiddler)\",\n"
"	dateFormat: \"DD MMM YYYY\",\n"
"	createdPrompt: \"created\"});\n"
"\n"
"merge(config.views.editor,{\n"
"	tagPrompt: \"Type tags separated with spaces, [[use double square brackets]] if necessary, or add existing\",\n"
"	defaultText: \"Type the text for '%0'\"});\n"
"\n"
"merge(config.views.editor.tagChooser,{\n"
"	text: \"tags\",\n"
"	tooltip: \"Choose existing tags to add to this tiddler\",\n"
"	popupNone: \"There are no tags defined\",\n"
"	tagTooltip: \"Add the tag '%0'\"});\n"
"\n"
"merge(config.messages,{\n"
"	sizeTemplates:\n"
"		[\n"
"		{unit: 1024*1024*1024, template: \"%0\\u00a0GB\"},\n"
"		{unit: 1024*1024, template: \"%0\\u00a0MB\"},\n"
"		{unit: 1024, template: \"%0\\u00a0KB\"},\n"
"		{unit: 1, template: \"%0\\u00a0B\"}\n"
"		]});\n"
"\n"
"merge(config.macros.search,{\n"
"	label: \"search\",\n"
"	prompt: \"Search this TiddlyWiki\",\n"
"	accessKey: \"F\",\n"
"	successMsg: \"%0 tiddlers found matching %1\",\n"
"	failureMsg: \"No tiddlers found matching %0\"});\n"
"\n"
"merge(config.macros.tagging,{\n"
"	label: \"tagging: \",\n"
"	labelNotTag: \"not tagging\",\n"
"	tooltip: \"List of tiddlers tagged with '%0'\"});\n"
"\n"
"merge(config.macros.timeline,{\n"
"	dateFormat: \"DD MMM YYYY\"});\n"
"\n"
"merge(config.macros.allTags,{\n"
"	tooltip: \"Show tiddlers tagged with '%0'\",\n"
"	noTags: \"There are no tagged tiddlers\"});\n"
"\n"
"config.macros.list.all.prompt = \"All tiddlers in alphabetical order\";\n"
"config.macros.list.missing.prompt = \"Tiddlers that have links to them but are not defined\";\n"
"config.macros.list.orphans.prompt = \"Tiddlers that are not linked to from any other tiddlers\";\n"
"config.macros.list.shadowed.prompt = \"Tiddlers shadowed with default contents\";\n"
"config.macros.list.touched.prompt = \"Tiddlers that have been modified locally\";\n"
"\n"
"merge(config.macros.closeAll,{\n"
"	label: \"close all\",\n"
"	prompt: \"Close all displayed tiddlers (except any that are being edited)\"});\n"
"\n"
"merge(config.macros.permaview,{\n"
"	label: \"permaview\",\n"
"	prompt: \"Link to an URL that retrieves all the currently displayed tiddlers\"});\n"
"\n"
"merge(config.macros.saveChanges,{\n"
"	label: \"save changes\",\n"
"	prompt: \"Save all tiddlers to create a new TiddlyWiki\",\n"
"	accessKey: \"S\"});\n"
"\n"
"merge(config.macros.newTiddler,{\n"
"	label: \"new tiddler\",\n"
"	prompt: \"Create a new tiddler\",\n"
"	title: \"New Tiddler\",\n"
"	accessKey: \"N\"});\n"
"\n"
"merge(config.macros.newJournal,{\n"
"	label: \"new journal\",\n"
"	prompt: \"Create a new tiddler from the current date and time\",\n"
"	accessKey: \"J\"});\n"
"\n"
"merge(config.macros.options,{\n"
"	wizardTitle: \"Tweak advanced options\",\n"
"	step1Title: \"These options are saved in cookies in your browser\",\n"
"	step1Html: \"<input type='hidden' name='markList'></input><br><input type='checkbox' checked='false' name='chkUnknown'>Show unknown options</input>\",\n"
"	unknownDescription: \"//(unknown)//\",\n"
"	listViewTemplate: {\n"
"		columns: [\n"
"			{name: 'Option', field: 'option', title: \"Option\", type: 'String'},\n"
"			{name: 'Description', field: 'description', title: \"Description\", type: 'WikiText'},\n"
"			{name: 'Name', field: 'name', title: \"Name\", type: 'String'}\n"
"			],\n"
"		rowClasses: [\n"
"			{className: 'lowlight', field: 'lowlight'}\n"
"			]}\n"
"	});\n"
"\n"
"merge(config.macros.plugins,{\n"
"	wizardTitle: \"Manage plugins\",\n"
"	step1Title: \"Currently loaded plugins\",\n"
"	step1Html: \"<input type='hidden' name='markList'></input>\", // DO NOT TRANSLATE\n"
"	skippedText: \"(This plugin has not been executed because it was added since startup)\",\n"
"	noPluginText: \"There are no plugins installed\",\n"
"	confirmDeleteText: \"Are you sure you want to delete these plugins:\\n\\n%0\",\n"
"	removeLabel: \"remove systemConfig tag\",\n"
"	removePrompt: \"Remove systemConfig tag\",\n"
"	deleteLabel: \"delete\",\n"
"	deletePrompt: \"Delete these tiddlers forever\",\n"
"	listViewTemplate: {\n"
"		columns: [\n"
"			{name: 'Selected', field: 'Selected', rowName: 'title', type: 'Selector'},\n"
"			{name: 'Tiddler', field: 'tiddler', title: \"Tiddler\", type: 'Tiddler'},\n"
"			{name: 'Description', field: 'Description', title: \"Description\", type: 'String'},\n"
"			{name: 'Version', field: 'Version', title: \"Version\", type: 'String'},\n"
"			{name: 'Size', field: 'size', tiddlerLink: 'size', title: \"Size\", type: 'Size'},\n"
"			{name: 'Forced', field: 'forced', title: \"Forced\", tag: 'systemConfigForce', type: 'TagCheckbox'},\n"
"			{name: 'Disabled', field: 'disabled', title: \"Disabled\", tag: 'systemConfigDisable', type: 'TagCheckbox'},\n"
"			{name: 'Executed', field: 'executed', title: \"Loaded\", type: 'Boolean', trueText: \"Yes\", falseText: \"No\"},\n"
"			{name: 'Startup Time', field: 'startupTime', title: \"Startup Time\", type: 'String'},\n"
"			{name: 'Error', field: 'error', title: \"Status\", type: 'Boolean', trueText: \"Error\", falseText: \"OK\"},\n"
"			{name: 'Log', field: 'log', title: \"Log\", type: 'StringList'}\n"
"			],\n"
"		rowClasses: [\n"
"			{className: 'error', field: 'error'},\n"
"			{className: 'warning', field: 'warning'}\n"
"			]}\n"
"	});\n"
"\n"
"merge(config.macros.toolbar,{\n"
"	moreLabel: \"more\",\n"
"	morePrompt: \"Show additional commands\",\n"
"	lessLabel: \"less\",\n"
"	lessPrompt: \"Hide additional commands\",\n"
"	separator: \"|\"\n"
"	});\n"
"\n"
"merge(config.macros.refreshDisplay,{\n"
"	label: \"refresh\",\n"
"	prompt: \"Redraw the entire TiddlyWiki display\"\n"
"	});\n"
"\n"
"merge(config.macros.importTiddlers,{\n"
"	readOnlyWarning: \"You cannot import into a read-only TiddlyWiki file. Try opening it from a file:// URL\",\n"
"	wizardTitle: \"Import tiddlers from another file or server\",\n"
"	step1Title: \"Step 1: Locate the server or TiddlyWiki file\",\n"
"	step1Html: \"Specify the type of the server: <select name='selTypes'><option value=''>Choose...</option></select><br>Enter the URL or pathname here: <input type='text' size=50 name='txtPath'><br>...or browse for a file: <input type='file' size=50 name='txtBrowse'><br><hr>...or select a pre-defined feed: <select name='selFeeds'><option value=''>Choose...</option></select>\",\n"
"	openLabel: \"open\",\n"
"	openPrompt: \"Open the connection to this file or server\",\n"
"	openError: \"There were problems fetching the tiddlywiki file\",\n"
"	statusOpenHost: \"Opening the host\",\n"
"	statusGetWorkspaceList: \"Getting the list of available workspaces\",\n"
"	step2Title: \"Step 2: Choose the workspace\",\n"
"	step2Html: \"Enter a workspace name: <input type='text' size=50 name='txtWorkspace'><br>...or select a workspace: <select name='selWorkspace'><option value=''>Choose...</option></select>\",\n"
"	cancelLabel: \"cancel\",\n"
"	cancelPrompt: \"Cancel this import\",\n"
"	statusOpenWorkspace: \"Opening the workspace\",\n"
"	statusGetTiddlerList: \"Getting the list of available tiddlers\",\n"
"	errorGettingTiddlerList: \"Error getting list of tiddlers, click Cancel to try again\",\n"
"	step3Title: \"Step 3: Choose the tiddlers to import\",\n"
"	step3Html: \"<input type='hidden' name='markList'></input><br><input type='checkbox' checked='true' name='chkSync'>Keep these tiddlers linked to this server so that you can synchronise subsequent changes</input><br><input type='checkbox' name='chkSave'>Save the details of this server in a 'systemServer' tiddler called:</input> <input type='text' size=25 name='txtSaveTiddler'>\",\n"
"	importLabel: \"import\",\n"
"	importPrompt: \"Import these tiddlers\",\n"
"	confirmOverwriteText: \"Are you sure you want to overwrite these tiddlers:\\n\\n%0\",\n"
"	step4Title: \"Step 4: Importing %0 tiddler(s)\",\n"
"	step4Html: \"<input type='hidden' name='markReport'></input>\", // DO NOT TRANSLATE\n"
"	doneLabel: \"done\",\n"
"	donePrompt: \"Close this wizard\",\n"
"	statusDoingImport: \"Importing tiddlers\",\n"
"	statusDoneImport: \"All tiddlers imported\",\n"
"	systemServerNamePattern: \"%2 on %1\",\n"
"	systemServerNamePatternNoWorkspace: \"%1\",\n"
"	confirmOverwriteSaveTiddler: \"The tiddler '%0' already exists. Click 'OK' to overwrite it with the details of this server, or 'Cancel' to leave it unchanged\",\n"
"	serverSaveTemplate: \"|''Type:''|%0|\\n|''URL:''|%1|\\n|''Workspace:''|%2|\\n\\nThis tiddler was automatically created to record the details of this server\",\n"
"	serverSaveModifier: \"(System)\",\n"
"	listViewTemplate: {\n"
"		columns: [\n"
"			{name: 'Selected', field: 'Selected', rowName: 'title', type: 'Selector'},\n"
"			{name: 'Tiddler', field: 'tiddler', title: \"Tiddler\", type: 'Tiddler'},\n"
"			{name: 'Size', field: 'size', tiddlerLink: 'size', title: \"Size\", type: 'Size'},\n"
"			{name: 'Tags', field: 'tags', title: \"Tags\", type: 'Tags'}\n"
"			],\n"
"		rowClasses: [\n"
"			]}\n"
"	});\n"
"\n"
"merge(config.macros.upgrade,{\n"
"	wizardTitle: \"Upgrade TiddlyWiki core code\",\n"
"	step1Title: \"Update or repair this TiddlyWiki to the latest release\",\n"
"	step1Html: \"You are about to upgrade to the latest release of the TiddlyWiki core code (from <a href='%0' class='externalLink' target='_blank'>%1</a>). Your content will be preserved across the upgrade.<br><br>Note that core upgrades have been known to interfere with older plugins. If you run into problems with the upgraded file, see <a href='http://www.tiddlywiki.org/wiki/CoreUpgrades' class='externalLink' target='_blank'>http://www.tiddlywiki.org/wiki/CoreUpgrades</a>\",\n"
"	errorCantUpgrade: \"Unable to upgrade this TiddlyWiki. You can only perform upgrades on TiddlyWiki files stored locally\",\n"
"	errorNotSaved: \"You must save changes before you can perform an upgrade\",\n"
"	step2Title: \"Confirm the upgrade details\",\n"
"	step2Html_downgrade: \"You are about to downgrade to TiddlyWiki version %0 from %1.<br><br>Downgrading to an earlier version of the core code is not recommended\",\n"
"	step2Html_restore: \"This TiddlyWiki appears to be already using the latest version of the core code (%0).<br><br>You can continue to upgrade anyway to ensure that the core code hasn't been corrupted or damaged\",\n"
"	step2Html_upgrade: \"You are about to upgrade to TiddlyWiki version %0 from %1\",\n"
"	upgradeLabel: \"upgrade\",\n"
"	upgradePrompt: \"Prepare for the upgrade process\",\n"
"	statusPreparingBackup: \"Preparing backup\",\n"
"	statusSavingBackup: \"Saving backup file\",\n"
"	errorSavingBackup: \"There was a problem saving the backup file\",\n"
"	statusLoadingCore: \"Loading core code\",\n"
"	errorLoadingCore: \"Error loading the core code\",\n"
"	errorCoreFormat: \"Error with the new core code\",\n"
"	statusSavingCore: \"Saving the new core code\",\n"
"	statusReloadingCore: \"Reloading the new core code\",\n"
"	startLabel: \"start\",\n"
"	startPrompt: \"Start the upgrade process\",\n"
"	cancelLabel: \"cancel\",\n"
"	cancelPrompt: \"Cancel the upgrade process\",\n"
"	step3Title: \"Upgrade cancelled\",\n"
"	step3Html: \"You have cancelled the upgrade process\"\n"
"	});\n"
"\n"
"merge(config.macros.sync,{\n"
"	listViewTemplate: {\n"
"		columns: [\n"
"			{name: 'Selected', field: 'selected', rowName: 'title', type: 'Selector'},\n"
"			{name: 'Tiddler', field: 'tiddler', title: \"Tiddler\", type: 'Tiddler'},\n"
"			{name: 'Server Type', field: 'serverType', title: \"Server type\", type: 'String'},\n"
"			{name: 'Server Host', field: 'serverHost', title: \"Server host\", type: 'String'},\n"
"			{name: 'Server Workspace', field: 'serverWorkspace', title: \"Server workspace\", type: 'String'},\n"
"			{name: 'Status', field: 'status', title: \"Synchronisation status\", type: 'String'},\n"
"			{name: 'Server URL', field: 'serverUrl', title: \"Server URL\", text: \"View\", type: 'Link'}\n"
"			],\n"
"		rowClasses: [\n"
"			],\n"
"		buttons: [\n"
"			{caption: \"Sync these tiddlers\", name: 'sync'}\n"
"			]},\n"
"	wizardTitle: \"Synchronize with external servers and files\",\n"
"	step1Title: \"Choose the tiddlers you want to synchronize\",\n"
"	step1Html: \"<input type='hidden' name='markList'></input>\", // DO NOT TRANSLATE\n"
"	syncLabel: \"sync\",\n"
"	syncPrompt: \"Sync these tiddlers\",\n"
"	hasChanged: \"Changed while unplugged\",\n"
"	hasNotChanged: \"Unchanged while unplugged\",\n"
"	syncStatusList: {\n"
"		none: {text: \"...\", display:null, className:'notChanged'},\n"
"		changedServer: {text: \"Changed on server\", display:null, className:'changedServer'},\n"
"		changedLocally: {text: \"Changed while unplugged\", display:null, className:'changedLocally'},\n"
"		changedBoth: {text: \"Changed while unplugged and on server\", display:null, className:'changedBoth'},\n"
"		notFound: {text: \"Not found on server\", display:null, className:'notFound'},\n"
"		putToServer: {text: \"Saved update on server\", display:null, className:'putToServer'},\n"
"		gotFromServer: {text: \"Retrieved update from server\", display:null, className:'gotFromServer'}\n"
"		}\n"
"	});\n"
"\n"
"merge(config.macros.annotations,{\n"
"	});\n"
"\n"
"merge(config.commands.closeTiddler,{\n"
"	text: \"close\",\n"
"	tooltip: \"Close this tiddler\"});\n"
"\n"
"merge(config.commands.closeOthers,{\n"
"	text: \"close others\",\n"
"	tooltip: \"Close all other tiddlers\"});\n"
"\n"
"merge(config.commands.editTiddler,{\n"
"	text: \"edit\",\n"
"	tooltip: \"Edit this tiddler\",\n"
"	readOnlyText: \"view\",\n"
"	readOnlyTooltip: \"View the source of this tiddler\"});\n"
"\n"
"merge(config.commands.saveTiddler,{\n"
"	text: \"done\",\n"
"	tooltip: \"Save changes to this tiddler\"});\n"
"\n"
"merge(config.commands.cancelTiddler,{\n"
"	text: \"cancel\",\n"
"	tooltip: \"Undo changes to this tiddler\",\n"
"	warning: \"Are you sure you want to abandon your changes to '%0'?\",\n"
"	readOnlyText: \"done\",\n"
"	readOnlyTooltip: \"View this tiddler normally\"});\n"
"\n"
"merge(config.commands.deleteTiddler,{\n"
"	text: \"delete\",\n"
"	tooltip: \"Delete this tiddler\",\n"
"	warning: \"Are you sure you want to delete '%0'?\"});\n"
"\n"
"merge(config.commands.permalink,{\n"
"	text: \"permalink\",\n"
"	tooltip: \"Permalink for this tiddler\"});\n"
"\n"
"merge(config.commands.references,{\n"
"	text: \"references\",\n"
"	tooltip: \"Show tiddlers that link to this one\",\n"
"	popupNone: \"No references\"});\n"
"\n"
"merge(config.commands.jump,{\n"
"	text: \"jump\",\n"
"	tooltip: \"Jump to another open tiddler\"});\n"
"\n"
"merge(config.commands.syncing,{\n"
"	text: \"syncing\",\n"
"	tooltip: \"Control synchronisation of this tiddler with a server or external file\",\n"
"	currentlySyncing: \"<div>Currently syncing via <span class='popupHighlight'>'%0'</span> to:</\"+\"div><div>host: <span class='popupHighlight'>%1</span></\"+\"div><div>workspace: <span class='popupHighlight'>%2</span></\"+\"div>\", // Note escaping of closing <div> tag\n"
"	notCurrentlySyncing: \"Not currently syncing\",\n"
"	captionUnSync: \"Stop synchronising this tiddler\",\n"
"	chooseServer: \"Synchronise this tiddler with another server:\",\n"
"	currServerMarker: \"\\u25cf \",\n"
"	notCurrServerMarker: \"  \"});\n"
"\n"
"merge(config.commands.fields,{\n"
"	text: \"fields\",\n"
"	tooltip: \"Show the extended fields of this tiddler\",\n"
"	emptyText: \"There are no extended fields for this tiddler\",\n"
"	listViewTemplate: {\n"
"		columns: [\n"
"			{name: 'Field', field: 'field', title: \"Field\", type: 'String'},\n"
"			{name: 'Value', field: 'value', title: \"Value\", type: 'String'}\n"
"			],\n"
"		rowClasses: [\n"
"			],\n"
"		buttons: [\n"
"			]}});\n"
"\n"
"merge(config.shadowTiddlers,{\n"
"	DefaultTiddlers: \"[[GettingStarted]]\",\n"
"	MainMenu: \"[[GettingStarted]]\",\n"
"	SiteTitle: \"My TiddlyWiki\",\n"
"	SiteSubtitle: \"a reusable non-linear personal web notebook\",\n"
"	SiteUrl: \"http://www.tiddlywiki.com/\",\n"
"	SideBarOptions: '<<search>><<closeAll>><<permaview>><<newTiddler>><<newJournal \"DD MMM YYYY\" \"journal\">><<saveChanges>><<slider chkSliderOptionsPanel OptionsPanel \"options \\u00bb\" \"Change TiddlyWiki advanced options\">>',\n"
"	SideBarTabs: '<<tabs txtMainTab \"Timeline\" \"Timeline\" TabTimeline \"All\" \"All tiddlers\" TabAll \"Tags\" \"All tags\" TabTags \"More\" \"More lists\" TabMore>>',\n"
"	TabMore: '<<tabs txtMoreTab \"Missing\" \"Missing tiddlers\" TabMoreMissing \"Orphans\" \"Orphaned tiddlers\" TabMoreOrphans \"Shadowed\" \"Shadowed tiddlers\" TabMoreShadowed>>'\n"
"	});\n"
"\n"
"merge(config.annotations,{\n"
"	AdvancedOptions: \"This shadow tiddler provides access to several advanced options\",\n"
"	ColorPalette: \"These values in this shadow tiddler determine the colour scheme of the ~TiddlyWiki user interface\",\n"
"	DefaultTiddlers: \"The tiddlers listed in this shadow tiddler will be automatically displayed when ~TiddlyWiki starts up\",\n"
"	EditTemplate: \"The HTML template in this shadow tiddler determines how tiddlers look while they are being edited\",\n"
"	GettingStarted: \"This shadow tiddler provides basic usage instructions\",\n"
"	ImportTiddlers: \"This shadow tiddler provides access to importing tiddlers\",\n"
"	MainMenu: \"This shadow tiddler is used as the contents of the main menu in the left-hand column of the screen\",\n"
"	MarkupPreHead: \"This tiddler is inserted at the top of the <head> section of the TiddlyWiki HTML file\",\n"
"	MarkupPostHead: \"This tiddler is inserted at the bottom of the <head> section of the TiddlyWiki HTML file\",\n"
"	MarkupPreBody: \"This tiddler is inserted at the top of the <body> section of the TiddlyWiki HTML file\",\n"
"	MarkupPostBody: \"This tiddler is inserted at the end of the <body> section of the TiddlyWiki HTML file immediately after the script block\",\n"
"	OptionsPanel: \"This shadow tiddler is used as the contents of the options panel slider in the right-hand sidebar\",\n"
"	PageTemplate: \"The HTML template in this shadow tiddler determines the overall ~TiddlyWiki layout\",\n"
"	PluginManager: \"This shadow tiddler provides access to the plugin manager\",\n"
"	SideBarOptions: \"This shadow tiddler is used as the contents of the option panel in the right-hand sidebar\",\n"
"	SideBarTabs: \"This shadow tiddler is used as the contents of the tabs panel in the right-hand sidebar\",\n"
"	SiteSubtitle: \"This shadow tiddler is used as the second part of the page title\",\n"
"	SiteTitle: \"This shadow tiddler is used as the first part of the page title\",\n"
"	SiteUrl: \"This shadow tiddler should be set to the full target URL for publication\",\n"
"	StyleSheetColors: \"This shadow tiddler contains CSS definitions related to the color of page elements. ''DO NOT EDIT THIS TIDDLER'', instead make your changes in the StyleSheet shadow tiddler\",\n"
"	StyleSheet: \"This tiddler can contain custom CSS definitions\",\n"
"	StyleSheetLayout: \"This shadow tiddler contains CSS definitions related to the layout of page elements. ''DO NOT EDIT THIS TIDDLER'', instead make your changes in the StyleSheet shadow tiddler\",\n"
"	StyleSheetLocale: \"This shadow tiddler contains CSS definitions related to the translation locale\",\n"
"	StyleSheetPrint: \"This shadow tiddler contains CSS definitions for printing\",\n"
"	TabAll: \"This shadow tiddler contains the contents of the 'All' tab in the right-hand sidebar\",\n"
"	TabMore: \"This shadow tiddler contains the contents of the 'More' tab in the right-hand sidebar\",\n"
"	TabMoreMissing: \"This shadow tiddler contains the contents of the 'Missing' tab in the right-hand sidebar\",\n"
"	TabMoreOrphans: \"This shadow tiddler contains the contents of the 'Orphans' tab in the right-hand sidebar\",\n"
"	TabMoreShadowed: \"This shadow tiddler contains the contents of the 'Shadowed' tab in the right-hand sidebar\",\n"
"	TabTags: \"This shadow tiddler contains the contents of the 'Tags' tab in the right-hand sidebar\",\n"
"	TabTimeline: \"This shadow tiddler contains the contents of the 'Timeline' tab in the right-hand sidebar\",\n"
"	ToolbarCommands: \"This shadow tiddler determines which commands are shown in tiddler toolbars\",\n"
"	ViewTemplate: \"The HTML template in this shadow tiddler determines how tiddlers look\"\n"
"	});\n"
"\n"
"//--\n"
"//-- Main\n"
"//--\n"
"\n"
"var params = null; // Command line parameters\n"
"var store = null; // TiddlyWiki storage\n"
"var story = null; // Main story\n"
"var formatter = null; // Default formatters for the wikifier\n"
"var anim = typeof Animator == \"function\" ? new Animator() : null; // Animation engine\n"
"var readOnly = false; // Whether we're in readonly mode\n"
"var highlightHack = null; // Embarrassing hack department...\n"
"var hadConfirmExit = false; // Don't warn more than once\n"
"var safeMode = false; // Disable all plugins and cookies\n"
"var showBackstage; // Whether to include the backstage area\n"
"var installedPlugins = []; // Information filled in when plugins are executed\n"
"var startingUp = false; // Whether we're in the process of starting up\n"
"var pluginInfo,tiddler; // Used to pass information to plugins in loadPlugins()\n"
"\n"
"// Whether to use the JavaSaver applet\n"
"var useJavaSaver = (config.browser.isSafari || config.browser.isOpera) && (document.location.toString().substr(0,4) != \"http\");\n"
"\n"
"// Starting up\n"
"function main()\n"
"{\n"
"	var t10,t9,t8,t7,t6,t5,t4,t3,t2,t1,t0 = new Date();\n"
"	startingUp = true;\n"
"	jQuery.noConflict();\n"
"	window.onbeforeunload = function(e) {if(window.confirmExit) return confirmExit();};\n"
"	params = getParameters();\n"
"	if(params)\n"
"		params = params.parseParams(\"open\",null,false);\n"
"	store = new TiddlyWiki();\n"
"	invokeParamifier(params,\"oninit\");\n"
"	story = new Story(\"tiddlerDisplay\",\"tiddler\");\n"
"	addEvent(document,\"click\",Popup.onDocumentClick);\n"
"	saveTest();\n"
"	loadOptionsCookie();\n"
"	for(var s=0; s<config.notifyTiddlers.length; s++)\n"
"		store.addNotification(config.notifyTiddlers[s].name,config.notifyTiddlers[s].notify);\n"
"	t1 = new Date();\n"
"	loadShadowTiddlers();\n"
"	jQuery().trigger(\"loadShadows\");\n"
"	t2 = new Date();\n"
"	store.loadFromDiv(\"storeArea\",\"store\",true);\n"
"	jQuery().trigger(\"loadTiddlers\");\n"
"	t3 = new Date();\n"
"	invokeParamifier(params,\"onload\");\n"
"	t4 = new Date();\n"
"	readOnly = (window.location.protocol == \"file:\") ? false : config.options.chkHttpReadOnly;\n"
"	var pluginProblem = loadPlugins();\n"
"	jQuery().trigger(\"loadPlugins\");\n"
"	t5 = new Date();\n"
"	formatter = new Formatter(config.formatters);\n"
"	invokeParamifier(params,\"onconfig\");\n"
"	story.switchTheme(config.options.txtTheme);\n"
"	showBackstage = !readOnly;\n"
"	t6 = new Date();\n"
"	for(var m in config.macros) {\n"
"		if(config.macros[m].init)\n"
"			config.macros[m].init();\n"
"	}\n"
"	t7 = new Date();\n"
"	store.notifyAll();\n"
"	t8 = new Date();\n"
"	restart();\n"
"	refreshDisplay();\n"
"	t9 = new Date();\n"
"	if(pluginProblem) {\n"
"		story.displayTiddler(null,\"PluginManager\");\n"
"		displayMessage(config.messages.customConfigError);\n"
"	}\n"
"	if(showBackstage)\n"
"		backstage.init();\n"
"	t10 = new Date();\n"
"	if(config.options.chkDisplayInstrumentation) {\n"
"		displayMessage(\"LoadShadows \" + (t2-t1) + \" ms\");\n"
"		displayMessage(\"LoadFromDiv \" + (t3-t2) + \" ms\");\n"
"		displayMessage(\"LoadPlugins \" + (t5-t4) + \" ms\");\n"
"		displayMessage(\"Macro init \" + (t7-t6) + \" ms\");\n"
"		displayMessage(\"Notify \" + (t8-t7) + \" ms\");\n"
"		displayMessage(\"Restart \" + (t9-t8) + \" ms\");\n"
"		displayMessage(\"Total: \" + (t10-t0) + \" ms\");\n"
"	}\n"
"	startingUp = false;\n"
"	jQuery().trigger(\"startup\");\n"
"}\n"
"\n"
"// Called on unload. All functions called conditionally since they themselves may have been unloaded.\n"
"function unload()\n"
"{\n"
"	if(window.checkUnsavedChanges)\n"
"		checkUnsavedChanges();\n"
"	if(window.scrubNodes)\n"
"		scrubNodes(document.body);\n"
"}\n"
"\n"
"// Restarting\n"
"function restart()\n"
"{\n"
"	invokeParamifier(params,\"onstart\");\n"
"	if(story.isEmpty()) {\n"
"		story.displayDefaultTiddlers();\n"
"	}\n"
"	window.scrollTo(0,0);\n"
"}\n"
"\n"
"function saveTest()\n"
"{\n"
"	var s = document.getElementById(\"saveTest\");\n"
"	if(s.hasChildNodes())\n"
"		alert(config.messages.savedSnapshotError);\n"
"	s.appendChild(document.createTextNode(\"savetest\"));\n"
"}\n"
"\n"
"function loadShadowTiddlers()\n"
"{\n"
"	var shadows = new TiddlyWiki();\n"
"	shadows.loadFromDiv(\"shadowArea\",\"shadows\",true);\n"
"	shadows.forEachTiddler(function(title,tiddler){config.shadowTiddlers[title] = tiddler.text;});\n"
"	delete shadows;\n"
"}\n"
"\n"
"function loadPlugins()\n"
"{\n"
"	if(safeMode)\n"
"		return false;\n"
"	var tiddlers = store.getTaggedTiddlers(\"systemConfig\");\n"
"	var toLoad = [];\n"
"	var nLoaded = 0;\n"
"	var map = {};\n"
"	var nPlugins = tiddlers.length;\n"
"	installedPlugins = [];\n"
"	for(var i=0; i<nPlugins; i++) {\n"
"		var p = getPluginInfo(tiddlers[i]);\n"
"		installedPlugins[i] = p;\n"
"		var n = p.Name;\n"
"		if(n)\n"
"			map[n] = p;\n"
"		n = p.Source;\n"
"		if(n)\n"
"			map[n] = p;\n"
"	}\n"
"	var visit = function(p) {\n"
"		if(!p || p.done)\n"
"			return;\n"
"		p.done = 1;\n"
"		var reqs = p.Requires;\n"
"		if(reqs) {\n"
"			reqs = reqs.readBracketedList();\n"
"			for(var i=0; i<reqs.length; i++)\n"
"				visit(map[reqs[i]]);\n"
"		}\n"
"		toLoad.push(p);\n"
"	};\n"
"	for(i=0; i<nPlugins; i++)\n"
"		visit(installedPlugins[i]);\n"
"	for(i=0; i<toLoad.length; i++) {\n"
"		p = toLoad[i];\n"
"		pluginInfo = p;\n"
"		tiddler = p.tiddler;\n"
"		if(isPluginExecutable(p)) {\n"
"			if(isPluginEnabled(p)) {\n"
"				p.executed = true;\n"
"				var startTime = new Date();\n"
"				try {\n"
"					if(tiddler.text)\n"
"						window.eval(tiddler.text);\n"
"					nLoaded++;\n"
"				} catch(ex) {\n"
"					p.log.push(config.messages.pluginError.format([exceptionText(ex)]));\n"
"					p.error = true;\n"
"				}\n"
"				pluginInfo.startupTime = String((new Date()) - startTime) + \"ms\";\n"
"			} else {\n"
"				nPlugins--;\n"
"			}\n"
"		} else {\n"
"			p.warning = true;\n"
"		}\n"
"	}\n"
"	return nLoaded != nPlugins;\n"
"}\n"
"\n"
"function getPluginInfo(tiddler)\n"
"{\n"
"	var p = store.getTiddlerSlices(tiddler.title,[\"Name\",\"Description\",\"Version\",\"Requires\",\"CoreVersion\",\"Date\",\"Source\",\"Author\",\"License\",\"Browsers\"]);\n"
"	p.tiddler = tiddler;\n"
"	p.title = tiddler.title;\n"
"	p.log = [];\n"
"	return p;\n"
"}\n"
"\n"
"// Check that a particular plugin is valid for execution\n"
"function isPluginExecutable(plugin)\n"
"{\n"
"	if(plugin.tiddler.isTagged(\"systemConfigForce\")) {\n"
"		plugin.log.push(config.messages.pluginForced);\n"
"		return true;\n"
"	}\n"
"	if(plugin[\"CoreVersion\"]) {\n"
"		var coreVersion = plugin[\"CoreVersion\"].split(\".\");\n"
"		var w = parseInt(coreVersion[0],10) - version.major;\n"
"		if(w == 0 && coreVersion[1])\n"
"			w = parseInt(coreVersion[1],10) - version.minor;\n"
"		if(w == 0 && coreVersion[2])\n"
"			w = parseInt(coreVersion[2],10) - version.revision;\n"
"		if(w > 0) {\n"
"			plugin.log.push(config.messages.pluginVersionError);\n"
"			return false;\n"
"		}\n"
"	}\n"
"	return true;\n"
"}\n"
"\n"
"function isPluginEnabled(plugin)\n"
"{\n"
"	if(plugin.tiddler.isTagged(\"systemConfigDisable\")) {\n"
"		plugin.log.push(config.messages.pluginDisabled);\n"
"		return false;\n"
"	}\n"
"	return true;\n"
"}\n"
"\n"
"function invokeMacro(place,macro,params,wikifier,tiddler)\n"
"{\n"
"	try {\n"
"		var m = config.macros[macro];\n"
"		if(m && m.handler) {\n"
"			var tiddlerElem = story.findContainingTiddler(place);\n"
"			window.tiddler = tiddlerElem ? store.getTiddler(tiddlerElem.getAttribute(\"tiddler\")) : null;\n"
"			window.place = place;\n"
"			m.handler(place,macro,params.readMacroParams(),wikifier,params,tiddler);\n"
"		} else {\n"
"			createTiddlyError(place,config.messages.macroError.format([macro]),config.messages.macroErrorDetails.format([macro,config.messages.missingMacro]));\n"
"		}\n"
"	} catch(ex) {\n"
"		createTiddlyError(place,config.messages.macroError.format([macro]),config.messages.macroErrorDetails.format([macro,ex.toString()]));\n"
"	}\n"
"}\n"
"\n"
"//--\n"
"//-- Paramifiers\n"
"//--\n"
"\n"
"function getParameters()\n"
"{\n"
"	var p = null;\n"
"	if(window.location.hash) {\n"
"		p = decodeURIComponent(window.location.hash.substr(1));\n"
"		if(config.browser.firefoxDate != null && config.browser.firefoxDate[1] < \"20051111\")\n"
"			p = convertUTF8ToUnicode(p);\n"
"	}\n"
"	return p;\n"
"}\n"
"\n"
"function invokeParamifier(params,handler)\n"
"{\n"
"	if(!params || params.length == undefined || params.length <= 1)\n"
"		return;\n"
"	for(var i=1; i<params.length; i++) {\n"
"		var p = config.paramifiers[params[i].name];\n"
"		if(p && p[handler] instanceof Function)\n"
"			p[handler](params[i].value);\n"
"		else {\n"
"			var h = config.optionHandlers[params[i].name.substr(0,3)];\n"
"			if(h && h.set instanceof Function)\n"
"				h.set(params[i].name,params[i].value);\n"
"		}\n"
"	}\n"
"}\n"
"\n"
"config.paramifiers = {};\n"
"\n"
"config.paramifiers.start = {\n"
"	oninit: function(v) {\n"
"		safeMode = v.toLowerCase() == \"safe\";\n"
"	}\n"
"};\n"
"\n"
"config.paramifiers.open = {\n"
"	onstart: function(v) {\n"
"		if(!readOnly || store.tiddlerExists(v) || store.isShadowTiddler(v))\n"
"			story.displayTiddler(\"bottom\",v,null,false,null);\n"
"	}\n"
"};\n"
"\n"
"config.paramifiers.story = {\n"
"	onstart: function(v) {\n"
"		var list = store.getTiddlerText(v,\"\").parseParams(\"open\",null,false);\n"
"		invokeParamifier(list,\"onstart\");\n"
"	}\n"
"};\n"
"\n"
"config.paramifiers.search = {\n"
"	onstart: function(v) {\n"
"		story.search(v,false,false);\n"
"	}\n"
"};\n"
"\n"
"config.paramifiers.searchRegExp = {\n"
"	onstart: function(v) {\n"
"		story.prototype.search(v,false,true);\n"
"	}\n"
"};\n"
"\n"
"config.paramifiers.tag = {\n"
"	onstart: function(v) {\n"
"		story.displayTiddlers(null,store.filterTiddlers(\"[tag[\"+v+\"]]\"),null,false,null);\n"
"	}\n"
"};\n"
"\n"
"config.paramifiers.newTiddler = {\n"
"	onstart: function(v) {\n"
"		if(!readOnly) {\n"
"			story.displayTiddler(null,v,DEFAULT_EDIT_TEMPLATE);\n"
"			story.focusTiddler(v,\"text\");\n"
"		}\n"
"	}\n"
"};\n"
"\n"
"config.paramifiers.newJournal = {\n"
"	onstart: function(v) {\n"
"		if(!readOnly) {\n"
"			var now = new Date();\n"
"			var title = now.formatString(v.trim());\n"
"			story.displayTiddler(null,title,DEFAULT_EDIT_TEMPLATE);\n"
"			story.focusTiddler(title,\"text\");\n"
"		}\n"
"	}\n"
"};\n"
"\n"
"config.paramifiers.readOnly = {\n"
"	onconfig: function(v) {\n"
"		var p = v.toLowerCase();\n"
"		readOnly = p == \"yes\" ? true : (p == \"no\" ? false : readOnly);\n"
"	}\n"
"};\n"
"\n"
"config.paramifiers.theme = {\n"
"	onconfig: function(v) {\n"
"		story.switchTheme(v);\n"
"	}\n"
"};\n"
"\n"
"config.paramifiers.upgrade = {\n"
"	onstart: function(v) {\n"
"		upgradeFrom(v);\n"
"	}\n"
"};\n"
"\n"
"config.paramifiers.recent= {\n"
"	onstart: function(v) {\n"
"		var titles=[];\n"
"		var tiddlers=store.getTiddlers(\"modified\",\"excludeLists\").reverse();\n"
"		for(var i=0; i<v && i<tiddlers.length; i++)\n"
"			titles.push(tiddlers[i].title);\n"
"		story.displayTiddlers(null,titles);\n"
"	}\n"
"};\n"
"\n"
"config.paramifiers.filter = {\n"
"	onstart: function(v) {\n"
"		story.displayTiddlers(null,store.filterTiddlers(v),null,false);\n"
"	}\n"
"};\n"
"\n"
"//--\n"
"//-- Formatter helpers\n"
"//--\n"
"\n"
"function Formatter(formatters)\n"
"{\n"
"	this.formatters = [];\n"
"	var pattern = [];\n"
"	for(var n=0; n<formatters.length; n++) {\n"
"		pattern.push(\"(\" + formatters[n].match + \")\");\n"
"		this.formatters.push(formatters[n]);\n"
"	}\n"
"	this.formatterRegExp = new RegExp(pattern.join(\"|\"),\"mg\");\n"
"}\n"
"\n"
"config.formatterHelpers = {\n"
"\n"
"	createElementAndWikify: function(w)\n"
"	{\n"
"		w.subWikifyTerm(createTiddlyElement(w.output,this.element),this.termRegExp);\n"
"	},\n"
"\n"
"	inlineCssHelper: function(w)\n"
"	{\n"
"		var styles = [];\n"
"		config.textPrimitives.cssLookaheadRegExp.lastIndex = w.nextMatch;\n"
"		var lookaheadMatch = config.textPrimitives.cssLookaheadRegExp.exec(w.source);\n"
"		while(lookaheadMatch && lookaheadMatch.index == w.nextMatch) {\n"
"			var s,v;\n"
"			if(lookaheadMatch[1]) {\n"
"				s = lookaheadMatch[1].unDash();\n"
"				v = lookaheadMatch[2];\n"
"			} else {\n"
"				s = lookaheadMatch[3].unDash();\n"
"				v = lookaheadMatch[4];\n"
"			}\n"
"			if(s==\"bgcolor\")\n"
"				s = \"backgroundColor\";\n"
"			styles.push({style: s, value: v});\n"
"			w.nextMatch = lookaheadMatch.index + lookaheadMatch[0].length;\n"
"			config.textPrimitives.cssLookaheadRegExp.lastIndex = w.nextMatch;\n"
"			lookaheadMatch = config.textPrimitives.cssLookaheadRegExp.exec(w.source);\n"
"		}\n"
"		return styles;\n"
"	},\n"
"\n"
"	applyCssHelper: function(e,styles)\n"
"	{\n"
"		for(var t=0; t< styles.length; t++) {\n"
"			try {\n"
"				e.style[styles[t].style] = styles[t].value;\n"
"			} catch (ex) {\n"
"			}\n"
"		}\n"
"	},\n"
"\n"
"	enclosedTextHelper: function(w)\n"
"	{\n"
"		this.lookaheadRegExp.lastIndex = w.matchStart;\n"
"		var lookaheadMatch = this.lookaheadRegExp.exec(w.source);\n"
"		if(lookaheadMatch && lookaheadMatch.index == w.matchStart) {\n"
"			var text = lookaheadMatch[1];\n"
"			if(config.browser.isIE)\n"
"				text = text.replace(/\\n/g,\"\\r\");\n"
"			createTiddlyElement(w.output,this.element,null,null,text);\n"
"			w.nextMatch = lookaheadMatch.index + lookaheadMatch[0].length;\n"
"		}\n"
"	},\n"
"\n"
"	isExternalLink: function(link)\n"
"	{\n"
"		if(store.tiddlerExists(link) || store.isShadowTiddler(link)) {\n"
"			return false;\n"
"		}\n"
"		var urlRegExp = new RegExp(config.textPrimitives.urlPattern,\"mg\");\n"
"		if(urlRegExp.exec(link)) {\n"
"			return true;\n"
"		}\n"
"		if(link.indexOf(\".\")!=-1 || link.indexOf(\"\\\\\")!=-1 || link.indexOf(\"/\")!=-1 || link.indexOf(\"#\")!=-1) {\n"
"			return true;\n"
"		}\n"
"		return false;\n"
"	}\n"
"\n"
"};\n"
"\n"
"//--\n"
"//-- Standard formatters\n"
"//--\n"
"\n"
"config.formatters = [\n"
"{\n"
"	name: \"table\",\n"
"	match: \"^\\\\|(?:[^\\\\n]*)\\\\|(?:[fhck]?)$\",\n"
"	lookaheadRegExp: /^\\|([^\\n]*)\\|([fhck]?)$/mg,\n"
"	rowTermRegExp: /(\\|(?:[fhck]?)$\\n?)/mg,\n"
"	cellRegExp: /(?:\\|([^\\n\\|]*)\\|)|(\\|[fhck]?$\\n?)/mg,\n"
"	cellTermRegExp: /((?:\\x20*)\\|)/mg,\n"
"	rowTypes: {\"c\":\"caption\", \"h\":\"thead\", \"\":\"tbody\", \"f\":\"tfoot\"},\n"
"	handler: function(w)\n"
"	{\n"
"		var table = createTiddlyElement(w.output,\"table\",null,\"twtable\");\n"
"		var prevColumns = [];\n"
"		var currRowType = null;\n"
"		var rowContainer;\n"
"		var rowCount = 0;\n"
"		w.nextMatch = w.matchStart;\n"
"		this.lookaheadRegExp.lastIndex = w.nextMatch;\n"
"		var lookaheadMatch = this.lookaheadRegExp.exec(w.source);\n"
"		while(lookaheadMatch && lookaheadMatch.index == w.nextMatch) {\n"
"			var nextRowType = lookaheadMatch[2];\n"
"			if(nextRowType == \"k\") {\n"
"				table.className = lookaheadMatch[1];\n"
"				w.nextMatch += lookaheadMatch[0].length+1;\n"
"			} else {\n"
"				if(nextRowType != currRowType) {\n"
"					rowContainer = createTiddlyElement(table,this.rowTypes[nextRowType]);\n"
"					currRowType = nextRowType;\n"
"				}\n"
"				if(currRowType == \"c\") {\n"
"					// Caption\n"
"					w.nextMatch++;\n"
"					if(rowContainer != table.firstChild)\n"
"						table.insertBefore(rowContainer,table.firstChild);\n"
"					rowContainer.setAttribute(\"align\",rowCount == 0?\"top\":\"bottom\");\n"
"					w.subWikifyTerm(rowContainer,this.rowTermRegExp);\n"
"				} else {\n"
"					var theRow = createTiddlyElement(rowContainer,\"tr\",null,(rowCount&1)?\"oddRow\":\"evenRow\");\n"
"					theRow.onmouseover = function() {addClass(this,\"hoverRow\");};\n"
"					theRow.onmouseout = function() {removeClass(this,\"hoverRow\");};\n"
"					this.rowHandler(w,theRow,prevColumns);\n"
"					rowCount++;\n"
"				}\n"
"			}\n"
"			this.lookaheadRegExp.lastIndex = w.nextMatch;\n"
"			lookaheadMatch = this.lookaheadRegExp.exec(w.source);\n"
"		}\n"
"	},\n"
"	rowHandler: function(w,e,prevColumns)\n"
"	{\n"
"		var col = 0;\n"
"		var colSpanCount = 1;\n"
"		var prevCell = null;\n"
"		this.cellRegExp.lastIndex = w.nextMatch;\n"
"		var cellMatch = this.cellRegExp.exec(w.source);\n"
"		while(cellMatch && cellMatch.index == w.nextMatch) {\n"
"			if(cellMatch[1] == \"~\") {\n"
"				// Rowspan\n"
"				var last = prevColumns[col];\n"
"				if(last) {\n"
"					last.rowSpanCount++;\n"
"					last.element.setAttribute(\"rowspan\",last.rowSpanCount);\n"
"					last.element.setAttribute(\"rowSpan\",last.rowSpanCount); // Needed for IE\n"
"					last.element.valign = \"center\";\n"
"				}\n"
"				w.nextMatch = this.cellRegExp.lastIndex-1;\n"
"			} else if(cellMatch[1] == \">\") {\n"
"				// Colspan\n"
"				colSpanCount++;\n"
"				w.nextMatch = this.cellRegExp.lastIndex-1;\n"
"			} else if(cellMatch[2]) {\n"
"				// End of row\n"
"				if(prevCell && colSpanCount > 1) {\n"
"					prevCell.setAttribute(\"colspan\",colSpanCount);\n"
"					prevCell.setAttribute(\"colSpan\",colSpanCount); // Needed for IE\n"
"				}\n"
"				w.nextMatch = this.cellRegExp.lastIndex;\n"
"				break;\n"
"			} else {\n"
"				// Cell\n"
"				w.nextMatch++;\n"
"				var styles = config.formatterHelpers.inlineCssHelper(w);\n"
"				var spaceLeft = false;\n"
"				var chr = w.source.substr(w.nextMatch,1);\n"
"				while(chr == \" \") {\n"
"					spaceLeft = true;\n"
"					w.nextMatch++;\n"
"					chr = w.source.substr(w.nextMatch,1);\n"
"				}\n"
"				var cell;\n"
"				if(chr == \"!\") {\n"
"					cell = createTiddlyElement(e,\"th\");\n"
"					w.nextMatch++;\n"
"				} else {\n"
"					cell = createTiddlyElement(e,\"td\");\n"
"				}\n"
"				prevCell = cell;\n"
"				prevColumns[col] = {rowSpanCount:1,element:cell};\n"
"				if(colSpanCount > 1) {\n"
"					cell.setAttribute(\"colspan\",colSpanCount);\n"
"					cell.setAttribute(\"colSpan\",colSpanCount); // Needed for IE\n"
"					colSpanCount = 1;\n"
"				}\n"
"				config.formatterHelpers.applyCssHelper(cell,styles);\n"
"				w.subWikifyTerm(cell,this.cellTermRegExp);\n"
"				if(w.matchText.substr(w.matchText.length-2,1) == \" \") // spaceRight\n"
"					cell.align = spaceLeft ? \"center\" : \"left\";\n"
"				else if(spaceLeft)\n"
"					cell.align = \"right\";\n"
"				w.nextMatch--;\n"
"			}\n"
"			col++;\n"
"			this.cellRegExp.lastIndex = w.nextMatch;\n"
"			cellMatch = this.cellRegExp.exec(w.source);\n"
"		}\n"
"	}\n"
"},\n"
"\n"
"{\n"
"	name: \"heading\",\n"
"	match: \"^!{1,6}\",\n"
"	termRegExp: /(\\n)/mg,\n"
"	handler: function(w)\n"
"	{\n"
"		w.subWikifyTerm(createTiddlyElement(w.output,\"h\" + w.matchLength),this.termRegExp);\n"
"	}\n"
"},\n"
"\n"
"{\n"
"	name: \"list\",\n"
"	match: \"^(?:[\\\\*#;:]+)\",\n"
"	lookaheadRegExp: /^(?:(?:(\\*)|(#)|(;)|(:))+)/mg,\n"
"	termRegExp: /(\\n)/mg,\n"
"	handler: function(w)\n"
"	{\n"
"		var stack = [w.output];\n"
"		var currLevel = 0, currType = null;\n"
"		var listLevel, listType, itemType, baseType;\n"
"		w.nextMatch = w.matchStart;\n"
"		this.lookaheadRegExp.lastIndex = w.nextMatch;\n"
"		var lookaheadMatch = this.lookaheadRegExp.exec(w.source);\n"
"		while(lookaheadMatch && lookaheadMatch.index == w.nextMatch) {\n"
"			if(lookaheadMatch[1]) {\n"
"				listType = \"ul\";\n"
"				itemType = \"li\";\n"
"			} else if(lookaheadMatch[2]) {\n"
"				listType = \"ol\";\n"
"				itemType = \"li\";\n"
"			} else if(lookaheadMatch[3]) {\n"
"				listType = \"dl\";\n"
"				itemType = \"dt\";\n"
"			} else if(lookaheadMatch[4]) {\n"
"				listType = \"dl\";\n"
"				itemType = \"dd\";\n"
"			}\n"
"			if(!baseType)\n"
"				baseType = listType;\n"
"			listLevel = lookaheadMatch[0].length;\n"
"			w.nextMatch += lookaheadMatch[0].length;\n"
"			var t;\n"
"			if(listLevel > currLevel) {\n"
"				for(t=currLevel; t<listLevel; t++) {\n"
"					var target = (currLevel == 0) ? stack[stack.length-1] : stack[stack.length-1].lastChild;\n"
"					stack.push(createTiddlyElement(target,listType));\n"
"				}\n"
"			} else if(listType!=baseType && listLevel==1) {\n"
"				w.nextMatch -= lookaheadMatch[0].length;\n"
"				return;\n"
"			} else if(listLevel < currLevel) {\n"
"				for(t=currLevel; t>listLevel; t--)\n"
"					stack.pop();\n"
"			} else if(listLevel == currLevel && listType != currType) {\n"
"				stack.pop();\n"
"				stack.push(createTiddlyElement(stack[stack.length-1].lastChild,listType));\n"
"			}\n"
"			currLevel = listLevel;\n"
"			currType = listType;\n"
"			var e = createTiddlyElement(stack[stack.length-1],itemType);\n"
"			w.subWikifyTerm(e,this.termRegExp);\n"
"			this.lookaheadRegExp.lastIndex = w.nextMatch;\n"
"			lookaheadMatch = this.lookaheadRegExp.exec(w.source);\n"
"		}\n"
"	}\n"
"},\n"
"\n"
"{\n"
"	name: \"quoteByBlock\",\n"
"	match: \"^<<<\\\\n\",\n"
"	termRegExp: /(^<<<(\\n|$))/mg,\n"
"	element: \"blockquote\",\n"
"	handler: config.formatterHelpers.createElementAndWikify\n"
"},\n"
"\n"
"{\n"
"	name: \"quoteByLine\",\n"
"	match: \"^>+\",\n"
"	lookaheadRegExp: /^>+/mg,\n"
"	termRegExp: /(\\n)/mg,\n"
"	element: \"blockquote\",\n"
"	handler: function(w)\n"
"	{\n"
"		var stack = [w.output];\n"
"		var currLevel = 0;\n"
"		var newLevel = w.matchLength;\n"
"		var t;\n"
"		do {\n"
"			if(newLevel > currLevel) {\n"
"				for(t=currLevel; t<newLevel; t++)\n"
"					stack.push(createTiddlyElement(stack[stack.length-1],this.element));\n"
"			} else if(newLevel < currLevel) {\n"
"				for(t=currLevel; t>newLevel; t--)\n"
"					stack.pop();\n"
"			}\n"
"			currLevel = newLevel;\n"
"			w.subWikifyTerm(stack[stack.length-1],this.termRegExp);\n"
"			createTiddlyElement(stack[stack.length-1],\"br\");\n"
"			this.lookaheadRegExp.lastIndex = w.nextMatch;\n"
"			var lookaheadMatch = this.lookaheadRegExp.exec(w.source);\n"
"			var matched = lookaheadMatch && lookaheadMatch.index == w.nextMatch;\n"
"			if(matched) {\n"
"				newLevel = lookaheadMatch[0].length;\n"
"				w.nextMatch += lookaheadMatch[0].length;\n"
"			}\n"
"		} while(matched);\n"
"	}\n"
"},\n"
"\n"
"{\n"
"	name: \"rule\",\n"
"	match: \"^----+$\\\\n?|<hr ?/?>\\\\n?\",\n"
"	handler: function(w)\n"
"	{\n"
"		createTiddlyElement(w.output,\"hr\");\n"
"	}\n"
"},\n"
"\n"
"{\n"
"	name: \"monospacedByLine\",\n"
"	match: \"^(?:/\\\\*\\\\{\\\\{\\\\{\\\\*/|\\\\{\\\\{\\\\{|//\\\\{\\\\{\\\\{|<!--\\\\{\\\\{\\\\{-->)\\\\n\",\n"
"	element: \"pre\",\n"
"	handler: function(w)\n"
"	{\n"
"		switch(w.matchText) {\n"
"		case \"/*{{{*/\\n\": // CSS\n"
"			this.lookaheadRegExp = /\\/\\*\\{\\{\\{\\*\\/\\n*((?:^[^\\n]*\\n)+?)(\\n*^\\/\\*\\}\\}\\}\\*\\/$\\n?)/mg;\n"
"			break;\n"
"		case \"{{{\\n\": // monospaced block\n"
"			this.lookaheadRegExp = /^\\{\\{\\{\\n((?:^[^\\n]*\\n)+?)(^\\}\\}\\}$\\n?)/mg;\n"
"			break;\n"
"		case \"//{{{\\n\": // plugin\n"
"			this.lookaheadRegExp = /^\\/\\/\\{\\{\\{\\n\\n*((?:^[^\\n]*\\n)+?)(\\n*^\\/\\/\\}\\}\\}$\\n?)/mg;\n"
"			break;\n"
"		case \"<!--{{{-->\\n\": //template\n"
"			this.lookaheadRegExp = /<!--\\{\\{\\{-->\\n*((?:^[^\\n]*\\n)+?)(\\n*^<!--\\}\\}\\}-->$\\n?)/mg;\n"
"			break;\n"
"		default:\n"
"			break;\n"
"		}\n"
"		config.formatterHelpers.enclosedTextHelper.call(this,w);\n"
"	}\n"
"},\n"
"\n"
"{\n"
"	name: \"wikifyComment\",\n"
"	match: \"^(?:/\\\\*\\\\*\\\\*|<!---)\\\\n\",\n"
"	handler: function(w)\n"
"	{\n"
"		var termRegExp = (w.matchText == \"/***\\n\") ? (/(^\\*\\*\\*\\/\\n)/mg) : (/(^--->\\n)/mg);\n"
"		w.subWikifyTerm(w.output,termRegExp);\n"
"	}\n"
"},\n"
"\n"
"{\n"
"	name: \"macro\",\n"
"	match: \"<<\",\n"
"	lookaheadRegExp: /<<([^>\\s]+)(?:\\s*)((?:[^>]|(?:>(?!>)))*)>>/mg,\n"
"	handler: function(w)\n"
"	{\n"
"		this.lookaheadRegExp.lastIndex = w.matchStart;\n"
"		var lookaheadMatch = this.lookaheadRegExp.exec(w.source);\n"
"		if(lookaheadMatch && lookaheadMatch.index == w.matchStart && lookaheadMatch[1]) {\n"
"			w.nextMatch = this.lookaheadRegExp.lastIndex;\n"
"			invokeMacro(w.output,lookaheadMatch[1],lookaheadMatch[2],w,w.tiddler);\n"
"		}\n"
"	}\n"
"},\n"
"\n"
"{\n"
"	name: \"prettyLink\",\n"
"	match: \"\\\\[\\\\[\",\n"
"	lookaheadRegExp: /\\[\\[(.*?)(?:\\|(~)?(.*?))?\\]\\]/mg,\n"
"	handler: function(w)\n"
"	{\n"
"		this.lookaheadRegExp.lastIndex = w.matchStart;\n"
"		var lookaheadMatch = this.lookaheadRegExp.exec(w.source);\n"
"		if(lookaheadMatch && lookaheadMatch.index == w.matchStart) {\n"
"			var e;\n"
"			var text = lookaheadMatch[1];\n"
"			if(lookaheadMatch[3]) {\n"
"				// Pretty bracketted link\n"
"				var link = lookaheadMatch[3];\n"
"				e = (!lookaheadMatch[2] && config.formatterHelpers.isExternalLink(link)) ?\n"
"						createExternalLink(w.output,link) : createTiddlyLink(w.output,decodeURIComponent(link),false,null,w.isStatic,w.tiddler);\n"
"			} else {\n"
"				// Simple bracketted link\n"
"				e = createTiddlyLink(w.output,decodeURIComponent(text),false,null,w.isStatic,w.tiddler);\n"
"			}\n"
"			createTiddlyText(e,text);\n"
"			w.nextMatch = this.lookaheadRegExp.lastIndex;\n"
"		}\n"
"	}\n"
"},\n"
"\n"
"{\n"
"	name: \"wikiLink\",\n"
"	match: config.textPrimitives.unWikiLink+\"?\"+config.textPrimitives.wikiLink,\n"
"	handler: function(w)\n"
"	{\n"
"		if(w.matchText.substr(0,1) == config.textPrimitives.unWikiLink) {\n"
"			w.outputText(w.output,w.matchStart+1,w.nextMatch);\n"
"			return;\n"
"		}\n"
"		if(w.matchStart > 0) {\n"
"			var preRegExp = new RegExp(config.textPrimitives.anyLetterStrict,\"mg\");\n"
"			preRegExp.lastIndex = w.matchStart-1;\n"
"			var preMatch = preRegExp.exec(w.source);\n"
"			if(preMatch.index == w.matchStart-1) {\n"
"				w.outputText(w.output,w.matchStart,w.nextMatch);\n"
"				return;\n"
"			}\n"
"		}\n"
"		if(w.autoLinkWikiWords || store.isShadowTiddler(w.matchText)) {\n"
"			var link = createTiddlyLink(w.output,w.matchText,false,null,w.isStatic,w.tiddler);\n"
"			w.outputText(link,w.matchStart,w.nextMatch);\n"
"		} else {\n"
"			w.outputText(w.output,w.matchStart,w.nextMatch);\n"
"		}\n"
"	}\n"
"},\n"
"\n"
"{\n"
"	name: \"urlLink\",\n"
"	match: config.textPrimitives.urlPattern,\n"
"	handler: function(w)\n"
"	{\n"
"		w.outputText(createExternalLink(w.output,w.matchText),w.matchStart,w.nextMatch);\n"
"	}\n"
"},\n"
"\n"
"{\n"
"	name: \"image\",\n"
"	match: \"\\\\[[<>]?[Ii][Mm][Gg]\\\\[\",\n"
"	lookaheadRegExp: /\\[([<]?)(>?)[Ii][Mm][Gg]\\[(?:([^\\|\\]]+)\\|)?([^\\[\\]\\|]+)\\](?:\\[([^\\]]*)\\])?\\]/mg,\n"
"	handler: function(w)\n"
"	{\n"
"		this.lookaheadRegExp.lastIndex = w.matchStart;\n"
"		var lookaheadMatch = this.lookaheadRegExp.exec(w.source);\n"
"		if(lookaheadMatch && lookaheadMatch.index == w.matchStart) {\n"
"			var e = w.output;\n"
"			if(lookaheadMatch[5]) {\n"
"				var link = lookaheadMatch[5];\n"
"				e = config.formatterHelpers.isExternalLink(link) ? createExternalLink(w.output,link) : createTiddlyLink(w.output,link,false,null,w.isStatic,w.tiddler);\n"
"				addClass(e,\"imageLink\");\n"
"			}\n"
"			var img = createTiddlyElement(e,\"img\");\n"
"			if(lookaheadMatch[1])\n"
"				img.align = \"left\";\n"
"			else if(lookaheadMatch[2])\n"
"				img.align = \"right\";\n"
"			if(lookaheadMatch[3]) {\n"
"				img.title = lookaheadMatch[3];\n"
"				img.setAttribute(\"alt\",lookaheadMatch[3]);\n"
"			}\n"
"			img.src = lookaheadMatch[4];\n"
"			w.nextMatch = this.lookaheadRegExp.lastIndex;\n"
"		}\n"
"	}\n"
"},\n"
"\n"
"{\n"
"	name: \"html\",\n"
"	match: \"<[Hh][Tt][Mm][Ll]>\",\n"
"	lookaheadRegExp: /<[Hh][Tt][Mm][Ll]>((?:.|\\n)*?)<\\/[Hh][Tt][Mm][Ll]>/mg,\n"
"	handler: function(w)\n"
"	{\n"
"		this.lookaheadRegExp.lastIndex = w.matchStart;\n"
"		var lookaheadMatch = this.lookaheadRegExp.exec(w.source);\n"
"		if(lookaheadMatch && lookaheadMatch.index == w.matchStart) {\n"
"			createTiddlyElement(w.output,\"span\").innerHTML = lookaheadMatch[1];\n"
"			w.nextMatch = this.lookaheadRegExp.lastIndex;\n"
"		}\n"
"	}\n"
"},\n"
"\n"
"{\n"
"	name: \"commentByBlock\",\n"
"	match: \"/%\",\n"
"	lookaheadRegExp: /\\/%((?:.|\\n)*?)%\\//mg,\n"
"	handler: function(w)\n"
"	{\n"
"		this.lookaheadRegExp.lastIndex = w.matchStart;\n"
"		var lookaheadMatch = this.lookaheadRegExp.exec(w.source);\n"
"		if(lookaheadMatch && lookaheadMatch.index == w.matchStart)\n"
"			w.nextMatch = this.lookaheadRegExp.lastIndex;\n"
"	}\n"
"},\n"
"\n"
"{\n"
"	name: \"characterFormat\",\n"
"	match: \"''|//|__|\\\\^\\\\^|~~|--(?!\\\\s|$)|\\\\{\\\\{\\\\{\",\n"
"	handler: function(w)\n"
"	{\n"
"		switch(w.matchText) {\n"
"		case \"''\":\n"
"			w.subWikifyTerm(w.output.appendChild(document.createElement(\"strong\")),/('')/mg);\n"
"			break;\n"
"		case \"//\":\n"
"			w.subWikifyTerm(createTiddlyElement(w.output,\"em\"),/(\\/\\/)/mg);\n"
"			break;\n"
"		case \"__\":\n"
"			w.subWikifyTerm(createTiddlyElement(w.output,\"u\"),/(__)/mg);\n"
"			break;\n"
"		case \"^^\":\n"
"			w.subWikifyTerm(createTiddlyElement(w.output,\"sup\"),/(\\^\\^)/mg);\n"
"			break;\n"
"		case \"~~\":\n"
"			w.subWikifyTerm(createTiddlyElement(w.output,\"sub\"),/(~~)/mg);\n"
"			break;\n"
"		case \"--\":\n"
"			w.subWikifyTerm(createTiddlyElement(w.output,\"strike\"),/(--)/mg);\n"
"			break;\n"
"		case \"{{{\":\n"
"			var lookaheadRegExp = /\\{\\{\\{((?:.|\\n)*?)\\}\\}\\}/mg;\n"
"			lookaheadRegExp.lastIndex = w.matchStart;\n"
"			var lookaheadMatch = lookaheadRegExp.exec(w.source);\n"
"			if(lookaheadMatch && lookaheadMatch.index == w.matchStart) {\n"
"				createTiddlyElement(w.output,\"code\",null,null,lookaheadMatch[1]);\n"
"				w.nextMatch = lookaheadRegExp.lastIndex;\n"
"			}\n"
"			break;\n"
"		}\n"
"	}\n"
"},\n"
"\n"
"{\n"
"	name: \"customFormat\",\n"
"	match: \"@@|\\\\{\\\\{\",\n"
"	handler: function(w)\n"
"	{\n"
"		switch(w.matchText) {\n"
"		case \"@@\":\n"
"			var e = createTiddlyElement(w.output,\"span\");\n"
"			var styles = config.formatterHelpers.inlineCssHelper(w);\n"
"			if(styles.length == 0)\n"
"				e.className = \"marked\";\n"
"			else\n"
"				config.formatterHelpers.applyCssHelper(e,styles);\n"
"			w.subWikifyTerm(e,/(@@)/mg);\n"
"			break;\n"
"		case \"{{\":\n"
"			var lookaheadRegExp = /\\{\\{[\\s]*([\\w]+[\\s\\w]*)[\\s]*\\{(\\n?)/mg;\n"
"			lookaheadRegExp.lastIndex = w.matchStart;\n"
"			var lookaheadMatch = lookaheadRegExp.exec(w.source);\n"
"			if(lookaheadMatch) {\n"
"				w.nextMatch = lookaheadRegExp.lastIndex;\n"
"				e = createTiddlyElement(w.output,lookaheadMatch[2] == \"\\n\" ? \"div\" : \"span\",null,lookaheadMatch[1]);\n"
"				w.subWikifyTerm(e,/(\\}\\}\\})/mg);\n"
"			}\n"
"			break;\n"
"		}\n"
"	}\n"
"},\n"
"\n"
"{\n"
"	name: \"mdash\",\n"
"	match: \"--\",\n"
"	handler: function(w)\n"
"	{\n"
"		createTiddlyElement(w.output,\"span\").innerHTML = \"&mdash;\";\n"
"	}\n"
"},\n"
"\n"
"{\n"
"	name: \"lineBreak\",\n"
"	match: \"\\\\n|<br ?/?>\",\n"
"	handler: function(w)\n"
"	{\n"
"		createTiddlyElement(w.output,\"br\");\n"
"	}\n"
"},\n"
"\n"
"{\n"
"	name: \"rawText\",\n"
"	match: \"\\\"{3}|<nowiki>\",\n"
"	lookaheadRegExp: /(?:\\\"{3}|<nowiki>)((?:.|\\n)*?)(?:\\\"{3}|<\\/nowiki>)/mg,\n"
"	handler: function(w)\n"
"	{\n"
"		this.lookaheadRegExp.lastIndex = w.matchStart;\n"
"		var lookaheadMatch = this.lookaheadRegExp.exec(w.source);\n"
"		if(lookaheadMatch && lookaheadMatch.index == w.matchStart) {\n"
"			createTiddlyElement(w.output,\"span\",null,null,lookaheadMatch[1]);\n"
"			w.nextMatch = this.lookaheadRegExp.lastIndex;\n"
"		}\n"
"	}\n"
"},\n"
"\n"
"{\n"
"	name: \"htmlEntitiesEncoding\",\n"
"	match: \"(?:(?:&#?[a-zA-Z0-9]{2,8};|.)(?:&#?(?:x0*(?:3[0-6][0-9a-fA-F]|1D[c-fC-F][0-9a-fA-F]|20[d-fD-F][0-9a-fA-F]|FE2[0-9a-fA-F])|0*(?:76[89]|7[7-9][0-9]|8[0-7][0-9]|761[6-9]|76[2-7][0-9]|84[0-3][0-9]|844[0-7]|6505[6-9]|6506[0-9]|6507[0-1]));)+|&#?[a-zA-Z0-9]{2,8};)\",\n"
"	handler: function(w)\n"
"	{\n"
"		createTiddlyElement(w.output,\"span\").innerHTML = w.matchText;\n"
"	}\n"
"}\n"
"\n"
"];\n"
"\n"
"//--\n"
"//-- Wikifier\n"
"//--\n"
"\n"
"function getParser(tiddler,format)\n"
"{\n"
"	if(tiddler) {\n"
"		if(!format)\n"
"			format = tiddler.fields[\"wikiformat\"];\n"
"		var i;\n"
"		if(format) {\n"
"			for(i in config.parsers) {\n"
"				if(format == config.parsers[i].format)\n"
"					return config.parsers[i];\n"
"			}\n"
"		} else {\n"
"			for(i in config.parsers) {\n"
"				if(tiddler.isTagged(config.parsers[i].formatTag))\n"
"					return config.parsers[i];\n"
"			}\n"
"		}\n"
"	}\n"
"	return formatter;\n"
"}\n"
"\n"
"function wikify(source,output,highlightRegExp,tiddler)\n"
"{\n"
"	if(source) {\n"
"		var wikifier = new Wikifier(source,getParser(tiddler),highlightRegExp,tiddler);\n"
"		var t0 = new Date();\n"
"		wikifier.subWikify(output);\n"
"		if(tiddler && config.options.chkDisplayInstrumentation)\n"
"			displayMessage(\"wikify:\" +tiddler.title+ \" in \" + (new Date()-t0) + \" ms\");\n"
"	}\n"
"}\n"
"\n"
"function wikifyStatic(source,highlightRegExp,tiddler,format)\n"
"{\n"
"	var e = createTiddlyElement(document.body,\"pre\");\n"
"	e.style.display = \"none\";\n"
"	var html = \"\";\n"
"	if(source && source != \"\") {\n"
"		if(!tiddler)\n"
"			tiddler = new Tiddler(\"temp\");\n"
"		var wikifier = new Wikifier(source,getParser(tiddler,format),highlightRegExp,tiddler);\n"
"		wikifier.isStatic = true;\n"
"		wikifier.subWikify(e);\n"
"		html = e.innerHTML;\n"
"		removeNode(e);\n"
"	}\n"
"	return html;\n"
"}\n"
"\n"
"function wikifyPlain(title,theStore,limit)\n"
"{\n"
"	if(!theStore)\n"
"		theStore = store;\n"
"	if(theStore.tiddlerExists(title) || theStore.isShadowTiddler(title)) {\n"
"		return wikifyPlainText(theStore.getTiddlerText(title),limit,tiddler);\n"
"	} else {\n"
"		return \"\";\n"
"	}\n"
"}\n"
"\n"
"function wikifyPlainText(text,limit,tiddler)\n"
"{\n"
"	if(limit > 0)\n"
"		text = text.substr(0,limit);\n"
"	var wikifier = new Wikifier(text,formatter,null,tiddler);\n"
"	return wikifier.wikifyPlain();\n"
"}\n"
"\n"
"function highlightify(source,output,highlightRegExp,tiddler)\n"
"{\n"
"	if(source) {\n"
"		var wikifier = new Wikifier(source,formatter,highlightRegExp,tiddler);\n"
"		wikifier.outputText(output,0,source.length);\n"
"	}\n"
"}\n"
"\n"
"function Wikifier(source,formatter,highlightRegExp,tiddler)\n"
"{\n"
"	this.source = source;\n"
"	this.output = null;\n"
"	this.formatter = formatter;\n"
"	this.nextMatch = 0;\n"
"	this.autoLinkWikiWords = tiddler && tiddler.autoLinkWikiWords() == false ? false : true;\n"
"	this.highlightRegExp = highlightRegExp;\n"
"	this.highlightMatch = null;\n"
"	this.isStatic = false;\n"
"	if(highlightRegExp) {\n"
"		highlightRegExp.lastIndex = 0;\n"
"		this.highlightMatch = highlightRegExp.exec(source);\n"
"	}\n"
"	this.tiddler = tiddler;\n"
"}\n"
"\n"
"Wikifier.prototype.wikifyPlain = function()\n"
"{\n"
"	var e = createTiddlyElement(document.body,\"div\");\n"
"	e.style.display = \"none\";\n"
"	this.subWikify(e);\n"
"	var text = getPlainText(e);\n"
"	removeNode(e);\n"
"	return text;\n"
"};\n"
"\n"
"Wikifier.prototype.subWikify = function(output,terminator)\n"
"{\n"
"	try {\n"
"		if(terminator)\n"
"			this.subWikifyTerm(output,new RegExp(\"(\" + terminator + \")\",\"mg\"));\n"
"		else\n"
"			this.subWikifyUnterm(output);\n"
"	} catch(ex) {\n"
"		showException(ex);\n"
"	}\n"
"};\n"
"\n"
"Wikifier.prototype.subWikifyUnterm = function(output)\n"
"{\n"
"	var oldOutput = this.output;\n"
"	this.output = output;\n"
"	this.formatter.formatterRegExp.lastIndex = this.nextMatch;\n"
"	var formatterMatch = this.formatter.formatterRegExp.exec(this.source);\n"
"	while(formatterMatch) {\n"
"		// Output any text before the match\n"
"		if(formatterMatch.index > this.nextMatch)\n"
"			this.outputText(this.output,this.nextMatch,formatterMatch.index);\n"
"		// Set the match parameters for the handler\n"
"		this.matchStart = formatterMatch.index;\n"
"		this.matchLength = formatterMatch[0].length;\n"
"		this.matchText = formatterMatch[0];\n"
"		this.nextMatch = this.formatter.formatterRegExp.lastIndex;\n"
"		for(var t=1; t<formatterMatch.length; t++) {\n"
"			if(formatterMatch[t]) {\n"
"				this.formatter.formatters[t-1].handler(this);\n"
"				this.formatter.formatterRegExp.lastIndex = this.nextMatch;\n"
"				break;\n"
"			}\n"
"		}\n"
"		formatterMatch = this.formatter.formatterRegExp.exec(this.source);\n"
"	}\n"
"	if(this.nextMatch < this.source.length) {\n"
"		this.outputText(this.output,this.nextMatch,this.source.length);\n"
"		this.nextMatch = this.source.length;\n"
"	}\n"
"	this.output = oldOutput;\n"
"};\n"
"\n"
"Wikifier.prototype.subWikifyTerm = function(output,terminatorRegExp)\n"
"{\n"
"	var oldOutput = this.output;\n"
"	this.output = output;\n"
"	terminatorRegExp.lastIndex = this.nextMatch;\n"
"	var terminatorMatch = terminatorRegExp.exec(this.source);\n"
"	this.formatter.formatterRegExp.lastIndex = this.nextMatch;\n"
"	var formatterMatch = this.formatter.formatterRegExp.exec(terminatorMatch ? this.source.substr(0,terminatorMatch.index) : this.source);\n"
"	while(terminatorMatch || formatterMatch) {\n"
"		if(terminatorMatch && (!formatterMatch || terminatorMatch.index <= formatterMatch.index)) {\n"
"			if(terminatorMatch.index > this.nextMatch)\n"
"				this.outputText(this.output,this.nextMatch,terminatorMatch.index);\n"
"			this.matchText = terminatorMatch[1];\n"
"			this.matchLength = terminatorMatch[1].length;\n"
"			this.matchStart = terminatorMatch.index;\n"
"			this.nextMatch = this.matchStart + this.matchLength;\n"
"			this.output = oldOutput;\n"
"			return;\n"
"		}\n"
"		if(formatterMatch.index > this.nextMatch)\n"
"			this.outputText(this.output,this.nextMatch,formatterMatch.index);\n"
"		this.matchStart = formatterMatch.index;\n"
"		this.matchLength = formatterMatch[0].length;\n"
"		this.matchText = formatterMatch[0];\n"
"		this.nextMatch = this.formatter.formatterRegExp.lastIndex;\n"
"		for(var t=1; t<formatterMatch.length; t++) {\n"
"			if(formatterMatch[t]) {\n"
"				this.formatter.formatters[t-1].handler(this);\n"
"				this.formatter.formatterRegExp.lastIndex = this.nextMatch;\n"
"				break;\n"
"			}\n"
"		}\n"
"		terminatorRegExp.lastIndex = this.nextMatch;\n"
"		terminatorMatch = terminatorRegExp.exec(this.source);\n"
"		formatterMatch = this.formatter.formatterRegExp.exec(terminatorMatch ? this.source.substr(0,terminatorMatch.index) : this.source);\n"
"	}\n"
"	if(this.nextMatch < this.source.length) {\n"
"		this.outputText(this.output,this.nextMatch,this.source.length);\n"
"		this.nextMatch = this.source.length;\n"
"	}\n"
"	this.output = oldOutput;\n"
"};\n"
"\n"
"Wikifier.prototype.outputText = function(place,startPos,endPos)\n"
"{\n"
"	while(this.highlightMatch && (this.highlightRegExp.lastIndex > startPos) && (this.highlightMatch.index < endPos) && (startPos < endPos)) {\n"
"		if(this.highlightMatch.index > startPos) {\n"
"			createTiddlyText(place,this.source.substring(startPos,this.highlightMatch.index));\n"
"			startPos = this.highlightMatch.index;\n"
"		}\n"
"		var highlightEnd = Math.min(this.highlightRegExp.lastIndex,endPos);\n"
"		var theHighlight = createTiddlyElement(place,\"span\",null,\"highlight\",this.source.substring(startPos,highlightEnd));\n"
"		startPos = highlightEnd;\n"
"		if(startPos >= this.highlightRegExp.lastIndex)\n"
"			this.highlightMatch = this.highlightRegExp.exec(this.source);\n"
"	}\n"
"	if(startPos < endPos) {\n"
"		createTiddlyText(place,this.source.substring(startPos,endPos));\n"
"	}\n"
"};\n"
"\n"
"//--\n"
"//-- Macro definitions\n"
"//--\n"
"\n"
"config.macros.today.handler = function(place,macroName,params)\n"
"{\n"
"	var now = new Date();\n"
"	var text = params[0] ? now.formatString(params[0].trim()) : now.toLocaleString();\n"
"	jQuery(\"<span/>\").text(text).appendTo(place);\n"
"};\n"
"\n"
"config.macros.version.handler = function(place)\n"
"{\n"
"	jQuery(\"<span/>\").text(formatVersion()).appendTo(place);\n"
"};\n"
"\n"
"config.macros.list.handler = function(place,macroName,params)\n"
"{\n"
"	var type = params[0] || \"all\";\n"
"	var list = document.createElement(\"ul\");\n"
"	place.appendChild(list);\n"
"	if(this[type].prompt)\n"
"		createTiddlyElement(list,\"li\",null,\"listTitle\",this[type].prompt);\n"
"	var results;\n"
"	if(this[type].handler)\n"
"		results = this[type].handler(params);\n"
"	for(var t = 0; t < results.length; t++) {\n"
"		var li = document.createElement(\"li\");\n"
"		list.appendChild(li);\n"
"		createTiddlyLink(li,typeof results[t] == \"string\" ? results[t] : results[t].title,true);\n"
"	}\n"
"};\n"
"\n"
"config.macros.list.all.handler = function(params)\n"
"{\n"
"	return store.reverseLookup(\"tags\",\"excludeLists\",false,\"title\");\n"
"};\n"
"\n"
"config.macros.list.missing.handler = function(params)\n"
"{\n"
"	return store.getMissingLinks();\n"
"};\n"
"\n"
"config.macros.list.orphans.handler = function(params)\n"
"{\n"
"	return store.getOrphans();\n"
"};\n"
"\n"
"config.macros.list.shadowed.handler = function(params)\n"
"{\n"
"	return store.getShadowed();\n"
"};\n"
"\n"
"config.macros.list.touched.handler = function(params)\n"
"{\n"
"	return store.getTouched();\n"
"};\n"
"\n"
"config.macros.list.filter.handler = function(params)\n"
"{\n"
"	var filter = params[1];\n"
"	var results = [];\n"
"	if(filter) {\n"
"		var tiddlers = store.filterTiddlers(filter);\n"
"		for(var t=0; t<tiddlers.length; t++)\n"
"			results.push(tiddlers[t].title);\n"
"	}\n"
"	return results;\n"
"};\n"
"\n"
"config.macros.allTags.handler = function(place,macroName,params)\n"
"{\n"
"	var tags = store.getTags(params[0]);\n"
"	var ul = createTiddlyElement(place,\"ul\");\n"
"	if(tags.length == 0)\n"
"		createTiddlyElement(ul,\"li\",null,\"listTitle\",this.noTags);\n"
"	for(var t=0; t<tags.length; t++) {\n"
"		var title = tags[t][0];\n"
"		var info = getTiddlyLinkInfo(title);\n"
"		var li = createTiddlyElement(ul,\"li\");\n"
"		var btn = createTiddlyButton(li,title + \" (\" + tags[t][1] + \")\",this.tooltip.format([title]),onClickTag,info.classes);\n"
"		btn.setAttribute(\"tag\",title);\n"
"		btn.setAttribute(\"refresh\",\"link\");\n"
"		btn.setAttribute(\"tiddlyLink\",title);\n"
"	}\n"
"};\n"
"\n"
"config.macros.timeline.handler = function(place,macroName,params)\n"
"{\n"
"	var field = params[0] || \"modified\";\n"
"	var tiddlers = store.reverseLookup(\"tags\",\"excludeLists\",false,field);\n"
"	var lastDay = \"\";\n"
"	var last = params[1] ? tiddlers.length-Math.min(tiddlers.length,parseInt(params[1])) : 0;\n"
"	var dateFormat = params[2] || this.dateFormat;\n"
"	for(var t=tiddlers.length-1; t>=last; t--) {\n"
"		var tiddler = tiddlers[t];\n"
"		var theDay = tiddler[field].convertToLocalYYYYMMDDHHMM().substr(0,8);\n"
"		if(theDay != lastDay) {\n"
"			var ul = document.createElement(\"ul\");\n"
"			place.appendChild(ul);\n"
"			createTiddlyElement(ul,\"li\",null,\"listTitle\",tiddler[field].formatString(dateFormat));\n"
"			lastDay = theDay;\n"
"		}\n"
"		createTiddlyElement(ul,\"li\",null,\"listLink\").appendChild(createTiddlyLink(place,tiddler.title,true));\n"
"	}\n"
"};\n"
"\n"
"config.macros.tiddler.handler = function(place,macroName,params,wikifier,paramString,tiddler)\n"
"{\n"
"	params = paramString.parseParams(\"name\",null,true,false,true);\n"
"	var names = params[0][\"name\"];\n"
"	var tiddlerName = names[0];\n"
"	var className = names[1] || null;\n"
"	var args = params[0][\"with\"];\n"
"	var wrapper = createTiddlyElement(place,\"span\",null,className);\n"
"	if(!args) {\n"
"		wrapper.setAttribute(\"refresh\",\"content\");\n"
"		wrapper.setAttribute(\"tiddler\",tiddlerName);\n"
"	}\n"
"	var text = store.getTiddlerText(tiddlerName);\n"
"	if(text) {\n"
"		var stack = config.macros.tiddler.tiddlerStack;\n"
"		if(stack.indexOf(tiddlerName) !== -1)\n"
"			return;\n"
"		stack.push(tiddlerName);\n"
"		try {\n"
"			var n = args ? Math.min(args.length,9) : 0;\n"
"			for(var i=0; i<n; i++) {\n"
"				var placeholderRE = new RegExp(\"\\\\$\" + (i + 1),\"mg\");\n"
"				text = text.replace(placeholderRE,args[i]);\n"
"			}\n"
"			config.macros.tiddler.renderText(wrapper,text,tiddlerName,params);\n"
"		} finally {\n"
"			stack.pop();\n"
"		}\n"
"	}\n"
"};\n"
"\n"
"config.macros.tiddler.renderText = function(place,text,tiddlerName,params)\n"
"{\n"
"	wikify(text,place,null,store.getTiddler(tiddlerName));\n"
"};\n"
"\n"
"config.macros.tiddler.tiddlerStack = [];\n"
"\n"
"config.macros.tag.handler = function(place,macroName,params)\n"
"{\n"
"	createTagButton(place,params[0],null,params[1],params[2]);\n"
"};\n"
"\n"
"config.macros.tags.handler = function(place,macroName,params,wikifier,paramString,tiddler)\n"
"{\n"
"	params = paramString.parseParams(\"anon\",null,true,false,false);\n"
"	var ul = createTiddlyElement(place,\"ul\");\n"
"	var title = getParam(params,\"anon\",\"\");\n"
"	if(title && store.tiddlerExists(title))\n"
"		tiddler = store.getTiddler(title);\n"
"	var sep = getParam(params,\"sep\",\" \");\n"
"	var lingo = config.views.wikified.tag;\n"
"	var prompt = tiddler.tags.length == 0 ? lingo.labelNoTags : lingo.labelTags;\n"
"	createTiddlyElement(ul,\"li\",null,\"listTitle\",prompt.format([tiddler.title]));\n"
"	for(var t=0; t<tiddler.tags.length; t++) {\n"
"		var tag = store.getTiddler(tiddler.tags[t]); \n"
"		if(!tag || !tag.tags.contains(\"excludeLists\")) { \n"
"			createTagButton(createTiddlyElement(ul,\"li\"),tiddler.tags[t],tiddler.title);\n"
"			if(t<tiddler.tags.length-1)\n"
"				createTiddlyText(ul,sep);\n"
"		}\n"
"	}\n"
"};\n"
"\n"
"config.macros.tagging.handler = function(place,macroName,params,wikifier,paramString,tiddler)\n"
"{\n"
"	params = paramString.parseParams(\"anon\",null,true,false,false);\n"
"	var ul = createTiddlyElement(place,\"ul\");\n"
"	var title = getParam(params,\"anon\",\"\");\n"
"	if(title == \"\" && tiddler instanceof Tiddler)\n"
"		title = tiddler.title;\n"
"	var sep = getParam(params,\"sep\",\" \");\n"
"	ul.setAttribute(\"title\",this.tooltip.format([title]));\n"
"	var tagged = store.getTaggedTiddlers(title);\n"
"	var prompt = tagged.length == 0 ? this.labelNotTag : this.label;\n"
"	createTiddlyElement(ul,\"li\",null,\"listTitle\",prompt.format([title,tagged.length]));\n"
"	for(var t=0; t<tagged.length; t++) {\n"
"		createTiddlyLink(createTiddlyElement(ul,\"li\"),tagged[t].title,true);\n"
"		if(t<tagged.length-1)\n"
"			createTiddlyText(ul,sep);\n"
"	}\n"
"};\n"
"\n"
"config.macros.closeAll.handler = function(place)\n"
"{\n"
"	createTiddlyButton(place,this.label,this.prompt,this.onClick);\n"
"};\n"
"\n"
"config.macros.closeAll.onClick = function(e)\n"
"{\n"
"	story.closeAllTiddlers();\n"
"	return false;\n"
"};\n"
"\n"
"config.macros.permaview.handler = function(place)\n"
"{\n"
"	createTiddlyButton(place,this.label,this.prompt,this.onClick);\n"
"};\n"
"\n"
"config.macros.permaview.onClick = function(e)\n"
"{\n"
"	story.permaView();\n"
"	return false;\n"
"};\n"
"\n"
"config.macros.saveChanges.handler = function(place,macroName,params)\n"
"{\n"
"	if(!readOnly)\n"
"		createTiddlyButton(place,params[0] || this.label,params[1] || this.prompt,this.onClick,null,null,this.accessKey);\n"
"};\n"
"\n"
"config.macros.saveChanges.onClick = function(e)\n"
"{\n"
"	saveChanges();\n"
"	return false;\n"
"};\n"
"\n"
"config.macros.slider.onClickSlider = function(ev)\n"
"{\n"
"	var e = ev || window.event;\n"
"	var n = this.nextSibling;\n"
"	var cookie = n.getAttribute(\"cookie\");\n"
"	var isOpen = n.style.display != \"none\";\n"
"	if(config.options.chkAnimate && anim && typeof Slider == \"function\")\n"
"		anim.startAnimating(new Slider(n,!isOpen,null,\"none\"));\n"
"	else\n"
"		n.style.display = isOpen ? \"none\" : \"block\";\n"
"	config.options[cookie] = !isOpen;\n"
"	saveOptionCookie(cookie);\n"
"	return false;\n"
"};\n"
"\n"
"config.macros.slider.createSlider = function(place,cookie,title,tooltip)\n"
"{\n"
"	var c = cookie || \"\";\n"
"	var btn = createTiddlyButton(place,title,tooltip,this.onClickSlider);\n"
"	var panel = createTiddlyElement(null,\"div\",null,\"sliderPanel\");\n"
"	panel.setAttribute(\"cookie\",c);\n"
"	panel.style.display = config.options[c] ? \"block\" : \"none\";\n"
"	place.appendChild(panel);\n"
"	return panel;\n"
"};\n"
"\n"
"config.macros.slider.handler = function(place,macroName,params)\n"
"{\n"
"	var panel = this.createSlider(place,params[0],params[2],params[3]);\n"
"	var text = store.getTiddlerText(params[1]);\n"
"	panel.setAttribute(\"refresh\",\"content\");\n"
"	panel.setAttribute(\"tiddler\",params[1]);\n"
"	if(text)\n"
"		wikify(text,panel,null,store.getTiddler(params[1]));\n"
"};\n"
"\n"
"// <<gradient [[tiddler name]] vert|horiz rgb rgb rgb rgb... >>\n"
"config.macros.gradient.handler = function(place,macroName,params,wikifier,paramString,tiddler)\n"
"{\n"
"	var panel = wikifier ? createTiddlyElement(place,\"div\",null,\"gradient\") : place;\n"
"	panel.style.position = \"relative\";\n"
"	panel.style.overflow = \"hidden\";\n"
"	panel.style.zIndex = \"0\";\n"
"	if(wikifier) {\n"
"		var styles = config.formatterHelpers.inlineCssHelper(wikifier);\n"
"		config.formatterHelpers.applyCssHelper(panel,styles);\n"
"	}\n"
"	params = paramString.parseParams(\"color\");\n"
"	var locolors = [], hicolors = [];\n"
"	for(var t=2; t<params.length; t++) {\n"
"		var c = params[t].value;\n"
"		if(params[t].name == \"snap\") {\n"
"			hicolors[hicolors.length-1] = c;\n"
"		} else {\n"
"			locolors.push(c);\n"
"			hicolors.push(c);\n"
"		}\n"
"	}\n"
"	drawGradient(panel,params[1].value != \"vert\",locolors,hicolors);\n"
"	if(wikifier)\n"
"		wikifier.subWikify(panel,\">>\");\n"
"	if(document.all) {\n"
"		panel.style.height = \"100%\";\n"
"		panel.style.width = \"100%\";\n"
"	}\n"
"};\n"
"\n"
"config.macros.message.handler = function(place,macroName,params)\n"
"{\n"
"	if(params[0]) {\n"
"		var names = params[0].split(\".\");\n"
"		var lookupMessage = function(root,nameIndex) {\n"
"				if(names[nameIndex] in root) {\n"
"					if(nameIndex < names.length-1)\n"
"						return (lookupMessage(root[names[nameIndex]],nameIndex+1));\n"
"					else\n"
"						return root[names[nameIndex]];\n"
"				} else\n"
"					return null;\n"
"			};\n"
"		var m = lookupMessage(config,0);\n"
"		if(m == null)\n"
"			m = lookupMessage(window,0);\n"
"		createTiddlyText(place,m.toString().format(params.splice(1)));\n"
"	}\n"
"};\n"
"\n"
"\n"
"config.macros.view.views = {\n"
"	text: function(value,place,params,wikifier,paramString,tiddler) {\n"
"		highlightify(value,place,highlightHack,tiddler);\n"
"	},\n"
"	link: function(value,place,params,wikifier,paramString,tiddler) {\n"
"		createTiddlyLink(place,value,true);\n"
"	},\n"
"	wikified: function(value,place,params,wikifier,paramString,tiddler) {\n"
"		if(params[2])\n"
"			value=params[2].unescapeLineBreaks().format([value]);\n"
"		wikify(value,place,highlightHack,tiddler);\n"
"	},\n"
"	date: function(value,place,params,wikifier,paramString,tiddler) {\n"
"		value = Date.convertFromYYYYMMDDHHMM(value);\n"
"		createTiddlyText(place,value.formatString(params[2] ? params[2] : config.views.wikified.dateFormat));\n"
"	}\n"
"};\n"
"\n"
"config.macros.view.handler = function(place,macroName,params,wikifier,paramString,tiddler)\n"
"{\n"
"	if((tiddler instanceof Tiddler) && params[0]) {\n"
"		var value = store.getValue(tiddler,params[0]);\n"
"		if(value) {\n"
"			var type = params[1] || config.macros.view.defaultView;\n"
"			var handler = config.macros.view.views[type];\n"
"			if(handler)\n"
"				handler(value,place,params,wikifier,paramString,tiddler);\n"
"		}\n"
"	}\n"
"};\n"
"\n"
"config.macros.edit.handler = function(place,macroName,params,wikifier,paramString,tiddler)\n"
"{\n"
"	var field = params[0];\n"
"	var rows = params[1] || 0;\n"
"	var defVal = params[2] || '';\n"
"	if((tiddler instanceof Tiddler) && field) {\n"
"		story.setDirty(tiddler.title,true);\n"
"		var e,v;\n"
"		if(field != \"text\" && !rows) {\n"
"			e = createTiddlyElement(null,\"input\");\n"
"			if(tiddler.isReadOnly())\n"
"				e.setAttribute(\"readOnly\",\"readOnly\");\n"
"			e.setAttribute(\"edit\",field);\n"
"			e.setAttribute(\"type\",\"text\");\n"
"			e.value = store.getValue(tiddler,field) || defVal;\n"
"			e.setAttribute(\"size\",\"40\");\n"
"			e.setAttribute(\"autocomplete\",\"off\");\n"
"			place.appendChild(e);\n"
"		} else {\n"
"			var wrapper1 = createTiddlyElement(null,\"fieldset\",null,\"fieldsetFix\");\n"
"			var wrapper2 = createTiddlyElement(wrapper1,\"div\");\n"
"			e = createTiddlyElement(wrapper2,\"textarea\");\n"
"			if(tiddler.isReadOnly())\n"
"				e.setAttribute(\"readOnly\",\"readOnly\");\n"
"			e.value = v = store.getValue(tiddler,field) || defVal;\n"
"			rows = rows || 10;\n"
"			var lines = v.match(/\\n/mg);\n"
"			var maxLines = Math.max(parseInt(config.options.txtMaxEditRows),5);\n"
"			if(lines != null && lines.length > rows)\n"
"				rows = lines.length + 5;\n"
"			rows = Math.min(rows,maxLines);\n"
"			e.setAttribute(\"rows\",rows);\n"
"			e.setAttribute(\"edit\",field);\n"
"			place.appendChild(wrapper1);\n"
"		}\n"
"		return e;\n"
"	}\n"
"};\n"
"\n"
"config.macros.tagChooser.onClick = function(ev)\n"
"{\n"
"	var e = ev || window.event;\n"
"	var lingo = config.views.editor.tagChooser;\n"
"	var popup = Popup.create(this);\n"
"	var tags = store.getTags(this.getAttribute(\"tags\"));\n"
"	if(tags.length == 0)\n"
"		jQuery(\"<li/>\").text(lingo.popupNone).appendTo(jQuery(popup));\n"
"	for(var t=0; t<tags.length; t++) {\n"
"		var tag = createTiddlyButton(createTiddlyElement(popup,\"li\"),tags[t][0],lingo.tagTooltip.format([tags[t][0]]),config.macros.tagChooser.onTagClick);\n"
"		tag.setAttribute(\"tag\",tags[t][0]);\n"
"		tag.setAttribute(\"tiddler\",this.getAttribute(\"tiddler\"));\n"
"	}\n"
"	Popup.show();\n"
"	e.cancelBubble = true;\n"
"	if(e.stopPropagation) e.stopPropagation();\n"
"	return false;\n"
"};\n"
"\n"
"config.macros.tagChooser.onTagClick = function(ev)\n"
"{\n"
"	var e = ev || window.event;\n"
"	if(e.metaKey || e.ctrlKey) stopEvent(e); //# keep popup open on CTRL-click\n"
"	var tag = this.getAttribute(\"tag\");\n"
"	var title = this.getAttribute(\"tiddler\");\n"
"	if(!readOnly)\n"
"		story.setTiddlerTag(title,tag,0);\n"
"	return false;\n"
"};\n"
"\n"
"config.macros.tagChooser.handler = function(place,macroName,params,wikifier,paramString,tiddler)\n"
"{\n"
"	if(tiddler instanceof Tiddler) {\n"
"		var lingo = config.views.editor.tagChooser;\n"
"		var btn = createTiddlyButton(place,lingo.text,lingo.tooltip,this.onClick);\n"
"		btn.setAttribute(\"tiddler\",tiddler.title);\n"
"		btn.setAttribute(\"tags\",params[0]);\n"
"	}\n"
"};\n"
"\n"
"config.macros.refreshDisplay.handler = function(place)\n"
"{\n"
"	createTiddlyButton(place,this.label,this.prompt,this.onClick);\n"
"};\n"
"\n"
"config.macros.refreshDisplay.onClick = function(e)\n"
"{\n"
"	refreshAll();\n"
"	return false;\n"
"};\n"
"\n"
"config.macros.annotations.handler = function(place,macroName,params,wikifier,paramString,tiddler)\n"
"{\n"
"	var title = tiddler ? tiddler.title : null;\n"
"	var a = title ? config.annotations[title] : null;\n"
"	if(!tiddler || !title || !a)\n"
"		return;\n"
"	var text = a.format([title]);\n"
"	wikify(text,createTiddlyElement(place,\"div\",null,\"annotation\"),null,tiddler);\n"
"};\n"
"\n"
"//--\n"
"//-- NewTiddler and NewJournal macros\n"
"//--\n"
"\n"
"config.macros.newTiddler.createNewTiddlerButton = function(place,title,params,label,prompt,accessKey,newFocus,isJournal)\n"
"{\n"
"	var tags = [];\n"
"	for(var t=1; t<params.length; t++) {\n"
"		if((params[t].name == \"anon\" && t != 1) || (params[t].name == \"tag\"))\n"
"			tags.push(params[t].value);\n"
"	}\n"
"	label = getParam(params,\"label\",label);\n"
"	prompt = getParam(params,\"prompt\",prompt);\n"
"	accessKey = getParam(params,\"accessKey\",accessKey);\n"
"	newFocus = getParam(params,\"focus\",newFocus);\n"
"	var customFields = getParam(params,\"fields\",\"\");\n"
"	if(!customFields && !store.isShadowTiddler(title))\n"
"		customFields = String.encodeHashMap(config.defaultCustomFields);\n"
"	var btn = createTiddlyButton(place,label,prompt,this.onClickNewTiddler,null,null,accessKey);\n"
"	btn.setAttribute(\"newTitle\",title);\n"
"	btn.setAttribute(\"isJournal\",isJournal ? \"true\" : \"false\");\n"
"	if(tags.length > 0)\n"
"		btn.setAttribute(\"params\",tags.join(\"|\"));\n"
"	btn.setAttribute(\"newFocus\",newFocus);\n"
"	btn.setAttribute(\"newTemplate\",getParam(params,\"template\",DEFAULT_EDIT_TEMPLATE));\n"
"	if(customFields !== \"\")\n"
"		btn.setAttribute(\"customFields\",customFields);\n"
"	var text = getParam(params,\"text\");\n"
"	if(text !== undefined)\n"
"		btn.setAttribute(\"newText\",text);\n"
"	return btn;\n"
"};\n"
"\n"
"config.macros.newTiddler.onClickNewTiddler = function()\n"
"{\n"
"	var title = this.getAttribute(\"newTitle\");\n"
"	if(this.getAttribute(\"isJournal\") == \"true\") {\n"
"		title = new Date().formatString(title.trim());\n"
"	}\n"
"	var params = this.getAttribute(\"params\");\n"
"	var tags = params ? params.split(\"|\") : [];\n"
"	var focus = this.getAttribute(\"newFocus\");\n"
"	var template = this.getAttribute(\"newTemplate\");\n"
"	var customFields = this.getAttribute(\"customFields\");\n"
"	if(!customFields && !store.isShadowTiddler(title))\n"
"		customFields = String.encodeHashMap(config.defaultCustomFields);\n"
"	story.displayTiddler(null,title,template,false,null,null);\n"
"	var tiddlerElem = story.getTiddler(title);\n"
"	if(customFields)\n"
"		story.addCustomFields(tiddlerElem,customFields);\n"
"	var text = this.getAttribute(\"newText\");\n"
"	if(typeof text == \"string\" && story.getTiddlerField(title,\"text\"))\n"
"		story.getTiddlerField(title,\"text\").value = text.format([title]);\n"
"	for(var t=0;t<tags.length;t++)\n"
"		story.setTiddlerTag(title,tags[t],+1);\n"
"	story.focusTiddler(title,focus);\n"
"	return false;\n"
"};\n"
"\n"
"config.macros.newTiddler.handler = function(place,macroName,params,wikifier,paramString)\n"
"{\n"
"	if(!readOnly) {\n"
"		params = paramString.parseParams(\"anon\",null,true,false,false);\n"
"		var title = params[1] && params[1].name == \"anon\" ? params[1].value : this.title;\n"
"		title = getParam(params,\"title\",title);\n"
"		this.createNewTiddlerButton(place,title,params,this.label,this.prompt,this.accessKey,\"title\",false);\n"
"	}\n"
"};\n"
"\n"
"config.macros.newJournal.handler = function(place,macroName,params,wikifier,paramString)\n"
"{\n"
"	if(!readOnly) {\n"
"		params = paramString.parseParams(\"anon\",null,true,false,false);\n"
"		var title = params[1] && params[1].name == \"anon\" ? params[1].value : config.macros.timeline.dateFormat;\n"
"		title = getParam(params,\"title\",title);\n"
"		config.macros.newTiddler.createNewTiddlerButton(place,title,params,this.label,this.prompt,this.accessKey,\"text\",true);\n"
"	}\n"
"};\n"
"\n"
"//--\n"
"//-- Search macro\n"
"//--\n"
"\n"
"config.macros.search.handler = function(place,macroName,params)\n"
"{\n"
"	var searchTimeout = null;\n"
"	var btn = createTiddlyButton(place,this.label,this.prompt,this.onClick,\"searchButton\");\n"
"	var txt = createTiddlyElement(null,\"input\",null,\"txtOptionInput searchField\");\n"
"	if(params[0])\n"
"		txt.value = params[0];\n"
"	if(config.browser.isSafari) {\n"
"		txt.setAttribute(\"type\",\"search\");\n"
"		txt.setAttribute(\"results\",\"5\");\n"
"	} else {\n"
"		txt.setAttribute(\"type\",\"text\");\n"
"	}\n"
"	place.appendChild(txt);\n"
"	txt.onkeyup = this.onKeyPress;\n"
"	txt.onfocus = this.onFocus;\n"
"	txt.setAttribute(\"size\",this.sizeTextbox);\n"
"	txt.setAttribute(\"accessKey\",params[1] || this.accessKey);\n"
"	txt.setAttribute(\"autocomplete\",\"off\");\n"
"	txt.setAttribute(\"lastSearchText\",\"\");\n"
"};\n"
"\n"
"// Global because there's only ever one outstanding incremental search timer\n"
"config.macros.search.timeout = null;\n"
"\n"
"config.macros.search.doSearch = function(txt)\n"
"{\n"
"	if(txt.value.length > 0) {\n"
"		story.search(txt.value,config.options.chkCaseSensitiveSearch,config.options.chkRegExpSearch);\n"
"		txt.setAttribute(\"lastSearchText\",txt.value);\n"
"	}\n"
"};\n"
"\n"
"config.macros.search.onClick = function(e)\n"
"{\n"
"	config.macros.search.doSearch(this.nextSibling);\n"
"	return false;\n"
"};\n"
"\n"
"config.macros.search.onKeyPress = function(ev)\n"
"{\n"
"	var e = ev || window.event;\n"
"	switch(e.keyCode) {\n"
"		case 13: // Ctrl-Enter\n"
"		case 10: // Ctrl-Enter on IE PC\n"
"			config.macros.search.doSearch(this);\n"
"			break;\n"
"		case 27: // Escape\n"
"			this.value = \"\";\n"
"			clearMessage();\n"
"			break;\n"
"	}\n"
"	if(config.options.chkIncrementalSearch) {\n"
"		if(this.value.length > 2) {\n"
"			if(this.value != this.getAttribute(\"lastSearchText\")) {\n"
"				if(config.macros.search.timeout)\n"
"					clearTimeout(config.macros.search.timeout);\n"
"				var txt = this;\n"
"				config.macros.search.timeout = setTimeout(function() {config.macros.search.doSearch(txt);},500);\n"
"			}\n"
"		} else {\n"
"			if(config.macros.search.timeout)\n"
"				clearTimeout(config.macros.search.timeout);\n"
"		}\n"
"	}\n"
"};\n"
"\n"
"config.macros.search.onFocus = function(e)\n"
"{\n"
"	this.select();\n"
"};\n"
"\n"
"//--\n"
"//-- Tabs macro\n"
"//--\n"
"\n"
"config.macros.tabs.handler = function(place,macroName,params)\n"
"{\n"
"	var cookie = params[0];\n"
"	var numTabs = (params.length-1)/3;\n"
"	var wrapper = createTiddlyElement(null,\"div\",null,\"tabsetWrapper \" + cookie);\n"
"	var tabset = createTiddlyElement(wrapper,\"div\",null,\"tabset\");\n"
"	tabset.setAttribute(\"cookie\",cookie);\n"
"	var validTab = false;\n"
"	for(var t=0; t<numTabs; t++) {\n"
"		var label = params[t*3+1];\n"
"		var prompt = params[t*3+2];\n"
"		var content = params[t*3+3];\n"
"		var tab = createTiddlyButton(tabset,label,prompt,this.onClickTab,\"tab tabUnselected\");\n"
"		tab.setAttribute(\"tab\",label);\n"
"		tab.setAttribute(\"content\",content);\n"
"		tab.title = prompt;\n"
"		if(config.options[cookie] == label)\n"
"			validTab = true;\n"
"	}\n"
"	if(!validTab)\n"
"		config.options[cookie] = params[1];\n"
"	place.appendChild(wrapper);\n"
"	this.switchTab(tabset,config.options[cookie]);\n"
"};\n"
"\n"
"config.macros.tabs.onClickTab = function(e)\n"
"{\n"
"	config.macros.tabs.switchTab(this.parentNode,this.getAttribute(\"tab\"));\n"
"	return false;\n"
"};\n"
"\n"
"config.macros.tabs.switchTab = function(tabset,tab)\n"
"{\n"
"	var cookie = tabset.getAttribute(\"cookie\");\n"
"	var theTab = null;\n"
"	var nodes = tabset.childNodes;\n"
"	for(var t=0; t<nodes.length; t++) {\n"
"		if(nodes[t].getAttribute && nodes[t].getAttribute(\"tab\") == tab) {\n"
"			theTab = nodes[t];\n"
"			theTab.className = \"tab tabSelected\";\n"
"		} else {\n"
"			nodes[t].className = \"tab tabUnselected\";\n"
"		}\n"
"	}\n"
"	if(theTab) {\n"
"		if(tabset.nextSibling && tabset.nextSibling.className == \"tabContents\")\n"
"			removeNode(tabset.nextSibling);\n"
"		var tabContent = createTiddlyElement(null,\"div\",null,\"tabContents\");\n"
"		tabset.parentNode.insertBefore(tabContent,tabset.nextSibling);\n"
"		var contentTitle = theTab.getAttribute(\"content\");\n"
"		wikify(store.getTiddlerText(contentTitle),tabContent,null,store.getTiddler(contentTitle));\n"
"		if(cookie) {\n"
"			config.options[cookie] = tab;\n"
"			saveOptionCookie(cookie);\n"
"		}\n"
"	}\n"
"};\n"
"\n"
"//--\n"
"//-- Tiddler toolbar\n"
"//--\n"
"\n"
"// Create a toolbar command button\n"
"config.macros.toolbar.createCommand = function(place,commandName,tiddler,className)\n"
"{\n"
"	if(typeof commandName != \"string\") {\n"
"		var c = null;\n"
"		for(var t in config.commands) {\n"
"			if(config.commands[t] == commandName)\n"
"				c = t;\n"
"		}\n"
"		commandName = c;\n"
"	}\n"
"	if((tiddler instanceof Tiddler) && (typeof commandName == \"string\")) {\n"
"		var command = config.commands[commandName];\n"
"		if(command.isEnabled ? command.isEnabled(tiddler) : this.isCommandEnabled(command,tiddler)) {\n"
"			var text = command.getText ? command.getText(tiddler) : this.getCommandText(command,tiddler);\n"
"			var tooltip = command.getTooltip ? command.getTooltip(tiddler) : this.getCommandTooltip(command,tiddler);\n"
"			var cmd;\n"
"			switch(command.type) {\n"
"			case \"popup\":\n"
"				cmd = this.onClickPopup;\n"
"				break;\n"
"			case \"command\":\n"
"			default:\n"
"				cmd = this.onClickCommand;\n"
"				break;\n"
"			}\n"
"			var btn = createTiddlyButton(null,text,tooltip,cmd);\n"
"			btn.setAttribute(\"commandName\",commandName);\n"
"			btn.setAttribute(\"tiddler\",tiddler.title);\n"
"			addClass(btn,\"command_\" + commandName);\n"
"			if(className)\n"
"				addClass(btn,className);\n"
"			place.appendChild(btn);\n"
"		}\n"
"	}\n"
"};\n"
"\n"
"config.macros.toolbar.isCommandEnabled = function(command,tiddler)\n"
"{\n"
"	var title = tiddler.title;\n"
"	var ro = tiddler.isReadOnly();\n"
"	var shadow = store.isShadowTiddler(title) && !store.tiddlerExists(title);\n"
"	return (!ro || (ro && !command.hideReadOnly)) && !(shadow && command.hideShadow);\n"
"};\n"
"\n"
"config.macros.toolbar.getCommandText = function(command,tiddler)\n"
"{\n"
"	return tiddler.isReadOnly() && command.readOnlyText || command.text;\n"
"};\n"
"\n"
"config.macros.toolbar.getCommandTooltip = function(command,tiddler)\n"
"{\n"
"	return tiddler.isReadOnly() && command.readOnlyTooltip || command.tooltip;\n"
"};\n"
"\n"
"config.macros.toolbar.onClickCommand = function(ev)\n"
"{\n"
"	var e = ev || window.event;\n"
"	e.cancelBubble = true;\n"
"	if(e.stopPropagation) e.stopPropagation();\n"
"	var command = config.commands[this.getAttribute(\"commandName\")];\n"
"	return command.handler(e,this,this.getAttribute(\"tiddler\"));\n"
"};\n"
"\n"
"config.macros.toolbar.onClickPopup = function(ev)\n"
"{\n"
"	var e = ev || window.event;\n"
"	e.cancelBubble = true;\n"
"	if(e.stopPropagation) e.stopPropagation();\n"
"	var popup = Popup.create(this);\n"
"	var command = config.commands[this.getAttribute(\"commandName\")];\n"
"	var title = this.getAttribute(\"tiddler\");\n"
"	var tiddler = store.fetchTiddler(title);\n"
"	popup.setAttribute(\"tiddler\",title);\n"
"	command.handlePopup(popup,title);\n"
"	Popup.show();\n"
"	return false;\n"
"};\n"
"\n"
"// Invoke the first command encountered from a given place that is tagged with a specified class\n"
"config.macros.toolbar.invokeCommand = function(place,className,event)\n"
"{\n"
"	var children = place.getElementsByTagName(\"a\");\n"
"	for(var t=0; t<children.length; t++) {\n"
"		var c = children[t];\n"
"		if(hasClass(c,className) && c.getAttribute && c.getAttribute(\"commandName\")) {\n"
"			if(c.onclick instanceof Function)\n"
"				c.onclick.call(c,event);\n"
"			break;\n"
"		}\n"
"	}\n"
"};\n"
"\n"
"config.macros.toolbar.onClickMore = function(ev)\n"
"{\n"
"	var e = this.nextSibling;\n"
"	e.style.display = \"inline\";\n"
"	this.style.display = \"none\";\n"
"	return false;\n"
"};\n"
"\n"
"config.macros.toolbar.onClickLess = function(ev)\n"
"{\n"
"	var e = this.parentNode;\n"
"	var m = e.previousSibling;\n"
"	e.style.display = \"none\";\n"
"	m.style.display = \"inline\";\n"
"	return false;\n"
"};\n"
"\n"
"config.macros.toolbar.handler = function(place,macroName,params,wikifier,paramString,tiddler)\n"
"{\n"
"	for(var t=0; t<params.length; t++) {\n"
"		var c = params[t];\n"
"		switch(c) {\n"
"		case \"!\":\n"
"			createTiddlyText(place,this.separator);\n"
"			break;\n"
"		case \"*\":\n"
"			createTiddlyElement(place,\"br\");\n"
"			break;\n"
"		case \"<\":\n"
"			var btn = createTiddlyButton(place,this.lessLabel,this.lessPrompt,config.macros.toolbar.onClickLess);\n"
"			addClass(btn,\"lessCommand\");\n"
"			break;\n"
"		case \">\":\n"
"			var btn = createTiddlyButton(place,this.moreLabel,this.morePrompt,config.macros.toolbar.onClickMore);\n"
"			addClass(btn,\"moreCommand\");\n"
"			var e = createTiddlyElement(place,\"span\",null,\"moreCommand\");\n"
"			e.style.display = \"none\";\n"
"			place = e;\n"
"			break;\n"
"		default:\n"
"			var className = \"\";\n"
"			switch(c.substr(0,1)) {\n"
"			case \"+\":\n"
"				className = \"defaultCommand\";\n"
"				c = c.substr(1);\n"
"				break;\n"
"			case \"-\":\n"
"				className = \"cancelCommand\";\n"
"				c = c.substr(1);\n"
"				break;\n"
"			}\n"
"			if(c in config.commands)\n"
"				this.createCommand(place,c,tiddler,className);\n"
"			break;\n"
"		}\n"
"	}\n"
"};\n"
"\n"
"//--\n"
"//-- Menu and toolbar commands\n"
"//--\n"
"\n"
"config.commands.closeTiddler.handler = function(event,src,title)\n"
"{\n"
"	if(story.isDirty(title) && !readOnly) {\n"
"		if(!confirm(config.commands.cancelTiddler.warning.format([title])))\n"
"			return false;\n"
"	}\n"
"	story.setDirty(title,false);\n"
"	story.closeTiddler(title,true);\n"
"	return false;\n"
"};\n"
"\n"
"config.commands.closeOthers.handler = function(event,src,title)\n"
"{\n"
"	story.closeAllTiddlers(title);\n"
"	return false;\n"
"};\n"
"\n"
"config.commands.editTiddler.handler = function(event,src,title)\n"
"{\n"
"	clearMessage();\n"
"	var tiddlerElem = story.getTiddler(title);\n"
"	var fields = tiddlerElem.getAttribute(\"tiddlyFields\");\n"
"	story.displayTiddler(null,title,DEFAULT_EDIT_TEMPLATE,false,null,fields);\n"
"	story.focusTiddler(title,config.options.txtEditorFocus||\"text\");\n"
"	return false;\n"
"};\n"
"\n"
"config.commands.saveTiddler.handler = function(event,src,title)\n"
"{\n"
"	var newTitle = story.saveTiddler(title,event.shiftKey);\n"
"	if(newTitle)\n"
"		story.displayTiddler(null,newTitle);\n"
"	return false;\n"
"};\n"
"\n"
"config.commands.cancelTiddler.handler = function(event,src,title)\n"
"{\n"
"	if(story.hasChanges(title) && !readOnly) {\n"
"		if(!confirm(this.warning.format([title])))\n"
"			return false;\n"
"	}\n"
"	story.setDirty(title,false);\n"
"	story.displayTiddler(null,title);\n"
"	return false;\n"
"};\n"
"\n"
"config.commands.deleteTiddler.handler = function(event,src,title)\n"
"{\n"
"	var deleteIt = true;\n"
"	if(config.options.chkConfirmDelete)\n"
"		deleteIt = confirm(this.warning.format([title]));\n"
"	if(deleteIt) {\n"
"		store.removeTiddler(title);\n"
"		story.closeTiddler(title,true);\n"
"		autoSaveChanges();\n"
"	}\n"
"	return false;\n"
"};\n"
"\n"
"config.commands.permalink.handler = function(event,src,title)\n"
"{\n"
"	var t = encodeURIComponent(String.encodeTiddlyLink(title));\n"
"	if(window.location.hash != t)\n"
"		window.location.hash = t;\n"
"	return false;\n"
"};\n"
"\n"
"config.commands.references.handlePopup = function(popup,title)\n"
"{\n"
"	var references = store.getReferringTiddlers(title);\n"
"	var c = false;\n"
"	for(var r=0; r<references.length; r++) {\n"
"		if(references[r].title != title && !references[r].isTagged(\"excludeLists\")) {\n"
"			createTiddlyLink(createTiddlyElement(popup,\"li\"),references[r].title,true);\n"
"			c = true;\n"
"		}\n"
"	}\n"
"	if(!c)\n"
"		createTiddlyElement(popup,\"li\",null,\"disabled\",this.popupNone);\n"
"};\n"
"\n"
"config.commands.jump.handlePopup = function(popup,title)\n"
"{\n"
"	story.forEachTiddler(function(title,element) {\n"
"		createTiddlyLink(createTiddlyElement(popup,\"li\"),title,true,null,false,null,true);\n"
"		});\n"
"};\n"
"\n"
"config.commands.syncing.handlePopup = function(popup,title)\n"
"{\n"
"	var tiddler = store.fetchTiddler(title);\n"
"	if(!tiddler)\n"
"		return;\n"
"	var serverType = tiddler.getServerType();\n"
"	var serverHost = tiddler.fields[\"server.host\"];\n"
"	var serverWorkspace = tiddler.fields[\"server.workspace\"];\n"
"	if(!serverWorkspace)\n"
"		serverWorkspace = \"\";\n"
"	if(serverType) {\n"
"		var e = createTiddlyElement(popup,\"li\",null,\"popupMessage\");\n"
"		e.innerHTML = config.commands.syncing.currentlySyncing.format([serverType,serverHost,serverWorkspace]);\n"
"	} else {\n"
"		createTiddlyElement(popup,\"li\",null,\"popupMessage\",config.commands.syncing.notCurrentlySyncing);\n"
"	}\n"
"	if(serverType) {\n"
"		createTiddlyElement(createTiddlyElement(popup,\"li\",null,\"listBreak\"),\"div\");\n"
"		var btn = createTiddlyButton(createTiddlyElement(popup,\"li\"),this.captionUnSync,null,config.commands.syncing.onChooseServer);\n"
"		btn.setAttribute(\"tiddler\",title);\n"
"		btn.setAttribute(\"server.type\",\"\");\n"
"	}\n"
"	createTiddlyElement(createTiddlyElement(popup,\"li\",null,\"listBreak\"),\"div\");\n"
"	createTiddlyElement(popup,\"li\",null,\"popupMessage\",config.commands.syncing.chooseServer);\n"
"	var feeds = store.getTaggedTiddlers(\"systemServer\",\"title\");\n"
"	for(var t=0; t<feeds.length; t++) {\n"
"		var f = feeds[t];\n"
"		var feedServerType = store.getTiddlerSlice(f.title,\"Type\");\n"
"		if(!feedServerType)\n"
"			feedServerType = \"file\";\n"
"		var feedServerHost = store.getTiddlerSlice(f.title,\"URL\");\n"
"		if(!feedServerHost)\n"
"			feedServerHost = \"\";\n"
"		var feedServerWorkspace = store.getTiddlerSlice(f.title,\"Workspace\");\n"
"		if(!feedServerWorkspace)\n"
"			feedServerWorkspace = \"\";\n"
"		var caption = f.title;\n"
"		if(serverType == feedServerType && serverHost == feedServerHost && serverWorkspace == feedServerWorkspace) {\n"
"			caption = config.commands.syncing.currServerMarker + caption;\n"
"		} else {\n"
"			caption = config.commands.syncing.notCurrServerMarker + caption;\n"
"		}\n"
"		btn = createTiddlyButton(createTiddlyElement(popup,\"li\"),caption,null,config.commands.syncing.onChooseServer);\n"
"		btn.setAttribute(\"tiddler\",title);\n"
"		btn.setAttribute(\"server.type\",feedServerType);\n"
"		btn.setAttribute(\"server.host\",feedServerHost);\n"
"		btn.setAttribute(\"server.workspace\",feedServerWorkspace);\n"
"	}\n"
"};\n"
"\n"
"config.commands.syncing.onChooseServer = function(e)\n"
"{\n"
"	var tiddler = this.getAttribute(\"tiddler\");\n"
"	var serverType = this.getAttribute(\"server.type\");\n"
"	if(serverType) {\n"
"		store.addTiddlerFields(tiddler,{\n"
"			\"server.type\": serverType,\n"
"			\"server.host\": this.getAttribute(\"server.host\"),\n"
"			\"server.workspace\": this.getAttribute(\"server.workspace\")\n"
"			});\n"
"	} else {\n"
"		store.setValue(tiddler,\"server\",null);\n"
"	}\n"
"	return false;\n"
"};\n"
"\n"
"config.commands.fields.handlePopup = function(popup,title)\n"
"{\n"
"	var tiddler = store.fetchTiddler(title);\n"
"	if(!tiddler)\n"
"		return;\n"
"	var items = [];\n"
"	store.forEachField(tiddler,function(tiddler,fieldName,value){items.push({field:fieldName,value:value});},true);\n"
"	items.sort(function(a,b) {return a.field < b.field ? -1 : (a.field == b.field ? 0 : +1);});\n"
"	if(items.length > 0)\n"
"		ListView.create(popup,items,this.listViewTemplate);\n"
"	else\n"
"		createTiddlyElement(popup,\"div\",null,null,this.emptyText);\n"
"};\n"
"\n"
"//--\n"
"//-- Tiddler() object\n"
"//--\n"
"\n"
"function Tiddler(title)\n"
"{\n"
"	this.title = title;\n"
"	this.text = \"\";\n"
"	this.modifier = null;\n"
"	this.created = new Date();\n"
"	this.modified = this.created;\n"
"	this.links = [];\n"
"	this.linksUpdated = false;\n"
"	this.tags = [];\n"
"	this.fields = {};\n"
"	return this;\n"
"}\n"
"\n"
"Tiddler.prototype.getLinks = function()\n"
"{\n"
"	if(this.linksUpdated==false)\n"
"		this.changed();\n"
"	return this.links;\n"
"};\n"
"\n"
"// Returns the fields that are inherited in string field:\"value\" field2:\"value2\" format\n"
"Tiddler.prototype.getInheritedFields = function()\n"
"{\n"
"	var f = {};\n"
"	for(var i in this.fields) {\n"
"		if(i==\"server.host\" || i==\"server.workspace\" || i==\"wikiformat\"|| i==\"server.type\") {\n"
"			f[i] = this.fields[i];\n"
"		}\n"
"	}\n"
"	return String.encodeHashMap(f);\n"
"};\n"
"\n"
"// Increment the changeCount of a tiddler\n"
"Tiddler.prototype.incChangeCount = function()\n"
"{\n"
"	var c = this.fields['changecount'];\n"
"	c = c ? parseInt(c,10) : 0;\n"
"	this.fields['changecount'] = String(c+1);\n"
"};\n"
"\n"
"// Clear the changeCount of a tiddler\n"
"Tiddler.prototype.clearChangeCount = function()\n"
"{\n"
"	if(this.fields['changecount']) {\n"
"		delete this.fields['changecount'];\n"
"	}\n"
"};\n"
"\n"
"Tiddler.prototype.doNotSave = function()\n"
"{\n"
"	return this.fields['doNotSave'];\n"
"};\n"
"\n"
"// Returns true if the tiddler has been updated since the tiddler was created or downloaded\n"
"Tiddler.prototype.isTouched = function()\n"
"{\n"
"	var changeCount = this.fields['changecount'];\n"
"	if(changeCount === undefined)\n"
"		changeCount = 0;\n"
"	return changeCount > 0;\n"
"};\n"
"\n"
"// Change the text and other attributes of a tiddler\n"
"Tiddler.prototype.set = function(title,text,modifier,modified,tags,created,fields)\n"
"{\n"
"	this.assign(title,text,modifier,modified,tags,created,fields);\n"
"	this.changed();\n"
"	return this;\n"
"};\n"
"\n"
"// Change the text and other attributes of a tiddler without triggered a tiddler.changed() call\n"
"Tiddler.prototype.assign = function(title,text,modifier,modified,tags,created,fields)\n"
"{\n"
"	if(title != undefined)\n"
"		this.title = title;\n"
"	if(text != undefined)\n"
"		this.text = text;\n"
"	if(modifier != undefined)\n"
"		this.modifier = modifier;\n"
"	if(modified != undefined)\n"
"		this.modified = modified;\n"
"	if(created != undefined)\n"
"		this.created = created;\n"
"	if(fields != undefined)\n"
"		this.fields = fields;\n"
"	if(tags != undefined)\n"
"		this.tags = (typeof tags == \"string\") ? tags.readBracketedList() : tags;\n"
"	else if(this.tags == undefined)\n"
"		this.tags = [];\n"
"	return this;\n"
"};\n"
"\n"
"// Get the tags for a tiddler as a string (space delimited, using [[brackets]] for tags containing spaces)\n"
"Tiddler.prototype.getTags = function()\n"
"{\n"
"	return String.encodeTiddlyLinkList(this.tags);\n"
"};\n"
"\n"
"// Test if a tiddler carries a tag\n"
"Tiddler.prototype.isTagged = function(tag)\n"
"{\n"
"	return this.tags.indexOf(tag) != -1;\n"
"};\n"
"\n"
"// Static method to convert \"\\n\" to newlines, \"\\s\" to \"\\\"\n"
"Tiddler.unescapeLineBreaks = function(text)\n"
"{\n"
"	return text ? text.unescapeLineBreaks() : \"\";\n"
"};\n"
"\n"
"// Convert newlines to \"\\n\", \"\\\" to \"\\s\"\n"
"Tiddler.prototype.escapeLineBreaks = function()\n"
"{\n"
"	return this.text.escapeLineBreaks();\n"
"};\n"
"\n"
"// Updates the secondary information (like links[] array) after a change to a tiddler\n"
"Tiddler.prototype.changed = function()\n"
"{\n"
"	this.links = [];\n"
"	var text = this.text;\n"
"	// remove 'quoted' text before scanning tiddler source\n"
"	text = text.replace(/\\/%((?:.|\\n)*?)%\\//g,\"\").\n"
"		replace(/\\{{3}((?:.|\\n)*?)\\}{3}/g,\"\").\n"
"		replace(/\"\"\"((?:.|\\n)*?)\"\"\"/g,\"\").\n"
"		replace(/\\<nowiki\\>((?:.|\\n)*?)\\<\\/nowiki\\>/g,\"\").\n"
"		replace(/\\<html\\>((?:.|\\n)*?)\\<\\/html\\>/g,\"\").\n"
"		replace(/\\<script((?:.|\\n)*?)\\<\\/script\\>/g,\"\");\n"
"	var t = this.autoLinkWikiWords() ? 0 : 1;\n"
"	var tiddlerLinkRegExp = t==0 ? config.textPrimitives.tiddlerAnyLinkRegExp : config.textPrimitives.tiddlerForcedLinkRegExp;\n"
"	tiddlerLinkRegExp.lastIndex = 0;\n"
"	var formatMatch = tiddlerLinkRegExp.exec(text);\n"
"	while(formatMatch) {\n"
"		var lastIndex = tiddlerLinkRegExp.lastIndex;\n"
"		if(t==0 && formatMatch[1] && formatMatch[1] != this.title) {\n"
"			// wikiWordLink\n"
"			if(formatMatch.index > 0) {\n"
"				var preRegExp = new RegExp(config.textPrimitives.unWikiLink+\"|\"+config.textPrimitives.anyLetter,\"mg\");\n"
"				preRegExp.lastIndex = formatMatch.index-1;\n"
"				var preMatch = preRegExp.exec(text);\n"
"				if(preMatch.index != formatMatch.index-1)\n"
"					this.links.pushUnique(formatMatch[1]);\n"
"			} else {\n"
"				this.links.pushUnique(formatMatch[1]);\n"
"			}\n"
"		}\n"
"		else if(formatMatch[2-t] && !config.formatterHelpers.isExternalLink(formatMatch[3-t])) // titledBrackettedLink\n"
"			this.links.pushUnique(formatMatch[3-t]);\n"
"		else if(formatMatch[4-t] && formatMatch[4-t] != this.title) // brackettedLink\n"
"			this.links.pushUnique(formatMatch[4-t]);\n"
"		tiddlerLinkRegExp.lastIndex = lastIndex;\n"
"		formatMatch = tiddlerLinkRegExp.exec(text);\n"
"	}\n"
"	this.linksUpdated = true;\n"
"};\n"
"\n"
"Tiddler.prototype.getSubtitle = function()\n"
"{\n"
"	var modifier = this.modifier;\n"
"	if(!modifier)\n"
"		modifier = config.messages.subtitleUnknown;\n"
"	var modified = this.modified;\n"
"	if(modified)\n"
"		modified = modified.toLocaleString();\n"
"	else\n"
"		modified = config.messages.subtitleUnknown;\n"
"	return config.messages.tiddlerLinkTooltip.format([this.title,modifier,modified]);\n"
"};\n"
"\n"
"Tiddler.prototype.isReadOnly = function()\n"
"{\n"
"	return readOnly;\n"
"};\n"
"\n"
"Tiddler.prototype.autoLinkWikiWords = function()\n"
"{\n"
"	return !(this.isTagged(\"systemConfig\") || this.isTagged(\"excludeMissing\"));\n"
"};\n"
"\n"
"Tiddler.prototype.getServerType = function()\n"
"{\n"
"	var serverType = null;\n"
"	if(this.fields['server.type'])\n"
"		serverType = this.fields['server.type'];\n"
"	if(!serverType)\n"
"		serverType = this.fields['wikiformat'];\n"
"	if(serverType && !config.adaptors[serverType])\n"
"		serverType = null;\n"
"	return serverType;\n"
"};\n"
"\n"
"Tiddler.prototype.getAdaptor = function()\n"
"{\n"
"	var serverType = this.getServerType();\n"
"	return serverType ? new config.adaptors[serverType]() : null;\n"
"};\n"
"\n"
"//--\n"
"//-- TiddlyWiki() object contains Tiddler()s\n"
"//--\n"
"\n"
"function TiddlyWiki()\n"
"{\n"
"	var tiddlers = {}; // Hashmap by name of tiddlers\n"
"	this.tiddlersUpdated = false;\n"
"	this.namedNotifications = []; // Array of {name:,notify:} of notification functions\n"
"	this.notificationLevel = 0;\n"
"	this.slices = {}; // map tiddlerName->(map sliceName->sliceValue). Lazy.\n"
"	this.clear = function() {\n"
"		tiddlers = {};\n"
"		this.setDirty(false);\n"
"	};\n"
"	this.fetchTiddler = function(title) {\n"
"		var t = tiddlers[title];\n"
"		return t instanceof Tiddler ? t : null;\n"
"	};\n"
"	this.deleteTiddler = function(title) {\n"
"		delete this.slices[title];\n"
"		delete tiddlers[title];\n"
"	};\n"
"	this.addTiddler = function(tiddler) {\n"
"		delete this.slices[tiddler.title];\n"
"		tiddlers[tiddler.title] = tiddler;\n"
"	};\n"
"	this.forEachTiddler = function(callback) {\n"
"		for(var t in tiddlers) {\n"
"			var tiddler = tiddlers[t];\n"
"			if(tiddler instanceof Tiddler)\n"
"				callback.call(this,t,tiddler);\n"
"		}\n"
"	};\n"
"}\n"
"\n"
"TiddlyWiki.prototype.setDirty = function(dirty)\n"
"{\n"
"	this.dirty = dirty;\n"
"};\n"
"\n"
"TiddlyWiki.prototype.isDirty = function()\n"
"{\n"
"	return this.dirty;\n"
"};\n"
"\n"
"TiddlyWiki.prototype.tiddlerExists = function(title)\n"
"{\n"
"	var t = this.fetchTiddler(title);\n"
"	return t != undefined;\n"
"};\n"
"\n"
"TiddlyWiki.prototype.isShadowTiddler = function(title)\n"
"{\n"
"	return config.shadowTiddlers[title] === undefined ? false : true;\n"
"};\n"
"\n"
"TiddlyWiki.prototype.createTiddler = function(title)\n"
"{\n"
"	var tiddler = this.fetchTiddler(title);\n"
"	if(!tiddler) {\n"
"		tiddler = new Tiddler(title);\n"
"		this.addTiddler(tiddler);\n"
"		this.setDirty(true);\n"
"	}\n"
"	return tiddler;\n"
"};\n"
"\n"
"TiddlyWiki.prototype.getTiddler = function(title)\n"
"{\n"
"	var t = this.fetchTiddler(title);\n"
"	if(t != undefined)\n"
"		return t;\n"
"	else\n"
"		return null;\n"
"};\n"
"\n"
"TiddlyWiki.prototype.getShadowTiddlerText = function(title)\n"
"{\n"
"	if(typeof config.shadowTiddlers[title] == \"string\")\n"
"		return config.shadowTiddlers[title];\n"
"	else\n"
"		return \"\";\n"
"};\n"
"\n"
"// Retrieve tiddler contents\n"
"TiddlyWiki.prototype.getTiddlerText = function(title,defaultText)\n"
"{\n"
"	if(!title)\n"
"		return defaultText;\n"
"	var pos = title.indexOf(config.textPrimitives.sectionSeparator);\n"
"	var section = null;\n"
"	if(pos != -1) {\n"
"		section = title.substr(pos + config.textPrimitives.sectionSeparator.length);\n"
"		title = title.substr(0,pos);\n"
"	}\n"
"	pos = title.indexOf(config.textPrimitives.sliceSeparator);\n"
"	if(pos != -1) {\n"
"		var slice = this.getTiddlerSlice(title.substr(0,pos),title.substr(pos + config.textPrimitives.sliceSeparator.length));\n"
"		if(slice)\n"
"			return slice;\n"
"	}\n"
"	var tiddler = this.fetchTiddler(title);\n"
"	if(tiddler) {\n"
"		if(!section)\n"
"			return tiddler.text;\n"
"		var re = new RegExp(\"(^!{1,6}\" + section.escapeRegExp() + \"[ \\t]*\\n)\",\"mg\");\n"
"		re.lastIndex = 0;\n"
"		var match = re.exec(tiddler.text);\n"
"		if(match) {\n"
"			var t = tiddler.text.substr(match.index+match[1].length);\n"
"			var re2 = /^!/mg;\n"
"			re2.lastIndex = 0;\n"
"			match = re2.exec(t); //# search for the next heading\n"
"			if(match)\n"
"				t = t.substr(0,match.index-1);//# don't include final \\n\n"
"			return t;\n"
"		}\n"
"		return defaultText;\n"
"	}\n"
"	if(this.isShadowTiddler(title))\n"
"		return this.getShadowTiddlerText(title);\n"
"	if(defaultText != undefined)\n"
"		return defaultText;\n"
"	return null;\n"
"};\n"
"\n"
"TiddlyWiki.prototype.getRecursiveTiddlerText = function(title,defaultText,depth)\n"
"{\n"
"	var bracketRegExp = new RegExp(\"(?:\\\\[\\\\[([^\\\\]]+)\\\\]\\\\])\",\"mg\");\n"
"	var text = this.getTiddlerText(title,null);\n"
"	if(text == null)\n"
"		return defaultText;\n"
"	var textOut = [];\n"
"	var lastPos = 0;\n"
"	do {\n"
"		var match = bracketRegExp.exec(text);\n"
"		if(match) {\n"
"			textOut.push(text.substr(lastPos,match.index-lastPos));\n"
"			if(match[1]) {\n"
"				if(depth <= 0)\n"
"					textOut.push(match[1]);\n"
"				else\n"
"					textOut.push(this.getRecursiveTiddlerText(match[1],\"[[\" + match[1] + \"]]\",depth-1));\n"
"			}\n"
"			lastPos = match.index + match[0].length;\n"
"		} else {\n"
"			textOut.push(text.substr(lastPos));\n"
"		}\n"
"	} while(match);\n"
"	return textOut.join(\"\");\n"
"};\n"
"\n"
"TiddlyWiki.prototype.slicesRE = /(?:^([\\'\\/]{0,2})~?([\\.\\w]+)\\:\\1[\\t\\x20]*([^\\n]+)[\\t\\x20]*$)|(?:^\\|([\\'\\/]{0,2})~?([\\.\\w]+)\\:?\\4\\|[\\t\\x20]*([^\\n]+)[\\t\\x20]*\\|$)/gm;\n"
"\n"
"// @internal\n"
"TiddlyWiki.prototype.calcAllSlices = function(title)\n"
"{\n"
"	var slices = {};\n"
"	var text = this.getTiddlerText(title,\"\");\n"
"	this.slicesRE.lastIndex = 0;\n"
"	var m = this.slicesRE.exec(text);\n"
"	while(m) {\n"
"		if(m[2])\n"
"			slices[m[2]] = m[3];\n"
"		else\n"
"			slices[m[5]] = m[6];\n"
"		m = this.slicesRE.exec(text);\n"
"	}\n"
"	return slices;\n"
"};\n"
"\n"
"// Returns the slice of text of the given name\n"
"TiddlyWiki.prototype.getTiddlerSlice = function(title,sliceName)\n"
"{\n"
"	var slices = this.slices[title];\n"
"	if(!slices) {\n"
"		slices = this.calcAllSlices(title);\n"
"		this.slices[title] = slices;\n"
"	}\n"
"	return slices[sliceName];\n"
"};\n"
"\n"
"// Build an hashmap of the specified named slices of a tiddler\n"
"TiddlyWiki.prototype.getTiddlerSlices = function(title,sliceNames)\n"
"{\n"
"	var r = {};\n"
"	for(var t=0; t<sliceNames.length; t++) {\n"
"		var slice = this.getTiddlerSlice(title,sliceNames[t]);\n"
"		if(slice)\n"
"			r[sliceNames[t]] = slice;\n"
"	}\n"
"	return r;\n"
"};\n"
"\n"
"TiddlyWiki.prototype.suspendNotifications = function()\n"
"{\n"
"	this.notificationLevel--;\n"
"};\n"
"\n"
"TiddlyWiki.prototype.resumeNotifications = function()\n"
"{\n"
"	this.notificationLevel++;\n"
"};\n"
"\n"
"// Invoke the notification handlers for a particular tiddler\n"
"TiddlyWiki.prototype.notify = function(title,doBlanket)\n"
"{\n"
"	if(!this.notificationLevel) {\n"
"		for(var t=0; t<this.namedNotifications.length; t++) {\n"
"			var n = this.namedNotifications[t];\n"
"			if((n.name == null && doBlanket) || (n.name == title))\n"
"				n.notify(title);\n"
"		}\n"
"	}\n"
"};\n"
"\n"
"// Invoke the notification handlers for all tiddlers\n"
"TiddlyWiki.prototype.notifyAll = function()\n"
"{\n"
"	if(!this.notificationLevel) {\n"
"		for(var t=0; t<this.namedNotifications.length; t++) {\n"
"			var n = this.namedNotifications[t];\n"
"			if(n.name)\n"
"				n.notify(n.name);\n"
"		}\n"
"	}\n"
"};\n"
"\n"
"// Add a notification handler to a tiddler\n"
"TiddlyWiki.prototype.addNotification = function(title,fn)\n"
"{\n"
"	for(var i=0; i<this.namedNotifications.length; i++) {\n"
"		if((this.namedNotifications[i].name == title) && (this.namedNotifications[i].notify == fn))\n"
"			return this;\n"
"	}\n"
"	this.namedNotifications.push({name: title, notify: fn});\n"
"	return this;\n"
"};\n"
"\n"
"TiddlyWiki.prototype.removeTiddler = function(title)\n"
"{\n"
"	var tiddler = this.fetchTiddler(title);\n"
"	if(tiddler) {\n"
"		this.deleteTiddler(title);\n"
"		this.notify(title,true);\n"
"		this.setDirty(true);\n"
"	}\n"
"};\n"
"\n"
"// Reset the sync status of a freshly synced tiddler\n"
"TiddlyWiki.prototype.resetTiddler = function(title)\n"
"{\n"
"	var tiddler = this.fetchTiddler(title);\n"
"	if(tiddler) {\n"
"		tiddler.clearChangeCount();\n"
"		this.notify(title,true);\n"
"		this.setDirty(true);\n"
"	}\n"
"};\n"
"\n"
"TiddlyWiki.prototype.setTiddlerTag = function(title,status,tag)\n"
"{\n"
"	var tiddler = this.fetchTiddler(title);\n"
"	if(tiddler) {\n"
"		var t = tiddler.tags.indexOf(tag);\n"
"		if(t != -1)\n"
"			tiddler.tags.splice(t,1);\n"
"		if(status)\n"
"			tiddler.tags.push(tag);\n"
"		tiddler.changed();\n"
"		tiddler.incChangeCount();\n"
"		this.notify(title,true);\n"
"		this.setDirty(true);\n"
"	}\n"
"};\n"
"\n"
"TiddlyWiki.prototype.addTiddlerFields = function(title,fields)\n"
"{\n"
"	var tiddler = this.fetchTiddler(title);\n"
"	if(!tiddler)\n"
"		return;\n"
"	merge(tiddler.fields,fields);\n"
"	tiddler.changed();\n"
"	tiddler.incChangeCount();\n"
"	this.notify(title,true);\n"
"	this.setDirty(true);\n"
"};\n"
"\n"
"// Store tiddler in TiddlyWiki instance\n"
"TiddlyWiki.prototype.saveTiddler = function(title,newTitle,newBody,modifier,modified,tags,fields,clearChangeCount,created)\n"
"{\n"
"	var tiddler = this.fetchTiddler(title);\n"
"	if(tiddler) {\n"
"		created = created || tiddler.created; // Preserve created date\n"
"		this.deleteTiddler(title);\n"
"	} else {\n"
"		created = created || modified;\n"
"		tiddler = new Tiddler();\n"
"	}\n"
"	tiddler.set(newTitle,newBody,modifier,modified,tags,created,fields);\n"
"	this.addTiddler(tiddler);\n"
"	if(clearChangeCount)\n"
"		tiddler.clearChangeCount();\n"
"	else\n"
"		tiddler.incChangeCount();\n"
"	if(title != newTitle)\n"
"		this.notify(title,true);\n"
"	this.notify(newTitle,true);\n"
"	this.setDirty(true);\n"
"	return tiddler;\n"
"};\n"
"\n"
"TiddlyWiki.prototype.incChangeCount = function(title)\n"
"{\n"
"	var tiddler = this.fetchTiddler(title);\n"
"	if(tiddler)\n"
"		tiddler.incChangeCount();\n"
"};\n"
"\n"
"TiddlyWiki.prototype.getLoader = function()\n"
"{\n"
"	if(!this.loader)\n"
"		this.loader = new TW21Loader();\n"
"	return this.loader;\n"
"};\n"
"\n"
"TiddlyWiki.prototype.getSaver = function()\n"
"{\n"
"	if(!this.saver)\n"
"		this.saver = new TW21Saver();\n"
"	return this.saver;\n"
"};\n"
"\n"
"// Return all tiddlers formatted as an HTML string\n"
"TiddlyWiki.prototype.allTiddlersAsHtml = function()\n"
"{\n"
"	return this.getSaver().externalize(store);\n"
"};\n"
"\n"
"// Load contents of a TiddlyWiki from an HTML DIV\n"
"TiddlyWiki.prototype.loadFromDiv = function(src,idPrefix,noUpdate)\n"
"{\n"
"	this.idPrefix = idPrefix;\n"
"	var storeElem = (typeof src == \"string\") ? document.getElementById(src) : src;\n"
"	if(!storeElem)\n"
"		return;\n"
"	var tiddlers = this.getLoader().loadTiddlers(this,storeElem.childNodes);\n"
"	this.setDirty(false);\n"
"	if(!noUpdate) {\n"
"		for(var i = 0;i<tiddlers.length; i++)\n"
"			tiddlers[i].changed();\n"
"	}\n"
"	jQuery().trigger(\"loadTiddlers\");\n"
"};\n"
"\n"
"// Load contents of a TiddlyWiki from a string\n"
"// Returns null if there's an error\n"
"TiddlyWiki.prototype.importTiddlyWiki = function(text)\n"
"{\n"
"	var posDiv = locateStoreArea(text);\n"
"	if(!posDiv)\n"
"		return null;\n"
"	var content = \"<\" + \"html><\" + \"body>\" + text.substring(posDiv[0],posDiv[1] + endSaveArea.length) + \"<\" + \"/body><\" + \"/html>\";\n"
"	// Create the iframe\n"
"	var iframe = document.createElement(\"iframe\");\n"
"	iframe.style.display = \"none\";\n"
"	document.body.appendChild(iframe);\n"
"	var doc = iframe.document;\n"
"	if(iframe.contentDocument)\n"
"		doc = iframe.contentDocument; // For NS6\n"
"	else if(iframe.contentWindow)\n"
"		doc = iframe.contentWindow.document; // For IE5.5 and IE6\n"
"	// Put the content in the iframe\n"
"	doc.open();\n"
"	doc.writeln(content);\n"
"	doc.close();\n"
"	// Load the content into a TiddlyWiki() object\n"
"	var storeArea = doc.getElementById(\"storeArea\");\n"
"	this.loadFromDiv(storeArea,\"store\");\n"
"	// Get rid of the iframe\n"
"	iframe.parentNode.removeChild(iframe);\n"
"	return this;\n"
"};\n"
"\n"
"TiddlyWiki.prototype.updateTiddlers = function()\n"
"{\n"
"	this.tiddlersUpdated = true;\n"
"	this.forEachTiddler(function(title,tiddler) {\n"
"		tiddler.changed();\n"
"	});\n"
"};\n"
"\n"
"// Return an array of tiddlers matching a search regular expression\n"
"TiddlyWiki.prototype.search = function(searchRegExp,sortField,excludeTag,match)\n"
"{\n"
"	var candidates = this.reverseLookup(\"tags\",excludeTag,!!match);\n"
"	var results = [];\n"
"	for(var t=0; t<candidates.length; t++) {\n"
"		if((candidates[t].title.search(searchRegExp) != -1) || (candidates[t].text.search(searchRegExp) != -1))\n"
"			results.push(candidates[t]);\n"
"	}\n"
"	if(!sortField)\n"
"		sortField = \"title\";\n"
"	results.sort(function(a,b) {return a[sortField] < b[sortField] ? -1 : (a[sortField] == b[sortField] ? 0 : +1);});\n"
"	return results;\n"
"};\n"
"\n"
"// Returns a list of all tags in use\n"
"//   excludeTag - if present, excludes tags that are themselves tagged with excludeTag\n"
"// Returns an array of arrays where [tag][0] is the name of the tag and [tag][1] is the number of occurances\n"
"TiddlyWiki.prototype.getTags = function(excludeTag)\n"
"{\n"
"	var results = [];\n"
"	this.forEachTiddler(function(title,tiddler) {\n"
"		for(var g=0; g<tiddler.tags.length; g++) {\n"
"			var tag = tiddler.tags[g];\n"
"			var n = true;\n"
"			for(var c=0; c<results.length; c++) {\n"
"				if(results[c][0] == tag) {\n"
"					n = false;\n"
"					results[c][1]++;\n"
"				}\n"
"			}\n"
"			if(n && excludeTag) {\n"
"				var t = this.fetchTiddler(tag);\n"
"				if(t && t.isTagged(excludeTag))\n"
"					n = false;\n"
"			}\n"
"			if(n)\n"
"				results.push([tag,1]);\n"
"		}\n"
"	});\n"
"	results.sort(function(a,b) {return a[0].toLowerCase() < b[0].toLowerCase() ? -1 : (a[0].toLowerCase() == b[0].toLowerCase() ? 0 : +1);});\n"
"	return results;\n"
"};\n"
"\n"
"// Return an array of the tiddlers that are tagged with a given tag\n"
"TiddlyWiki.prototype.getTaggedTiddlers = function(tag,sortField)\n"
"{\n"
"	return this.reverseLookup(\"tags\",tag,true,sortField);\n"
"};\n"
"\n"
"// Return an array of the tiddlers that link to a given tiddler\n"
"TiddlyWiki.prototype.getReferringTiddlers = function(title,unusedParameter,sortField)\n"
"{\n"
"	if(!this.tiddlersUpdated)\n"
"		this.updateTiddlers();\n"
"	return this.reverseLookup(\"links\",title,true,sortField);\n"
"};\n"
"\n"
"// Return an array of the tiddlers that do or do not have a specified entry in the specified storage array (ie, \"links\" or \"tags\")\n"
"// lookupMatch == true to match tiddlers, false to exclude tiddlers\n"
"TiddlyWiki.prototype.reverseLookup = function(lookupField,lookupValue,lookupMatch,sortField)\n"
"{\n"
"	var results = [];\n"
"	this.forEachTiddler(function(title,tiddler) {\n"
"		var f = !lookupMatch;\n"
"		for(var lookup=0; lookup<tiddler[lookupField].length; lookup++) {\n"
"			if(tiddler[lookupField][lookup] == lookupValue)\n"
"				f = lookupMatch;\n"
"		}\n"
"		if(f)\n"
"			results.push(tiddler);\n"
"	});\n"
"	if(!sortField)\n"
"		sortField = \"title\";\n"
"	results.sort(function(a,b) {return a[sortField] < b[sortField] ? -1 : (a[sortField] == b[sortField] ? 0 : +1);});\n"
"	return results;\n"
"};\n"
"\n"
"// Return the tiddlers as a sorted array\n"
"TiddlyWiki.prototype.getTiddlers = function(field,excludeTag)\n"
"{\n"
"	var results = [];\n"
"	this.forEachTiddler(function(title,tiddler) {\n"
"		if(excludeTag == undefined || !tiddler.isTagged(excludeTag))\n"
"			results.push(tiddler);\n"
"	});\n"
"	if(field)\n"
"		results.sort(function(a,b) {return a[field] < b[field] ? -1 : (a[field] == b[field] ? 0 : +1);});\n"
"	return results;\n"
"};\n"
"\n"
"// Return array of names of tiddlers that are referred to but not defined\n"
"TiddlyWiki.prototype.getMissingLinks = function(sortField)\n"
"{\n"
"	if(!this.tiddlersUpdated)\n"
"		this.updateTiddlers();\n"
"	var results = [];\n"
"	this.forEachTiddler(function (title,tiddler) {\n"
"		if(tiddler.isTagged(\"excludeMissing\") || tiddler.isTagged(\"systemConfig\"))\n"
"			return;\n"
"		for(var n=0; n<tiddler.links.length;n++) {\n"
"			var link = tiddler.links[n];\n"
"			if(this.fetchTiddler(link) == null && !this.isShadowTiddler(link))\n"
"				results.pushUnique(link);\n"
"		}\n"
"	});\n"
"	results.sort();\n"
"	return results;\n"
"};\n"
"\n"
"// Return an array of names of tiddlers that are defined but not referred to\n"
"TiddlyWiki.prototype.getOrphans = function()\n"
"{\n"
"	var results = [];\n"
"	this.forEachTiddler(function (title,tiddler) {\n"
"		if(this.getReferringTiddlers(title).length == 0 && !tiddler.isTagged(\"excludeLists\"))\n"
"			results.push(title);\n"
"	});\n"
"	results.sort();\n"
"	return results;\n"
"};\n"
"\n"
"// Return an array of names of all the shadow tiddlers\n"
"TiddlyWiki.prototype.getShadowed = function()\n"
"{\n"
"	var results = [];\n"
"	for(var t in config.shadowTiddlers) {\n"
"		if(this.isShadowTiddler(t))\n"
"			results.push(t);\n"
"	}\n"
"	results.sort();\n"
"	return results;\n"
"};\n"
"\n"
"// Return an array of tiddlers that have been touched since they were downloaded or created\n"
"TiddlyWiki.prototype.getTouched = function()\n"
"{\n"
"	var results = [];\n"
"	this.forEachTiddler(function(title,tiddler) {\n"
"		if(tiddler.isTouched())\n"
"			results.push(tiddler);\n"
"		});\n"
"	results.sort();\n"
"	return results;\n"
"};\n"
"\n"
"// Resolves a Tiddler reference or tiddler title into a Tiddler object, or null if it doesn't exist\n"
"TiddlyWiki.prototype.resolveTiddler = function(tiddler)\n"
"{\n"
"	var t = (typeof tiddler == \"string\") ? this.getTiddler(tiddler) : tiddler;\n"
"	return t instanceof Tiddler ? t : null;\n"
"};\n"
"\n"
"// Filter a list of tiddlers\n"
"TiddlyWiki.prototype.filterTiddlers = function(filter)\n"
"{\n"
"	var results = [];\n"
"	if(filter) {\n"
"		var tiddler;\n"
"		var re = /([^\\s\\[\\]]+)|(?:\\[([ \\w]+)\\[([^\\]]+)\\]\\])|(?:\\[\\[([^\\]]+)\\]\\])/mg;\n"
"		var match = re.exec(filter);\n"
"		while(match) {\n"
"			if(match[1] || match[4]) {\n"
"				var title = match[1] || match[4];\n"
"				tiddler = this.fetchTiddler(title);\n"
"				if(tiddler) {\n"
"					results.pushUnique(tiddler);\n"
"				} else if(this.isShadowTiddler(title)) {\n"
"					tiddler = new Tiddler();\n"
"					tiddler.set(title,this.getTiddlerText(title));\n"
"					results.pushUnique(tiddler);\n"
"				} else {\n"
"					results.pushUnique(new Tiddler(title));\n"
"				}\n"
"			} else if(match[2]) {\n"
"				switch(match[2]) {\n"
"					case \"tag\":\n"
"						var matched = this.getTaggedTiddlers(match[3]);\n"
"						for(var m = 0; m < matched.length; m++)\n"
"							results.pushUnique(matched[m]);\n"
"						break;\n"
"					case \"sort\":\n"
"						results = this.sortTiddlers(results,match[3]);\n"
"						break;\n"
"				}\n"
"			}\n"
"			match = re.exec(filter);\n"
"		}\n"
"	}\n"
"	return results;\n"
"};\n"
"\n"
"// Sort a list of tiddlers\n"
"TiddlyWiki.prototype.sortTiddlers = function(tiddlers,field)\n"
"{\n"
"	var asc = +1;\n"
"	switch(field.substr(0,1)) {\n"
"	case \"-\":\n"
"		asc = -1;\n"
"		// Note: this fall-through is intentional\n"
"		/*jsl:fallthru*/\n"
"	case \"+\":\n"
"		field = field.substr(1);\n"
"		break;\n"
"	}\n"
"	if(TiddlyWiki.standardFieldAccess[field])\n"
"		tiddlers.sort(function(a,b) {return a[field] < b[field] ? -asc : (a[field] == b[field] ? 0 : asc);});\n"
"	else\n"
"		tiddlers.sort(function(a,b) {return a.fields[field] < b.fields[field] ? -asc : (a.fields[field] == b.fields[field] ? 0 : +asc);});\n"
"	return tiddlers;\n"
"};\n"
"\n"
"// Returns true if path is a valid field name (path),\n"
"// i.e. a sequence of identifiers, separated by \".\"\n"
"TiddlyWiki.isValidFieldName = function(name)\n"
"{\n"
"	var match = /[a-zA-Z_]\\w*(\\.[a-zA-Z_]\\w*)*/.exec(name);\n"
"	return match && (match[0] == name);\n"
"};\n"
"\n"
"// Throws an exception when name is not a valid field name.\n"
"TiddlyWiki.checkFieldName = function(name)\n"
"{\n"
"	if(!TiddlyWiki.isValidFieldName(name))\n"
"		throw config.messages.invalidFieldName.format([name]);\n"
"};\n"
"\n"
"function StringFieldAccess(n,readOnly)\n"
"{\n"
"	this.set = readOnly ?\n"
"			function(t,v) {if(v != t[n]) throw config.messages.fieldCannotBeChanged.format([n]);} :\n"
"			function(t,v) {if(v != t[n]) {t[n] = v; return true;}};\n"
"	this.get = function(t) {return t[n];};\n"
"}\n"
"\n"
"function DateFieldAccess(n)\n"
"{\n"
"	this.set = function(t,v) {\n"
"		var d = v instanceof Date ? v : Date.convertFromYYYYMMDDHHMM(v);\n"
"		if(d != t[n]) {\n"
"			t[n] = d; return true;\n"
"		}\n"
"	};\n"
"	this.get = function(t) {return t[n].convertToYYYYMMDDHHMM();};\n"
"}\n"
"\n"
"function LinksFieldAccess(n)\n"
"{\n"
"	this.set = function(t,v) {\n"
"		var s = (typeof v == \"string\") ? v.readBracketedList() : v;\n"
"		if(s.toString() != t[n].toString()) {\n"
"			t[n] = s; return true;\n"
"		}\n"
"	};\n"
"	this.get = function(t) {return String.encodeTiddlyLinkList(t[n]);};\n"
"}\n"
"\n"
"TiddlyWiki.standardFieldAccess = {\n"
"	// The set functions return true when setting the data has changed the value.\n"
"	\"title\":    new StringFieldAccess(\"title\",true),\n"
"	// Handle the \"tiddler\" field name as the title\n"
"	\"tiddler\":  new StringFieldAccess(\"title\",true),\n"
"	\"text\":     new StringFieldAccess(\"text\"),\n"
"	\"modifier\": new StringFieldAccess(\"modifier\"),\n"
"	\"modified\": new DateFieldAccess(\"modified\"),\n"
"	\"created\":  new DateFieldAccess(\"created\"),\n"
"	\"tags\":     new LinksFieldAccess(\"tags\")\n"
"};\n"
"\n"
"TiddlyWiki.isStandardField = function(name)\n"
"{\n"
"	return TiddlyWiki.standardFieldAccess[name] != undefined;\n"
"};\n"
"\n"
"// Sets the value of the given field of the tiddler to the value.\n"
"// Setting an ExtendedField's value to null or undefined removes the field.\n"
"// Setting a namespace to undefined removes all fields of that namespace.\n"
"// The fieldName is case-insensitive.\n"
"// All values will be converted to a string value.\n"
"TiddlyWiki.prototype.setValue = function(tiddler,fieldName,value)\n"
"{\n"
"	TiddlyWiki.checkFieldName(fieldName);\n"
"	var t = this.resolveTiddler(tiddler);\n"
"	if(!t)\n"
"		return;\n"
"	fieldName = fieldName.toLowerCase();\n"
"	var isRemove = (value === undefined) || (value === null);\n"
"	var accessor = TiddlyWiki.standardFieldAccess[fieldName];\n"
"	if(accessor) {\n"
"		if(isRemove)\n"
"			// don't remove StandardFields\n"
"			return;\n"
"		var h = TiddlyWiki.standardFieldAccess[fieldName];\n"
"		if(!h.set(t,value))\n"
"			return;\n"
"	} else {\n"
"		var oldValue = t.fields[fieldName];\n"
"		if(isRemove) {\n"
"			if(oldValue !== undefined) {\n"
"				// deletes a single field\n"
"				delete t.fields[fieldName];\n"
"			} else {\n"
"				// no concrete value is defined for the fieldName\n"
"				// so we guess this is a namespace path.\n"
"				// delete all fields in a namespace\n"
"				var re = new RegExp(\"^\"+fieldName+\"\\\\.\");\n"
"				var dirty = false;\n"
"				for(var n in t.fields) {\n"
"					if(n.match(re)) {\n"
"						delete t.fields[n];\n"
"						dirty = true;\n"
"					}\n"
"				}\n"
"				if(!dirty)\n"
"					return;\n"
"			}\n"
"		} else {\n"
"			// the \"normal\" set case. value is defined (not null/undefined)\n"
"			// For convenience provide a nicer conversion Date->String\n"
"			value = value instanceof Date ? value.convertToYYYYMMDDHHMMSSMMM() : String(value);\n"
"			if(oldValue == value)\n"
"				return;\n"
"			t.fields[fieldName] = value;\n"
"		}\n"
"	}\n"
"	// When we are here the tiddler/store really was changed.\n"
"	this.notify(t.title,true);\n"
"	if(!fieldName.match(/^temp\\./))\n"
"		this.setDirty(true);\n"
"};\n"
"\n"
"// Returns the value of the given field of the tiddler.\n"
"// The fieldName is case-insensitive.\n"
"// Will only return String values (or undefined).\n"
"TiddlyWiki.prototype.getValue = function(tiddler,fieldName)\n"
"{\n"
"	var t = this.resolveTiddler(tiddler);\n"
"	if(!t)\n"
"		return undefined;\n"
"	fieldName = fieldName.toLowerCase();\n"
"	var accessor = TiddlyWiki.standardFieldAccess[fieldName];\n"
"	if(accessor) {\n"
"		return accessor.get(t);\n"
"	}\n"
"	return t.fields[fieldName];\n"
"};\n"
"\n"
"// Calls the callback function for every field in the tiddler.\n"
"// When callback function returns a non-false value the iteration stops\n"
"// and that value is returned.\n"
"// The order of the fields is not defined.\n"
"// @param callback a function(tiddler,fieldName,value).\n"
"TiddlyWiki.prototype.forEachField = function(tiddler,callback,onlyExtendedFields)\n"
"{\n"
"	var t = this.resolveTiddler(tiddler);\n"
"	if(!t)\n"
"		return undefined;\n"
"	var n,result;\n"
"	for(n in t.fields) {\n"
"		result = callback(t,n,t.fields[n]);\n"
"		if(result)\n"
"			return result;\n"
"		}\n"
"	if(onlyExtendedFields)\n"
"		return undefined;\n"
"	for(n in TiddlyWiki.standardFieldAccess) {\n"
"		if(n == \"tiddler\")\n"
"			// even though the \"title\" field can also be referenced through the name \"tiddler\"\n"
"			// we only visit this field once.\n"
"			continue;\n"
"		result = callback(t,n,TiddlyWiki.standardFieldAccess[n].get(t));\n"
"		if(result)\n"
"			return result;\n"
"	}\n"
"	return undefined;\n"
"};\n"
"\n"
"//--\n"
"//-- Story functions\n"
"//--\n"
"\n"
"function Story(containerId,idPrefix)\n"
"{\n"
"	this.container = containerId;\n"
"	this.idPrefix = idPrefix;\n"
"	this.highlightRegExp = null;\n"
"	this.tiddlerId = function(title) {\n"
"		var id = this.idPrefix + title;\n"
"		return id==this.container ? this.idPrefix + \"_\" + title : id;\n"
"	};\n"
"	this.containerId = function() {\n"
"		return this.container;\n"
"	};\n"
"}\n"
"\n"
"Story.prototype.getTiddler = function(title)\n"
"{\n"
"	return document.getElementById(this.tiddlerId(title));\n"
"};\n"
"\n"
"Story.prototype.getContainer = function()\n"
"{\n"
"	return document.getElementById(this.containerId());\n"
"};\n"
"\n"
"Story.prototype.forEachTiddler = function(fn)\n"
"{\n"
"	var place = this.getContainer();\n"
"	if(!place)\n"
"		return;\n"
"	var e = place.firstChild;\n"
"	while(e) {\n"
"		var n = e.nextSibling;\n"
"		var title = e.getAttribute(\"tiddler\");\n"
"		fn.call(this,title,e);\n"
"		e = n;\n"
"	}\n"
"};\n"
"\n"
"Story.prototype.displayDefaultTiddlers = function()\n"
"{\n"
"	this.displayTiddlers(null,store.filterTiddlers(store.getTiddlerText(\"DefaultTiddlers\")));\n"
"};\n"
"\n"
"Story.prototype.displayTiddlers = function(srcElement,titles,template,animate,unused,customFields,toggle)\n"
"{\n"
"	for(var t = titles.length-1;t>=0;t--)\n"
"		this.displayTiddler(srcElement,titles[t],template,animate,unused,customFields);\n"
"};\n"
"\n"
"Story.prototype.displayTiddler = function(srcElement,tiddler,template,animate,unused,customFields,toggle,animationSrc)\n"
"{\n"
"	var title = (tiddler instanceof Tiddler) ? tiddler.title : tiddler;\n"
"	var tiddlerElem = this.getTiddler(title);\n"
"	if(tiddlerElem) {\n"
"		if(toggle)\n"
"			this.closeTiddler(title,true);\n"
"		else\n"
"			this.refreshTiddler(title,template,false,customFields);\n"
"	} else {\n"
"		var place = this.getContainer();\n"
"		var before = this.positionTiddler(srcElement);\n"
"		tiddlerElem = this.createTiddler(place,before,title,template,customFields);\n"
"	}\n"
"	if(animationSrc && typeof animationSrc !== \"string\") {\n"
"		srcElement = animationSrc;\n"
"	}\n"
"	if(srcElement && typeof srcElement !== \"string\") {\n"
"		if(config.options.chkAnimate && (animate == undefined || animate == true) && anim && typeof Zoomer == \"function\" && typeof Scroller == \"function\")\n"
"			anim.startAnimating(new Zoomer(title,srcElement,tiddlerElem),new Scroller(tiddlerElem));\n"
"		else\n"
"			window.scrollTo(0,ensureVisible(tiddlerElem));\n"
"	}\n"
"};\n"
"\n"
"Story.prototype.positionTiddler = function(srcElement)\n"
"{\n"
"	var place = this.getContainer();\n"
"	var before = null;\n"
"	if(typeof srcElement == \"string\") {\n"
"		switch(srcElement) {\n"
"		case \"top\":\n"
"			before = place.firstChild;\n"
"			break;\n"
"		case \"bottom\":\n"
"			before = null;\n"
"			break;\n"
"		}\n"
"	} else {\n"
"		var after = this.findContainingTiddler(srcElement);\n"
"		if(after == null) {\n"
"			before = place.firstChild;\n"
"		} else if(after.nextSibling) {\n"
"			before = after.nextSibling;\n"
"			if(before.nodeType != 1)\n"
"				before = null;\n"
"		}\n"
"	}\n"
"	return before;\n"
"};\n"
"\n"
"Story.prototype.createTiddler = function(place,before,title,template,customFields)\n"
"{\n"
"	var tiddlerElem = createTiddlyElement(null,\"div\",this.tiddlerId(title),\"tiddler\");\n"
"	tiddlerElem.setAttribute(\"refresh\",\"tiddler\");\n"
"	if(customFields)\n"
"		tiddlerElem.setAttribute(\"tiddlyFields\",customFields);\n"
"	place.insertBefore(tiddlerElem,before);\n"
"	var defaultText = null;\n"
"	if(!store.tiddlerExists(title) && !store.isShadowTiddler(title))\n"
"		defaultText = this.loadMissingTiddler(title,customFields,tiddlerElem);\n"
"	this.refreshTiddler(title,template,false,customFields,defaultText);\n"
"	return tiddlerElem;\n"
"};\n"
"\n"
"Story.prototype.loadMissingTiddler = function(title,fields,tiddlerElem)\n"
"{\n"
"	var getTiddlerCallback = function(context)\n"
"	{\n"
"		if(context.status) {\n"
"			var t = context.tiddler;\n"
"			if(!t.created)\n"
"				t.created = new Date();\n"
"			if(!t.modified)\n"
"				t.modified = t.created;\n"
"			store.saveTiddler(t.title,t.title,t.text,t.modifier,t.modified,t.tags,t.fields,true,t.created);\n"
"			autoSaveChanges();\n"
"		} else {\n"
"			story.refreshTiddler(context.title,null,true);\n"
"		}\n"
"		context.adaptor.close();\n"
"		delete context.adaptor;\n"
"	};\n"
"	var tiddler = new Tiddler(title);\n"
"	tiddler.fields = typeof fields == \"string\" ? fields.decodeHashMap() : fields||{};\n"
"	var context = {serverType:tiddler.getServerType()};\n"
"	if(!context.serverType)\n"
"		return;\n"
"	context.host = tiddler.fields['server.host'];\n"
"	context.workspace = tiddler.fields['server.workspace'];\n"
"	var adaptor = new config.adaptors[context.serverType];\n"
"	adaptor.getTiddler(title,context,null,getTiddlerCallback);\n"
"	return config.messages.loadingMissingTiddler.format([title,context.serverType,context.host,context.workspace]);\n"
"};\n"
"\n"
"Story.prototype.chooseTemplateForTiddler = function(title,template)\n"
"{\n"
"	if(!template)\n"
"		template = DEFAULT_VIEW_TEMPLATE;\n"
"	if(template == DEFAULT_VIEW_TEMPLATE || template == DEFAULT_EDIT_TEMPLATE)\n"
"		template = config.tiddlerTemplates[template];\n"
"	return template;\n"
"};\n"
"\n"
"Story.prototype.getTemplateForTiddler = function(title,template,tiddler)\n"
"{\n"
"	return store.getRecursiveTiddlerText(template,null,10);\n"
"};\n"
"\n"
"Story.prototype.refreshTiddler = function(title,template,force,customFields,defaultText)\n"
"{\n"
"	var tiddlerElem = this.getTiddler(title);\n"
"	if(tiddlerElem) {\n"
"		if(tiddlerElem.getAttribute(\"dirty\") == \"true\" && !force)\n"
"			return tiddlerElem;\n"
"		template = this.chooseTemplateForTiddler(title,template);\n"
"		var currTemplate = tiddlerElem.getAttribute(\"template\");\n"
"		if((template != currTemplate) || force) {\n"
"			var tiddler = store.getTiddler(title);\n"
"			if(!tiddler) {\n"
"				tiddler = new Tiddler();\n"
"				if(store.isShadowTiddler(title)) {\n"
"					var tags = [];\n"
"					tiddler.set(title,store.getTiddlerText(title),config.views.wikified.shadowModifier,version.date,tags,version.date);\n"
"				} else {\n"
"					var text = template==\"EditTemplate\" ?\n"
"								config.views.editor.defaultText.format([title]) :\n"
"								config.views.wikified.defaultText.format([title]);\n"
"					text = defaultText || text;\n"
"					var fields = customFields ? customFields.decodeHashMap() : null;\n"
"					tiddler.set(title,text,config.views.wikified.defaultModifier,version.date,[],version.date,fields);\n"
"				}\n"
"			}\n"
"			tiddlerElem.setAttribute(\"tags\",tiddler.tags.join(\" \"));\n"
"			tiddlerElem.setAttribute(\"tiddler\",title);\n"
"			tiddlerElem.setAttribute(\"template\",template);\n"
"			tiddlerElem.onmouseover = this.onTiddlerMouseOver;\n"
"			tiddlerElem.onmouseout = this.onTiddlerMouseOut;\n"
"			tiddlerElem.ondblclick = this.onTiddlerDblClick;\n"
"			tiddlerElem[window.event?\"onkeydown\":\"onkeypress\"] = this.onTiddlerKeyPress;\n"
"			tiddlerElem.innerHTML = this.getTemplateForTiddler(title,template,tiddler);\n"
"			applyHtmlMacros(tiddlerElem,tiddler);\n"
"			if(store.getTaggedTiddlers(title).length > 0)\n"
"				addClass(tiddlerElem,\"isTag\");\n"
"			else\n"
"				removeClass(tiddlerElem,\"isTag\");\n"
"			if(store.tiddlerExists(title)) {\n"
"				removeClass(tiddlerElem,\"shadow\");\n"
"				removeClass(tiddlerElem,\"missing\");\n"
"			} else {\n"
"				addClass(tiddlerElem, store.isShadowTiddler(title) ? \"shadow\" : \"missing\");\n"
"			}\n"
"			if(customFields)\n"
"				this.addCustomFields(tiddlerElem,customFields);\n"
"			forceReflow();\n"
"		}\n"
"	}\n"
"	return tiddlerElem;\n"
"};\n"
"\n"
"Story.prototype.addCustomFields = function(place,customFields)\n"
"{\n"
"	var fields = customFields.decodeHashMap();\n"
"	var w = createTiddlyElement(place,\"div\",null,\"customFields\");\n"
"	w.style.display = \"none\";\n"
"	for(var t in fields) {\n"
"		var e = document.createElement(\"input\");\n"
"		e.setAttribute(\"type\",\"text\");\n"
"		e.setAttribute(\"value\",fields[t]);\n"
"		w.appendChild(e);\n"
"		e.setAttribute(\"edit\",t);\n"
"	}\n"
"};\n"
"\n"
"Story.prototype.refreshAllTiddlers = function(force)\n"
"{\n"
"	var e = this.getContainer().firstChild;\n"
"	while(e) {\n"
"		var template = e.getAttribute(\"template\");\n"
"		if(template && e.getAttribute(\"dirty\") != \"true\") {\n"
"			this.refreshTiddler(e.getAttribute(\"tiddler\"),force ? null : template,true);\n"
"		}\n"
"		e = e.nextSibling;\n"
"	}\n"
"};\n"
"\n"
"Story.prototype.onTiddlerMouseOver = function(e)\n"
"{\n"
"	addClass(this, \"selected\");\n"
"};\n"
"\n"
"Story.prototype.onTiddlerMouseOut = function(e)\n"
"{\n"
"	removeClass(this,\"selected\");\n"
"};\n"
"\n"
"Story.prototype.onTiddlerDblClick = function(ev)\n"
"{\n"
"	var e = ev || window.event;\n"
"	var target = resolveTarget(e);\n"
"	if(target && target.nodeName.toLowerCase() != \"input\" && target.nodeName.toLowerCase() != \"textarea\") {\n"
"		if(document.selection && document.selection.empty)\n"
"			document.selection.empty();\n"
"		config.macros.toolbar.invokeCommand(this,\"defaultCommand\",e);\n"
"		e.cancelBubble = true;\n"
"		if(e.stopPropagation) e.stopPropagation();\n"
"		return true;\n"
"	}\n"
"	return false;\n"
"};\n"
"\n"
"Story.prototype.onTiddlerKeyPress = function(ev)\n"
"{\n"
"	var e = ev || window.event;\n"
"	clearMessage();\n"
"	var consume = false;\n"
"	var title = this.getAttribute(\"tiddler\");\n"
"	var target = resolveTarget(e);\n"
"	switch(e.keyCode) {\n"
"	case 9: // Tab\n"
"		if(config.options.chkInsertTabs && target.tagName.toLowerCase() == \"textarea\") {\n"
"			replaceSelection(target,String.fromCharCode(9));\n"
"			consume = true;\n"
"		}\n"
"		if(config.isOpera) {\n"
"			target.onblur = function() {\n"
"				this.focus();\n"
"				this.onblur = null;\n"
"			};\n"
"		}\n"
"		break;\n"
"	case 13: // Ctrl-Enter\n"
"	case 10: // Ctrl-Enter on IE PC\n"
"	case 77: // Ctrl-Enter is \"M\" on some platforms\n"
"		if(e.ctrlKey) {\n"
"			blurElement(this);\n"
"			config.macros.toolbar.invokeCommand(this,\"defaultCommand\",e);\n"
"			consume = true;\n"
"		}\n"
"		break;\n"
"	case 27: // Escape\n"
"		blurElement(this);\n"
"		config.macros.toolbar.invokeCommand(this,\"cancelCommand\",e);\n"
"		consume = true;\n"
"		break;\n"
"	}\n"
"	e.cancelBubble = consume;\n"
"	if(consume) {\n"
"		if(e.stopPropagation) e.stopPropagation(); // Stop Propagation\n"
"		e.returnValue = true; // Cancel The Event in IE\n"
"		if(e.preventDefault ) e.preventDefault(); // Cancel The Event in Moz\n"
"	}\n"
"	return !consume;\n"
"};\n"
"\n"
"Story.prototype.getTiddlerField = function(title,field)\n"
"{\n"
"	var tiddlerElem = this.getTiddler(title);\n"
"	var e = null;\n"
"	if(tiddlerElem ) {\n"
"		var children = tiddlerElem.getElementsByTagName(\"*\");\n"
"		for(var t=0; t<children.length; t++) {\n"
"			var c = children[t];\n"
"			if(c.tagName.toLowerCase() == \"input\" || c.tagName.toLowerCase() == \"textarea\") {\n"
"				if(!e)\n"
"					e = c;\n"
"				if(c.getAttribute(\"edit\") == field)\n"
"					e = c;\n"
"			}\n"
"		}\n"
"	}\n"
"	return e;\n"
"};\n"
"\n"
"Story.prototype.focusTiddler = function(title,field)\n"
"{\n"
"	var e = this.getTiddlerField(title,field);\n"
"	if(e) {\n"
"		e.focus();\n"
"		e.select();\n"
"	}\n"
"};\n"
"\n"
"Story.prototype.blurTiddler = function(title)\n"
"{\n"
"	var tiddlerElem = this.getTiddler(title);\n"
"	if(tiddlerElem && tiddlerElem.focus && tiddlerElem.blur) {\n"
"		tiddlerElem.focus();\n"
"		tiddlerElem.blur();\n"
"	}\n"
"};\n"
"\n"
"Story.prototype.setTiddlerField = function(title,tag,mode,field)\n"
"{\n"
"	var c = this.getTiddlerField(title,field);\n"
"	var tags = c.value.readBracketedList();\n"
"	tags.setItem(tag,mode);\n"
"	c.value = String.encodeTiddlyLinkList(tags);\n"
"};\n"
"\n"
"Story.prototype.setTiddlerTag = function(title,tag,mode)\n"
"{\n"
"	this.setTiddlerField(title,tag,mode,\"tags\");\n"
"};\n"
"\n"
"Story.prototype.closeTiddler = function(title,animate,unused)\n"
"{\n"
"	var tiddlerElem = this.getTiddler(title);\n"
"	if(tiddlerElem) {\n"
"		clearMessage();\n"
"		this.scrubTiddler(tiddlerElem);\n"
"		if(config.options.chkAnimate && animate && anim && typeof Slider == \"function\")\n"
"			anim.startAnimating(new Slider(tiddlerElem,false,null,\"all\"));\n"
"		else {\n"
"			removeNode(tiddlerElem);\n"
"			forceReflow();\n"
"		}\n"
"	}\n"
"};\n"
"\n"
"Story.prototype.scrubTiddler = function(tiddlerElem)\n"
"{\n"
"	tiddlerElem.id = null;\n"
"};\n"
"\n"
"Story.prototype.setDirty = function(title,dirty)\n"
"{\n"
"	var tiddlerElem = this.getTiddler(title);\n"
"	if(tiddlerElem)\n"
"		tiddlerElem.setAttribute(\"dirty\",dirty ? \"true\" : \"false\");\n"
"};\n"
"\n"
"Story.prototype.isDirty = function(title)\n"
"{\n"
"	var tiddlerElem = this.getTiddler(title);\n"
"	if(tiddlerElem)\n"
"		return tiddlerElem.getAttribute(\"dirty\") == \"true\";\n"
"	return null;\n"
"};\n"
"\n"
"Story.prototype.areAnyDirty = function()\n"
"{\n"
"	var r = false;\n"
"	this.forEachTiddler(function(title,element) {\n"
"		if(this.isDirty(title))\n"
"			r = true;\n"
"	});\n"
"	return r;\n"
"};\n"
"\n"
"Story.prototype.closeAllTiddlers = function(exclude)\n"
"{\n"
"	clearMessage();\n"
"	this.forEachTiddler(function(title,element) {\n"
"		if((title != exclude) && element.getAttribute(\"dirty\") != \"true\")\n"
"			this.closeTiddler(title);\n"
"	});\n"
"	window.scrollTo(0,ensureVisible(this.container));\n"
"};\n"
"\n"
"Story.prototype.isEmpty = function()\n"
"{\n"
"	var place = this.getContainer();\n"
"	return place && place.firstChild == null;\n"
"};\n"
"\n"
"Story.prototype.search = function(text,useCaseSensitive,useRegExp)\n"
"{\n"
"	this.closeAllTiddlers();\n"
"	highlightHack = new RegExp(useRegExp ? text : text.escapeRegExp(),useCaseSensitive ? \"mg\" : \"img\");\n"
"	var matches = store.search(highlightHack,\"title\",\"excludeSearch\");\n"
"	this.displayTiddlers(null,matches);\n"
"	highlightHack = null;\n"
"	var q = useRegExp ? \"/\" : \"'\";\n"
"	if(matches.length > 0)\n"
"		displayMessage(config.macros.search.successMsg.format([matches.length.toString(),q + text + q]));\n"
"	else\n"
"		displayMessage(config.macros.search.failureMsg.format([q + text + q]));\n"
"};\n"
"\n"
"Story.prototype.findContainingTiddler = function(e)\n"
"{\n"
"	while(e && !hasClass(e,\"tiddler\"))\n"
"		e = e.parentNode;\n"
"	return e;\n"
"};\n"
"\n"
"Story.prototype.gatherSaveFields = function(e,fields)\n"
"{\n"
"	if(e && e.getAttribute) {\n"
"		var f = e.getAttribute(\"edit\");\n"
"		if(f)\n"
"			fields[f] = e.value.replace(/\\r/mg,\"\");\n"
"		if(e.hasChildNodes()) {\n"
"			var c = e.childNodes;\n"
"			for(var t=0; t<c.length; t++)\n"
"				this.gatherSaveFields(c[t],fields);\n"
"		}\n"
"	}\n"
"};\n"
"\n"
"Story.prototype.hasChanges = function(title)\n"
"{\n"
"	var e = this.getTiddler(title);\n"
"	if(e) {\n"
"		var fields = {};\n"
"		this.gatherSaveFields(e,fields);\n"
"		if(store.fetchTiddler(title)) {\n"
"			for(var n in fields) {\n"
"				if(store.getValue(title,n) != fields[n]) //# tiddler changed\n"
"					return true;\n"
"			}\n"
"		} else {\n"
"			if(store.isShadowTiddler(title) && store.getShadowTiddlerText(title) == fields.text) { //# not checking for title or tags\n"
"				return false;\n"
"			} else { //# changed shadow or new tiddler\n"
"				return true;\n"
"			}\n"
"		}\n"
"	}\n"
"	return false;\n"
"};\n"
"\n"
"Story.prototype.saveTiddler = function(title,minorUpdate)\n"
"{\n"
"	var tiddlerElem = this.getTiddler(title);\n"
"	if(tiddlerElem) {\n"
"		var fields = {};\n"
"		this.gatherSaveFields(tiddlerElem,fields);\n"
"		var newTitle = fields.title || title;\n"
"		if(!store.tiddlerExists(newTitle))\n"
"			newTitle = newTitle.trim();\n"
"		if(store.tiddlerExists(newTitle) && newTitle != title) {\n"
"			if(!confirm(config.messages.overwriteWarning.format([newTitle.toString()])))\n"
"				return null;\n"
"		}\n"
"		if(newTitle != title)\n"
"			this.closeTiddler(newTitle,false);\n"
"		tiddlerElem.id = this.tiddlerId(newTitle);\n"
"		tiddlerElem.setAttribute(\"tiddler\",newTitle);\n"
"		tiddlerElem.setAttribute(\"template\",DEFAULT_VIEW_TEMPLATE);\n"
"		tiddlerElem.setAttribute(\"dirty\",\"false\");\n"
"		if(config.options.chkForceMinorUpdate)\n"
"			minorUpdate = !minorUpdate;\n"
"		if(!store.tiddlerExists(newTitle))\n"
"			minorUpdate = false;\n"
"		var newDate = new Date();\n"
"		if(store.tiddlerExists(title)) {\n"
"			var extendedFields = store.fetchTiddler(title).fields;\n"
"		} else {\n"
"			extendedFields = merge({},config.defaultCustomFields);\n"
"		}\n"
"		for(var n in fields) {\n"
"			if(!TiddlyWiki.isStandardField(n))\n"
"				extendedFields[n] = fields[n];\n"
"		}\n"
"		var tiddler = store.saveTiddler(title,newTitle,fields.text,minorUpdate ? undefined : config.options.txtUserName,minorUpdate ? undefined : newDate,fields.tags,extendedFields);\n"
"		autoSaveChanges(null,[tiddler]);\n"
"		return newTitle;\n"
"	}\n"
"	return null;\n"
"};\n"
"\n"
"Story.prototype.permaView = function()\n"
"{\n"
"	var links = [];\n"
"	this.forEachTiddler(function(title,element) {\n"
"		links.push(String.encodeTiddlyLink(title));\n"
"	});\n"
"	var t = encodeURIComponent(links.join(\" \"));\n"
"	if(t == \"\")\n"
"		t = \"#\";\n"
"	if(window.location.hash != t)\n"
"		window.location.hash = t;\n"
"};\n"
"\n"
"Story.prototype.switchTheme = function(theme)\n"
"{\n"
"	if(safeMode)\n"
"		return;\n"
"\n"
"	var isAvailable = function(title) {\n"
"		var s = title ? title.indexOf(config.textPrimitives.sectionSeparator) : -1;\n"
"		if(s!=-1)\n"
"			title = title.substr(0,s);\n"
"		return store.tiddlerExists(title) || store.isShadowTiddler(title);\n"
"	};\n"
"\n"
"	var getSlice = function(theme,slice) {\n"
"		var r;\n"
"		if(readOnly)\n"
"			r = store.getTiddlerSlice(theme,slice+\"ReadOnly\") || store.getTiddlerSlice(theme,\"Web\"+slice);\n"
"		r = r || store.getTiddlerSlice(theme,slice);\n"
"		if(r && r.indexOf(config.textPrimitives.sectionSeparator)==0)\n"
"			r = theme + r;\n"
"		return isAvailable(r) ? r : slice;\n"
"	};\n"
"\n"
"	var replaceNotification = function(i,name,theme,slice) {\n"
"		var newName = getSlice(theme,slice);\n"
"		if(name!=newName && store.namedNotifications[i].name==name) {\n"
"			store.namedNotifications[i].name = newName;\n"
"			return newName;\n"
"		}\n"
"		return name;\n"
"	};\n"
"\n"
"	var pt = config.refresherData.pageTemplate;\n"
"	var vi = DEFAULT_VIEW_TEMPLATE;\n"
"	var vt = config.tiddlerTemplates[vi];\n"
"	var ei = DEFAULT_EDIT_TEMPLATE;\n"
"	var et = config.tiddlerTemplates[ei];\n"
"\n"
"	for(var i=0; i<config.notifyTiddlers.length; i++) {\n"
"		var name = config.notifyTiddlers[i].name;\n"
"		switch(name) {\n"
"		case \"PageTemplate\":\n"
"			config.refresherData.pageTemplate = replaceNotification(i,config.refresherData.pageTemplate,theme,name);\n"
"			break;\n"
"		case \"StyleSheet\":\n"
"			removeStyleSheet(config.refresherData.styleSheet);\n"
"			config.refresherData.styleSheet = replaceNotification(i,config.refresherData.styleSheet,theme,name);\n"
"			break;\n"
"		case \"ColorPalette\":\n"
"			config.refresherData.colorPalette = replaceNotification(i,config.refresherData.colorPalette,theme,name);\n"
"			break;\n"
"		default:\n"
"			break;\n"
"		}\n"
"	}\n"
"	config.tiddlerTemplates[vi] = getSlice(theme,\"ViewTemplate\");\n"
"	config.tiddlerTemplates[ei] = getSlice(theme,\"EditTemplate\");\n"
"	if(!startingUp) {\n"
"		if(config.refresherData.pageTemplate!=pt || config.tiddlerTemplates[vi]!=vt || config.tiddlerTemplates[ei]!=et) {\n"
"			refreshAll();\n"
"			this.refreshAllTiddlers(true);\n"
"		} else {\n"
"			setStylesheet(store.getRecursiveTiddlerText(config.refresherData.styleSheet,\"\",10),config.refreshers.styleSheet);\n"
"		}\n"
"		config.options.txtTheme = theme;\n"
"		saveOptionCookie(\"txtTheme\");\n"
"	}\n"
"};\n"
"\n"
"//--\n"
"//-- Backstage\n"
"//--\n"
"\n"
"var backstage = {\n"
"	area: null,\n"
"	toolbar: null,\n"
"	button: null,\n"
"	showButton: null,\n"
"	hideButton: null,\n"
"	cloak: null,\n"
"	panel: null,\n"
"	panelBody: null,\n"
"	panelFooter: null,\n"
"	currTabName: null,\n"
"	currTabElem: null,\n"
"	content: null,\n"
"\n"
"	init: function() {\n"
"		var cmb = config.messages.backstage;\n"
"		this.area = document.getElementById(\"backstageArea\");\n"
"		this.toolbar = document.getElementById(\"backstageToolbar\");\n"
"		this.button = document.getElementById(\"backstageButton\");\n"
"		this.button.style.display = \"block\";\n"
"		var t = cmb.open.text + \" \" + glyph(\"bentArrowLeft\");\n"
"		this.showButton = createTiddlyButton(this.button,t,cmb.open.tooltip,\n"
"						function(e) {backstage.show(); return false;},null,\"backstageShow\");\n"
"		t = glyph(\"bentArrowRight\") + \" \" + cmb.close.text;\n"
"		this.hideButton = createTiddlyButton(this.button,t,cmb.close.tooltip,\n"
"						function(e) {backstage.hide(); return false;},null,\"backstageHide\");\n"
"		this.cloak = document.getElementById(\"backstageCloak\");\n"
"		this.panel = document.getElementById(\"backstagePanel\");\n"
"		this.panelFooter = createTiddlyElement(this.panel,\"div\",null,\"backstagePanelFooter\");\n"
"		this.panelBody = createTiddlyElement(this.panel,\"div\",null,\"backstagePanelBody\");\n"
"		this.cloak.onmousedown = function(e) {backstage.switchTab(null);};\n"
"		createTiddlyText(this.toolbar,cmb.prompt);\n"
"		for(t=0; t<config.backstageTasks.length; t++) {\n"
"			var taskName = config.backstageTasks[t];\n"
"			var task = config.tasks[taskName];\n"
"			var handler = task.action ? this.onClickCommand : this.onClickTab;\n"
"			var text = task.text + (task.action ? \"\" : glyph(\"downTriangle\"));\n"
"			var btn = createTiddlyButton(this.toolbar,text,task.tooltip,handler,\"backstageTab\");\n"
"			addClass(btn,task.action ? \"backstageAction\" : \"backstageTask\");\n"
"			btn.setAttribute(\"task\", taskName);\n"
"			}\n"
"		this.content = document.getElementById(\"contentWrapper\");\n"
"		if(config.options.chkBackstage)\n"
"			this.show();\n"
"		else\n"
"			this.hide();\n"
"	},\n"
"\n"
"	isVisible: function() {\n"
"		return this.area ? this.area.style.display == \"block\" : false;\n"
"	},\n"
"\n"
"	show: function() {\n"
"		this.area.style.display = \"block\";\n"
"		if(anim && config.options.chkAnimate) {\n"
"			backstage.toolbar.style.left = findWindowWidth() + \"px\";\n"
"			var p = [{style: \"left\", start: findWindowWidth(), end: 0, template: \"%0px\"}];\n"
"			anim.startAnimating(new Morpher(backstage.toolbar,config.animDuration,p));\n"
"		} else {\n"
"			backstage.area.style.left = \"0px\";\n"
"		}\n"
"		jQuery(this.showButton).hide();\n"
"		jQuery(this.hideButton).show();\n"
"		config.options.chkBackstage = true;\n"
"		saveOptionCookie(\"chkBackstage\");\n"
"		addClass(this.content,\"backstageVisible\");\n"
"	},\n"
"\n"
"	hide: function() {\n"
"		if(this.currTabElem) {\n"
"			this.switchTab(null);\n"
"		} else {\n"
"			backstage.toolbar.style.left = \"0px\";\n"
"			if(anim && config.options.chkAnimate) {\n"
"				var p = [{style: \"left\", start: 0, end: findWindowWidth(), template: \"%0px\"}];\n"
"				var c = function(element,properties) {backstage.area.style.display = \"none\";};\n"
"				anim.startAnimating(new Morpher(backstage.toolbar,config.animDuration,p,c));\n"
"			} else {\n"
"				this.area.style.display = \"none\";\n"
"			}\n"
"			this.showButton.style.display = \"block\";\n"
"			this.hideButton.style.display = \"none\";\n"
"			config.options.chkBackstage = false;\n"
"			saveOptionCookie(\"chkBackstage\");\n"
"			removeClass(this.content, \"backstageVisible\");\n"
"		}\n"
"	},\n"
"\n"
"	onClickCommand: function(e) {\n"
"		var task = config.tasks[this.getAttribute(\"task\")];\n"
"		displayMessage(task);\n"
"		if(task.action) {\n"
"			backstage.switchTab(null);\n"
"			task.action();\n"
"		}\n"
"		return false;\n"
"	},\n"
"\n"
"	onClickTab: function(e) {\n"
"		backstage.switchTab(this.getAttribute(\"task\"));\n"
"		return false;\n"
"	},\n"
"\n"
"	// Switch to a given tab, or none if null is passed\n"
"	switchTab: function(tabName) {\n"
"		var tabElem = null;\n"
"		var e = this.toolbar.firstChild;\n"
"		while(e)\n"
"			{\n"
"			if(e.getAttribute && e.getAttribute(\"task\") == tabName)\n"
"				tabElem = e;\n"
"			e = e.nextSibling;\n"
"			}\n"
"		if(tabName == backstage.currTabName) {\n"
"			backstage.hidePanel();\n"
"			return;\n"
"		}\n"
"		if(backstage.currTabElem) {\n"
"			removeClass(this.currTabElem, \"backstageSelTab\");\n"
"		}\n"
"		if(tabElem && tabName) {\n"
"			backstage.preparePanel();\n"
"			addClass(tabElem,\"backstageSelTab\");\n"
"			var task = config.tasks[tabName];\n"
"			wikify(task.content,backstage.panelBody,null,null);\n"
"			backstage.showPanel();\n"
"		} else if(backstage.currTabElem) {\n"
"			backstage.hidePanel();\n"
"		}\n"
"		backstage.currTabName = tabName;\n"
"		backstage.currTabElem = tabElem;\n"
"	},\n"
"\n"
"	isPanelVisible: function() {\n"
"		return backstage.panel ? backstage.panel.style.display == \"block\" : false;\n"
"	},\n"
"\n"
"	preparePanel: function() {\n"
"		backstage.cloak.style.height = findWindowHeight() + \"px\";\n"
"		backstage.cloak.style.display = \"block\";\n"
"		removeChildren(backstage.panelBody);\n"
"		return backstage.panelBody;\n"
"	},\n"
"\n"
"	showPanel: function() {\n"
"		backstage.panel.style.display = \"block\";\n"
"		if(anim && config.options.chkAnimate) {\n"
"			backstage.panel.style.top = (-backstage.panel.offsetHeight) + \"px\";\n"
"			var p = [{style: \"top\", start: -backstage.panel.offsetHeight, end: 0, template: \"%0px\"}];\n"
"			anim.startAnimating(new Morpher(backstage.panel,config.animDuration,p),new Scroller(backstage.panel,false));\n"
"		} else {\n"
"			backstage.panel.style.top = \"0px\";\n"
"		}\n"
"		return backstage.panelBody;\n"
"	},\n"
"\n"
"	hidePanel: function() {\n"
"		if(backstage.currTabElem)\n"
"			removeClass(backstage.currTabElem, \"backstageSelTab\");\n"
"		backstage.currTabElem = null;\n"
"		backstage.currTabName = null;\n"
"		if(anim && config.options.chkAnimate) {\n"
"			var p = [\n"
"				{style: \"top\", start: 0, end: -(backstage.panel.offsetHeight), template: \"%0px\"},\n"
"				{style: \"display\", atEnd: \"none\"}\n"
"			];\n"
"			var c = function(element,properties) {backstage.cloak.style.display = \"none\";};\n"
"			anim.startAnimating(new Morpher(backstage.panel,config.animDuration,p,c));\n"
"		} else {\n"
"			jQuery([backstage.panel,backstage.cloak]).hide();\n"
"		}\n"
"	}\n"
"};\n"
"\n"
"config.macros.backstage = {};\n"
"\n"
"config.macros.backstage.handler = function(place,macroName,params)\n"
"{\n"
"	var backstageTask = config.tasks[params[0]];\n"
"	if(backstageTask)\n"
"		createTiddlyButton(place,backstageTask.text,backstageTask.tooltip,function(e) {backstage.switchTab(params[0]); return false;});\n"
"};\n"
"\n"
"//--\n"
"//-- ImportTiddlers macro\n"
"//--\n"
"\n"
"config.macros.importTiddlers.handler = function(place,macroName,params,wikifier,paramString,tiddler)\n"
"{\n"
"	if(readOnly) {\n"
"		createTiddlyElement(place,\"div\",null,\"marked\",this.readOnlyWarning);\n"
"		return;\n"
"	}\n"
"	var w = new Wizard();\n"
"	w.createWizard(place,this.wizardTitle);\n"
"	this.restart(w);\n"
"};\n"
"\n"
"config.macros.importTiddlers.onCancel = function(e)\n"
"{\n"
"	var wizard = new Wizard(this);\n"
"	var place = wizard.clear();\n"
"	config.macros.importTiddlers.restart(wizard);\n"
"	return false;\n"
"};\n"
"\n"
"config.macros.importTiddlers.onClose = function(e)\n"
"{\n"
"	backstage.hidePanel();\n"
"	return false;\n"
"};\n"
"\n"
"config.macros.importTiddlers.restart = function(wizard)\n"
"{\n"
"	wizard.addStep(this.step1Title,this.step1Html);\n"
"	var s = wizard.getElement(\"selTypes\");\n"
"	for(var t in config.adaptors) {\n"
"		var e = createTiddlyElement(s,\"option\",null,null,config.adaptors[t].serverLabel ? config.adaptors[t].serverLabel : t);\n"
"		e.value = t;\n"
"	}\n"
"	if(config.defaultAdaptor)\n"
"		s.value = config.defaultAdaptor;\n"
"	s = wizard.getElement(\"selFeeds\");\n"
"	var feeds = this.getFeeds();\n"
"	for(t in feeds) {\n"
"		e = createTiddlyElement(s,\"option\",null,null,t);\n"
"		e.value = t;\n"
"	}\n"
"	wizard.setValue(\"feeds\",feeds);\n"
"	s.onchange = config.macros.importTiddlers.onFeedChange;\n"
"	var fileInput = wizard.getElement(\"txtBrowse\");\n"
"	fileInput.onchange = config.macros.importTiddlers.onBrowseChange;\n"
"	fileInput.onkeyup = config.macros.importTiddlers.onBrowseChange;\n"
"	wizard.setButtons([{caption: this.openLabel, tooltip: this.openPrompt, onClick: config.macros.importTiddlers.onOpen}]);\n"
"	wizard.formElem.action = \"javascript:;\";\n"
"	wizard.formElem.onsubmit = function() {\n"
"		if(!this.txtPath || this.txtPath.value.length) //# check for manually entered path in first step\n"
"			this.lastChild.firstChild.onclick();\n"
"	};\n"
"};\n"
"\n"
"config.macros.importTiddlers.getFeeds = function()\n"
"{\n"
"	var feeds = {};\n"
"	var tagged = store.getTaggedTiddlers(\"systemServer\",\"title\");\n"
"	for(var t=0; t<tagged.length; t++) {\n"
"		var title = tagged[t].title;\n"
"		var serverType = store.getTiddlerSlice(title,\"Type\");\n"
"		if(!serverType)\n"
"			serverType = \"file\";\n"
"		feeds[title] = {title: title,\n"
"						url: store.getTiddlerSlice(title,\"URL\"),\n"
"						workspace: store.getTiddlerSlice(title,\"Workspace\"),\n"
"						workspaceList: store.getTiddlerSlice(title,\"WorkspaceList\"),\n"
"						tiddlerFilter: store.getTiddlerSlice(title,\"TiddlerFilter\"),\n"
"						serverType: serverType,\n"
"						description: store.getTiddlerSlice(title,\"Description\")};\n"
"	}\n"
"	return feeds;\n"
"};\n"
"\n"
"config.macros.importTiddlers.onFeedChange = function(e)\n"
"{\n"
"	var wizard = new Wizard(this);\n"
"	var selTypes = wizard.getElement(\"selTypes\");\n"
"	var fileInput = wizard.getElement(\"txtPath\");\n"
"	var feeds = wizard.getValue(\"feeds\");\n"
"	var f = feeds[this.value];\n"
"	if(f) {\n"
"		selTypes.value = f.serverType;\n"
"		fileInput.value = f.url;\n"
"		wizard.setValue(\"feedName\",f.serverType);\n"
"		wizard.setValue(\"feedHost\",f.url);\n"
"		wizard.setValue(\"feedWorkspace\",f.workspace);\n"
"		wizard.setValue(\"feedWorkspaceList\",f.workspaceList);\n"
"		wizard.setValue(\"feedTiddlerFilter\",f.tiddlerFilter);\n"
"	}\n"
"	return false;\n"
"};\n"
"\n"
"config.macros.importTiddlers.onBrowseChange = function(e)\n"
"{\n"
"	var wizard = new Wizard(this);\n"
"	var fileInput = wizard.getElement(\"txtPath\");\n"
"	fileInput.value = config.macros.importTiddlers.getURLFromLocalPath(this.value);\n"
"	var serverType = wizard.getElement(\"selTypes\");\n"
"	serverType.value = \"file\";\n"
"	return true;\n"
"};\n"
"\n"
"config.macros.importTiddlers.getURLFromLocalPath = function(v)\n"
"{\n"
"	if(!v||!v.length)\n"
"		return v;\n"
"	v = v.replace(/\\\\/g,\"/\"); // use \"/\" for cross-platform consistency\n"
"	var u;\n"
"	var t = v.split(\":\");\n"
"	var p = t[1]||t[0]; // remove drive letter (if any)\n"
"	if (t[1] && (t[0]==\"http\"||t[0]==\"https\"||t[0]==\"file\")) {\n"
"		u = v;\n"
"	} else if(p.substr(0,1)==\"/\") {\n"
"		u = document.location.protocol + \"//\" + document.location.hostname + (t[1] ? \"/\" : \"\") + v;\n"
"	} else {\n"
"		var c = document.location.href.replace(/\\\\/g,\"/\");\n"
"		var pos = c.lastIndexOf(\"/\");\n"
"		if (pos!=-1)\n"
"			c = c.substr(0,pos); // remove filename\n"
"		u = c + \"/\" + p;\n"
"	}\n"
"	return u;\n"
"};\n"
"\n"
"config.macros.importTiddlers.onOpen = function(e)\n"
"{\n"
"	var wizard = new Wizard(this);\n"
"	var fileInput = wizard.getElement(\"txtPath\");\n"
"	var url = fileInput.value;\n"
"	var serverType = wizard.getElement(\"selTypes\").value || config.defaultAdaptor;\n"
"	var adaptor = new config.adaptors[serverType]();\n"
"	wizard.setValue(\"adaptor\",adaptor);\n"
"	wizard.setValue(\"serverType\",serverType);\n"
"	wizard.setValue(\"host\",url);\n"
"	var ret = adaptor.openHost(url,null,wizard,config.macros.importTiddlers.onOpenHost);\n"
"	if(ret !== true)\n"
"		displayMessage(ret);\n"
"	wizard.setButtons([{caption: config.macros.importTiddlers.cancelLabel, tooltip: config.macros.importTiddlers.cancelPrompt, onClick: config.macros.importTiddlers.onCancel}],config.macros.importTiddlers.statusOpenHost);\n"
"	return false;\n"
"};\n"
"\n"
"config.macros.importTiddlers.onOpenHost = function(context,wizard)\n"
"{\n"
"	var adaptor = wizard.getValue(\"adaptor\");\n"
"	if(context.status !== true)\n"
"		displayMessage(\"Error in importTiddlers.onOpenHost: \" + context.statusText);\n"
"	var ret = adaptor.getWorkspaceList(context,wizard,config.macros.importTiddlers.onGetWorkspaceList);\n"
"	if(ret !== true)\n"
"		displayMessage(ret);\n"
"	wizard.setButtons([{caption: config.macros.importTiddlers.cancelLabel, tooltip: config.macros.importTiddlers.cancelPrompt, onClick: config.macros.importTiddlers.onCancel}],config.macros.importTiddlers.statusGetWorkspaceList);\n"
"};\n"
"\n"
"config.macros.importTiddlers.onGetWorkspaceList = function(context,wizard)\n"
"{\n"
"	if(context.status !== true)\n"
"		displayMessage(\"Error in importTiddlers.onGetWorkspaceList: \" + context.statusText);\n"
"	wizard.setValue(\"context\",context);\n"
"	var workspace = wizard.getValue(\"feedWorkspace\");\n"
"	if(!workspace && context.workspaces.length==1)\n"
"		workspace = context.workspaces[0].title;\n"
"	if(workspace) {\n"
"		var ret = context.adaptor.openWorkspace(workspace,context,wizard,config.macros.importTiddlers.onOpenWorkspace);\n"
"		if(ret !== true)\n"
"			displayMessage(ret);\n"
"		wizard.setValue(\"workspace\",workspace);\n"
"		wizard.setButtons([{caption: config.macros.importTiddlers.cancelLabel, tooltip: config.macros.importTiddlers.cancelPrompt, onClick: config.macros.importTiddlers.onCancel}],config.macros.importTiddlers.statusOpenWorkspace);\n"
"		return;\n"
"	}\n"
"	wizard.addStep(config.macros.importTiddlers.step2Title,config.macros.importTiddlers.step2Html);\n"
"	var s = wizard.getElement(\"selWorkspace\");\n"
"	s.onchange = config.macros.importTiddlers.onWorkspaceChange;\n"
"	for(var t=0; t<context.workspaces.length; t++) {\n"
"		var e = createTiddlyElement(s,\"option\",null,null,context.workspaces[t].title);\n"
"		e.value = context.workspaces[t].title;\n"
"	}\n"
"	var workspaceList = wizard.getValue(\"feedWorkspaceList\");\n"
"	if(workspaceList) {\n"
"		var list = workspaceList.parseParams(\"workspace\",null,false,true);\n"
"		for(var n=1; n<list.length; n++) {\n"
"			if(context.workspaces.findByField(\"title\",list[n].value) == null) {\n"
"				e = createTiddlyElement(s,\"option\",null,null,list[n].value);\n"
"				e.value = list[n].value;\n"
"			}\n"
"		}\n"
"	}\n"
"	if(workspace) {\n"
"		t = wizard.getElement(\"txtWorkspace\");\n"
"		t.value = workspace;\n"
"	}\n"
"	wizard.setButtons([{caption: config.macros.importTiddlers.openLabel, tooltip: config.macros.importTiddlers.openPrompt, onClick: config.macros.importTiddlers.onChooseWorkspace}]);\n"
"};\n"
"\n"
"config.macros.importTiddlers.onWorkspaceChange = function(e)\n"
"{\n"
"	var wizard = new Wizard(this);\n"
"	var t = wizard.getElement(\"txtWorkspace\");\n"
"	t.value = this.value;\n"
"	this.selectedIndex = 0;\n"
"	return false;\n"
"};\n"
"\n"
"config.macros.importTiddlers.onChooseWorkspace = function(e)\n"
"{\n"
"	var wizard = new Wizard(this);\n"
"	var adaptor = wizard.getValue(\"adaptor\");\n"
"	var workspace = wizard.getElement(\"txtWorkspace\").value;\n"
"	wizard.setValue(\"workspace\",workspace);\n"
"	var context = wizard.getValue(\"context\");\n"
"	var ret = adaptor.openWorkspace(workspace,context,wizard,config.macros.importTiddlers.onOpenWorkspace);\n"
"	if(ret !== true)\n"
"		displayMessage(ret);\n"
"	wizard.setButtons([{caption: config.macros.importTiddlers.cancelLabel, tooltip: config.macros.importTiddlers.cancelPrompt, onClick: config.macros.importTiddlers.onCancel}],config.macros.importTiddlers.statusOpenWorkspace);\n"
"	return false;\n"
"};\n"
"\n"
"config.macros.importTiddlers.onOpenWorkspace = function(context,wizard)\n"
"{\n"
"	if(context.status !== true)\n"
"		displayMessage(\"Error in importTiddlers.onOpenWorkspace: \" + context.statusText);\n"
"	var adaptor = wizard.getValue(\"adaptor\");\n"
"	var ret = adaptor.getTiddlerList(context,wizard,config.macros.importTiddlers.onGetTiddlerList,wizard.getValue(\"feedTiddlerFilter\"));\n"
"	if(ret !== true)\n"
"		displayMessage(ret);\n"
"	wizard.setButtons([{caption: config.macros.importTiddlers.cancelLabel, tooltip: config.macros.importTiddlers.cancelPrompt, onClick: config.macros.importTiddlers.onCancel}],config.macros.importTiddlers.statusGetTiddlerList);\n"
"};\n"
"\n"
"config.macros.importTiddlers.onGetTiddlerList = function(context,wizard)\n"
"{\n"
"	if(context.status !== true) {\n"
"		wizard.setButtons([{caption: config.macros.importTiddlers.cancelLabel, tooltip: config.macros.importTiddlers.cancelPrompt, onClick: config.macros.importTiddlers.onCancel}],config.macros.importTiddlers.errorGettingTiddlerList);\n"
"		return;\n"
"	}\n"
"	// Extract data for the listview\n"
"	var listedTiddlers = [];\n"
"	if(context.tiddlers) {\n"
"		for(var n=0; n<context.tiddlers.length; n++) {\n"
"			var tiddler = context.tiddlers[n];\n"
"			listedTiddlers.push({\n"
"				title: tiddler.title,\n"
"				modified: tiddler.modified,\n"
"				modifier: tiddler.modifier,\n"
"				text: tiddler.text ? wikifyPlainText(tiddler.text,100) : \"\",\n"
"				tags: tiddler.tags,\n"
"				size: tiddler.text ? tiddler.text.length : 0,\n"
"				tiddler: tiddler\n"
"			});\n"
"		}\n"
"	}\n"
"	listedTiddlers.sort(function(a,b) {return a.title < b.title ? -1 : (a.title == b.title ? 0 : +1);});\n"
"	// Display the listview\n"
"	wizard.addStep(config.macros.importTiddlers.step3Title,config.macros.importTiddlers.step3Html);\n"
"	var markList = wizard.getElement(\"markList\");\n"
"	var listWrapper = document.createElement(\"div\");\n"
"	markList.parentNode.insertBefore(listWrapper,markList);\n"
"	var listView = ListView.create(listWrapper,listedTiddlers,config.macros.importTiddlers.listViewTemplate);\n"
"	wizard.setValue(\"listView\",listView);\n"
"	wizard.setValue(\"context\",context);\n"
"	var txtSaveTiddler = wizard.getElement(\"txtSaveTiddler\");\n"
"	txtSaveTiddler.value = config.macros.importTiddlers.generateSystemServerName(wizard);\n"
"	wizard.setButtons([\n"
"			{caption: config.macros.importTiddlers.cancelLabel, tooltip: config.macros.importTiddlers.cancelPrompt, onClick: config.macros.importTiddlers.onCancel},\n"
"			{caption: config.macros.importTiddlers.importLabel, tooltip: config.macros.importTiddlers.importPrompt, onClick: config.macros.importTiddlers.doImport}\n"
"		]);\n"
"};\n"
"\n"
"config.macros.importTiddlers.generateSystemServerName = function(wizard)\n"
"{\n"
"	var serverType = wizard.getValue(\"serverType\");\n"
"	var host = wizard.getValue(\"host\");\n"
"	var workspace = wizard.getValue(\"workspace\");\n"
"	var pattern = config.macros.importTiddlers[workspace ? \"systemServerNamePattern\" : \"systemServerNamePatternNoWorkspace\"];\n"
"	return pattern.format([serverType,host,workspace]);\n"
"};\n"
"\n"
"config.macros.importTiddlers.saveServerTiddler = function(wizard)\n"
"{\n"
"	var txtSaveTiddler = wizard.getElement(\"txtSaveTiddler\").value;\n"
"	if(store.tiddlerExists(txtSaveTiddler)) {\n"
"		if(!confirm(config.macros.importTiddlers.confirmOverwriteSaveTiddler.format([txtSaveTiddler])))\n"
"			return;\n"
"		store.suspendNotifications();\n"
"		store.removeTiddler(txtSaveTiddler);\n"
"		store.resumeNotifications();\n"
"	}\n"
"	var serverType = wizard.getValue(\"serverType\");\n"
"	var host = wizard.getValue(\"host\");\n"
"	var workspace = wizard.getValue(\"workspace\");\n"
"	var text = config.macros.importTiddlers.serverSaveTemplate.format([serverType,host,workspace]);\n"
"	store.saveTiddler(txtSaveTiddler,txtSaveTiddler,text,config.macros.importTiddlers.serverSaveModifier,new Date(),[\"systemServer\"]);\n"
"};\n"
"\n"
"config.macros.importTiddlers.doImport = function(e)\n"
"{\n"
"	var wizard = new Wizard(this);\n"
"	if(wizard.getElement(\"chkSave\").checked)\n"
"		config.macros.importTiddlers.saveServerTiddler(wizard);\n"
"	var chkSync = wizard.getElement(\"chkSync\").checked;\n"
"	wizard.setValue(\"sync\",chkSync);\n"
"	var listView = wizard.getValue(\"listView\");\n"
"	var rowNames = ListView.getSelectedRows(listView);\n"
"	var adaptor = wizard.getValue(\"adaptor\");\n"
"	var overwrite = [];\n"
"	var t;\n"
"	for(t=0; t<rowNames.length; t++) {\n"
"		if(store.tiddlerExists(rowNames[t]))\n"
"			overwrite.push(rowNames[t]);\n"
"	}\n"
"	if(overwrite.length > 0) {\n"
"		if(!confirm(config.macros.importTiddlers.confirmOverwriteText.format([overwrite.join(\", \")])))\n"
"			return false;\n"
"	}\n"
"	wizard.addStep(config.macros.importTiddlers.step4Title.format([rowNames.length]),config.macros.importTiddlers.step4Html);\n"
"	for(t=0; t<rowNames.length; t++) {\n"
"		var link = document.createElement(\"div\");\n"
"		createTiddlyLink(link,rowNames[t],true);\n"
"		var place = wizard.getElement(\"markReport\");\n"
"		place.parentNode.insertBefore(link,place);\n"
"	}\n"
"	wizard.setValue(\"remainingImports\",rowNames.length);\n"
"	wizard.setButtons([\n"
"			{caption: config.macros.importTiddlers.cancelLabel, tooltip: config.macros.importTiddlers.cancelPrompt, onClick: config.macros.importTiddlers.onCancel}\n"
"		],config.macros.importTiddlers.statusDoingImport);\n"
"	var wizardContext = wizard.getValue(\"context\");\n"
"	var tiddlers = wizardContext ? wizardContext.tiddlers : [];\n"
"	for(t=0; t<rowNames.length; t++) {\n"
"		var context = {\n"
"			allowSynchronous:true,\n"
"			tiddler:tiddlers[tiddlers.findByField(\"title\",rowNames[t])]\n"
"		};\n"
"		adaptor.getTiddler(rowNames[t],context,wizard,config.macros.importTiddlers.onGetTiddler);\n"
"	}\n"
"	return false;\n"
"};\n"
"\n"
"config.macros.importTiddlers.onGetTiddler = function(context,wizard)\n"
"{\n"
"	if(!context.status)\n"
"		displayMessage(\"Error in importTiddlers.onGetTiddler: \" + context.statusText);\n"
"	var tiddler = context.tiddler;\n"
"	store.suspendNotifications();\n"
"	store.saveTiddler(tiddler.title, tiddler.title, tiddler.text, tiddler.modifier, tiddler.modified, tiddler.tags, tiddler.fields, true, tiddler.created);\n"
"	if(!wizard.getValue(\"sync\")) {\n"
"		store.setValue(tiddler.title,'server',null);\n"
"	}\n"
"	store.resumeNotifications();\n"
"	if(!context.isSynchronous)\n"
"		store.notify(tiddler.title,true);\n"
"	var remainingImports = wizard.getValue(\"remainingImports\")-1;\n"
"	wizard.setValue(\"remainingImports\",remainingImports);\n"
"	if(remainingImports == 0) {\n"
"		if(context.isSynchronous) {\n"
"			store.notifyAll();\n"
"			refreshDisplay();\n"
"		}\n"
"		wizard.setButtons([\n"
"				{caption: config.macros.importTiddlers.doneLabel, tooltip: config.macros.importTiddlers.donePrompt, onClick: config.macros.importTiddlers.onClose}\n"
"			],config.macros.importTiddlers.statusDoneImport);\n"
"		autoSaveChanges();\n"
"	}\n"
"};\n"
"\n"
"//--\n"
"//-- Upgrade macro\n"
"//--\n"
"\n"
"config.macros.upgrade.handler = function(place)\n"
"{\n"
"	var w = new Wizard();\n"
"	w.createWizard(place,this.wizardTitle);\n"
"	w.addStep(this.step1Title,this.step1Html.format([this.source,this.source]));\n"
"	w.setButtons([{caption: this.upgradeLabel, tooltip: this.upgradePrompt, onClick: this.onClickUpgrade}]);\n"
"};\n"
"\n"
"config.macros.upgrade.onClickUpgrade = function(e)\n"
"{\n"
"	var me = config.macros.upgrade;\n"
"	var w = new Wizard(this);\n"
"	if(window.location.protocol != \"file:\") {\n"
"		alert(me.errorCantUpgrade);\n"
"		return false;\n"
"	}\n"
"	if(story.areAnyDirty() || store.isDirty()) {\n"
"		alert(me.errorNotSaved);\n"
"		return false;\n"
"	}\n"
"	var localPath = getLocalPath(document.location.toString());\n"
"	var backupPath = getBackupPath(localPath,me.backupExtension);\n"
"	w.setValue(\"backupPath\",backupPath);\n"
"	w.setButtons([],me.statusPreparingBackup);\n"
"	var original = loadOriginal(localPath);\n"
"	w.setButtons([],me.statusSavingBackup);\n"
"	var backup = copyFile(backupPath,localPath);\n"
"	if(!backup)\n"
"		backup = saveFile(backupPath,original);\n"
"	if(!backup) {\n"
"		w.setButtons([],me.errorSavingBackup);\n"
"		alert(me.errorSavingBackup);\n"
"		return false;\n"
"	}\n"
"	w.setButtons([],me.statusLoadingCore);\n"
"	var load = loadRemoteFile(me.source,me.onLoadCore,w);\n"
"	if(typeof load == \"string\") {\n"
"		w.setButtons([],me.errorLoadingCore);\n"
"		alert(me.errorLoadingCore);\n"
"		return false;\n"
"	}\n"
"	return false;\n"
"};\n"
"\n"
"config.macros.upgrade.onLoadCore = function(status,params,responseText,url,xhr)\n"
"{\n"
"	var me = config.macros.upgrade;\n"
"	var w = params;\n"
"	var errMsg;\n"
"	if(!status)\n"
"		errMsg = me.errorLoadingCore;\n"
"	var newVer = me.extractVersion(responseText);\n"
"	if(!newVer)\n"
"		errMsg = me.errorCoreFormat;\n"
"	if(errMsg) {\n"
"		w.setButtons([],errMsg);\n"
"		alert(errMsg);\n"
"		return;\n"
"	}\n"
"	var onStartUpgrade = function(e) {\n"
"		w.setButtons([],me.statusSavingCore);\n"
"		var localPath = getLocalPath(document.location.toString());\n"
"		saveFile(localPath,responseText);\n"
"		w.setButtons([],me.statusReloadingCore);\n"
"		var backupPath = w.getValue(\"backupPath\");\n"
"		var newLoc = document.location.toString() + \"?time=\" + new Date().convertToYYYYMMDDHHMM() + \"#upgrade:[[\" + encodeURI(backupPath) + \"]]\";\n"
"		window.setTimeout(function () {window.location = newLoc;},10);\n"
"	};\n"
"	var step2 = [me.step2Html_downgrade,me.step2Html_restore,me.step2Html_upgrade][compareVersions(version,newVer) + 1];\n"
"	w.addStep(me.step2Title,step2.format([formatVersion(newVer),formatVersion(version)]));\n"
"	w.setButtons([{caption: me.startLabel, tooltip: me.startPrompt, onClick: onStartUpgrade},{caption: me.cancelLabel, tooltip: me.cancelPrompt, onClick: me.onCancel}]);\n"
"};\n"
"\n"
"config.macros.upgrade.onCancel = function(e)\n"
"{\n"
"	var me = config.macros.upgrade;\n"
"	var w = new Wizard(this);\n"
"	w.addStep(me.step3Title,me.step3Html);\n"
"	w.setButtons([]);\n"
"	return false;\n"
"};\n"
"\n"
"config.macros.upgrade.extractVersion = function(upgradeFile)\n"
"{\n"
"	var re = /^var version = \\{title: \"([^\"]+)\", major: (\\d+), minor: (\\d+), revision: (\\d+)(, beta: (\\d+)){0,1}, date: new Date\\(\"([^\"]+)\"\\)/mg;\n"
"	var m = re.exec(upgradeFile);\n"
"	return  m ? {title: m[1], major: m[2], minor: m[3], revision: m[4], beta: m[6], date: new Date(m[7])} : null;\n"
"};\n"
"\n"
"function upgradeFrom(path)\n"
"{\n"
"	var importStore = new TiddlyWiki();\n"
"	var tw = loadFile(path);\n"
"	if(window.netscape !== undefined)\n"
"		tw = convertUTF8ToUnicode(tw);\n"
"	importStore.importTiddlyWiki(tw);\n"
"	importStore.forEachTiddler(function(title,tiddler) {\n"
"		if(!store.getTiddler(title)) {\n"
"			store.addTiddler(tiddler);\n"
"		}\n"
"	});\n"
"	refreshDisplay();\n"
"	saveChanges(); //# To create appropriate Markup* sections\n"
"	alert(config.messages.upgradeDone.format([formatVersion()]));\n"
"	window.location = window.location.toString().substr(0,window.location.toString().lastIndexOf(\"?\"));\n"
"}\n"
"\n"
"//--\n"
"//-- Sync macro\n"
"//--\n"
"\n"
"// Synchronisation handlers\n"
"config.syncers = {};\n"
"\n"
"// Sync state.\n"
"var currSync = null;\n"
"\n"
"// sync macro\n"
"config.macros.sync.handler = function(place,macroName,params,wikifier,paramString,tiddler)\n"
"{\n"
"	if(!wikifier.isStatic)\n"
"		this.startSync(place);\n"
"};\n"
"\n"
"config.macros.sync.cancelSync = function()\n"
"{\n"
"	currSync = null;\n"
"};\n"
"\n"
"config.macros.sync.startSync = function(place)\n"
"{\n"
"	if(currSync)\n"
"		config.macros.sync.cancelSync();\n"
"	currSync = {};\n"
"	currSync.syncList = this.getSyncableTiddlers();\n"
"	currSync.syncTasks = this.createSyncTasks(currSync.syncList);\n"
"	this.preProcessSyncableTiddlers(currSync.syncList);\n"
"	var wizard = new Wizard();\n"
"	currSync.wizard = wizard;\n"
"	wizard.createWizard(place,this.wizardTitle);\n"
"	wizard.addStep(this.step1Title,this.step1Html);\n"
"	var markList = wizard.getElement(\"markList\");\n"
"	var listWrapper = document.createElement(\"div\");\n"
"	markList.parentNode.insertBefore(listWrapper,markList);\n"
"	currSync.listView = ListView.create(listWrapper,currSync.syncList,this.listViewTemplate);\n"
"	this.processSyncableTiddlers(currSync.syncList);\n"
"	wizard.setButtons([{caption: this.syncLabel, tooltip: this.syncPrompt, onClick: this.doSync}]);\n"
"};\n"
"\n"
"config.macros.sync.getSyncableTiddlers = function()\n"
"{\n"
"	var list = [];\n"
"	store.forEachTiddler(function(title,tiddler) {\n"
"		var syncItem = {};\n"
"		syncItem.serverType = tiddler.getServerType();\n"
"		syncItem.serverHost = tiddler.fields['server.host'];\n"
"		if(syncItem.serverType && syncItem.serverHost) {\n"
"			syncItem.adaptor = new config.adaptors[syncItem.serverType];\n"
"			syncItem.serverWorkspace = tiddler.fields['server.workspace'];\n"
"			syncItem.tiddler = tiddler;\n"
"			syncItem.title = tiddler.title;\n"
"			syncItem.isTouched = tiddler.isTouched();\n"
"			syncItem.selected = syncItem.isTouched;\n"
"			syncItem.syncStatus = config.macros.sync.syncStatusList[syncItem.isTouched ? \"changedLocally\" : \"none\"];\n"
"			syncItem.status = syncItem.syncStatus.text;\n"
"			list.push(syncItem);\n"
"		}\n"
"		});\n"
"	list.sort(function(a,b) {return a.title < b.title ? -1 : (a.title == b.title ? 0 : +1);});\n"
"	return list;\n"
"};\n"
"\n"
"config.macros.sync.preProcessSyncableTiddlers = function(syncList)\n"
"{\n"
"	for(var i=0; i<syncList.length; i++) {\n"
"		var si = syncList[i];\n"
"		si.serverUrl = si.adaptor.generateTiddlerInfo(si.tiddler).uri;\n"
"	}\n"
"};\n"
"\n"
"config.macros.sync.processSyncableTiddlers = function(syncList)\n"
"{\n"
"	for(var i=0; i<syncList.length; i++) {\n"
"		var si = syncList[i];\n"
"		if(si.syncStatus.display)\n"
"			si.rowElement.style.display = si.syncStatus.display;\n"
"		if(si.syncStatus.className)\n"
"			si.rowElement.className = si.syncStatus.className;\n"
"	}\n"
"};\n"
"\n"
"config.macros.sync.createSyncTasks = function(syncList)\n"
"{\n"
"	var syncTasks = [];\n"
"	for(var i=0; i<syncList.length; i++) {\n"
"		var si = syncList[i];\n"
"		var r = null;\n"
"		for(var j=0; j<syncTasks.length; j++) {\n"
"			var cst = syncTasks[j];\n"
"			if(si.serverType == cst.serverType && si.serverHost == cst.serverHost && si.serverWorkspace == cst.serverWorkspace)\n"
"				r = cst;\n"
"		}\n"
"		if(r) {\n"
"			si.syncTask = r;\n"
"			r.syncItems.push(si);\n"
"		} else {\n"
"			si.syncTask = this.createSyncTask(si);\n"
"			syncTasks.push(si.syncTask);\n"
"		}\n"
"	}\n"
"	return syncTasks;\n"
"};\n"
"\n"
"config.macros.sync.createSyncTask = function(syncItem)\n"
"{\n"
"	var st = {};\n"
"	st.serverType = syncItem.serverType;\n"
"	st.serverHost = syncItem.serverHost;\n"
"	st.serverWorkspace = syncItem.serverWorkspace;\n"
"	st.syncItems = [syncItem];\n"
"\n"
"	var openWorkspaceCallback = function(context,syncItems) {\n"
"		if(context.status) {\n"
"			context.adaptor.getTiddlerList(context,syncItems,getTiddlerListCallback);\n"
"			return true;\n"
"		}\n"
"		displayMessage(context.statusText);\n"
"		return false;\n"
"	};\n"
"\n"
"	var getTiddlerListCallback = function(context,sycnItems) {\n"
"		if(!context.status) {\n"
"			displayMessage(context.statusText);\n"
"			return false;\n"
"		}\n"
"		syncItems = context.userParams;\n"
"		var tiddlers = context.tiddlers;\n"
"		for(var i=0; i<syncItems.length; i++) {\n"
"			var si = syncItems[i];\n"
"			var f = tiddlers.findByField(\"title\",si.title);\n"
"			if(f !== null) {\n"
"				if(tiddlers[f].fields['server.page.revision'] > si.tiddler.fields['server.page.revision']) {\n"
"					si.syncStatus = config.macros.sync.syncStatusList[si.isTouched ? 'changedBoth' : 'changedServer'];\n"
"				}\n"
"			} else {\n"
"				si.syncStatus = config.macros.sync.syncStatusList.notFound;\n"
"			}\n"
"			config.macros.sync.updateSyncStatus(si);\n"
"		}\n"
"		return true;\n"
"	};\n"
"	var context = {host:st.serverHost,workspace:st.serverWorkspace};\n"
"	syncItem.adaptor.openHost(st.serverHost);\n"
"	syncItem.adaptor.openWorkspace(st.serverWorkspace,context,st.syncItems,openWorkspaceCallback);\n"
"	return st;\n"
"};\n"
"\n"
"config.macros.sync.updateSyncStatus = function(syncItem)\n"
"{\n"
"	var e = syncItem.colElements[\"status\"];\n"
"	removeChildren(e);\n"
"	createTiddlyText(e,syncItem.syncStatus.text);\n"
"	if(syncItem.syncStatus.display)\n"
"		syncItem.rowElement.style.display = syncItem.syncStatus.display;\n"
"	if(syncItem.syncStatus.className)\n"
"		syncItem.rowElement.className = syncItem.syncStatus.className;\n"
"};\n"
"\n"
"config.macros.sync.doSync = function(e)\n"
"{\n"
"	var getTiddlerCallback = function(context,syncItem) {\n"
"		if(syncItem) {\n"
"			var tiddler = context.tiddler;\n"
"			store.saveTiddler(tiddler.title,tiddler.title,tiddler.text,tiddler.modifier,tiddler.modified,tiddler.tags,tiddler.fields,true,tiddler.created);\n"
"			syncItem.syncStatus = config.macros.sync.syncStatusList.gotFromServer;\n"
"			config.macros.sync.updateSyncStatus(syncItem);\n"
"		}\n"
"	};\n"
"	var putTiddlerCallback = function(context,syncItem) {\n"
"		if(syncItem) {\n"
"			store.resetTiddler(context.title);\n"
"			syncItem.syncStatus = config.macros.sync.syncStatusList.putToServer;\n"
"			config.macros.sync.updateSyncStatus(syncItem);\n"
"		}\n"
"	};\n"
"\n"
"	var rowNames = ListView.getSelectedRows(currSync.listView);\n"
"	var sl = config.macros.sync.syncStatusList;\n"
"	for(var i=0; i<currSync.syncList.length; i++) {\n"
"		var si = currSync.syncList[i];\n"
"		if(rowNames.indexOf(si.title) != -1) {\n"
"			var errorMsg = \"Error in doSync: \";\n"
"			try {\n"
"				var r = true;\n"
"				switch(si.syncStatus) {\n"
"				case sl.changedServer:\n"
"					r = si.adaptor.getTiddler(si.title,null,si,getTiddlerCallback);\n"
"					break;\n"
"				case sl.notFound:\n"
"				case sl.changedLocally:\n"
"				case sl.changedBoth:\n"
"					r = si.adaptor.putTiddler(si.tiddler,null,si,putTiddlerCallback);\n"
"					break;\n"
"				default:\n"
"					break;\n"
"				}\n"
"				if(!r)\n"
"					displayMessage(errorMsg + r);\n"
"			} catch(ex) {\n"
"				if(ex.name == \"TypeError\")\n"
"					displayMessage(\"sync operation unsupported: \" + ex.message);\n"
"				else\n"
"					displayMessage(errorMsg + ex.message);\n"
"			}\n"
"		}\n"
"	}\n"
"	return false;\n"
"};\n"
"\n"
"//--\n"
"//-- Manager UI for groups of tiddlers\n"
"//--\n"
"\n"
"config.macros.plugins.handler = function(place,macroName,params,wikifier,paramString)\n"
"{\n"
"	var wizard = new Wizard();\n"
"	wizard.createWizard(place,this.wizardTitle);\n"
"	wizard.addStep(this.step1Title,this.step1Html);\n"
"	var markList = wizard.getElement(\"markList\");\n"
"	var listWrapper = document.createElement(\"div\");\n"
"	markList.parentNode.insertBefore(listWrapper,markList);\n"
"	listWrapper.setAttribute(\"refresh\",\"macro\");\n"
"	listWrapper.setAttribute(\"macroName\",\"plugins\");\n"
"	listWrapper.setAttribute(\"params\",paramString);\n"
"	this.refresh(listWrapper,paramString);\n"
"};\n"
"\n"
"config.macros.plugins.refresh = function(listWrapper,params)\n"
"{\n"
"	var wizard = new Wizard(listWrapper);\n"
"	var selectedRows = [];\n"
"	ListView.forEachSelector(listWrapper,function(e,rowName) {\n"
"			if(e.checked)\n"
"				selectedRows.push(e.getAttribute(\"rowName\"));\n"
"		});\n"
"	removeChildren(listWrapper);\n"
"	params = params.parseParams(\"anon\");\n"
"	var plugins = installedPlugins.slice(0);\n"
"	var t,tiddler,p;\n"
"	var configTiddlers = store.getTaggedTiddlers(\"systemConfig\");\n"
"	for(t=0; t<configTiddlers.length; t++) {\n"
"		tiddler = configTiddlers[t];\n"
"		if(plugins.findByField(\"title\",tiddler.title) == null) {\n"
"			p = getPluginInfo(tiddler);\n"
"			p.executed = false;\n"
"			p.log.splice(0,0,this.skippedText);\n"
"			plugins.push(p);\n"
"		}\n"
"	}\n"
"	for(t=0; t<plugins.length; t++) {\n"
"		p = plugins[t];\n"
"		p.size = p.tiddler.text ? p.tiddler.text.length : 0;\n"
"		p.forced = p.tiddler.isTagged(\"systemConfigForce\");\n"
"		p.disabled = p.tiddler.isTagged(\"systemConfigDisable\");\n"
"		p.Selected = selectedRows.indexOf(plugins[t].title) != -1;\n"
"	}\n"
"	if(plugins.length == 0) {\n"
"		createTiddlyElement(listWrapper,\"em\",null,null,this.noPluginText);\n"
"		wizard.setButtons([]);\n"
"	} else {\n"
"		var listView = ListView.create(listWrapper,plugins,this.listViewTemplate,this.onSelectCommand);\n"
"		wizard.setValue(\"listView\",listView);\n"
"		wizard.setButtons([\n"
"				{caption: config.macros.plugins.removeLabel, tooltip: config.macros.plugins.removePrompt, onClick: config.macros.plugins.doRemoveTag},\n"
"				{caption: config.macros.plugins.deleteLabel, tooltip: config.macros.plugins.deletePrompt, onClick: config.macros.plugins.doDelete}\n"
"			]);\n"
"	}\n"
"};\n"
"\n"
"config.macros.plugins.doRemoveTag = function(e)\n"
"{\n"
"	var wizard = new Wizard(this);\n"
"	var listView = wizard.getValue(\"listView\");\n"
"	var rowNames = ListView.getSelectedRows(listView);\n"
"	if(rowNames.length == 0) {\n"
"		alert(config.messages.nothingSelected);\n"
"	} else {\n"
"		for(var t=0; t<rowNames.length; t++)\n"
"			store.setTiddlerTag(rowNames[t],false,\"systemConfig\");\n"
"	}\n"
"};\n"
"\n"
"config.macros.plugins.doDelete = function(e)\n"
"{\n"
"	var wizard = new Wizard(this);\n"
"	var listView = wizard.getValue(\"listView\");\n"
"	var rowNames = ListView.getSelectedRows(listView);\n"
"	if(rowNames.length == 0) {\n"
"		alert(config.messages.nothingSelected);\n"
"	} else {\n"
"		if(confirm(config.macros.plugins.confirmDeleteText.format([rowNames.join(\", \")]))) {\n"
"			for(var t=0; t<rowNames.length; t++) {\n"
"				store.removeTiddler(rowNames[t]);\n"
"				story.closeTiddler(rowNames[t],true);\n"
"			}\n"
"		}\n"
"	}\n"
"};\n"
"\n"
"//--\n"
"//-- Message area\n"
"//--\n"
"\n"
"function getMessageDiv()\n"
"{\n"
"	var msgArea = document.getElementById(\"messageArea\");\n"
"	if(!msgArea)\n"
"		return null;\n"
"	if(!msgArea.hasChildNodes())\n"
"		createTiddlyButton(createTiddlyElement(msgArea,\"div\",null,\"messageToolbar\"),\n"
"			config.messages.messageClose.text,\n"
"			config.messages.messageClose.tooltip,\n"
"			clearMessage);\n"
"	msgArea.style.display = \"block\";\n"
"	return createTiddlyElement(msgArea,\"div\");\n"
"}\n"
"\n"
"function displayMessage(text,linkText)\n"
"{\n"
"	var e = getMessageDiv();\n"
"	if(!e) {\n"
"		alert(text);\n"
"		return;\n"
"	}\n"
"	if(linkText) {\n"
"		var link = createTiddlyElement(e,\"a\",null,null,text);\n"
"		link.href = linkText;\n"
"		link.target = \"_blank\";\n"
"	} else {\n"
"		e.appendChild(document.createTextNode(text));\n"
"	}\n"
"}\n"
"\n"
"function clearMessage()\n"
"{\n"
"	var msgArea = document.getElementById(\"messageArea\");\n"
"	if(msgArea) {\n"
"		removeChildren(msgArea);\n"
"		msgArea.style.display = \"none\";\n"
"	}\n"
"	return false;\n"
"}\n"
"\n"
"//--\n"
"//-- Refresh mechanism\n"
"//--\n"
"\n"
"config.notifyTiddlers = [\n"
"	{name: \"StyleSheetLayout\", notify: refreshStyles},\n"
"	{name: \"StyleSheetColors\", notify: refreshStyles},\n"
"	{name: \"StyleSheet\", notify: refreshStyles},\n"
"	{name: \"StyleSheetPrint\", notify: refreshStyles},\n"
"	{name: \"PageTemplate\", notify: refreshPageTemplate},\n"
"	{name: \"SiteTitle\", notify: refreshPageTitle},\n"
"	{name: \"SiteSubtitle\", notify: refreshPageTitle},\n"
"	{name: \"ColorPalette\", notify: refreshColorPalette},\n"
"	{name: null, notify: refreshDisplay}\n"
"];\n"
"\n"
"config.refreshers = {\n"
"	link: function(e,changeList)\n"
"		{\n"
"		var title = e.getAttribute(\"tiddlyLink\");\n"
"		refreshTiddlyLink(e,title);\n"
"		return true;\n"
"		},\n"
"\n"
"	tiddler: function(e,changeList)\n"
"		{\n"
"		var title = e.getAttribute(\"tiddler\");\n"
"		var template = e.getAttribute(\"template\");\n"
"		if(changeList && changeList.indexOf(title) != -1 && !story.isDirty(title))\n"
"			story.refreshTiddler(title,template,true);\n"
"		else\n"
"			refreshElements(e,changeList);\n"
"		return true;\n"
"		},\n"
"\n"
"	content: function(e,changeList)\n"
"		{\n"
"		var title = e.getAttribute(\"tiddler\");\n"
"		var force = e.getAttribute(\"force\");\n"
"		if(force != null || changeList == null || changeList.indexOf(title) != -1) {\n"
"			removeChildren(e);\n"
"			wikify(store.getTiddlerText(title,\"\"),e,null,store.fetchTiddler(title));\n"
"			return true;\n"
"		} else\n"
"			return false;\n"
"		},\n"
"\n"
"	macro: function(e,changeList)\n"
"		{\n"
"		var macro = e.getAttribute(\"macroName\");\n"
"		var params = e.getAttribute(\"params\");\n"
"		if(macro)\n"
"			macro = config.macros[macro];\n"
"		if(macro && macro.refresh)\n"
"			macro.refresh(e,params);\n"
"		return true;\n"
"		}\n"
"};\n"
"\n"
"config.refresherData = {\n"
"	styleSheet: \"StyleSheet\",\n"
"	defaultStyleSheet: \"StyleSheet\",\n"
"	pageTemplate: \"PageTemplate\",\n"
"	defaultPageTemplate: \"PageTemplate\",\n"
"	colorPalette: \"ColorPalette\",\n"
"	defaultColorPalette: \"ColorPalette\"\n"
"};\n"
"\n"
"function refreshElements(root,changeList)\n"
"{\n"
"	var nodes = root.childNodes;\n"
"	for(var c=0; c<nodes.length; c++) {\n"
"		var e = nodes[c], type = null;\n"
"		if(e.getAttribute && (e.tagName ? e.tagName != \"IFRAME\" : true))\n"
"			type = e.getAttribute(\"refresh\");\n"
"		var refresher = config.refreshers[type];\n"
"		var refreshed = false;\n"
"		if(refresher != undefined)\n"
"			refreshed = refresher(e,changeList);\n"
"		if(e.hasChildNodes() && !refreshed)\n"
"			refreshElements(e,changeList);\n"
"	}\n"
"}\n"
"\n"
"function applyHtmlMacros(root,tiddler)\n"
"{\n"
"	var e = root.firstChild;\n"
"	while(e) {\n"
"		var nextChild = e.nextSibling;\n"
"		if(e.getAttribute) {\n"
"			var macro = e.getAttribute(\"macro\");\n"
"			if(macro) {\n"
"				e.removeAttribute(\"macro\");\n"
"				var params = \"\";\n"
"				var p = macro.indexOf(\" \");\n"
"				if(p != -1) {\n"
"					params = macro.substr(p+1);\n"
"					macro = macro.substr(0,p);\n"
"				}\n"
"				invokeMacro(e,macro,params,null,tiddler);\n"
"			}\n"
"		}\n"
"		if(e.hasChildNodes())\n"
"			applyHtmlMacros(e,tiddler);\n"
"		e = nextChild;\n"
"	}\n"
"}\n"
"\n"
"function refreshPageTemplate(title)\n"
"{\n"
"	var stash = jQuery(\"<div/>\").appendTo(\"body\").hide()[0];\n"
"	var display = story.getContainer();\n"
"	var nodes,t;\n"
"	if(display) {\n"
"		nodes = display.childNodes;\n"
"		for(t=nodes.length-1; t>=0; t--)\n"
"			stash.appendChild(nodes[t]);\n"
"	}\n"
"	var wrapper = document.getElementById(\"contentWrapper\");\n"
"\n"
"	var isAvailable = function(title) {\n"
"		var s = title ? title.indexOf(config.textPrimitives.sectionSeparator) : -1;\n"
"		if(s!=-1)\n"
"			title = title.substr(0,s);\n"
"		return store.tiddlerExists(title) || store.isShadowTiddler(title);\n"
"	};\n"
"	if(!title || !isAvailable(title))\n"
"		title = config.refresherData.pageTemplate;\n"
"	if(!isAvailable(title))\n"
"		title = config.refresherData.defaultPageTemplate; //# this one is always avaialable\n"
"	wrapper.innerHTML = store.getRecursiveTiddlerText(title,null,10);\n"
"	applyHtmlMacros(wrapper);\n"
"	refreshElements(wrapper);\n"
"	display = story.getContainer();\n"
"	removeChildren(display);\n"
"	if(!display)\n"
"		display = createTiddlyElement(wrapper,\"div\",story.containerId());\n"
"	nodes = stash.childNodes;\n"
"	for(t=nodes.length-1; t>=0; t--)\n"
"		display.appendChild(nodes[t]);\n"
"	removeNode(stash);\n"
"}\n"
"\n"
"function refreshDisplay(hint)\n"
"{\n"
"	if(typeof hint == \"string\")\n"
"		hint = [hint];\n"
"	var e = document.getElementById(\"contentWrapper\");\n"
"	refreshElements(e,hint);\n"
"	if(backstage.isPanelVisible()) {\n"
"		e = document.getElementById(\"backstage\");\n"
"		refreshElements(e,hint);\n"
"	}\n"
"}\n"
"\n"
"function refreshPageTitle()\n"
"{\n"
"	document.title = getPageTitle();\n"
"}\n"
"\n"
"function getPageTitle()\n"
"{\n"
"	var st = wikifyPlain(\"SiteTitle\");\n"
"	var ss = wikifyPlain(\"SiteSubtitle\");\n"
"	return st + ((st == \"\" || ss == \"\") ? \"\" : \" - \") + ss;\n"
"}\n"
"\n"
"function refreshStyles(title,doc)\n"
"{\n"
"	setStylesheet(title == null ? \"\" : store.getRecursiveTiddlerText(title,\"\",10),title,doc || document);\n"
"}\n"
"\n"
"function refreshColorPalette(title)\n"
"{\n"
"	if(!startingUp)\n"
"		refreshAll();\n"
"}\n"
"\n"
"function refreshAll()\n"
"{\n"
"	refreshPageTemplate();\n"
"	refreshDisplay();\n"
"	refreshStyles(\"StyleSheetLayout\");\n"
"	refreshStyles(\"StyleSheetColors\");\n"
"	refreshStyles(config.refresherData.styleSheet);\n"
"	refreshStyles(\"StyleSheetPrint\");\n"
"}\n"
"\n"
"//--\n"
"//-- Options stuff\n"
"//--\n"
"\n"
"config.optionHandlers = {\n"
"	'txt': {\n"
"		get: function(name) {return encodeCookie(config.options[name].toString());},\n"
"		set: function(name,value) {config.options[name] = decodeCookie(value);}\n"
"	},\n"
"	'chk': {\n"
"		get: function(name) {return config.options[name] ? \"true\" : \"false\";},\n"
"		set: function(name,value) {config.options[name] = value == \"true\";}\n"
"	}\n"
"};\n"
"\n"
"function loadOptionsCookie()\n"
"{\n"
"	if(safeMode)\n"
"		return;\n"
"	var cookies = document.cookie.split(\";\");\n"
"	for(var c=0; c<cookies.length; c++) {\n"
"		var p = cookies[c].indexOf(\"=\");\n"
"		if(p != -1) {\n"
"			var name = cookies[c].substr(0,p).trim();\n"
"			var value = cookies[c].substr(p+1).trim();\n"
"			var optType = name.substr(0,3);\n"
"			if(config.optionHandlers[optType] && config.optionHandlers[optType].set)\n"
"				config.optionHandlers[optType].set(name,value);\n"
"		}\n"
"	}\n"
"}\n"
"\n"
"function saveOptionCookie(name)\n"
"{\n"
"	if(safeMode)\n"
"		return;\n"
"	var c = name + \"=\";\n"
"	var optType = name.substr(0,3);\n"
"	if(config.optionHandlers[optType] && config.optionHandlers[optType].get)\n"
"		c += config.optionHandlers[optType].get(name);\n"
"	c += \"; expires=Fri, 1 Jan 2038 12:00:00 UTC; path=/\";\n"
"	document.cookie = c;\n"
"}\n"
"\n"
"function removeCookie(name)\n"
"{\n"
"	document.cookie = name + \"=; expires=Thu, 01-Jan-1970 00:00:01 UTC; path=/;\";\n"
"}\n"
"\n"
"function encodeCookie(s)\n"
"{\n"
"	return escape(convertUnicodeToHtmlEntities(s));\n"
"}\n"
"\n"
"function decodeCookie(s)\n"
"{\n"
"	s = unescape(s);\n"
"	var re = /&#[0-9]{1,5};/g;\n"
"	return s.replace(re,function($0) {return String.fromCharCode(eval($0.replace(/[&#;]/g,\"\")));});\n"
"}\n"
"\n"
"\n"
"config.macros.option.genericCreate = function(place,type,opt,className,desc)\n"
"{\n"
"	var typeInfo = config.macros.option.types[type];\n"
"	var c = document.createElement(typeInfo.elementType);\n"
"	if(typeInfo.typeValue)\n"
"		c.setAttribute(\"type\",typeInfo.typeValue);\n"
"	c[typeInfo.eventName] = typeInfo.onChange;\n"
"	c.setAttribute(\"option\",opt);\n"
"	c.className = className || typeInfo.className;\n"
"	if(config.optionsDesc[opt])\n"
"		c.setAttribute(\"title\",config.optionsDesc[opt]);\n"
"	place.appendChild(c);\n"
"	if(desc != \"no\")\n"
"		createTiddlyText(place,config.optionsDesc[opt] || opt);\n"
"	c[typeInfo.valueField] = config.options[opt];\n"
"	return c;\n"
"};\n"
"\n"
"config.macros.option.genericOnChange = function(e)\n"
"{\n"
"	var opt = this.getAttribute(\"option\");\n"
"	if(opt) {\n"
"		var optType = opt.substr(0,3);\n"
"		var handler = config.macros.option.types[optType];\n"
"		if(handler.elementType && handler.valueField)\n"
"			config.macros.option.propagateOption(opt,handler.valueField,this[handler.valueField],handler.elementType,this);\n"
"	}\n"
"	return true;\n"
"};\n"
"\n"
"config.macros.option.types = {\n"
"	'txt': {\n"
"		elementType: \"input\",\n"
"		valueField: \"value\",\n"
"		eventName: \"onchange\",\n"
"		className: \"txtOptionInput\",\n"
"		create: config.macros.option.genericCreate,\n"
"		onChange: config.macros.option.genericOnChange\n"
"	},\n"
"	'chk': {\n"
"		elementType: \"input\",\n"
"		valueField: \"checked\",\n"
"		eventName: \"onclick\",\n"
"		className: \"chkOptionInput\",\n"
"		typeValue: \"checkbox\",\n"
"		create: config.macros.option.genericCreate,\n"
"		onChange: config.macros.option.genericOnChange\n"
"	}\n"
"};\n"
"\n"
"config.macros.option.propagateOption = function(opt,valueField,value,elementType,elem)\n"
"{\n"
"	config.options[opt] = value;\n"
"	saveOptionCookie(opt);\n"
"	var nodes = document.getElementsByTagName(elementType);\n"
"	for(var t=0; t<nodes.length; t++) {\n"
"		var optNode = nodes[t].getAttribute(\"option\");\n"
"		if(opt == optNode && nodes[t]!=elem)\n"
"			nodes[t][valueField] = value;\n"
"	}\n"
"};\n"
"\n"
"config.macros.option.handler = function(place,macroName,params,wikifier,paramString)\n"
"{\n"
"	params = paramString.parseParams(\"anon\",null,true,false,false);\n"
"	var opt = (params[1] && params[1].name == \"anon\") ? params[1].value : getParam(params,\"name\",null);\n"
"	var className = (params[2] && params[2].name == \"anon\") ? params[2].value : getParam(params,\"class\",null);\n"
"	var desc = getParam(params,\"desc\",\"no\");\n"
"	var type = opt.substr(0,3);\n"
"	var h = config.macros.option.types[type];\n"
"	if(h && h.create)\n"
"		h.create(place,type,opt,className,desc);\n"
"};\n"
"\n"
"config.macros.options.handler = function(place,macroName,params,wikifier,paramString)\n"
"{\n"
"	params = paramString.parseParams(\"anon\",null,true,false,false);\n"
"	var showUnknown = getParam(params,\"showUnknown\",\"no\");\n"
"	var wizard = new Wizard();\n"
"	wizard.createWizard(place,this.wizardTitle);\n"
"	wizard.addStep(this.step1Title,this.step1Html);\n"
"	var markList = wizard.getElement(\"markList\");\n"
"	var chkUnknown = wizard.getElement(\"chkUnknown\");\n"
"	chkUnknown.checked = showUnknown == \"yes\";\n"
"	chkUnknown.onchange = this.onChangeUnknown;\n"
"	var listWrapper = document.createElement(\"div\");\n"
"	markList.parentNode.insertBefore(listWrapper,markList);\n"
"	wizard.setValue(\"listWrapper\",listWrapper);\n"
"	this.refreshOptions(listWrapper,showUnknown == \"yes\");\n"
"};\n"
"\n"
"config.macros.options.refreshOptions = function(listWrapper,showUnknown)\n"
"{\n"
"	var opts = [];\n"
"	for(var n in config.options) {\n"
"		var opt = {};\n"
"		opt.option = \"\";\n"
"		opt.name = n;\n"
"		opt.lowlight = !config.optionsDesc[n];\n"
"		opt.description = opt.lowlight ? this.unknownDescription : config.optionsDesc[n];\n"
"		if(!opt.lowlight || showUnknown)\n"
"			opts.push(opt);\n"
"	}\n"
"	opts.sort(function(a,b) {return a.name.substr(3) < b.name.substr(3) ? -1 : (a.name.substr(3) == b.name.substr(3) ? 0 : +1);});\n"
"	var listview = ListView.create(listWrapper,opts,this.listViewTemplate);\n"
"	for(n=0; n<opts.length; n++) {\n"
"		var type = opts[n].name.substr(0,3);\n"
"		var h = config.macros.option.types[type];\n"
"		if(h && h.create) {\n"
"			h.create(opts[n].colElements['option'],type,opts[n].name,null,\"no\");\n"
"		}\n"
"	}\n"
"};\n"
"\n"
"config.macros.options.onChangeUnknown = function(e)\n"
"{\n"
"	var wizard = new Wizard(this);\n"
"	var listWrapper = wizard.getValue(\"listWrapper\");\n"
"	removeChildren(listWrapper);\n"
"	config.macros.options.refreshOptions(listWrapper,this.checked);\n"
"	return false;\n"
"};\n"
"\n"
"//--\n"
"//-- Saving\n"
"//--\n"
"\n"
"var saveUsingSafari = false;\n"
"\n"
"var startSaveArea = '<div id=\"' + 'storeArea\">'; // Split up into two so that indexOf() of this source doesn't find it\n"
"var endSaveArea = '</d' + 'iv>';\n"
"\n"
"// If there are unsaved changes, force the user to confirm before exitting\n"
"function confirmExit()\n"
"{\n"
"	hadConfirmExit = true;\n"
"	if((store && store.isDirty && store.isDirty()) || (story && story.areAnyDirty && story.areAnyDirty()))\n"
"		return config.messages.confirmExit;\n"
"}\n"
"\n"
"// Give the user a chance to save changes before exitting\n"
"function checkUnsavedChanges()\n"
"{\n"
"	if(store && store.isDirty && store.isDirty() && window.hadConfirmExit === false) {\n"
"		if(confirm(config.messages.unsavedChangesWarning))\n"
"			saveChanges();\n"
"	}\n"
"}\n"
"\n"
"function updateLanguageAttribute(s)\n"
"{\n"
"	if(config.locale) {\n"
"		var mRE = /(<html(?:.*?)?)(?: xml:lang\\=\"([a-z]+)\")?(?: lang\\=\"([a-z]+)\")?>/;\n"
"		var m = mRE.exec(s);\n"
"		if(m) {\n"
"			var t = m[1];\n"
"			if(m[2])\n"
"				t += ' xml:lang=\"' + config.locale + '\"';\n"
"			if(m[3])\n"
"				t += ' lang=\"' + config.locale + '\"';\n"
"			t += \">\";\n"
"			s = s.substr(0,m.index) + t + s.substr(m.index+m[0].length);\n"
"		}\n"
"	}\n"
"	return s;\n"
"}\n"
"\n"
"function updateMarkupBlock(s,blockName,tiddlerName)\n"
"{\n"
"	return s.replaceChunk(\n"
"			\"<!--%0-START-->\".format([blockName]),\n"
"			\"<!--%0-END-->\".format([blockName]),\n"
"			\"\\n\" + convertUnicodeToFileFormat(store.getRecursiveTiddlerText(tiddlerName,\"\")) + \"\\n\");\n"
"}\n"
"\n"
"function updateOriginal(original,posDiv,localPath)\n"
"{\n"
"	if(!posDiv)\n"
"		posDiv = locateStoreArea(original);\n"
"	if(!posDiv) {\n"
"		alert(config.messages.invalidFileError.format([localPath]));\n"
"		return null;\n"
"	}\n"
"	var revised = original.substr(0,posDiv[0] + startSaveArea.length) + \"\\n\" +\n"
"				convertUnicodeToFileFormat(store.allTiddlersAsHtml()) + \"\\n\" +\n"
"				original.substr(posDiv[1]);\n"
"	var newSiteTitle = convertUnicodeToFileFormat(getPageTitle()).htmlEncode();\n"
"	revised = revised.replaceChunk(\"<title\"+\">\",\"</title\"+\">\",\" \" + newSiteTitle + \" \");\n"
"	revised = updateLanguageAttribute(revised);\n"
"	revised = updateMarkupBlock(revised,\"PRE-HEAD\",\"MarkupPreHead\");\n"
"	revised = updateMarkupBlock(revised,\"POST-HEAD\",\"MarkupPostHead\");\n"
"	revised = updateMarkupBlock(revised,\"PRE-BODY\",\"MarkupPreBody\");\n"
"	revised = updateMarkupBlock(revised,\"POST-SCRIPT\",\"MarkupPostBody\");\n"
"	return revised;\n"
"}\n"
"\n"
"function locateStoreArea(original)\n"
"{\n"
"	// Locate the storeArea div's\n"
"	var posOpeningDiv = original.indexOf(startSaveArea);\n"
"	var limitClosingDiv = original.indexOf(\"<\"+\"!--POST-STOREAREA--\"+\">\");\n"
"	if(limitClosingDiv == -1)\n"
"		limitClosingDiv = original.indexOf(\"<\"+\"!--POST-BODY-START--\"+\">\");\n"
"	var posClosingDiv = original.lastIndexOf(endSaveArea,limitClosingDiv == -1 ? original.length : limitClosingDiv);\n"
"	return (posOpeningDiv != -1 && posClosingDiv != -1) ? [posOpeningDiv,posClosingDiv] : null;\n"
"}\n"
"\n"
"function autoSaveChanges(onlyIfDirty,tiddlers)\n"
"{\n"
"	if(config.options.chkAutoSave)\n"
"		saveChanges(onlyIfDirty,tiddlers);\n"
"}\n"
"\n"
"function loadOriginal(localPath)\n"
"{\n"
"	return loadFile(localPath);\n"
"}\n"
"\n"
"// Save this tiddlywiki with the pending changes\n"
"function saveChanges(onlyIfDirty,tiddlers)\n"
"{\n"
"	if(onlyIfDirty && !store.isDirty())\n"
"		return;\n"
"	clearMessage();\n"
"	var t0 = new Date();\n"
"	var originalPath = document.location.toString();\n"
"	if(originalPath.substr(0,5) != \"file:\") {\n"
"		alert(config.messages.notFileUrlError);\n"
"		if(store.tiddlerExists(config.messages.saveInstructions))\n"
"			story.displayTiddler(null,config.messages.saveInstructions);\n"
"		return;\n"
"	}\n"
"	var localPath = getLocalPath(originalPath);\n"
"	var original = loadOriginal(localPath);\n"
"	if(original == null) {\n"
"		alert(config.messages.cantSaveError);\n"
"		if(store.tiddlerExists(config.messages.saveInstructions))\n"
"			story.displayTiddler(null,config.messages.saveInstructions);\n"
"		return;\n"
"	}\n"
"	var posDiv = locateStoreArea(original);\n"
"	if(!posDiv) {\n"
"		alert(config.messages.invalidFileError.format([localPath]));\n"
"		return;\n"
"	}\n"
"	saveMain(localPath,original,posDiv);\n"
"	if(config.options.chkSaveBackups)\n"
"		saveBackup(localPath,original);\n"
"	if(config.options.chkSaveEmptyTemplate)\n"
"		saveEmpty(localPath,original,posDiv);\n"
"	if(config.options.chkGenerateAnRssFeed && saveRss instanceof Function)\n"
"		saveRss(localPath);\n"
"	if(config.options.chkDisplayInstrumentation)\n"
"		displayMessage(\"saveChanges \" + (new Date()-t0) + \" ms\");\n"
"}\n"
"\n"
"function saveMain(localPath,original,posDiv)\n"
"{\n"
"	var save;\n"
"	try {\n"
"		var revised = updateOriginal(original,posDiv,localPath);\n"
"		save = saveFile(localPath,revised);\n"
"	} catch (ex) {\n"
"		showException(ex);\n"
"	}\n"
"	if(save) {\n"
"		displayMessage(config.messages.mainSaved,\"file://\" + localPath);\n"
"		store.setDirty(false);\n"
"	} else {\n"
"		alert(config.messages.mainFailed);\n"
"	}\n"
"}\n"
"\n"
"function saveBackup(localPath,original)\n"
"{\n"
"	var backupPath = getBackupPath(localPath);\n"
"	var backup = copyFile(backupPath,localPath);\n"
"	if(!backup)\n"
"		backup = saveFile(backupPath,original);\n"
"	if(backup)\n"
"		displayMessage(config.messages.backupSaved,\"file://\" + backupPath);\n"
"	else\n"
"		alert(config.messages.backupFailed);\n"
"}\n"
"\n"
"function saveEmpty(localPath,original,posDiv)\n"
"{\n"
"	var emptyPath,p;\n"
"	if((p = localPath.lastIndexOf(\"/\")) != -1)\n"
"		emptyPath = localPath.substr(0,p) + \"/\";\n"
"	else if((p = localPath.lastIndexOf(\"\\\\\")) != -1)\n"
"		emptyPath = localPath.substr(0,p) + \"\\\\\";\n"
"	else\n"
"		emptyPath = localPath + \".\";\n"
"	emptyPath += \"empty.html\";\n"
"	var empty = original.substr(0,posDiv[0] + startSaveArea.length) + original.substr(posDiv[1]);\n"
"	var emptySave = saveFile(emptyPath,empty);\n"
"	if(emptySave)\n"
"		displayMessage(config.messages.emptySaved,\"file://\" + emptyPath);\n"
"	else\n"
"		alert(config.messages.emptyFailed);\n"
"}\n"
"\n"
"function getLocalPath(origPath)\n"
"{\n"
"	var originalPath = convertUriToUTF8(origPath,config.options.txtFileSystemCharSet);\n"
"	// Remove any location or query part of the URL\n"
"	var argPos = originalPath.indexOf(\"?\");\n"
"	if(argPos != -1)\n"
"		originalPath = originalPath.substr(0,argPos);\n"
"	var hashPos = originalPath.indexOf(\"#\");\n"
"	if(hashPos != -1)\n"
"		originalPath = originalPath.substr(0,hashPos);\n"
"	// Convert file://localhost/ to file:///\n"
"	if(originalPath.indexOf(\"file://localhost/\") == 0)\n"
"		originalPath = \"file://\" + originalPath.substr(16);\n"
"	// Convert to a native file format\n"
"	var localPath;\n"
"	if(originalPath.charAt(9) == \":\") // pc local file\n"
"		localPath = unescape(originalPath.substr(8)).replace(new RegExp(\"/\",\"g\"),\"\\\\\");\n"
"	else if(originalPath.indexOf(\"file://///\") == 0) // FireFox pc network file\n"
"		localPath = \"\\\\\\\\\" + unescape(originalPath.substr(10)).replace(new RegExp(\"/\",\"g\"),\"\\\\\");\n"
"	else if(originalPath.indexOf(\"file:///\") == 0) // mac/unix local file\n"
"		localPath = unescape(originalPath.substr(7));\n"
"	else if(originalPath.indexOf(\"file:/\") == 0) // mac/unix local file\n"
"		localPath = unescape(originalPath.substr(5));\n"
"	else // pc network file\n"
"		localPath = \"\\\\\\\\\" + unescape(originalPath.substr(7)).replace(new RegExp(\"/\",\"g\"),\"\\\\\");\n"
"	return localPath;\n"
"}\n"
"\n"
"function getBackupPath(localPath,title,extension)\n"
"{\n"
"	var slash = \"\\\\\";\n"
"	var dirPathPos = localPath.lastIndexOf(\"\\\\\");\n"
"	if(dirPathPos == -1) {\n"
"		dirPathPos = localPath.lastIndexOf(\"/\");\n"
"		slash = \"/\";\n"
"	}\n"
"	var backupFolder = config.options.txtBackupFolder;\n"
"	if(!backupFolder || backupFolder == \"\")\n"
"		backupFolder = \".\";\n"
"	var backupPath = localPath.substr(0,dirPathPos) + slash + backupFolder + localPath.substr(dirPathPos);\n"
"	backupPath = backupPath.substr(0,backupPath.lastIndexOf(\".\")) + \".\";\n"
"	if(title)\n"
"		backupPath += title.replace(/[\\\\\\/\\*\\?\\\":<> ]/g,\"_\") + \".\";\n"
"	backupPath += (new Date()).convertToYYYYMMDDHHMMSSMMM() + \".\" + (extension || \"html\");\n"
"	return backupPath;\n"
"}\n"
"\n"
"//--\n"
"//-- RSS Saving\n"
"//--\n"
"\n"
"function saveRss(localPath)\n"
"{\n"
"	var rssPath = localPath.substr(0,localPath.lastIndexOf(\".\")) + \".xml\";\n"
"	if(saveFile(rssPath,convertUnicodeToFileFormat(generateRss())))\n"
"		displayMessage(config.messages.rssSaved,\"file://\" + rssPath);\n"
"	else\n"
"		alert(config.messages.rssFailed);\n"
"}\n"
"\n"
"tiddlerToRssItem = function(tiddler,uri)\n"
"{\n"
"	var s = \"<title\" + \">\" + tiddler.title.htmlEncode() + \"</title\" + \">\\n\";\n"
"	s += \"<description>\" + wikifyStatic(tiddler.text,null,tiddler).htmlEncode() + \"</description>\\n\";\n"
"	for(var i=0; i<tiddler.tags.length; i++)\n"
"		s += \"<category>\" + tiddler.tags[i] + \"</category>\\n\";\n"
"	s += \"<link>\" + uri + \"#\" + encodeURIComponent(String.encodeTiddlyLink(tiddler.title)) + \"</link>\\n\";\n"
"	s +=\"<pubDate>\" + tiddler.modified.toGMTString() + \"</pubDate>\\n\";\n"
"	return s;\n"
"};\n"
"\n"
"function generateRss()\n"
"{\n"
"	var s = [];\n"
"	var d = new Date();\n"
"	var u = store.getTiddlerText(\"SiteUrl\");\n"
"	// Assemble the header\n"
"	s.push(\"<\" + \"?xml version=\\\"1.0\\\"?\" + \">\");\n"
"	s.push(\"<rss version=\\\"2.0\\\">\");\n"
"	s.push(\"<channel>\");\n"
"	s.push(\"<title\" + \">\" + wikifyPlain(\"SiteTitle\").htmlEncode() + \"</title\" + \">\");\n"
"	if(u)\n"
"		s.push(\"<link>\" + u.htmlEncode() + \"</link>\");\n"
"	s.push(\"<description>\" + wikifyPlain(\"SiteSubtitle\").htmlEncode() + \"</description>\");\n"
"	s.push(\"<language>\" + config.locale + \"</language>\");\n"
"	s.push(\"<copyright>Copyright \" + d.getFullYear() + \" \" + config.options.txtUserName.htmlEncode() + \"</copyright>\");\n"
"	s.push(\"<pubDate>\" + d.toGMTString() + \"</pubDate>\");\n"
"	s.push(\"<lastBuildDate>\" + d.toGMTString() + \"</lastBuildDate>\");\n"
"	s.push(\"<docs>http://blogs.law.harvard.edu/tech/rss</docs>\");\n"
"	s.push(\"<generator>TiddlyWiki \" + formatVersion() + \"</generator>\");\n"
"	// The body\n"
"	var tiddlers = store.getTiddlers(\"modified\",\"excludeLists\");\n"
"	var n = config.numRssItems > tiddlers.length ? 0 : tiddlers.length-config.numRssItems;\n"
"	for(var i=tiddlers.length-1; i>=n; i--) {\n"
"		s.push(\"<item>\\n\" + tiddlerToRssItem(tiddlers[i],u) + \"\\n</item>\");\n"
"	}\n"
"	// And footer\n"
"	s.push(\"</channel>\");\n"
"	s.push(\"</rss>\");\n"
"	// Save it all\n"
"	return s.join(\"\\n\");\n"
"}\n"
"\n"
"//--\n"
"//-- Filesystem code\n"
"//--\n"
"\n"
"function convertUTF8ToUnicode(u)\n"
"{\n"
"	return config.browser.isOpera || !window.netscape ? manualConvertUTF8ToUnicode(u) : mozConvertUTF8ToUnicode(u);\n"
"}\n"
"\n"
"function manualConvertUTF8ToUnicode(utf)\n"
"{\n"
"	var uni = utf;\n"
"	var src = 0;\n"
"	var dst = 0;\n"
"	var b1, b2, b3;\n"
"	var c;\n"
"	while(src < utf.length) {\n"
"		b1 = utf.charCodeAt(src++);\n"
"		if(b1 < 0x80) {\n"
"			dst++;\n"
"		} else if(b1 < 0xE0) {\n"
"			b2 = utf.charCodeAt(src++);\n"
"			c = String.fromCharCode(((b1 & 0x1F) << 6) | (b2 & 0x3F));\n"
"			uni = uni.substring(0,dst++).concat(c,utf.substr(src));\n"
"		} else {\n"
"			b2 = utf.charCodeAt(src++);\n"
"			b3 = utf.charCodeAt(src++);\n"
"			c = String.fromCharCode(((b1 & 0xF) << 12) | ((b2 & 0x3F) << 6) | (b3 & 0x3F));\n"
"			uni = uni.substring(0,dst++).concat(c,utf.substr(src));\n"
"		}\n"
"	}\n"
"	return uni;\n"
"}\n"
"\n"
"function mozConvertUTF8ToUnicode(u)\n"
"{\n"
"	try {\n"
"		netscape.security.PrivilegeManager.enablePrivilege(\"UniversalXPConnect\");\n"
"		var converter = Components.classes[\"@mozilla.org/intl/scriptableunicodeconverter\"].createInstance(Components.interfaces.nsIScriptableUnicodeConverter);\n"
"		converter.charset = \"UTF-8\";\n"
"	} catch(ex) {\n"
"		return manualConvertUTF8ToUnicode(u);\n"
"	} // fallback\n"
"	var s = converter.ConvertToUnicode(u);\n"
"	var fin = converter.Finish();\n"
"	return fin.length > 0 ? s+fin : s;\n"
"}\n"
"\n"
"function convertUnicodeToFileFormat(s)\n"
"{\n"
"	return config.browser.isOpera || !window.netscape ? convertUnicodeToHtmlEntities(s) : mozConvertUnicodeToUTF8(s);\n"
"}\n"
"\n"
"function convertUnicodeToHtmlEntities(s)\n"
"{\n"
"	var re = /[^\\u0000-\\u007F]/g;\n"
"	return s.replace(re,function($0) {return \"&#\" + $0.charCodeAt(0).toString() + \";\";});\n"
"}\n"
"\n"
"function convertUnicodeToUTF8(s)\n"
"{\n"
"// return convertUnicodeToFileFormat to allow plugin migration\n"
"	return convertUnicodeToFileFormat(s);\n"
"}\n"
"\n"
"function manualConvertUnicodeToUTF8(s)\n"
"{\n"
"	return unescape(encodeURIComponent(s));\n"
"}\n"
"\n"
"function mozConvertUnicodeToUTF8(s)\n"
"{\n"
"	try {\n"
"		netscape.security.PrivilegeManager.enablePrivilege(\"UniversalXPConnect\");\n"
"		var converter = Components.classes[\"@mozilla.org/intl/scriptableunicodeconverter\"].createInstance(Components.interfaces.nsIScriptableUnicodeConverter);\n"
"		converter.charset = \"UTF-8\";\n"
"	} catch(ex) {\n"
"		return manualConvertUnicodeToUTF8(s);\n"
"	} // fallback\n"
"	var u = converter.ConvertFromUnicode(s);\n"
"	var fin = converter.Finish();\n"
"	return fin.length > 0 ? u + fin : u;\n"
"}\n"
"\n"
"function convertUriToUTF8(uri,charSet)\n"
"{\n"
"	if(window.netscape == undefined || charSet == undefined || charSet == \"\")\n"
"		return uri;\n"
"	try {\n"
"		netscape.security.PrivilegeManager.enablePrivilege(\"UniversalXPConnect\");\n"
"		var converter = Components.classes[\"@mozilla.org/intl/utf8converterservice;1\"].getService(Components.interfaces.nsIUTF8ConverterService);\n"
"	} catch(ex) {\n"
"		return uri;\n"
"	}\n"
"	return converter.convertURISpecToUTF8(uri,charSet);\n"
"}\n"
"\n"
"function copyFile(dest,source)\n"
"{\n"
"	return config.browser.isIE ? ieCopyFile(dest,source) : false;\n"
"}\n"
"\n"
"function saveFile(fileUrl,content)\n"
"{\n"
"	var r = mozillaSaveFile(fileUrl,content);\n"
"	if(!r)\n"
"		r = ieSaveFile(fileUrl,content);\n"
"	if(!r)\n"
"		r = javaSaveFile(fileUrl,content);\n"
"	return r;\n"
"}\n"
"\n"
"function loadFile(fileUrl)\n"
"{\n"
"	var r = mozillaLoadFile(fileUrl);\n"
"	if((r == null) || (r == false))\n"
"		r = ieLoadFile(fileUrl);\n"
"	if((r == null) || (r == false))\n"
"		r = javaLoadFile(fileUrl);\n"
"	return r;\n"
"}\n"
"\n"
"function ieCreatePath(path)\n"
"{\n"
"	try {\n"
"		var fso = new ActiveXObject(\"Scripting.FileSystemObject\");\n"
"	} catch(ex) {\n"
"		return null;\n"
"	}\n"
"\n"
"	var pos = path.lastIndexOf(\"\\\\\");\n"
"	if(pos==-1)\n"
"		pos = path.lastIndexOf(\"/\");\n"
"	if(pos!=-1)\n"
"		path = path.substring(0,pos+1);\n"
"\n"
"	var scan = [path];\n"
"	var parent = fso.GetParentFolderName(path);\n"
"	while(parent && !fso.FolderExists(parent)) {\n"
"		scan.push(parent);\n"
"		parent = fso.GetParentFolderName(parent);\n"
"	}\n"
"\n"
"	for(i=scan.length-1;i>=0;i--) {\n"
"		if(!fso.FolderExists(scan[i])) {\n"
"			fso.CreateFolder(scan[i]);\n"
"		}\n"
"	}\n"
"	return true;\n"
"}\n"
"\n"
"// Returns null if it can't do it, false if there's an error, true if it saved OK\n"
"function ieSaveFile(filePath,content)\n"
"{\n"
"	ieCreatePath(filePath);\n"
"	try {\n"
"		var fso = new ActiveXObject(\"Scripting.FileSystemObject\");\n"
"	} catch(ex) {\n"
"		return null;\n"
"	}\n"
"	var file = fso.OpenTextFile(filePath,2,-1,0);\n"
"	file.Write(content);\n"
"	file.Close();\n"
"	return true;\n"
"}\n"
"\n"
"// Returns null if it can't do it, false if there's an error, or a string of the content if successful\n"
"function ieLoadFile(filePath)\n"
"{\n"
"	try {\n"
"		var fso = new ActiveXObject(\"Scripting.FileSystemObject\");\n"
"		var file = fso.OpenTextFile(filePath,1);\n"
"		var content = file.ReadAll();\n"
"		file.Close();\n"
"	} catch(ex) {\n"
"		return null;\n"
"	}\n"
"	return content;\n"
"}\n"
"\n"
"function ieCopyFile(dest,source)\n"
"{\n"
"	ieCreatePath(dest);\n"
"	try {\n"
"		var fso = new ActiveXObject(\"Scripting.FileSystemObject\");\n"
"		fso.GetFile(source).Copy(dest);\n"
"	} catch(ex) {\n"
"		return false;\n"
"	}\n"
"	return true;\n"
"}\n"
"\n"
"// Returns null if it can't do it, false if there's an error, true if it saved OK\n"
"function mozillaSaveFile(filePath,content)\n"
"{\n"
"	if(window.Components) {\n"
"		try {\n"
"			netscape.security.PrivilegeManager.enablePrivilege(\"UniversalXPConnect\");\n"
"			var file = Components.classes[\"@mozilla.org/file/local;1\"].createInstance(Components.interfaces.nsILocalFile);\n"
"			file.initWithPath(filePath);\n"
"			if(!file.exists())\n"
"				file.create(0,0664);\n"
"			var out = Components.classes[\"@mozilla.org/network/file-output-stream;1\"].createInstance(Components.interfaces.nsIFileOutputStream);\n"
"			out.init(file,0x20|0x02,00004,null);\n"
"			out.write(content,content.length);\n"
"			out.flush();\n"
"			out.close();\n"
"			return true;\n"
"		} catch(ex) {\n"
"			return false;\n"
"		}\n"
"	}\n"
"	return null;\n"
"}\n"
"\n"
"// Returns null if it can't do it, false if there's an error, or a string of the content if successful\n"
"function mozillaLoadFile(filePath)\n"
"{\n"
"	if(window.Components) {\n"
"		try {\n"
"			netscape.security.PrivilegeManager.enablePrivilege(\"UniversalXPConnect\");\n"
"			var file = Components.classes[\"@mozilla.org/file/local;1\"].createInstance(Components.interfaces.nsILocalFile);\n"
"			file.initWithPath(filePath);\n"
"			if(!file.exists())\n"
"				return null;\n"
"			var inputStream = Components.classes[\"@mozilla.org/network/file-input-stream;1\"].createInstance(Components.interfaces.nsIFileInputStream);\n"
"			inputStream.init(file,0x01,00004,null);\n"
"			var sInputStream = Components.classes[\"@mozilla.org/scriptableinputstream;1\"].createInstance(Components.interfaces.nsIScriptableInputStream);\n"
"			sInputStream.init(inputStream);\n"
"			var contents = sInputStream.read(sInputStream.available());\n"
"			sInputStream.close();\n"
"			inputStream.close();\n"
"			return contents;\n"
"		} catch(ex) {\n"
"			return false;\n"
"		}\n"
"	}\n"
"	return null;\n"
"}\n"
"\n"
"function javaUrlToFilename(url)\n"
"{\n"
"	var f = \"//localhost\";\n"
"	if(url.indexOf(f) == 0)\n"
"		return url.substring(f.length);\n"
"	var i = url.indexOf(\":\");\n"
"	return i > 0 ? url.substring(i-1) : url;\n"
"}\n"
"\n"
"function javaSaveFile(filePath,content)\n"
"{\n"
"	try {\n"
"		if(document.applets[\"TiddlySaver\"])\n"
"			return document.applets[\"TiddlySaver\"].saveFile(javaUrlToFilename(filePath),\"UTF-8\",content);\n"
"	} catch(ex) {\n"
"	}\n"
"	try {\n"
"		var s = new java.io.PrintStream(new java.io.FileOutputStream(javaUrlToFilename(filePath)));\n"
"		s.print(content);\n"
"		s.close();\n"
"	} catch(ex) {\n"
"		return null;\n"
"	}\n"
"	return true;\n"
"}\n"
"\n"
"function javaLoadFile(filePath)\n"
"{\n"
"	try {\n"
"		if(document.applets[\"TiddlySaver\"])\n"
"			return String(document.applets[\"TiddlySaver\"].loadFile(javaUrlToFilename(filePath),\"UTF-8\"));\n"
"	} catch(ex) {\n"
"	}\n"
"	var content = [];\n"
"	try {\n"
"		var r = new java.io.BufferedReader(new java.io.FileReader(javaUrlToFilename(filePath)));\n"
"		var line;\n"
"		while((line = r.readLine()) != null)\n"
"			content.push(new String(line));\n"
"		r.close();\n"
"	} catch(ex) {\n"
"		return null;\n"
"	}\n"
"	return content.join(\"\\n\");\n"
"}\n"
"\n"
"//--\n"
"//-- Server adaptor base class\n"
"//--\n"
"\n"
"function AdaptorBase()\n"
"{\n"
"	this.host = null;\n"
"	this.store = null;\n"
"	return this;\n"
"}\n"
"\n"
"AdaptorBase.prototype.close = function()\n"
"{\n"
"	return true;\n"
"};\n"
"\n"
"AdaptorBase.prototype.fullHostName = function(host)\n"
"{\n"
"	if(!host)\n"
"		return '';\n"
"	host = host.trim();\n"
"	if(!host.match(/:\\/\\//))\n"
"		host = 'http://' + host;\n"
"	if(host.substr(host.length-1) == '/')\n"
"		host = host.substr(0,host.length-1);\n"
"	return host;\n"
"};\n"
"\n"
"AdaptorBase.minHostName = function(host)\n"
"{\n"
"	return host ? host.replace(/^http:\\/\\//,'').replace(/\\/$/,'') : '';\n"
"};\n"
"\n"
"AdaptorBase.prototype.setContext = function(context,userParams,callback)\n"
"{\n"
"	if(!context) context = {};\n"
"	context.userParams = userParams;\n"
"	if(callback) context.callback = callback;\n"
"	context.adaptor = this;\n"
"	if(!context.host)\n"
"		context.host = this.host;\n"
"	context.host = this.fullHostName(context.host);\n"
"	if(!context.workspace)\n"
"		context.workspace = this.workspace;\n"
"	return context;\n"
"};\n"
"\n"
"// Open the specified host\n"
"AdaptorBase.prototype.openHost = function(host,context,userParams,callback)\n"
"{\n"
"	this.host = host;\n"
"	context = this.setContext(context,userParams,callback);\n"
"	context.status = true;\n"
"	if(callback)\n"
"		window.setTimeout(function() {context.callback(context,userParams);},10);\n"
"	return true;\n"
"};\n"
"\n"
"// Open the specified workspace\n"
"AdaptorBase.prototype.openWorkspace = function(workspace,context,userParams,callback)\n"
"{\n"
"	this.workspace = workspace;\n"
"	context = this.setContext(context,userParams,callback);\n"
"	context.status = true;\n"
"	if(callback)\n"
"		window.setTimeout(function() {callback(context,userParams);},10);\n"
"	return true;\n"
"};\n"
"\n"
"//--\n"
"//-- Server adaptor for talking to static TiddlyWiki files\n"
"//--\n"
"\n"
"function FileAdaptor()\n"
"{\n"
"}\n"
"\n"
"FileAdaptor.prototype = new AdaptorBase();\n"
"\n"
"FileAdaptor.serverType = 'file';\n"
"FileAdaptor.serverLabel = 'TiddlyWiki';\n"
"\n"
"FileAdaptor.loadTiddlyWikiCallback = function(status,context,responseText,url,xhr)\n"
"{\n"
"	context.status = status;\n"
"	if(!status) {\n"
"		context.statusText = \"Error reading file\";\n"
"	} else {\n"
"		context.adaptor.store = new TiddlyWiki();\n"
"		if(!context.adaptor.store.importTiddlyWiki(responseText)) {\n"
"			context.statusText = config.messages.invalidFileError.format([url]);\n"
"			context.status = false;\n"
"		}\n"
"	}\n"
"	context.complete(context,context.userParams);\n"
"};\n"
"\n"
"// Get the list of workspaces on a given server\n"
"FileAdaptor.prototype.getWorkspaceList = function(context,userParams,callback)\n"
"{\n"
"	context = this.setContext(context,userParams,callback);\n"
"	context.workspaces = [{title:\"(default)\"}];\n"
"	context.status = true;\n"
"	if(callback)\n"
"		window.setTimeout(function() {callback(context,userParams);},10);\n"
"	return true;\n"
"};\n"
"\n"
"// Gets the list of tiddlers within a given workspace\n"
"FileAdaptor.prototype.getTiddlerList = function(context,userParams,callback,filter)\n"
"{\n"
"	context = this.setContext(context,userParams,callback);\n"
"	if(!context.filter)\n"
"		context.filter = filter;\n"
"	context.complete = FileAdaptor.getTiddlerListComplete;\n"
"	if(this.store) {\n"
"		var ret = context.complete(context,context.userParams);\n"
"	} else {\n"
"		ret = loadRemoteFile(context.host,FileAdaptor.loadTiddlyWikiCallback,context);\n"
"		if(typeof ret != \"string\")\n"
"			ret = true;\n"
"	}\n"
"	return ret;\n"
"};\n"
"\n"
"FileAdaptor.getTiddlerListComplete = function(context,userParams)\n"
"{\n"
"	if(context.status) {\n"
"		if(context.filter) {\n"
"			context.tiddlers = context.adaptor.store.filterTiddlers(context.filter);\n"
"		} else {\n"
"			context.tiddlers = [];\n"
"			context.adaptor.store.forEachTiddler(function(title,tiddler) {context.tiddlers.push(tiddler);});\n"
"		}\n"
"		for(var i=0; i<context.tiddlers.length; i++) {\n"
"			context.tiddlers[i].fields['server.type'] = FileAdaptor.serverType;\n"
"			context.tiddlers[i].fields['server.host'] = AdaptorBase.minHostName(context.host);\n"
"			context.tiddlers[i].fields['server.page.revision'] = context.tiddlers[i].modified.convertToYYYYMMDDHHMM();\n"
"		}\n"
"		context.status = true;\n"
"	}\n"
"	if(context.callback) {\n"
"		window.setTimeout(function() {context.callback(context,userParams);},10);\n"
"	}\n"
"	return true;\n"
"};\n"
"\n"
"FileAdaptor.prototype.generateTiddlerInfo = function(tiddler)\n"
"{\n"
"	var info = {};\n"
"	info.uri = tiddler.fields['server.host'] + \"#\" + tiddler.title;\n"
"	return info;\n"
"};\n"
"\n"
"// Retrieve a tiddler from a given workspace on a given server\n"
"FileAdaptor.prototype.getTiddler = function(title,context,userParams,callback)\n"
"{\n"
"	context = this.setContext(context,userParams,callback);\n"
"	context.title = title;\n"
"	context.complete = FileAdaptor.getTiddlerComplete;\n"
"	return context.adaptor.store ?\n"
"		context.complete(context,context.userParams) :\n"
"		loadRemoteFile(context.host,FileAdaptor.loadTiddlyWikiCallback,context);\n"
"};\n"
"\n"
"FileAdaptor.getTiddlerComplete = function(context,userParams)\n"
"{\n"
"	var t = context.adaptor.store.fetchTiddler(context.title);\n"
"	if(t) {\n"
"		t.fields['server.type'] = FileAdaptor.serverType;\n"
"		t.fields['server.host'] = AdaptorBase.minHostName(context.host);\n"
"		t.fields['server.page.revision'] = t.modified.convertToYYYYMMDDHHMM();\n"
"		context.tiddler = t;\n"
"		context.status = true;\n"
"	} else { //# tiddler does not exist in document\n"
"		context.status = false;\n"
"	}\n"
"	if(context.allowSynchronous) {\n"
"		context.isSynchronous = true;\n"
"		context.callback(context,userParams);\n"
"	} else {\n"
"		window.setTimeout(function() {context.callback(context,userParams);},10);\n"
"	}\n"
"	return true;\n"
"};\n"
"\n"
"FileAdaptor.prototype.close = function()\n"
"{\n"
"	delete this.store;\n"
"	this.store = null;\n"
"};\n"
"\n"
"config.adaptors[FileAdaptor.serverType] = FileAdaptor;\n"
"\n"
"config.defaultAdaptor = FileAdaptor.serverType;\n"
"\n"
"//--\n"
"//-- HTTP request code\n"
"//--\n"
"\n"
"function ajaxReq(args)\n"
"{\n"
"	if(window.Components && window.netscape && window.netscape.security && document.location.protocol.indexOf(\"http\") == -1)\n"
"		window.netscape.security.PrivilegeManager.enablePrivilege(\"UniversalBrowserRead\");\n"
"	return jQuery.ajax(args);\n"
"}\n"
"\n"
"//--\n"
"//-- TiddlyWiki-specific utility functions\n"
"//--\n"
"\n"
"// Returns TiddlyWiki version string\n"
"function formatVersion(v)\n"
"{\n"
"	v = v || version;\n"
"	return v.major + \".\" + v.minor + \".\" + v.revision +\n"
"		(v.alpha ? \" (alpha \" + v.alpha + \")\" : \"\") +\n"
"		(v.beta ? \" (beta \" + v.beta + \")\" : \"\");\n"
"}\n"
"\n"
"function compareVersions(v1,v2)\n"
"{\n"
"	var a = [\"major\",\"minor\",\"revision\"];\n"
"	for(var i = 0; i<a.length; i++) {\n"
"		var x1 = v1[a[i]] || 0;\n"
"		var x2 = v2[a[i]] || 0;\n"
"		if(x1<x2)\n"
"			return 1;\n"
"		if(x1>x2)\n"
"			return -1;\n"
"	}\n"
"	x1 = v1.beta || 9999;\n"
"	x2 = v2.beta || 9999;\n"
"	if(x1<x2)\n"
"		return 1;\n"
"	return x1 > x2 ? -1 : 0;\n"
"}\n"
"\n"
"function createTiddlyButton(parent,text,tooltip,action,className,id,accessKey,attribs)\n"
"{\n"
"	var btn = document.createElement(\"a\");\n"
"	if(action) {\n"
"		btn.onclick = action;\n"
"		btn.setAttribute(\"href\",\"javascript:;\");\n"
"	}\n"
"	if(tooltip)\n"
"		btn.setAttribute(\"title\",tooltip);\n"
"	if(text)\n"
"		btn.appendChild(document.createTextNode(text));\n"
"	btn.className = className || \"button\";\n"
"	if(id)\n"
"		btn.id = id;\n"
"	if(attribs) {\n"
"		for(var i in attribs) {\n"
"			btn.setAttribute(i,attribs[i]);\n"
"		}\n"
"	}\n"
"	if(parent)\n"
"		parent.appendChild(btn);\n"
"	if(accessKey)\n"
"		btn.setAttribute(\"accessKey\",accessKey);\n"
"	return btn;\n"
"}\n"
"\n"
"function createTiddlyLink(place,title,includeText,className,isStatic,linkedFromTiddler,noToggle)\n"
"{\n"
"	var text = includeText ? title : null;\n"
"	var i = getTiddlyLinkInfo(title,className);\n"
"	var btn = isStatic ? createExternalLink(place,store.getTiddlerText(\"SiteUrl\",null) + \"#\" + title) : createTiddlyButton(place,text,i.subTitle,onClickTiddlerLink,i.classes);\n"
"	if(isStatic)\n"
"		btn.className += ' ' + className;\n"
"	btn.setAttribute(\"refresh\",\"link\");\n"
"	btn.setAttribute(\"tiddlyLink\",title);\n"
"	if(noToggle)\n"
"		btn.setAttribute(\"noToggle\",\"true\");\n"
"	if(linkedFromTiddler) {\n"
"		var fields = linkedFromTiddler.getInheritedFields();\n"
"		if(fields)\n"
"			btn.setAttribute(\"tiddlyFields\",fields);\n"
"	}\n"
"	return btn;\n"
"}\n"
"\n"
"function refreshTiddlyLink(e,title)\n"
"{\n"
"	var i = getTiddlyLinkInfo(title,e.className);\n"
"	e.className = i.classes;\n"
"	e.title = i.subTitle;\n"
"}\n"
"\n"
"function getTiddlyLinkInfo(title,currClasses)\n"
"{\n"
"	var classes = currClasses ? currClasses.split(\" \") : [];\n"
"	classes.pushUnique(\"tiddlyLink\");\n"
"	var tiddler = store.fetchTiddler(title);\n"
"	var subTitle;\n"
"	if(tiddler) {\n"
"		subTitle = tiddler.getSubtitle();\n"
"		classes.pushUnique(\"tiddlyLinkExisting\");\n"
"		classes.remove(\"tiddlyLinkNonExisting\");\n"
"		classes.remove(\"shadow\");\n"
"	} else {\n"
"		classes.remove(\"tiddlyLinkExisting\");\n"
"		classes.pushUnique(\"tiddlyLinkNonExisting\");\n"
"		if(store.isShadowTiddler(title)) {\n"
"			subTitle = config.messages.shadowedTiddlerToolTip.format([title]);\n"
"			classes.pushUnique(\"shadow\");\n"
"		} else {\n"
"			subTitle = config.messages.undefinedTiddlerToolTip.format([title]);\n"
"			classes.remove(\"shadow\");\n"
"		}\n"
"	}\n"
"	if(typeof config.annotations[title]==\"string\")\n"
"		subTitle = config.annotations[title];\n"
"	return {classes: classes.join(\" \"),subTitle: subTitle};\n"
"}\n"
"\n"
"function createExternalLink(place,url,label)\n"
"{\n"
"	var link = document.createElement(\"a\");\n"
"	link.className = \"externalLink\";\n"
"	link.href = url;\n"
"	link.title = config.messages.externalLinkTooltip.format([url]);\n"
"	if(config.options.chkOpenInNewWindow)\n"
"		link.target = \"_blank\";\n"
"	place.appendChild(link);\n"
"	if(label)\n"
"		createTiddlyText(link, label);\n"
"	return link;\n"
"}\n"
"\n"
"// Event handler for clicking on a tiddly link\n"
"function onClickTiddlerLink(ev)\n"
"{\n"
"	var e = ev || window.event;\n"
"	var target = resolveTarget(e);\n"
"	var link = target;\n"
"	var title = null;\n"
"	var fields = null;\n"
"	var noToggle = null;\n"
"	do {\n"
"		title = link.getAttribute(\"tiddlyLink\");\n"
"		fields = link.getAttribute(\"tiddlyFields\");\n"
"		noToggle = link.getAttribute(\"noToggle\");\n"
"		link = link.parentNode;\n"
"	} while(title == null && link != null);\n"
"	if(!store.isShadowTiddler(title)) {\n"
"		var f = fields ? fields.decodeHashMap() : {};\n"
"		fields = String.encodeHashMap(merge(f,config.defaultCustomFields,true));\n"
"	}\n"
"	if(title) {\n"
"		var toggling = e.metaKey || e.ctrlKey;\n"
"		if(config.options.chkToggleLinks)\n"
"			toggling = !toggling;\n"
"		if(noToggle)\n"
"			toggling = false;\n"
"		if(store.getTiddler(title))\n"
"			fields = null;\n"
"		story.displayTiddler(target,title,null,true,null,fields,toggling);\n"
"	}\n"
"	clearMessage();\n"
"	return false;\n"
"}\n"
"\n"
"// Create a button for a tag with a popup listing all the tiddlers that it tags\n"
"function createTagButton(place,tag,excludeTiddler,title,tooltip)\n"
"{\n"
"	var btn = createTiddlyButton(place,title||tag,(tooltip||config.views.wikified.tag.tooltip).format([tag]),onClickTag);\n"
"	btn.setAttribute(\"tag\",tag);\n"
"	if(excludeTiddler)\n"
"		btn.setAttribute(\"tiddler\",excludeTiddler);\n"
"	return btn;\n"
"}\n"
"\n"
"// Event handler for clicking on a tiddler tag\n"
"function onClickTag(ev)\n"
"{\n"
"	var e = ev || window.event;\n"
"	var popup = Popup.create(this);\n"
"	addClass(popup,\"taggedTiddlerList\");\n"
"	var tag = this.getAttribute(\"tag\");\n"
"	var title = this.getAttribute(\"tiddler\");\n"
"	if(popup && tag) {\n"
"		var tagged = store.getTaggedTiddlers(tag);\n"
"		var titles = [];\n"
"		var li,r;\n"
"		for(r=0;r<tagged.length;r++) {\n"
"			if(tagged[r].title != title)\n"
"				titles.push(tagged[r].title);\n"
"		}\n"
"		var lingo = config.views.wikified.tag;\n"
"		if(titles.length > 0) {\n"
"			var openAll = createTiddlyButton(createTiddlyElement(popup,\"li\"),lingo.openAllText.format([tag]),lingo.openAllTooltip,onClickTagOpenAll);\n"
"			openAll.setAttribute(\"tag\",tag);\n"
"			createTiddlyElement(createTiddlyElement(popup,\"li\",null,\"listBreak\"),\"div\");\n"
"			for(r=0; r<titles.length; r++) {\n"
"				createTiddlyLink(createTiddlyElement(popup,\"li\"),titles[r],true);\n"
"			}\n"
"		} else {\n"
"			createTiddlyElement(popup,\"li\",null,\"disabled\",lingo.popupNone.format([tag]));\n"
"		}\n"
"		createTiddlyElement(createTiddlyElement(popup,\"li\",null,\"listBreak\"),\"div\");\n"
"		var h = createTiddlyLink(createTiddlyElement(popup,\"li\"),tag,false);\n"
"		createTiddlyText(h,lingo.openTag.format([tag]));\n"
"	}\n"
"	Popup.show();\n"
"	e.cancelBubble = true;\n"
"	if(e.stopPropagation) e.stopPropagation();\n"
"	return false;\n"
"}\n"
"\n"
"// Event handler for 'open all' on a tiddler popup\n"
"function onClickTagOpenAll(ev)\n"
"{\n"
"	var tiddlers = store.getTaggedTiddlers(this.getAttribute(\"tag\"));\n"
"	story.displayTiddlers(this,tiddlers);\n"
"	return false;\n"
"}\n"
"\n"
"function onClickError(ev)\n"
"{\n"
"	var e = ev || window.event;\n"
"	var popup = Popup.create(this);\n"
"	var lines = this.getAttribute(\"errorText\").split(\"\\n\");\n"
"	for(var t=0; t<lines.length; t++)\n"
"		createTiddlyElement(popup,\"li\",null,null,lines[t]);\n"
"	Popup.show();\n"
"	e.cancelBubble = true;\n"
"	if(e.stopPropagation) e.stopPropagation();\n"
"	return false;\n"
"}\n"
"\n"
"function createTiddlyDropDown(place,onchange,options,defaultValue)\n"
"{\n"
"	var sel = createTiddlyElement(place,\"select\");\n"
"	sel.onchange = onchange;\n"
"	for(var t=0; t<options.length; t++) {\n"
"		var e = createTiddlyElement(sel,\"option\",null,null,options[t].caption);\n"
"		e.value = options[t].name;\n"
"		if(options[t].name == defaultValue)\n"
"			e.selected = true;\n"
"	}\n"
"	return sel;\n"
"}\n"
"\n"
"function createTiddlyPopup(place,caption,tooltip,tiddler)\n"
"{\n"
"	if(tiddler.text) {\n"
"		createTiddlyLink(place,caption,true);\n"
"		var btn = createTiddlyButton(place,glyph(\"downArrow\"),tooltip,onClickTiddlyPopup,\"tiddlerPopupButton\");\n"
"		btn.tiddler = tiddler;\n"
"	} else {\n"
"		createTiddlyText(place,caption);\n"
"	}\n"
"}\n"
"\n"
"function onClickTiddlyPopup(ev)\n"
"{\n"
"	var e = ev || window.event;\n"
"	var tiddler = this.tiddler;\n"
"	if(tiddler.text) {\n"
"		var popup = Popup.create(this,\"div\",\"popupTiddler\");\n"
"		wikify(tiddler.text,popup,null,tiddler);\n"
"		Popup.show();\n"
"	}\n"
"	if(e) e.cancelBubble = true;\n"
"	if(e && e.stopPropagation) e.stopPropagation();\n"
"	return false;\n"
"}\n"
"\n"
"function createTiddlyError(place,title,text)\n"
"{\n"
"	var btn = createTiddlyButton(place,title,null,onClickError,\"errorButton\");\n"
"	if(text) btn.setAttribute(\"errorText\",text);\n"
"}\n"
"\n"
"function merge(dst,src,preserveExisting)\n"
"{\n"
"	for(var i in src) {\n"
"		if(!preserveExisting || dst[i] === undefined)\n"
"			dst[i] = src[i];\n"
"	}\n"
"	return dst;\n"
"}\n"
"\n"
"// Returns a string containing the description of an exception, optionally prepended by a message\n"
"function exceptionText(e,message)\n"
"{\n"
"	var s = e.description || e.toString();\n"
"	return message ? \"%0:\\n%1\".format([message,s]) : s;\n"
"}\n"
"\n"
"// Displays an alert of an exception description with optional message\n"
"function showException(e,message)\n"
"{\n"
"	alert(exceptionText(e,message));\n"
"}\n"
"\n"
"function alertAndThrow(m)\n"
"{\n"
"	alert(m);\n"
"	throw(m);\n"
"}\n"
"\n"
"function glyph(name)\n"
"{\n"
"	var g = config.glyphs;\n"
"	var b = g.currBrowser;\n"
"	if(b == null) {\n"
"		b = 0;\n"
"		while(!g.browsers[b]() && b < g.browsers.length-1)\n"
"			b++;\n"
"		g.currBrowser = b;\n"
"	}\n"
"	if(!g.codes[name])\n"
"		return \"\";\n"
"	return g.codes[name][b];\n"
"}\n"
"\n"
"if(!window.console) {\n"
"	console = {tiddlywiki:true,log:function(message) {displayMessage(message);}};\n"
"}\n"
"\n"
"//-\n"
"//- Animation engine\n"
"//-\n"
"\n"
"function Animator()\n"
"{\n"
"	this.running = 0; // Incremented at start of each animation, decremented afterwards. If zero, the interval timer is disabled\n"
"	this.timerID = 0; // ID of the timer used for animating\n"
"	this.animations = []; // List of animations in progress\n"
"	return this;\n"
"}\n"
"\n"
"// Start animation engine\n"
"Animator.prototype.startAnimating = function() //# Variable number of arguments\n"
"{\n"
"	for(var t=0; t<arguments.length; t++)\n"
"		this.animations.push(arguments[t]);\n"
"	if(this.running == 0) {\n"
"		var me = this;\n"
"		this.timerID = window.setInterval(function() {me.doAnimate(me);},10);\n"
"	}\n"
"	this.running += arguments.length;\n"
"};\n"
"\n"
"// Perform an animation engine tick, calling each of the known animation modules\n"
"Animator.prototype.doAnimate = function(me)\n"
"{\n"
"	var a = 0;\n"
"	while(a < me.animations.length) {\n"
"		var animation = me.animations[a];\n"
"		if(animation.tick()) {\n"
"			a++;\n"
"		} else {\n"
"			me.animations.splice(a,1);\n"
"			if(--me.running == 0)\n"
"				window.clearInterval(me.timerID);\n"
"		}\n"
"	}\n"
"};\n"
"\n"
"Animator.slowInSlowOut = function(progress)\n"
"{\n"
"	return(1-((Math.cos(progress * Math.PI)+1)/2));\n"
"};\n"
"\n"
"//--\n"
"//-- Morpher animation\n"
"//--\n"
"\n"
"// Animate a set of properties of an element\n"
"function Morpher(element,duration,properties,callback)\n"
"{\n"
"	this.element = element;\n"
"	this.duration = duration;\n"
"	this.properties = properties;\n"
"	this.startTime = new Date();\n"
"	this.endTime = Number(this.startTime) + duration;\n"
"	this.callback = callback;\n"
"	this.tick();\n"
"	return this;\n"
"}\n"
"\n"
"Morpher.prototype.assignStyle = function(element,style,value)\n"
"{\n"
"	switch(style) {\n"
"	case \"-tw-vertScroll\":\n"
"		window.scrollTo(findScrollX(),value);\n"
"		break;\n"
"	case \"-tw-horizScroll\":\n"
"		window.scrollTo(value,findScrollY());\n"
"		break;\n"
"	default:\n"
"		element.style[style] = value;\n"
"		break;\n"
"	}\n"
"};\n"
"\n"
"Morpher.prototype.stop = function()\n"
"{\n"
"	for(var t=0; t<this.properties.length; t++) {\n"
"		var p = this.properties[t];\n"
"		if(p.atEnd !== undefined) {\n"
"			this.assignStyle(this.element,p.style,p.atEnd);\n"
"		}\n"
"	}\n"
"	if(this.callback)\n"
"		this.callback(this.element,this.properties);\n"
"};\n"
"\n"
"Morpher.prototype.tick = function()\n"
"{\n"
"	var currTime = Number(new Date());\n"
"	var progress = Animator.slowInSlowOut(Math.min(1,(currTime-this.startTime)/this.duration));\n"
"	for(var t=0; t<this.properties.length; t++) {\n"
"		var p = this.properties[t];\n"
"		if(p.start !== undefined && p.end !== undefined) {\n"
"			var template = p.template || \"%0\";\n"
"			switch(p.format) {\n"
"			case undefined:\n"
"			case \"style\":\n"
"				var v = p.start + (p.end-p.start) * progress;\n"
"				this.assignStyle(this.element,p.style,template.format([v]));\n"
"				break;\n"
"			case \"color\":\n"
"				break;\n"
"			}\n"
"		}\n"
"	}\n"
"	if(currTime >= this.endTime) {\n"
"		this.stop();\n"
"		return false;\n"
"	}\n"
"	return true;\n"
"};\n"
"\n"
"//--\n"
"//-- Zoomer animation\n"
"//--\n"
"\n"
"function Zoomer(text,startElement,targetElement,unused)\n"
"{\n"
"	var e = createTiddlyElement(document.body,\"div\",null,\"zoomer\");\n"
"	createTiddlyElement(e,\"div\",null,null,text);\n"
"	var winWidth = findWindowWidth();\n"
"	var winHeight = findWindowHeight();\n"
"	var p = [\n"
"		{style: 'left', start: findPosX(startElement), end: findPosX(targetElement), template: '%0px'},\n"
"		{style: 'top', start: findPosY(startElement), end: findPosY(targetElement), template: '%0px'},\n"
"		{style: 'width', start: Math.min(startElement.scrollWidth,winWidth), end: Math.min(targetElement.scrollWidth,winWidth), template: '%0px', atEnd: 'auto'},\n"
"		{style: 'height', start: Math.min(startElement.scrollHeight,winHeight), end: Math.min(targetElement.scrollHeight,winHeight), template: '%0px', atEnd: 'auto'},\n"
"		{style: 'fontSize', start: 8, end: 24, template: '%0pt'}\n"
"	];\n"
"	var c = function(element,properties) {removeNode(element);};\n"
"	return new Morpher(e,config.animDuration,p,c);\n"
"}\n"
"\n"
"//--\n"
"//-- Scroller animation\n"
"//--\n"
"\n"
"function Scroller(targetElement)\n"
"{\n"
"	var p = [{style: '-tw-vertScroll', start: findScrollY(), end: ensureVisible(targetElement)}];\n"
"	return new Morpher(targetElement,config.animDuration,p);\n"
"}\n"
"\n"
"//--\n"
"//-- Slider animation\n"
"//--\n"
"\n"
"// deleteMode - \"none\", \"all\" [delete target element and it's children], [only] \"children\" [but not the target element]\n"
"function Slider(element,opening,unused,deleteMode)\n"
"{\n"
"	element.style.overflow = 'hidden';\n"
"	if(opening)\n"
"		element.style.height = '0px'; // Resolves a Firefox flashing bug\n"
"	element.style.display = 'block';\n"
"	var left = findPosX(element);\n"
"	var width = element.scrollWidth;\n"
"	var height = element.scrollHeight;\n"
"	var winWidth = findWindowWidth();\n"
"	var p = [];\n"
"	var c = null;\n"
"	if(opening) {\n"
"		p.push({style: 'height', start: 0, end: height, template: '%0px', atEnd: 'auto'});\n"
"		p.push({style: 'opacity', start: 0, end: 1, template: '%0'});\n"
"		p.push({style: 'filter', start: 0, end: 100, template: 'alpha(opacity:%0)'});\n"
"	} else {\n"
"		p.push({style: 'height', start: height, end: 0, template: '%0px'});\n"
"		p.push({style: 'display', atEnd: 'none'});\n"
"		p.push({style: 'opacity', start: 1, end: 0, template: '%0'});\n"
"		p.push({style: 'filter', start: 100, end: 0, template: 'alpha(opacity:%0)'});\n"
"		switch(deleteMode) {\n"
"		case \"all\":\n"
"			c = function(element,properties) {removeNode(element);};\n"
"			break;\n"
"		case \"children\":\n"
"			c = function(element,properties) {removeChildren(element);};\n"
"			break;\n"
"		}\n"
"	}\n"
"	return new Morpher(element,config.animDuration,p,c);\n"
"}\n"
"\n"
"//--\n"
"//-- Popup menu\n"
"//--\n"
"\n"
"var Popup = {\n"
"	stack: [] // Array of objects with members root: and popup:\n"
"	};\n"
"\n"
"Popup.create = function(root,elem,className)\n"
"{\n"
"	var stackPosition = this.find(root,\"popup\");\n"
"	Popup.remove(stackPosition+1);\n"
"	var popup = createTiddlyElement(document.body,elem || \"ol\",\"popup\",className || \"popup\");\n"
"	popup.stackPosition = stackPosition;\n"
"	Popup.stack.push({root: root, popup: popup});\n"
"	return popup;\n"
"};\n"
"\n"
"Popup.onDocumentClick = function(ev)\n"
"{\n"
"	var e = ev || window.event;\n"
"	if(e.eventPhase == undefined)\n"
"		Popup.remove();\n"
"	else if(e.eventPhase == Event.BUBBLING_PHASE || e.eventPhase == Event.AT_TARGET)\n"
"		Popup.remove();\n"
"	return true;\n"
"};\n"
"\n"
"Popup.show = function(valign,halign,offset)\n"
"{\n"
"	var curr = Popup.stack[Popup.stack.length-1];\n"
"	this.place(curr.root,curr.popup,valign,halign,offset);\n"
"	addClass(curr.root,\"highlight\");\n"
"	if(config.options.chkAnimate && anim && typeof Scroller == \"function\")\n"
"		anim.startAnimating(new Scroller(curr.popup));\n"
"	else\n"
"		window.scrollTo(0,ensureVisible(curr.popup));\n"
"};\n"
"\n"
"Popup.place = function(root,popup,valign,halign,offset)\n"
"{\n"
"	if(!offset)\n"
"		var offset = {x:0,y:0};\n"
"	if(popup.stackPosition >= 0 && !valign && !halign) {\n"
"		offset.x = offset.x + root.offsetWidth;\n"
"	} else {\n"
"		offset.x = (halign == \"right\") ? offset.x + root.offsetWidth : offset.x;\n"
"		offset.y = (valign == \"top\") ? offset.y : offset.y + root.offsetHeight;\n"
"	}\n"
"	var rootLeft = findPosX(root);\n"
"	var rootTop = findPosY(root);\n"
"	var popupLeft = rootLeft + offset.x;\n"
"	var popupTop = rootTop + offset.y;\n"
"	var winWidth = findWindowWidth();\n"
"	if(popup.offsetWidth > winWidth*0.75)\n"
"		popup.style.width = winWidth*0.75 + \"px\";\n"
"	var popupWidth = popup.offsetWidth;\n"
"	var scrollWidth = winWidth - document.body.offsetWidth;\n"
"	if(popupLeft + popupWidth > winWidth - scrollWidth - 1) {\n"
"		if(halign == \"right\")\n"
"			popupLeft = popupLeft - root.offsetWidth - popupWidth;\n"
"		else\n"
"			popupLeft = winWidth - popupWidth - scrollWidth - 1;\n"
"	}\n"
"	popup.style.left = popupLeft + \"px\";\n"
"	popup.style.top = popupTop + \"px\";\n"
"	popup.style.display = \"block\";\n"
"};\n"
"\n"
"Popup.find = function(e)\n"
"{\n"
"	var pos = -1;\n"
"	for (var t=this.stack.length-1; t>=0; t--) {\n"
"		if(isDescendant(e,this.stack[t].popup))\n"
"			pos = t;\n"
"	}\n"
"	return pos;\n"
"};\n"
"\n"
"Popup.remove = function(pos)\n"
"{\n"
"	if(!pos) var pos = 0;\n"
"	if(Popup.stack.length > pos) {\n"
"		Popup.removeFrom(pos);\n"
"	}\n"
"};\n"
"\n"
"Popup.removeFrom = function(from)\n"
"{\n"
"	for(var t=Popup.stack.length-1; t>=from; t--) {\n"
"		var p = Popup.stack[t];\n"
"		removeClass(p.root,\"highlight\");\n"
"		removeNode(p.popup);\n"
"	}\n"
"	Popup.stack = Popup.stack.slice(0,from);\n"
"};\n"
"\n"
"//--\n"
"//-- Wizard support\n"
"//--\n"
"\n"
"function Wizard(elem)\n"
"{\n"
"	if(elem) {\n"
"		this.formElem = findRelated(elem,\"wizard\",\"className\");\n"
"		this.bodyElem = findRelated(this.formElem.firstChild,\"wizardBody\",\"className\",\"nextSibling\");\n"
"		this.footElem = findRelated(this.formElem.firstChild,\"wizardFooter\",\"className\",\"nextSibling\");\n"
"	} else {\n"
"		this.formElem = null;\n"
"		this.bodyElem = null;\n"
"		this.footElem = null;\n"
"	}\n"
"}\n"
"\n"
"Wizard.prototype.setValue = function(name,value)\n"
"{\n"
"	if(this.formElem)\n"
"		this.formElem[name] = value;\n"
"};\n"
"\n"
"Wizard.prototype.getValue = function(name)\n"
"{\n"
"	return this.formElem ? this.formElem[name] : null;\n"
"};\n"
"\n"
"Wizard.prototype.createWizard = function(place,title)\n"
"{\n"
"	this.formElem = createTiddlyElement(place,\"form\",null,\"wizard\");\n"
"	createTiddlyElement(this.formElem,\"h1\",null,null,title);\n"
"	this.bodyElem = createTiddlyElement(this.formElem,\"div\",null,\"wizardBody\");\n"
"	this.footElem = createTiddlyElement(this.formElem,\"div\",null,\"wizardFooter\");\n"
"};\n"
"\n"
"Wizard.prototype.clear = function()\n"
"{\n"
"	removeChildren(this.bodyElem);\n"
"};\n"
"\n"
"Wizard.prototype.setButtons = function(buttonInfo,status)\n"
"{\n"
"	removeChildren(this.footElem);\n"
"	for(var t=0; t<buttonInfo.length; t++) {\n"
"		createTiddlyButton(this.footElem,buttonInfo[t].caption,buttonInfo[t].tooltip,buttonInfo[t].onClick);\n"
"		insertSpacer(this.footElem);\n"
"		}\n"
"	if(typeof status == \"string\") {\n"
"		createTiddlyElement(this.footElem,\"span\",null,\"status\",status);\n"
"	}\n"
"};\n"
"\n"
"Wizard.prototype.addStep = function(stepTitle,html)\n"
"{\n"
"	removeChildren(this.bodyElem);\n"
"	var w = createTiddlyElement(this.bodyElem,\"div\");\n"
"	createTiddlyElement(w,\"h2\",null,null,stepTitle);\n"
"	var step = createTiddlyElement(w,\"div\",null,\"wizardStep\");\n"
"	step.innerHTML = html;\n"
"	applyHtmlMacros(step,tiddler);\n"
"};\n"
"\n"
"Wizard.prototype.getElement = function(name)\n"
"{\n"
"	return this.formElem.elements[name];\n"
"};\n"
"\n"
"//--\n"
"//-- ListView gadget\n"
"//--\n"
"\n"
"var ListView = {};\n"
"\n"
"// Create a listview\n"
"ListView.create = function(place,listObject,listTemplate,callback,className)\n"
"{\n"
"	var table = createTiddlyElement(place,\"table\",null,className || \"listView twtable\");\n"
"	var thead = createTiddlyElement(table,\"thead\");\n"
"	var r = createTiddlyElement(thead,\"tr\");\n"
"	for(var t=0; t<listTemplate.columns.length; t++) {\n"
"		var columnTemplate = listTemplate.columns[t];\n"
"		var c = createTiddlyElement(r,\"th\");\n"
"		var colType = ListView.columnTypes[columnTemplate.type];\n"
"		if(colType && colType.createHeader) {\n"
"			colType.createHeader(c,columnTemplate,t);\n"
"			if(columnTemplate.className)\n"
"				addClass(c,columnTemplate.className);\n"
"		}\n"
"	}\n"
"	var tbody = createTiddlyElement(table,\"tbody\");\n"
"	for(var rc=0; rc<listObject.length; rc++) {\n"
"		var rowObject = listObject[rc];\n"
"		r = createTiddlyElement(tbody,\"tr\");\n"
"		for(c=0; c<listTemplate.rowClasses.length; c++) {\n"
"			if(rowObject[listTemplate.rowClasses[c].field])\n"
"				addClass(r,listTemplate.rowClasses[c].className);\n"
"		}\n"
"		rowObject.rowElement = r;\n"
"		rowObject.colElements = {};\n"
"		for(var cc=0; cc<listTemplate.columns.length; cc++) {\n"
"			c = createTiddlyElement(r,\"td\");\n"
"			columnTemplate = listTemplate.columns[cc];\n"
"			var field = columnTemplate.field;\n"
"			colType = ListView.columnTypes[columnTemplate.type];\n"
"			if(colType && colType.createItem) {\n"
"				colType.createItem(c,rowObject,field,columnTemplate,cc,rc);\n"
"				if(columnTemplate.className)\n"
"					addClass(c,columnTemplate.className);\n"
"			}\n"
"			rowObject.colElements[field] = c;\n"
"		}\n"
"	}\n"
"	if(callback && listTemplate.actions)\n"
"		createTiddlyDropDown(place,ListView.getCommandHandler(callback),listTemplate.actions);\n"
"	if(callback && listTemplate.buttons) {\n"
"		for(t=0; t<listTemplate.buttons.length; t++) {\n"
"			var a = listTemplate.buttons[t];\n"
"			if(a && a.name != \"\")\n"
"				createTiddlyButton(place,a.caption,null,ListView.getCommandHandler(callback,a.name,a.allowEmptySelection));\n"
"		}\n"
"	}\n"
"	return table;\n"
"};\n"
"\n"
"ListView.getCommandHandler = function(callback,name,allowEmptySelection)\n"
"{\n"
"	return function(e) {\n"
"		var view = findRelated(this,\"TABLE\",null,\"previousSibling\");\n"
"		var tiddlers = [];\n"
"		ListView.forEachSelector(view,function(e,rowName) {\n"
"					if(e.checked)\n"
"						tiddlers.push(rowName);\n"
"					});\n"
"		if(tiddlers.length == 0 && !allowEmptySelection) {\n"
"			alert(config.messages.nothingSelected);\n"
"		} else {\n"
"			if(this.nodeName.toLowerCase() == \"select\") {\n"
"				callback(view,this.value,tiddlers);\n"
"				this.selectedIndex = 0;\n"
"			} else {\n"
"				callback(view,name,tiddlers);\n"
"			}\n"
"		}\n"
"	};\n"
"};\n"
"\n"
"// Invoke a callback for each selector checkbox in the listview\n"
"ListView.forEachSelector = function(view,callback)\n"
"{\n"
"	var checkboxes = view.getElementsByTagName(\"input\");\n"
"	var hadOne = false;\n"
"	for(var t=0; t<checkboxes.length; t++) {\n"
"		var cb = checkboxes[t];\n"
"		if(cb.getAttribute(\"type\") == \"checkbox\") {\n"
"			var rn = cb.getAttribute(\"rowName\");\n"
"			if(rn) {\n"
"				callback(cb,rn);\n"
"				hadOne = true;\n"
"			}\n"
"		}\n"
"	}\n"
"	return hadOne;\n"
"};\n"
"\n"
"ListView.getSelectedRows = function(view)\n"
"{\n"
"	var rowNames = [];\n"
"	ListView.forEachSelector(view,function(e,rowName) {\n"
"				if(e.checked)\n"
"					rowNames.push(rowName);\n"
"				});\n"
"	return rowNames;\n"
"};\n"
"\n"
"ListView.columnTypes = {};\n"
"\n"
"ListView.columnTypes.String = {\n"
"	createHeader: function(place,columnTemplate,col)\n"
"		{\n"
"			createTiddlyText(place,columnTemplate.title);\n"
"		},\n"
"	createItem: function(place,listObject,field,columnTemplate,col,row)\n"
"		{\n"
"			var v = listObject[field];\n"
"			if(v != undefined)\n"
"				createTiddlyText(place,v);\n"
"		}\n"
"};\n"
"\n"
"ListView.columnTypes.WikiText = {\n"
"	createHeader: ListView.columnTypes.String.createHeader,\n"
"	createItem: function(place,listObject,field,columnTemplate,col,row)\n"
"		{\n"
"			var v = listObject[field];\n"
"			if(v != undefined)\n"
"				wikify(v,place,null,null);\n"
"		}\n"
"};\n"
"\n"
"ListView.columnTypes.Tiddler = {\n"
"	createHeader: ListView.columnTypes.String.createHeader,\n"
"	createItem: function(place,listObject,field,columnTemplate,col,row)\n"
"		{\n"
"			var v = listObject[field];\n"
"			if(v != undefined && v.title)\n"
"				createTiddlyPopup(place,v.title,config.messages.listView.tiddlerTooltip,v);\n"
"		}\n"
"};\n"
"\n"
"ListView.columnTypes.Size = {\n"
"	createHeader: ListView.columnTypes.String.createHeader,\n"
"	createItem: function(place,listObject,field,columnTemplate,col,row)\n"
"		{\n"
"			var v = listObject[field];\n"
"			if(v != undefined) {\n"
"				var t = 0;\n"
"				while(t<config.messages.sizeTemplates.length-1 && v<config.messages.sizeTemplates[t].unit)\n"
"					t++;\n"
"				createTiddlyText(place,config.messages.sizeTemplates[t].template.format([Math.round(v/config.messages.sizeTemplates[t].unit)]));\n"
"			}\n"
"		}\n"
"};\n"
"\n"
"ListView.columnTypes.Link = {\n"
"	createHeader: ListView.columnTypes.String.createHeader,\n"
"	createItem: function(place,listObject,field,columnTemplate,col,row)\n"
"		{\n"
"			var v = listObject[field];\n"
"			var c = columnTemplate.text;\n"
"			if(v != undefined)\n"
"				createExternalLink(place,v,c || v);\n"
"		}\n"
"};\n"
"\n"
"ListView.columnTypes.Date = {\n"
"	createHeader: ListView.columnTypes.String.createHeader,\n"
"	createItem: function(place,listObject,field,columnTemplate,col,row)\n"
"		{\n"
"			var v = listObject[field];\n"
"			if(v != undefined)\n"
"				createTiddlyText(place,v.formatString(columnTemplate.dateFormat));\n"
"		}\n"
"};\n"
"\n"
"ListView.columnTypes.StringList = {\n"
"	createHeader: ListView.columnTypes.String.createHeader,\n"
"	createItem: function(place,listObject,field,columnTemplate,col,row)\n"
"		{\n"
"			var v = listObject[field];\n"
"			if(v != undefined) {\n"
"				for(var t=0; t<v.length; t++) {\n"
"					createTiddlyText(place,v[t]);\n"
"					createTiddlyElement(place,\"br\");\n"
"				}\n"
"			}\n"
"		}\n"
"};\n"
"\n"
"ListView.columnTypes.Selector = {\n"
"	createHeader: function(place,columnTemplate,col)\n"
"		{\n"
"			createTiddlyCheckbox(place,null,false,this.onHeaderChange);\n"
"		},\n"
"	createItem: function(place,listObject,field,columnTemplate,col,row)\n"
"		{\n"
"			var e = createTiddlyCheckbox(place,null,listObject[field],null);\n"
"			e.setAttribute(\"rowName\",listObject[columnTemplate.rowName]);\n"
"		},\n"
"	onHeaderChange: function(e)\n"
"		{\n"
"			var state = this.checked;\n"
"			var view = findRelated(this,\"TABLE\");\n"
"			if(!view)\n"
"				return;\n"
"			ListView.forEachSelector(view,function(e,rowName) {\n"
"								e.checked = state;\n"
"							});\n"
"		}\n"
"};\n"
"\n"
"ListView.columnTypes.Tags = {\n"
"	createHeader: ListView.columnTypes.String.createHeader,\n"
"	createItem: function(place,listObject,field,columnTemplate,col,row)\n"
"		{\n"
"			var tags = listObject[field];\n"
"			createTiddlyText(place,String.encodeTiddlyLinkList(tags));\n"
"		}\n"
"};\n"
"\n"
"ListView.columnTypes.Boolean = {\n"
"	createHeader: ListView.columnTypes.String.createHeader,\n"
"	createItem: function(place,listObject,field,columnTemplate,col,row)\n"
"		{\n"
"			if(listObject[field] == true)\n"
"				createTiddlyText(place,columnTemplate.trueText);\n"
"			if(listObject[field] == false)\n"
"				createTiddlyText(place,columnTemplate.falseText);\n"
"		}\n"
"};\n"
"\n"
"ListView.columnTypes.TagCheckbox = {\n"
"	createHeader: ListView.columnTypes.String.createHeader,\n"
"	createItem: function(place,listObject,field,columnTemplate,col,row)\n"
"		{\n"
"			var e = createTiddlyCheckbox(place,null,listObject[field],this.onChange);\n"
"			e.setAttribute(\"tiddler\",listObject.title);\n"
"			e.setAttribute(\"tag\",columnTemplate.tag);\n"
"		},\n"
"	onChange : function(e)\n"
"		{\n"
"			var tag = this.getAttribute(\"tag\");\n"
"			var tiddler = this.getAttribute(\"tiddler\");\n"
"			store.setTiddlerTag(tiddler,this.checked,tag);\n"
"		}\n"
"};\n"
"\n"
"ListView.columnTypes.TiddlerLink = {\n"
"	createHeader: ListView.columnTypes.String.createHeader,\n"
"	createItem: function(place,listObject,field,columnTemplate,col,row)\n"
"		{\n"
"			var v = listObject[field];\n"
"			if(v != undefined) {\n"
"				var link = createTiddlyLink(place,listObject[columnTemplate.tiddlerLink],false,null);\n"
"				createTiddlyText(link,listObject[field]);\n"
"			}\n"
"		}\n"
"};\n"
"\n"
"//--\n"
"//-- Augmented methods for the JavaScript Number(), Array(), String() and Date() objects\n"
"//--\n"
"\n"
"// Clamp a number to a range\n"
"Number.prototype.clamp = function(min,max)\n"
"{\n"
"	var c = this;\n"
"	if(c < min)\n"
"		c = min;\n"
"	if(c > max)\n"
"		c = max;\n"
"	return Number(c);\n"
"};\n"
"\n"
"// Add indexOf function if browser does not support it\n"
"if(!Array.indexOf) {\n"
"Array.prototype.indexOf = function(item,from)\n"
"{\n"
"	if(!from)\n"
"		from = 0;\n"
"	for(var i=from; i<this.length; i++) {\n"
"		if(this[i] === item)\n"
"			return i;\n"
"	}\n"
"	return -1;\n"
"};}\n"
"\n"
"// Find an entry in a given field of the members of an array\n"
"Array.prototype.findByField = function(field,value)\n"
"{\n"
"	for(var t=0; t<this.length; t++) {\n"
"		if(this[t][field] === value)\n"
"			return t;\n"
"	}\n"
"	return null;\n"
"};\n"
"\n"
"// Return whether an entry exists in an array\n"
"Array.prototype.contains = function(item)\n"
"{\n"
"	return this.indexOf(item) != -1;\n"
"};\n"
"\n"
"// Adds, removes or toggles a particular value within an array\n"
"//  value - value to add\n"
"//  mode - +1 to add value, -1 to remove value, 0 to toggle it\n"
"Array.prototype.setItem = function(value,mode)\n"
"{\n"
"	var p = this.indexOf(value);\n"
"	if(mode == 0)\n"
"		mode = (p == -1) ? +1 : -1;\n"
"	if(mode == +1) {\n"
"		if(p == -1)\n"
"			this.push(value);\n"
"	} else if(mode == -1) {\n"
"		if(p != -1)\n"
"			this.splice(p,1);\n"
"	}\n"
"};\n"
"\n"
"// Return whether one of a list of values exists in an array\n"
"Array.prototype.containsAny = function(items)\n"
"{\n"
"	for(var i=0; i<items.length; i++) {\n"
"		if(this.indexOf(items[i]) != -1)\n"
"			return true;\n"
"	}\n"
"	return false;\n"
"};\n"
"\n"
"// Return whether all of a list of values exists in an array\n"
"Array.prototype.containsAll = function(items)\n"
"{\n"
"	for(var i = 0; i<items.length; i++) {\n"
"		if(this.indexOf(items[i]) == -1)\n"
"			return false;\n"
"	}\n"
"	return true;\n"
"};\n"
"\n"
"// Push a new value into an array only if it is not already present in the array. If the optional unique parameter is false, it reverts to a normal push\n"
"Array.prototype.pushUnique = function(item,unique)\n"
"{\n"
"	if(unique === false) {\n"
"		this.push(item);\n"
"	} else {\n"
"		if(this.indexOf(item) == -1)\n"
"			this.push(item);\n"
"	}\n"
"};\n"
"\n"
"Array.prototype.remove = function(item)\n"
"{\n"
"	var p = this.indexOf(item);\n"
"	if(p != -1)\n"
"		this.splice(p,1);\n"
"};\n"
"\n"
"if(!Array.prototype.map) {\n"
"Array.prototype.map = function(fn,thisObj)\n"
"{\n"
"	var scope = thisObj || window;\n"
"	var a = [];\n"
"	for(var i=0, j=this.length; i < j; ++i) {\n"
"		a.push(fn.call(scope,this[i],i,this));\n"
"	}\n"
"	return a;\n"
"};}\n"
"\n"
"// Get characters from the right end of a string\n"
"String.prototype.right = function(n)\n"
"{\n"
"	return n < this.length ? this.slice(this.length-n) : this;\n"
"};\n"
"\n"
"// Trim whitespace from both ends of a string\n"
"String.prototype.trim = function()\n"
"{\n"
"	return this.replace(/^\\s*|\\s*$/g,\"\");\n"
"};\n"
"\n"
"// Convert a string from a CSS style property name to a JavaScript style name (\"background-color\" -> \"backgroundColor\")\n"
"String.prototype.unDash = function()\n"
"{\n"
"	var s = this.split(\"-\");\n"
"	if(s.length > 1) {\n"
"		for(var t=1; t<s.length; t++)\n"
"			s[t] = s[t].substr(0,1).toUpperCase() + s[t].substr(1);\n"
"	}\n"
"	return s.join(\"\");\n"
"};\n"
"\n"
"// Substitute substrings from an array into a format string that includes '%1'-type specifiers\n"
"String.prototype.format = function(substrings)\n"
"{\n"
"	var subRegExp = /(?:%(\\d+))/mg;\n"
"	var currPos = 0;\n"
"	var r = [];\n"
"	do {\n"
"		var match = subRegExp.exec(this);\n"
"		if(match && match[1]) {\n"
"			if(match.index > currPos)\n"
"				r.push(this.substring(currPos,match.index));\n"
"			r.push(substrings[parseInt(match[1])]);\n"
"			currPos = subRegExp.lastIndex;\n"
"		}\n"
"	} while(match);\n"
"	if(currPos < this.length)\n"
"		r.push(this.substring(currPos,this.length));\n"
"	return r.join(\"\");\n"
"};\n"
"\n"
"// Escape any special RegExp characters with that character preceded by a backslash\n"
"String.prototype.escapeRegExp = function()\n"
"{\n"
"	var s = \"\\\\^$*+?()=!|,{}[].\";\n"
"	var c = this;\n"
"	for(var t=0; t<s.length; t++)\n"
"		c = c.replace(new RegExp(\"\\\\\" + s.substr(t,1),\"g\"),\"\\\\\" + s.substr(t,1));\n"
"	return c;\n"
"};\n"
"\n"
"// Convert \"\\\" to \"\\s\", newlines to \"\\n\" (and remove carriage returns)\n"
"String.prototype.escapeLineBreaks = function()\n"
"{\n"
"	return this.replace(/\\\\/mg,\"\\\\s\").replace(/\\n/mg,\"\\\\n\").replace(/\\r/mg,\"\");\n"
"};\n"
"\n"
"// Convert \"\\n\" to newlines, \"\\b\" to \" \", \"\\s\" to \"\\\" (and remove carriage returns)\n"
"String.prototype.unescapeLineBreaks = function()\n"
"{\n"
"	return this.replace(/\\\\n/mg,\"\\n\").replace(/\\\\b/mg,\" \").replace(/\\\\s/mg,\"\\\\\").replace(/\\r/mg,\"\");\n"
"};\n"
"\n"
"// Convert & to \"&amp;\", < to \"&lt;\", > to \"&gt;\" and \" to \"&quot;\"\n"
"String.prototype.htmlEncode = function()\n"
"{\n"
"	return this.replace(/&/mg,\"&amp;\").replace(/</mg,\"&lt;\").replace(/>/mg,\"&gt;\").replace(/\\\"/mg,\"&quot;\");\n"
"};\n"
"\n"
"// Convert \"&amp;\" to &, \"&lt;\" to <, \"&gt;\" to > and \"&quot;\" to \"\n"
"String.prototype.htmlDecode = function()\n"
"{\n"
"	return this.replace(/&lt;/mg,\"<\").replace(/&gt;/mg,\">\").replace(/&quot;/mg,\"\\\"\").replace(/&amp;/mg,\"&\");\n"
"};\n"
"\n"
"// Parse a space-separated string of name:value parameters\n"
"// The result is an array of objects:\n"
"//   result[0] = object with a member for each parameter name, value of that member being an array of values\n"
"//   result[1..n] = one object for each parameter, with 'name' and 'value' members\n"
"String.prototype.parseParams = function(defaultName,defaultValue,allowEval,noNames,cascadeDefaults)\n"
"{\n"
"	var parseToken = function(match,p) {\n"
"		var n;\n"
"		if(match[p]) // Double quoted\n"
"			n = match[p];\n"
"		else if(match[p+1]) // Single quoted\n"
"			n = match[p+1];\n"
"		else if(match[p+2]) // Double-square-bracket quoted\n"
"			n = match[p+2];\n"
"		else if(match[p+3]) // Double-brace quoted\n"
"			try {\n"
"				n = match[p+3];\n"
"				if(allowEval)\n"
"					n = window.eval(n);\n"
"			} catch(ex) {\n"
"				throw \"Unable to evaluate {{\" + match[p+3] + \"}}: \" + exceptionText(ex);\n"
"			}\n"
"		else if(match[p+4]) // Unquoted\n"
"			n = match[p+4];\n"
"		else if(match[p+5]) // empty quote\n"
"			n = \"\";\n"
"		return n;\n"
"	};\n"
"	var r = [{}];\n"
"	var dblQuote = \"(?:\\\"((?:(?:\\\\\\\\\\\")|[^\\\"])+)\\\")\";\n"
"	var sngQuote = \"(?:'((?:(?:\\\\\\\\\\')|[^'])+)')\";\n"
"	var dblSquare = \"(?:\\\\[\\\\[((?:\\\\s|\\\\S)*?)\\\\]\\\\])\";\n"
"	var dblBrace = \"(?:\\\\{\\\\{((?:\\\\s|\\\\S)*?)\\\\}\\\\})\";\n"
"	var unQuoted = noNames ? \"([^\\\"'\\\\s]\\\\S*)\" : \"([^\\\"':\\\\s][^\\\\s:]*)\";\n"
"	var emptyQuote = \"((?:\\\"\\\")|(?:''))\";\n"
"	var skipSpace = \"(?:\\\\s*)\";\n"
"	var token = \"(?:\" + dblQuote + \"|\" + sngQuote + \"|\" + dblSquare + \"|\" + dblBrace + \"|\" + unQuoted + \"|\" + emptyQuote + \")\";\n"
"	var re = noNames ? new RegExp(token,\"mg\") : new RegExp(skipSpace + token + skipSpace + \"(?:(\\\\:)\" + skipSpace + token + \")?\",\"mg\");\n"
"	var params = [];\n"
"	do {\n"
"		var match = re.exec(this);\n"
"		if(match) {\n"
"			var n = parseToken(match,1);\n"
"			if(noNames) {\n"
"				r.push({name:\"\",value:n});\n"
"			} else {\n"
"				var v = parseToken(match,8);\n"
"				if(v == null && defaultName) {\n"
"					v = n;\n"
"					n = defaultName;\n"
"				} else if(v == null && defaultValue) {\n"
"					v = defaultValue;\n"
"				}\n"
"				r.push({name:n,value:v});\n"
"				if(cascadeDefaults) {\n"
"					defaultName = n;\n"
"					defaultValue = v;\n"
"				}\n"
"			}\n"
"		}\n"
"	} while(match);\n"
"	// Summarise parameters into first element\n"
"	for(var t=1; t<r.length; t++) {\n"
"		if(r[0][r[t].name])\n"
"			r[0][r[t].name].push(r[t].value);\n"
"		else\n"
"			r[0][r[t].name] = [r[t].value];\n"
"	}\n"
"	return r;\n"
"};\n"
"\n"
"// Process a string list of macro parameters into an array. Parameters can be quoted with \"\", '',\n"
"// [[]], {{ }} or left unquoted (and therefore space-separated). Double-braces {{}} results in\n"
"// an *evaluated* parameter: e.g. {{config.options.txtUserName}} results in the current user's name.\n"
"String.prototype.readMacroParams = function()\n"
"{\n"
"	var p = this.parseParams(\"list\",null,true,true);\n"
"	var n = [];\n"
"	for(var t=1; t<p.length; t++)\n"
"		n.push(p[t].value);\n"
"	return n;\n"
"};\n"
"\n"
"// Process a string list of unique tiddler names into an array. Tiddler names that have spaces in them must be [[bracketed]]\n"
"String.prototype.readBracketedList = function(unique)\n"
"{\n"
"	var p = this.parseParams(\"list\",null,false,true);\n"
"	var n = [];\n"
"	for(var t=1; t<p.length; t++) {\n"
"		if(p[t].value)\n"
"			n.pushUnique(p[t].value,unique);\n"
"	}\n"
"	return n;\n"
"};\n"
"\n"
"// Returns array with start and end index of chunk between given start and end marker, or undefined.\n"
"String.prototype.getChunkRange = function(start,end)\n"
"{\n"
"	var s = this.indexOf(start);\n"
"	if(s != -1) {\n"
"		s += start.length;\n"
"		var e = this.indexOf(end,s);\n"
"		if(e != -1)\n"
"			return [s,e];\n"
"	}\n"
"};\n"
"\n"
"// Replace a chunk of a string given start and end markers\n"
"String.prototype.replaceChunk = function(start,end,sub)\n"
"{\n"
"	var r = this.getChunkRange(start,end);\n"
"	return r ? this.substring(0,r[0]) + sub + this.substring(r[1]) : this;\n"
"};\n"
"\n"
"// Returns a chunk of a string between start and end markers, or undefined\n"
"String.prototype.getChunk = function(start,end)\n"
"{\n"
"	var r = this.getChunkRange(start,end);\n"
"	if(r)\n"
"		return this.substring(r[0],r[1]);\n"
"};\n"
"\n"
"\n"
"// Static method to bracket a string with double square brackets if it contains a space\n"
"String.encodeTiddlyLink = function(title)\n"
"{\n"
"	return title.indexOf(\" \") == -1 ? title : \"[[\" + title + \"]]\";\n"
"};\n"
"\n"
"// Static method to encodeTiddlyLink for every item in an array and join them with spaces\n"
"String.encodeTiddlyLinkList = function(list)\n"
"{\n"
"	if(list) {\n"
"		var results = [];\n"
"		for(var t=0; t<list.length; t++)\n"
"			results.push(String.encodeTiddlyLink(list[t]));\n"
"		return results.join(\" \");\n"
"	} else {\n"
"		return \"\";\n"
"	}\n"
"};\n"
"\n"
"// Convert a string as a sequence of name:\"value\" pairs into a hashmap\n"
"String.prototype.decodeHashMap = function()\n"
"{\n"
"	var fields = this.parseParams(\"anon\",\"\",false);\n"
"	var r = {};\n"
"	for(var t=1; t<fields.length; t++)\n"
"		r[fields[t].name] = fields[t].value;\n"
"	return r;\n"
"};\n"
"\n"
"// Static method to encode a hashmap into a name:\"value\"... string\n"
"String.encodeHashMap = function(hashmap)\n"
"{\n"
"	var r = [];\n"
"	for(var t in hashmap)\n"
"		r.push(t + ':\"' + hashmap[t] + '\"');\n"
"	return r.join(\" \");\n"
"};\n"
"\n"
"// Static method to left-pad a string with 0s to a certain width\n"
"String.zeroPad = function(n,d)\n"
"{\n"
"	var s = n.toString();\n"
"	if(s.length < d)\n"
"		s = \"000000000000000000000000000\".substr(0,d-s.length) + s;\n"
"	return s;\n"
"};\n"
"\n"
"String.prototype.startsWith = function(prefix)\n"
"{\n"
"	return !prefix || this.substring(0,prefix.length) == prefix;\n"
"};\n"
"\n"
"// Returns the first value of the given named parameter.\n"
"function getParam(params,name,defaultValue)\n"
"{\n"
"	if(!params)\n"
"		return defaultValue;\n"
"	var p = params[0][name];\n"
"	return p ? p[0] : defaultValue;\n"
"}\n"
"\n"
"// Returns the first value of the given boolean named parameter.\n"
"function getFlag(params,name,defaultValue)\n"
"{\n"
"	return !!getParam(params,name,defaultValue);\n"
"}\n"
"\n"
"// Substitute date components into a string\n"
"Date.prototype.formatString = function(template)\n"
"{\n"
"	var t = template.replace(/0hh12/g,String.zeroPad(this.getHours12(),2));\n"
"	t = t.replace(/hh12/g,this.getHours12());\n"
"	t = t.replace(/0hh/g,String.zeroPad(this.getHours(),2));\n"
"	t = t.replace(/hh/g,this.getHours());\n"
"	t = t.replace(/mmm/g,config.messages.dates.shortMonths[this.getMonth()]);\n"
"	t = t.replace(/0mm/g,String.zeroPad(this.getMinutes(),2));\n"
"	t = t.replace(/mm/g,this.getMinutes());\n"
"	t = t.replace(/0ss/g,String.zeroPad(this.getSeconds(),2));\n"
"	t = t.replace(/ss/g,this.getSeconds());\n"
"	t = t.replace(/[ap]m/g,this.getAmPm().toLowerCase());\n"
"	t = t.replace(/[AP]M/g,this.getAmPm().toUpperCase());\n"
"	t = t.replace(/wYYYY/g,this.getYearForWeekNo());\n"
"	t = t.replace(/wYY/g,String.zeroPad(this.getYearForWeekNo()-2000,2));\n"
"	t = t.replace(/YYYY/g,this.getFullYear());\n"
"	t = t.replace(/YY/g,String.zeroPad(this.getFullYear()-2000,2));\n"
"	t = t.replace(/MMM/g,config.messages.dates.months[this.getMonth()]);\n"
"	t = t.replace(/0MM/g,String.zeroPad(this.getMonth()+1,2));\n"
"	t = t.replace(/MM/g,this.getMonth()+1);\n"
"	t = t.replace(/0WW/g,String.zeroPad(this.getWeek(),2));\n"
"	t = t.replace(/WW/g,this.getWeek());\n"
"	t = t.replace(/DDD/g,config.messages.dates.days[this.getDay()]);\n"
"	t = t.replace(/ddd/g,config.messages.dates.shortDays[this.getDay()]);\n"
"	t = t.replace(/0DD/g,String.zeroPad(this.getDate(),2));\n"
"	t = t.replace(/DDth/g,this.getDate()+this.daySuffix());\n"
"	t = t.replace(/DD/g,this.getDate());\n"
"	var tz = this.getTimezoneOffset();\n"
"	var atz = Math.abs(tz);\n"
"	t = t.replace(/TZD/g,(tz < 0 ? '+' : '-') + String.zeroPad(Math.floor(atz / 60),2) + ':' + String.zeroPad(atz % 60,2));\n"
"	t = t.replace(/\\\\/g,\"\");\n"
"	return t;\n"
"};\n"
"\n"
"Date.prototype.getWeek = function()\n"
"{\n"
"	var dt = new Date(this.getTime());\n"
"	var d = dt.getDay();\n"
"	if(d==0) d=7;// JavaScript Sun=0, ISO Sun=7\n"
"	dt.setTime(dt.getTime()+(4-d)*86400000);// shift day to Thurs of same week to calculate weekNo\n"
"	var n = Math.floor((dt.getTime()-new Date(dt.getFullYear(),0,1)+3600000)/86400000);\n"
"	return Math.floor(n/7)+1;\n"
"};\n"
"\n"
"Date.prototype.getYearForWeekNo = function()\n"
"{\n"
"	var dt = new Date(this.getTime());\n"
"	var d = dt.getDay();\n"
"	if(d==0) d=7;// JavaScript Sun=0, ISO Sun=7\n"
"	dt.setTime(dt.getTime()+(4-d)*86400000);// shift day to Thurs of same week\n"
"	return dt.getFullYear();\n"
"};\n"
"\n"
"Date.prototype.getHours12 = function()\n"
"{\n"
"	var h = this.getHours();\n"
"	return h > 12 ? h-12 : ( h > 0 ? h : 12 );\n"
"};\n"
"\n"
"Date.prototype.getAmPm = function()\n"
"{\n"
"	return this.getHours() >= 12 ? config.messages.dates.pm : config.messages.dates.am;\n"
"};\n"
"\n"
"Date.prototype.daySuffix = function()\n"
"{\n"
"	return config.messages.dates.daySuffixes[this.getDate()-1];\n"
"};\n"
"\n"
"// Convert a date to local YYYYMMDDHHMM string format\n"
"Date.prototype.convertToLocalYYYYMMDDHHMM = function()\n"
"{\n"
"	return this.getFullYear() + String.zeroPad(this.getMonth()+1,2) + String.zeroPad(this.getDate(),2) + String.zeroPad(this.getHours(),2) + String.zeroPad(this.getMinutes(),2);\n"
"};\n"
"\n"
"// Convert a date to UTC YYYYMMDDHHMM string format\n"
"Date.prototype.convertToYYYYMMDDHHMM = function()\n"
"{\n"
"	return this.getUTCFullYear() + String.zeroPad(this.getUTCMonth()+1,2) + String.zeroPad(this.getUTCDate(),2) + String.zeroPad(this.getUTCHours(),2) + String.zeroPad(this.getUTCMinutes(),2);\n"
"};\n"
"\n"
"// Convert a date to UTC YYYYMMDD.HHMMSSMMM string format\n"
"Date.prototype.convertToYYYYMMDDHHMMSSMMM = function()\n"
"{\n"
"	return this.getUTCFullYear() + String.zeroPad(this.getUTCMonth()+1,2) + String.zeroPad(this.getUTCDate(),2) + \".\" + String.zeroPad(this.getUTCHours(),2) + String.zeroPad(this.getUTCMinutes(),2) + String.zeroPad(this.getUTCSeconds(),2) + String.zeroPad(this.getUTCMilliseconds(),4);\n"
"};\n"
"\n"
"// Static method to create a date from a UTC YYYYMMDDHHMM format string\n"
"Date.convertFromYYYYMMDDHHMM = function(d)\n"
"{\n"
"	var hh = d.substr(8,2) || \"00\";\n"
"	var mm = d.substr(10,2) || \"00\";\n"
"	return new Date(Date.UTC(parseInt(d.substr(0,4),10),\n"
"			parseInt(d.substr(4,2),10)-1,\n"
"			parseInt(d.substr(6,2),10),\n"
"			parseInt(hh,10),\n"
"			parseInt(mm,10),0,0));\n"
"};\n"
"\n"
"//--\n"
"//-- RGB colour object\n"
"//--\n"
"\n"
"// Construct an RGB colour object from a '#rrggbb', '#rgb' or 'rgb(n,n,n)' string or from separate r,g,b values\n"
"function RGB(r,g,b)\n"
"{\n"
"	this.r = 0;\n"
"	this.g = 0;\n"
"	this.b = 0;\n"
"	if(typeof r == \"string\") {\n"
"		if(r.substr(0,1) == \"#\") {\n"
"			if(r.length == 7) {\n"
"				this.r = parseInt(r.substr(1,2),16)/255;\n"
"				this.g = parseInt(r.substr(3,2),16)/255;\n"
"				this.b = parseInt(r.substr(5,2),16)/255;\n"
"			} else {\n"
"				this.r = parseInt(r.substr(1,1),16)/15;\n"
"				this.g = parseInt(r.substr(2,1),16)/15;\n"
"				this.b = parseInt(r.substr(3,1),16)/15;\n"
"			}\n"
"		} else {\n"
"			var rgbPattern = /rgb\\s*\\(\\s*(\\d{1,3})\\s*,\\s*(\\d{1,3})\\s*,\\s*(\\d{1,3})\\s*\\)/;\n"
"			var c = r.match(rgbPattern);\n"
"			if(c) {\n"
"				this.r = parseInt(c[1],10)/255;\n"
"				this.g = parseInt(c[2],10)/255;\n"
"				this.b = parseInt(c[3],10)/255;\n"
"			}\n"
"		}\n"
"	} else {\n"
"		this.r = r;\n"
"		this.g = g;\n"
"		this.b = b;\n"
"	}\n"
"	return this;\n"
"}\n"
"\n"
"// Mixes this colour with another in a specified proportion\n"
"// c = other colour to mix\n"
"// f = 0..1 where 0 is this colour and 1 is the new colour\n"
"// Returns an RGB object\n"
"RGB.prototype.mix = function(c,f)\n"
"{\n"
"	return new RGB(this.r + (c.r-this.r) * f,this.g + (c.g-this.g) * f,this.b + (c.b-this.b) * f);\n"
"};\n"
"\n"
"// Return an rgb colour as a #rrggbb format hex string\n"
"RGB.prototype.toString = function()\n"
"{\n"
"	return \"#\" + (\"0\" + Math.floor(this.r.clamp(0,1) * 255).toString(16)).right(2) +\n"
"				 (\"0\" + Math.floor(this.g.clamp(0,1) * 255).toString(16)).right(2) +\n"
"				 (\"0\" + Math.floor(this.b.clamp(0,1) * 255).toString(16)).right(2);\n"
"};\n"
"\n"
"//--\n"
"//-- DOM utilities - many derived from www.quirksmode.org\n"
"//--\n"
"\n"
"// Resolve the target object of an event\n"
"function resolveTarget(e)\n"
"{\n"
"	var obj;\n"
"	if(e.target)\n"
"		obj = e.target;\n"
"	else if(e.srcElement)\n"
"		obj = e.srcElement;\n"
"	if(obj.nodeType == 3) // defeat Safari bug\n"
"		obj = obj.parentNode;\n"
"	return obj;\n"
"}\n"
"\n"
"function drawGradient(place,horiz,locolors,hicolors)\n"
"{\n"
"	if(!hicolors)\n"
"		hicolors = locolors;\n"
"	for(var t=0; t<= 100; t+=2) {\n"
"		var bar = document.createElement(\"div\");\n"
"		place.appendChild(bar);\n"
"		bar.style.position = \"absolute\";\n"
"		bar.style.left = horiz ? t + \"%\" : 0;\n"
"		bar.style.top = horiz ? 0 : t + \"%\";\n"
"		bar.style.width = horiz ? (101-t) + \"%\" : \"100%\";\n"
"		bar.style.height = horiz ? \"100%\" : (101-t) + \"%\";\n"
"		bar.style.zIndex = -1;\n"
"		var p = t/100*(locolors.length-1);\n"
"		var hc = hicolors[Math.floor(p)];\n"
"		if(typeof hc == \"string\")\n"
"			hc = new RGB(hc);\n"
"		var lc = locolors[Math.ceil(p)];\n"
"		if(typeof lc == \"string\")\n"
"			lc = new RGB(lc);\n"
"		bar.style.backgroundColor = hc.mix(lc,p-Math.floor(p)).toString();\n"
"	}\n"
"}\n"
"\n"
"function createTiddlyText(parent,text)\n"
"{\n"
"	return parent.appendChild(document.createTextNode(text));\n"
"}\n"
"\n"
"function createTiddlyCheckbox(parent,caption,checked,onChange)\n"
"{\n"
"	var cb = document.createElement(\"input\");\n"
"	cb.setAttribute(\"type\",\"checkbox\");\n"
"	cb.onclick = onChange;\n"
"	parent.appendChild(cb);\n"
"	cb.checked = checked;\n"
"	cb.className = \"chkOptionInput\";\n"
"	if(caption)\n"
"		wikify(caption,parent);\n"
"	return cb;\n"
"}\n"
"\n"
"function createTiddlyElement(parent,element,id,className,text,attribs)\n"
"{\n"
"	var e = document.createElement(element);\n"
"	if(className != null)\n"
"		e.className = className;\n"
"	if(id != null)\n"
"		e.setAttribute(\"id\",id);\n"
"	if(text != null)\n"
"		e.appendChild(document.createTextNode(text));\n"
"	if(attribs) {\n"
"		for(var n in attribs) {\n"
"			e.setAttribute(n,attribs[n]);\n"
"		}\n"
"	}\n"
"	if(parent != null)\n"
"		parent.appendChild(e);\n"
"	return e;\n"
"}\n"
"\n"
"function addEvent(obj,type,fn)\n"
"{\n"
"	if(obj.attachEvent) {\n"
"		obj[\"e\"+type+fn] = fn;\n"
"		obj[type+fn] = function(){obj[\"e\"+type+fn](window.event);};\n"
"		obj.attachEvent(\"on\"+type,obj[type+fn]);\n"
"	} else {\n"
"		obj.addEventListener(type,fn,false);\n"
"	}\n"
"}\n"
"\n"
"function removeEvent(obj,type,fn)\n"
"{\n"
"	if(obj.detachEvent) {\n"
"		obj.detachEvent(\"on\"+type,obj[type+fn]);\n"
"		obj[type+fn] = null;\n"
"	} else {\n"
"		obj.removeEventListener(type,fn,false);\n"
"	}\n"
"}\n"
"\n"
"\n"
"// Find the closest relative with a given property value (property defaults to tagName, relative defaults to parentNode)\n"
"function findRelated(e,value,name,relative)\n"
"{\n"
"	name = name || \"tagName\";\n"
"	relative = relative || \"parentNode\";\n"
"	if(name == \"className\") {\n"
"		while(e && !hasClass(e,value)) {\n"
"			e = e[relative];\n"
"		}\n"
"	} else {\n"
"		while(e && e[name] != value) {\n"
"			e = e[relative];\n"
"		}\n"
"	}\n"
"	return e;\n"
"}\n"
"\n"
"// Get the scroll position for window.scrollTo necessary to scroll a given element into view\n"
"function ensureVisible(e)\n"
"{\n"
"	var posTop = findPosY(e);\n"
"	var posBot = posTop + e.offsetHeight;\n"
"	var winTop = findScrollY();\n"
"	var winHeight = findWindowHeight();\n"
"	var winBot = winTop + winHeight;\n"
"	if(posTop < winTop) {\n"
"		return posTop;\n"
"	} else if(posBot > winBot) {\n"
"		if(e.offsetHeight < winHeight)\n"
"			return posTop - (winHeight - e.offsetHeight);\n"
"		else\n"
"			return posTop;\n"
"	} else {\n"
"		return winTop;\n"
"	}\n"
"}\n"
"\n"
"// Get the current width of the display window\n"
"function findWindowWidth()\n"
"{\n"
"	return window.innerWidth || document.documentElement.clientWidth;\n"
"}\n"
"\n"
"// Get the current height of the display window\n"
"function findWindowHeight()\n"
"{\n"
"	return window.innerHeight || document.documentElement.clientHeight;\n"
"}\n"
"\n"
"// Get the current horizontal page scroll position\n"
"function findScrollX()\n"
"{\n"
"	return window.scrollX || document.documentElement.scrollLeft;\n"
"}\n"
"\n"
"// Get the current vertical page scroll position\n"
"function findScrollY()\n"
"{\n"
"	return window.scrollY || document.documentElement.scrollTop;\n"
"}\n"
"\n"
"function findPosX(obj)\n"
"{\n"
"	var curleft = 0;\n"
"	while(obj.offsetParent) {\n"
"		curleft += obj.offsetLeft;\n"
"		obj = obj.offsetParent;\n"
"	}\n"
"	return curleft;\n"
"}\n"
"\n"
"function findPosY(obj)\n"
"{\n"
"	var curtop = 0;\n"
"	while(obj.offsetParent) {\n"
"		curtop += obj.offsetTop;\n"
"		obj = obj.offsetParent;\n"
"	}\n"
"	return curtop;\n"
"}\n"
"\n"
"// Blur a particular element\n"
"function blurElement(e)\n"
"{\n"
"	if(e && e.focus && e.blur) {\n"
"		e.focus();\n"
"		e.blur();\n"
"	}\n"
"}\n"
"\n"
"// Create a non-breaking space\n"
"function insertSpacer(place)\n"
"{\n"
"	var e = document.createTextNode(String.fromCharCode(160));\n"
"	if(place)\n"
"		place.appendChild(e);\n"
"	return e;\n"
"}\n"
"\n"
"// Force the browser to do a document reflow when needed to workaround browser bugs\n"
"function forceReflow()\n"
"{\n"
"	if(config.browser.isGecko) {\n"
"		setStylesheet(\"body {top:0px;margin-top:0px;}\",\"forceReflow\");\n"
"		setTimeout(function() {setStylesheet(\"\",\"forceReflow\");},1);\n"
"	}\n"
"}\n"
"\n"
"// Replace the current selection of a textarea or text input and scroll it into view\n"
"function replaceSelection(e,text)\n"
"{\n"
"	if(e.setSelectionRange) {\n"
"		var oldpos = e.selectionStart;\n"
"		var isRange = e.selectionEnd > e.selectionStart;\n"
"		e.value = e.value.substr(0,e.selectionStart) + text + e.value.substr(e.selectionEnd);\n"
"		e.setSelectionRange(isRange ? oldpos : oldpos + text.length,oldpos + text.length);\n"
"		var linecount = e.value.split(\"\\n\").length;\n"
"		var thisline = e.value.substr(0,e.selectionStart).split(\"\\n\").length-1;\n"
"		e.scrollTop = Math.floor((thisline - e.rows / 2) * e.scrollHeight / linecount);\n"
"	} else if(document.selection) {\n"
"		var range = document.selection.createRange();\n"
"		if(range.parentElement() == e) {\n"
"			var isCollapsed = range.text == \"\";\n"
"			range.text = text;\n"
"			if(!isCollapsed) {\n"
"				range.moveStart(\"character\", -text.length);\n"
"				range.select();\n"
"			}\n"
"		}\n"
"	}\n"
"}\n"
"\n"
"// Returns the text of the given (text) node, possibly merging subsequent text nodes\n"
"function getNodeText(e)\n"
"{\n"
"	var t = \"\";\n"
"	while(e && e.nodeName == \"#text\") {\n"
"		t += e.nodeValue;\n"
"		e = e.nextSibling;\n"
"	}\n"
"	return t;\n"
"}\n"
"\n"
"// Returns true if the element e has a given ancestor element\n"
"function isDescendant(e,ancestor)\n"
"{\n"
"	while(e) {\n"
"		if(e === ancestor)\n"
"			return true;\n"
"		e = e.parentNode;\n"
"	}\n"
"	return false;\n"
"}\n"
"\n"
"\n"
"// deprecate the following...\n"
"\n"
"// Prevent an event from bubbling\n"
"function stopEvent(e)\n"
"{\n"
"	var ev = e || window.event;\n"
"	ev.cancelBubble = true;\n"
"	if(ev.stopPropagation) ev.stopPropagation();\n"
"	return false;\n"
"}\n"
"\n"
"// Remove any event handlers or non-primitve custom attributes\n"
"function scrubNode(e)\n"
"{\n"
"	if(!config.browser.isIE)\n"
"		return;\n"
"	var att = e.attributes;\n"
"	if(att) {\n"
"		for(var t=0; t<att.length; t++) {\n"
"			var n = att[t].name;\n"
"			if(n !== \"style\" && (typeof e[n] === \"function\" || (typeof e[n] === \"object\" && e[n] != null))) {\n"
"				try {\n"
"					e[n] = null;\n"
"				} catch(ex) {\n"
"				}\n"
"			}\n"
"		}\n"
"	}\n"
"	var c = e.firstChild;\n"
"	while(c) {\n"
"		scrubNode(c);\n"
"		c = c.nextSibling;\n"
"	}\n"
"}\n"
"\n"
"function addClass(e,className)\n"
"{\n"
"	jQuery(e).addClass(className);\n"
"}\n"
"\n"
"function removeClass(e,className)\n"
"{\n"
"	jQuery(e).removeClass(className);\n"
"}\n"
"\n"
"function hasClass(e,className)\n"
"{\n"
"	return jQuery(e).hasClass(className);\n"
"}\n"
"\n"
"// Remove all children of a node\n"
"function removeChildren(e)\n"
"{\n"
"	jQuery(e).empty();\n"
"}\n"
"\n"
"// Return the content of an element as plain text with no formatting\n"
"function getPlainText(e)\n"
"{\n"
"	return jQuery(e).text();\n"
"}\n"
"\n"
"// Remove a node and all it's children\n"
"function removeNode(e)\n"
"{\n"
"	jQuery(e).remove();\n"
"}\n"
"\n"
"//--\n"
"//-- LoaderBase and SaverBase\n"
"//--\n"
"\n"
"function LoaderBase() {}\n"
"\n"
"LoaderBase.prototype.loadTiddler = function(store,node,tiddlers)\n"
"{\n"
"	var title = this.getTitle(store,node);\n"
"	if(safeMode && store.isShadowTiddler(title))\n"
"		return;\n"
"	if(title) {\n"
"		var tiddler = store.createTiddler(title);\n"
"		this.internalizeTiddler(store,tiddler,title,node);\n"
"		tiddlers.push(tiddler);\n"
"	}\n"
"};\n"
"\n"
"LoaderBase.prototype.loadTiddlers = function(store,nodes)\n"
"{\n"
"	var tiddlers = [];\n"
"	for(var t = 0; t < nodes.length; t++) {\n"
"		try {\n"
"			this.loadTiddler(store,nodes[t],tiddlers);\n"
"		} catch(ex) {\n"
"			showException(ex,config.messages.tiddlerLoadError.format([this.getTitle(store,nodes[t])]));\n"
"		}\n"
"	}\n"
"	return tiddlers;\n"
"};\n"
"\n"
"function SaverBase() {}\n"
"\n"
"SaverBase.prototype.externalize = function(store)\n"
"{\n"
"	var results = [];\n"
"	var tiddlers = store.getTiddlers(\"title\");\n"
"	for(var t = 0; t < tiddlers.length; t++) {\n"
"		if(!tiddlers[t].doNotSave())\n"
"			results.push(this.externalizeTiddler(store, tiddlers[t]));\n"
"	}\n"
"	return results.join(\"\\n\");\n"
"};\n"
"\n"
"//--\n"
"//-- TW21Loader (inherits from LoaderBase)\n"
"//--\n"
"\n"
"function TW21Loader() {}\n"
"\n"
"TW21Loader.prototype = new LoaderBase();\n"
"\n"
"TW21Loader.prototype.getTitle = function(store,node)\n"
"{\n"
"	var title = null;\n"
"	if(node.getAttribute) {\n"
"		title = node.getAttribute(\"title\");\n"
"		if(!title)\n"
"			title = node.getAttribute(\"tiddler\");\n"
"	}\n"
"	if(!title && node.id) {\n"
"		var lenPrefix = store.idPrefix.length;\n"
"		if(node.id.substr(0,lenPrefix) == store.idPrefix)\n"
"			title = node.id.substr(lenPrefix);\n"
"	}\n"
"	return title;\n"
"};\n"
"\n"
"TW21Loader.prototype.internalizeTiddler = function(store,tiddler,title,node)\n"
"{\n"
"	var e = node.firstChild;\n"
"	var text = null;\n"
"	if(node.getAttribute(\"tiddler\")) {\n"
"		text = getNodeText(e).unescapeLineBreaks();\n"
"	} else {\n"
"		while(e.nodeName!=\"PRE\" && e.nodeName!=\"pre\") {\n"
"			e = e.nextSibling;\n"
"		}\n"
"		text = e.innerHTML.replace(/\\r/mg,\"\").htmlDecode();\n"
"	}\n"
"	var modifier = node.getAttribute(\"modifier\");\n"
"	var c = node.getAttribute(\"created\");\n"
"	var m = node.getAttribute(\"modified\");\n"
"	var created = c ? Date.convertFromYYYYMMDDHHMM(c) : version.date;\n"
"	var modified = m ? Date.convertFromYYYYMMDDHHMM(m) : created;\n"
"	var tags = node.getAttribute(\"tags\");\n"
"	var fields = {};\n"
"	var attrs = node.attributes;\n"
"	for(var i = attrs.length-1; i >= 0; i--) {\n"
"		var name = attrs[i].name;\n"
"		if(attrs[i].specified && !TiddlyWiki.isStandardField(name)) {\n"
"			fields[name] = attrs[i].value.unescapeLineBreaks();\n"
"		}\n"
"	}\n"
"	tiddler.assign(title,text,modifier,modified,tags,created,fields);\n"
"	return tiddler;\n"
"};\n"
"\n"
"//--\n"
"//-- TW21Saver (inherits from SaverBase)\n"
"//--\n"
"\n"
"function TW21Saver() {}\n"
"\n"
"TW21Saver.prototype = new SaverBase();\n"
"\n"
"TW21Saver.prototype.externalizeTiddler = function(store,tiddler)\n"
"{\n"
"	try {\n"
"		var extendedAttributes = \"\";\n"
"		var usePre = config.options.chkUsePreForStorage;\n"
"		store.forEachField(tiddler,\n"
"			function(tiddler,fieldName,value) {\n"
"				// don't store stuff from the temp namespace\n"
"				if(typeof value != \"string\")\n"
"					value = \"\";\n"
"				if(!fieldName.match(/^temp\\./))\n"
"					extendedAttributes += ' %0=\"%1\"'.format([fieldName,value.escapeLineBreaks().htmlEncode()]);\n"
"			},true);\n"
"		var created = tiddler.created;\n"
"		var modified = tiddler.modified;\n"
"		var attributes = tiddler.modifier ? ' modifier=\"' + tiddler.modifier.htmlEncode() + '\"' : \"\";\n"
"		attributes += (usePre && created == version.date) ? \"\" :' created=\"' + created.convertToYYYYMMDDHHMM() + '\"';\n"
"		attributes += (usePre && modified == created) ? \"\" : ' modified=\"' + modified.convertToYYYYMMDDHHMM() +'\"';\n"
"		var tags = tiddler.getTags();\n"
"		if(!usePre || tags)\n"
"			attributes += ' tags=\"' + tags.htmlEncode() + '\"';\n"
"		return ('<div %0=\"%1\"%2%3>%4</'+'div>').format([\n"
"				usePre ? \"title\" : \"tiddler\",\n"
"				tiddler.title.htmlEncode(),\n"
"				attributes,\n"
"				extendedAttributes,\n"
"				usePre ? \"\\n<pre>\" + tiddler.text.htmlEncode() + \"</pre>\\n\" : tiddler.text.escapeLineBreaks().htmlEncode()\n"
"			]);\n"
"	} catch (ex) {\n"
"		throw exceptionText(ex,config.messages.tiddlerSaveError.format([tiddler.title]));\n"
"	}\n"
"};\n"
"\n"
"//]]>\n"
"</script>\n"
"<script id=\"jsdeprecatedArea\" type=\"text/javascript\">\n"
"//<![CDATA[\n"
"//--\n"
"//-- Deprecated Crypto functions and associated conversion routines.\n"
"//-- Use the jQuery.encoding functions directly instead.\n"
"//--\n"
"\n"
"// Crypto 'namespace'\n"
"function Crypto() {}\n"
"\n"
"// Convert a string to an array of big-endian 32-bit words\n"
"Crypto.strToBe32s = function(str)\n"
"{\n"
"	return jQuery.encoding.strToBe32s(str);\n"
"};\n"
"\n"
"// Convert an array of big-endian 32-bit words to a string\n"
"Crypto.be32sToStr = function(be)\n"
"{\n"
"	return jQuery.encoding.be32sToStr(be);\n"
"};\n"
"\n"
"// Convert an array of big-endian 32-bit words to a hex string\n"
"Crypto.be32sToHex = function(be)\n"
"{\n"
"	return jQuery.encoding.be32sToHex(be);\n"
"};\n"
"\n"
"// Return, in hex, the SHA-1 hash of a string\n"
"Crypto.hexSha1Str = function(str)\n"
"{\n"
"	return jQuery.encoding.digests.hexSha1Str(str);\n"
"};\n"
"\n"
"// Return the SHA-1 hash of a string\n"
"Crypto.sha1Str = function(str)\n"
"{\n"
"	return jQuery.encoding.digests.sha1Str(str);\n"
"};\n"
"\n"
"// Calculate the SHA-1 hash of an array of blen bytes of big-endian 32-bit words\n"
"Crypto.sha1 = function(x,blen)\n"
"{\n"
"	return jQuery.encoding.digests.sha1(x,blen);\n"
"};\n"
"\n"
"//--\n"
"//-- Deprecated DOM utilities\n"
"//--\n"
"\n"
"// @Deprecated: Use jQuery.stylesheet instead\n"
"function setStylesheet(s,id,doc)\n"
"{\n"
"	jQuery.twStylesheet(s,{ id: id, doc: doc });\n"
"}\n"
"\n"
"// @Deprecated: Use jQuery.stylesheet.remove instead\n"
"function removeStyleSheet(id)\n"
"{\n"
"	jQuery.twStylesheet.remove({ id: id });\n"
"}\n"
"//--\n"
"//-- Deprecated HTTP request code\n"
"//-- Use the jQuery ajax functions directly instead\n"
"//--\n"
"\n"
"function loadRemoteFile(url,callback,params)\n"
"{\n"
"	return httpReq(\"GET\",url,callback,params);\n"
"}\n"
"\n"
"function doHttp(type,url,data,contentType,username,password,callback,params,headers,allowCache)\n"
"{\n"
"	return httpReq(type,url,callback,params,headers,data,contentType,username,password,allowCache);\n"
"}\n"
"\n"
"function httpReq(type,url,callback,params,headers,data,contentType,username,password,allowCache)\n"
"{\n"
"	var options = {\n"
"		type:type,\n"
"		url:url,\n"
"		processData:false,\n"
"		data:data,\n"
"		cache:!!allowCache,\n"
"		beforeSend: function(xhr) {\n"
"			for(var i in headers)\n"
"				xhr.setRequestHeader(i,headers[i]);\n"
"			xhr.setRequestHeader(\"X-Requested-With\", \"TiddlyWiki \" + formatVersion());\n"
"		}\n"
"	};\n"
"\n"
"	if(callback) {\n"
"		options.complete = function(xhr,textStatus) {\n"
"			if(jQuery.httpSuccess(xhr))\n"
"				callback(true,params,xhr.responseText,url,xhr);\n"
"			else\n"
"				callback(false,params,null,url,xhr);\n"
"		};\n"
"	}\n"
"	if(contentType)\n"
"		options.contentType = contentType;\n"
"	if(username)\n"
"		options.username = username;\n"
"	if(password)\n"
"		options.password = password;\n"
"	if(window.Components && window.netscape && window.netscape.security && document.location.protocol.indexOf(\"http\") == -1)\n"
"		window.netscape.security.PrivilegeManager.enablePrivilege(\"UniversalBrowserRead\");\n"
"	jQuery.ajax(options);\n"
"}\n"
"\n"
"//--\n"
"//-- Deprecated String functions\n"
"//--\n"
"\n"
"// @Deprecated: no direct replacement, since not used in core code\n"
"String.prototype.toJSONString = function()\n"
"{\n"
"	// Convert a string to it's JSON representation by encoding control characters, double quotes and backslash. See json.org\n"
"	var m = {\n"
"		'\\b': '\\\\b',\n"
"		'\\f': '\\\\f',\n"
"		'\\n': '\\\\n',\n"
"		'\\r': '\\\\r',\n"
"		'\\t': '\\\\t',\n"
"		'\"' : '\\\\\"',\n"
"		'\\\\': '\\\\\\\\'\n"
"		};\n"
"	var replaceFn = function(a,b) {\n"
"		var c = m[b];\n"
"		if(c)\n"
"			return c;\n"
"		c = b.charCodeAt();\n"
"		return '\\\\u00' + Math.floor(c / 16).toString(16) + (c % 16).toString(16);\n"
"		};\n"
"	if(/[\"\\\\\\x00-\\x1f]/.test(this))\n"
"		return '\"' + this.replace(/([\\x00-\\x1f\\\\\"])/g,replaceFn) + '\"';\n"
"	return '\"' + this + '\"';\n"
"};\n"
"\n"
"//--\n"
"//-- Deprecated Tiddler code\n"
"//--\n"
"\n"
"// @Deprecated: Use tiddlerToRssItem(tiddler,uri) instead\n"
"Tiddler.prototype.toRssItem = function(uri)\n"
"{\n"
"	return tiddlerToRssItem(this,uri);\n"
"};\n"
"\n"
"// @Deprecated: Use \"<item>\\n\" + tiddlerToRssItem(tiddler,uri)  + \"\\n</item>\" instead\n"
"Tiddler.prototype.saveToRss = function(uri)\n"
"{\n"
"	return \"<item>\\n\" + tiddlerToRssItem(this,uri) + \"\\n</item>\";\n"
"};\n"
"\n"
"// @Deprecated: Use jQuery.encoding.digests.hexSha1Str instead\n"
"Tiddler.prototype.generateFingerprint = function()\n"
"{\n"
"	return \"0x\" + Crypto.hexSha1Str(this.text);\n"
"};\n"
"\n"
"//]]>\n"
"</script>\n"
"<script id=\"jslibArea\" type=\"text/javascript\">\n"
"//<![CDATA[\n"
"/*\n"
" * jQuery JavaScript Library v1.3.2\n"
" * http://jquery.com/\n"
" *\n"
" * Copyright (c) 2009 John Resig\n"
" * Dual licensed under the MIT and GPL licenses.\n"
" * http://docs.jquery.com/License\n"
" *\n"
" * Date: 2009-02-19 17:34:21 -0500 (Thu, 19 Feb 2009)\n"
" * Revision: 6246\n"
" */\n"
"(function(){var l=this,g,y=l.jQuery,p=l.$,o=l.jQuery=l.$=function(E,F){return new o.fn.init(E,F)},D=/^[^<]*(<(.|\\s)+>)[^>]*$|^#([\\w-]+)$/,f=/^.[^:#\\[\\.,]*$/;o.fn=o.prototype={init:function(E,H){E=E||document;if(E.nodeType){this[0]=E;this.length=1;this.context=E;return this}if(typeof E===\"string\"){var G=D.exec(E);if(G&&(G[1]||!H)){if(G[1]){E=o.clean([G[1]],H)}else{var I=document.getElementById(G[3]);if(I&&I.id!=G[3]){return o().find(E)}var F=o(I||[]);F.context=document;F.selector=E;return F}}else{return o(H).find(E)}}else{if(o.isFunction(E)){return o(document).ready(E)}}if(E.selector&&E.context){this.selector=E.selector;this.context=E.context}return this.setArray(o.isArray(E)?E:o.makeArray(E))},selector:\"\",jquery:\"1.3.2\",size:function(){return this.length},get:function(E){return E===g?Array.prototype.slice.call(this):this[E]},pushStack:function(F,H,E){var G=o(F);G.prevObject=this;G.context=this.context;if(H===\"find\"){G.selector=this.selector+(this.selector?\" \":\"\")+E}else{if(H){G.selector=this.selector+\".\"+H+\"(\"+E+\")\"}}return G},setArray:function(E){this.length=0;Array.prototype.push.apply(this,E);return this},each:function(F,E){return o.each(this,F,E)},index:function(E){return o.inArray(E&&E.jquery?E[0]:E,this)},attr:function(F,H,G){var E=F;if(typeof F===\"string\"){if(H===g){return this[0]&&o[G||\"attr\"](this[0],F)}else{E={};E[F]=H}}return this.each(function(I){for(F in E){o.attr(G?this.style:this,F,o.prop(this,E[F],G,I,F))}})},css:function(E,F){if((E==\"width\"||E==\"height\")&&parseFloat(F)<0){F=g}return this.attr(E,F,\"curCSS\")},text:function(F){if(typeof F!==\"object\"&&F!=null){return this.empty().append((this[0]&&this[0].ownerDocument||document).createTextNode(F))}var E=\"\";o.each(F||this,function(){o.each(this.childNodes,function(){if(this.nodeType!=8){E+=this.nodeType!=1?this.nodeValue:o.fn.text([this])}})});return E},wrapAll:function(E){if(this[0]){var F=o(E,this[0].ownerDocument).clone();if(this[0].parentNode){F.insertBefore(this[0])}F.map(function(){var G=this;while(G.firstChild){G=G.firstChild}return G}).append(this)}return this},wrapInner:function(E){return this.each(function(){o(this).contents().wrapAll(E)})},wrap:function(E){return this.each(function(){o(this).wrapAll(E)})},append:function(){return this.domManip(arguments,true,function(E){if(this.nodeType==1){this.appendChild(E)}})},prepend:function(){return this.domManip(arguments,true,function(E){if(this.nodeType==1){this.insertBefore(E,this.firstChild)}})},before:function(){return this.domManip(arguments,false,function(E){this.parentNode.insertBefore(E,this)})},after:function(){return this.domManip(arguments,false,function(E){this.parentNode.insertBefore(E,this.nextSibling)})},end:function(){return this.prevObject||o([])},push:[].push,sort:[].sort,splice:[].splice,find:function(E){if(this.length===1){var F=this.pushStack([],\"find\",E);F.length=0;o.find(E,this[0],F);return F}else{return this.pushStack(o.unique(o.map(this,function(G){return o.find(E,G)})),\"find\",E)}},clone:function(G){var E=this.map(function(){if(!o.support.noCloneEvent&&!o.isXMLDoc(this)){var I=this.outerHTML;if(!I){var J=this.ownerDocument.createElement(\"div\");J.appendChild(this.cloneNode(true));I=J.innerHTML}return o.clean([I.replace(/ jQuery\\d+=\"(?:\\d+|null)\"/g,\"\").replace(/^\\s*/,\"\")])[0]}else{return this.cloneNode(true)}});if(G===true){var H=this.find(\"*\").andSelf(),F=0;E.find(\"*\").andSelf().each(function(){if(this.nodeName!==H[F].nodeName){return}var I=o.data(H[F],\"events\");for(var K in I){for(var J in I[K]){o.event.add(this,K,I[K][J],I[K][J].data)}}F++})}return E},filter:function(E){return this.pushStack(o.isFunction(E)&&o.grep(this,function(G,F){return E.call(G,F)})||o.multiFilter(E,o.grep(this,function(F){return F.nodeType===1})),\"filter\",E)},closest:function(E){var G=o.expr.match.POS.test(E)?o(E):null,F=0;return this.map(function(){var H=this;while(H&&H.ownerDocument){if(G?G.index(H)>-1:o(H).is(E)){o.data(H,\"closest\",F);return H}H=H.parentNode;F++}})},not:function(E){if(typeof E===\"string\"){if(f.test(E)){return this.pushStack(o.multiFilter(E,this,true),\"not\",E)}else{E=o.multiFilter(E,this)}}var F=E.length&&E[E.length-1]!==g&&!E.nodeType;return this.filter(function(){return F?o.inArray(this,E)<0:this!=E})},add:function(E){return this.pushStack(o.unique(o.merge(this.get(),typeof E===\"string\"?o(E):o.makeArray(E))))},is:function(E){return !!E&&o.multiFilter(E,this).length>0},hasClass:function(E){return !!E&&this.is(\".\"+E)},val:function(K){if(K===g){var E=this[0];if(E){if(o.nodeName(E,\"option\")){return(E.attributes.value||{}).specified?E.value:E.text}if(o.nodeName(E,\"select\")){var I=E.selectedIndex,L=[],M=E.options,H=E.type==\"select-one\";if(I<0){return null}for(var F=H?I:0,J=H?I+1:M.length;F<J;F++){var G=M[F];if(G.selected){K=o(G).val();if(H){return K}L.push(K)}}return L}return(E.value||\"\").replace(/\\r/g,\"\")}return g}if(typeof K===\"number\"){K+=\"\"}return this.each(function(){if(this.nodeType!=1){return}if(o.isArray(K)&&/radio|checkbox/.test(this.type)){this.checked=(o.inArray(this.value,K)>=0||o.inArray(this.name,K)>=0)}else{if(o.nodeName(this,\"select\")){var N=o.makeArray(K);o(\"option\",this).each(function(){this.selected=(o.inArray(this.value,N)>=0||o.inArray(this.text,N)>=0)});if(!N.length){this.selectedIndex=-1}}else{this.value=K}}})},html:function(E){return E===g?(this[0]?this[0].innerHTML.replace(/ jQuery\\d+=\"(?:\\d+|null)\"/g,\"\"):null):this.empty().append(E)},replaceWith:function(E){return this.after(E).remove()},eq:function(E){return this.slice(E,+E+1)},slice:function(){return this.pushStack(Array.prototype.slice.apply(this,arguments),\"slice\",Array.prototype.slice.call(arguments).join(\",\"))},map:function(E){return this.pushStack(o.map(this,function(G,F){return E.call(G,F,G)}))},andSelf:function(){return this.add(this.prevObject)},domManip:function(J,M,L){if(this[0]){var I=(this[0].ownerDocument||this[0]).createDocumentFragment(),F=o.clean(J,(this[0].ownerDocument||this[0]),I),H=I.firstChild;if(H){for(var G=0,E=this.length;G<E;G++){L.call(K(this[G],H),this.length>1||G>0?I.cloneNode(true):I)}}if(F){o.each(F,z)}}return this;function K(N,O){return M&&o.nodeName(N,\"table\")&&o.nodeName(O,\"tr\")?(N.getElementsByTagName(\"tbody\")[0]||N.appendChild(N.ownerDocument.createElement(\"tbody\"))):N}}};o.fn.init.prototype=o.fn;function z(E,F){if(F.src){o.ajax({url:F.src,async:false,dataType:\"script\"})}else{o.globalEval(F.text||F.textContent||F.innerHTML||\"\")}if(F.parentNode){F.parentNode.removeChild(F)}}function e(){return +new Date}o.extend=o.fn.extend=function(){var J=arguments[0]||{},H=1,I=arguments.length,E=false,G;if(typeof J===\"boolean\"){E=J;J=arguments[1]||{};H=2}if(typeof J!==\"object\"&&!o.isFunction(J)){J={}}if(I==H){J=this;--H}for(;H<I;H++){if((G=arguments[H])!=null){for(var F in G){var K=J[F],L=G[F];if(J===L){continue}if(E&&L&&typeof L===\"object\"&&!L.nodeType){J[F]=o.extend(E,K||(L.length!=null?[]:{}),L)}else{if(L!==g){J[F]=L}}}}}return J};var b=/z-?index|font-?weight|opacity|zoom|line-?height/i,q=document.defaultView||{},s=Object.prototype.toString;o.extend({noConflict:function(E){l.$=p;if(E){l.jQuery=y}return o},isFunction:function(E){return s.call(E)===\"[object Function]\"},isArray:function(E){return s.call(E)===\"[object Array]\"},isXMLDoc:function(E){return E.nodeType===9&&E.documentElement.nodeName!==\"HTML\"||!!E.ownerDocument&&o.isXMLDoc(E.ownerDocument)},globalEval:function(G){if(G&&/\\S/.test(G)){var F=document.getElementsByTagName(\"head\")[0]||document.documentElement,E=document.createElement(\"script\");E.type=\"text/javascript\";if(o.support.scriptEval){E.appendChild(document.createTextNode(G))}else{E.text=G}F.insertBefore(E,F.firstChild);F.removeChild(E)}},nodeName:function(F,E){return F.nodeName&&F.nodeName.toUpperCase()==E.toUpperCase()},each:function(G,K,F){var E,H=0,I=G.length;if(F){if(I===g){for(E in G){if(K.apply(G[E],F)===false){break}}}else{for(;H<I;){if(K.apply(G[H++],F)===false){break}}}}else{if(I===g){for(E in G){if(K.call(G[E],E,G[E])===false){break}}}else{for(var J=G[0];H<I&&K.call(J,H,J)!==false;J=G[++H]){}}}return G},prop:function(H,I,G,F,E){if(o.isFunction(I)){I=I.call(H,F)}return typeof I===\"number\"&&G==\"curCSS\"&&!b.test(E)?I+\"px\":I},className:{add:function(E,F){o.each((F||\"\").split(/\\s+/),function(G,H){if(E.nodeType==1&&!o.className.has(E.className,H)){E.className+=(E.className?\" \":\"\")+H}})},remove:function(E,F){if(E.nodeType==1){E.className=F!==g?o.grep(E.className.split(/\\s+/),function(G){return !o.className.has(F,G)}).join(\" \"):\"\"}},has:function(F,E){return F&&o.inArray(E,(F.className||F).toString().split(/\\s+/))>-1}},swap:function(H,G,I){var E={};for(var F in G){E[F]=H.style[F];H.style[F]=G[F]}I.call(H);for(var F in G){H.style[F]=E[F]}},css:function(H,F,J,E){if(F==\"width\"||F==\"height\"){var L,G={position:\"absolute\",visibility:\"hidden\",display:\"block\"},K=F==\"width\"?[\"Left\",\"Right\"]:[\"Top\",\"Bottom\"];function I(){L=F==\"width\"?H.offsetWidth:H.offsetHeight;if(E===\"border\"){return}o.each(K,function(){if(!E){L-=parseFloat(o.curCSS(H,\"padding\"+this,true))||0}if(E===\"margin\"){L+=parseFloat(o.curCSS(H,\"margin\"+this,true))||0}else{L-=parseFloat(o.curCSS(H,\"border\"+this+\"Width\",true))||0}})}if(H.offsetWidth!==0){I()}else{o.swap(H,G,I)}return Math.max(0,Math.round(L))}return o.curCSS(H,F,J)},curCSS:function(I,F,G){var L,E=I.style;if(F==\"opacity\"&&!o.support.opacity){L=o.attr(E,\"opacity\");return L==\"\"?\"1\":L}if(F.match(/float/i)){F=w}if(!G&&E&&E[F]){L=E[F]}else{if(q.getComputedStyle){if(F.match(/float/i)){F=\"float\"}F=F.replace(/([A-Z])/g,\"-$1\").toLowerCase();var M=q.getComputedStyle(I,null);if(M){L=M.getPropertyValue(F)}if(F==\"opacity\"&&L==\"\"){L=\"1\"}}else{if(I.currentStyle){var J=F.replace(/\\-(\\w)/g,function(N,O){return O.toUpperCase()});L=I.currentStyle[F]||I.currentStyle[J];if(!/^\\d+(px)?$/i.test(L)&&/^\\d/.test(L)){var H=E.left,K=I.runtimeStyle.left;I.runtimeStyle.left=I.currentStyle.left;E.left=L||0;L=E.pixelLeft+\"px\";E.left=H;I.runtimeStyle.left=K}}}}return L},clean:function(F,K,I){K=K||document;if(typeof K.createElement===\"undefined\"){K=K.ownerDocument||K[0]&&K[0].ownerDocument||document}if(!I&&F.length===1&&typeof F[0]===\"string\"){var H=/^<(\\w+)\\s*\\/?>$/.exec(F[0]);if(H){return[K.createElement(H[1])]}}var G=[],E=[],L=K.createElement(\"div\");o.each(F,function(P,S){if(typeof S===\"number\"){S+=\"\"}if(!S){return}if(typeof S===\"string\"){S=S.replace(/(<(\\w+)[^>]*?)\\/>/g,function(U,V,T){return T.match(/^(abbr|br|col|img|input|link|meta|param|hr|area|embed)$/i)?U:V+\"></\"+T+\">\"});var O=S.replace(/^\\s+/,\"\").substring(0,10).toLowerCase();var Q=!O.indexOf(\"<opt\")&&[1,\"<select multiple='multiple'>\",\"</select>\"]||!O.indexOf(\"<leg\")&&[1,\"<fieldset>\",\"</fieldset>\"]||O.match(/^<(thead|tbody|tfoot|colg|cap)/)&&[1,\"<table>\",\"</table>\"]||!O.indexOf(\"<tr\")&&[2,\"<table><tbody>\",\"</tbody></table>\"]||(!O.indexOf(\"<td\")||!O.indexOf(\"<th\"))&&[3,\"<table><tbody><tr>\",\"</tr></tbody></table>\"]||!O.indexOf(\"<col\")&&[2,\"<table><tbody></tbody><colgroup>\",\"</colgroup></table>\"]||!o.support.htmlSerialize&&[1,\"div<div>\",\"</div>\"]||[0,\"\",\"\"];L.innerHTML=Q[1]+S+Q[2];while(Q[0]--){L=L.lastChild}if(!o.support.tbody){var R=/<tbody/i.test(S),N=!O.indexOf(\"<table\")&&!R?L.firstChild&&L.firstChild.childNodes:Q[1]==\"<table>\"&&!R?L.childNodes:[];for(var M=N.length-1;M>=0;--M){if(o.nodeName(N[M],\"tbody\")&&!N[M].childNodes.length){N[M].parentNode.removeChild(N[M])}}}if(!o.support.leadingWhitespace&&/^\\s/.test(S)){L.insertBefore(K.createTextNode(S.match(/^\\s*/)[0]),L.firstChild)}S=o.makeArray(L.childNodes)}if(S.nodeType){G.push(S)}else{G=o.merge(G,S)}});if(I){for(var J=0;G[J];J++){if(o.nodeName(G[J],\"script\")&&(!G[J].type||G[J].type.toLowerCase()===\"text/javascript\")){E.push(G[J].parentNode?G[J].parentNode.removeChild(G[J]):G[J])}else{if(G[J].nodeType===1){G.splice.apply(G,[J+1,0].concat(o.makeArray(G[J].getElementsByTagName(\"script\"))))}I.appendChild(G[J])}}return E}return G},attr:function(J,G,K){if(!J||J.nodeType==3||J.nodeType==8){return g}var H=!o.isXMLDoc(J),L=K!==g;G=H&&o.props[G]||G;if(J.tagName){var F=/href|src|style/.test(G);if(G==\"selected\"&&J.parentNode){J.parentNode.selectedIndex}if(G in J&&H&&!F){if(L){if(G==\"type\"&&o.nodeName(J,\"input\")&&J.parentNode){throw\"type property can't be changed\"}J[G]=K}if(o.nodeName(J,\"form\")&&J.getAttributeNode(G)){return J.getAttributeNode(G).nodeValue}if(G==\"tabIndex\"){var I=J.getAttributeNode(\"tabIndex\");return I&&I.specified?I.value:J.nodeName.match(/(button|input|object|select|textarea)/i)?0:J.nodeName.match(/^(a|area)$/i)&&J.href?0:g}return J[G]}if(!o.support.style&&H&&G==\"style\"){return o.attr(J.style,\"cssText\",K)}if(L){J.setAttribute(G,\"\"+K)}var E=!o.support.hrefNormalized&&H&&F?J.getAttribute(G,2):J.getAttribute(G);return E===null?g:E}if(!o.support.opacity&&G==\"opacity\"){if(L){J.zoom=1;J.filter=(J.filter||\"\").replace(/alpha\\([^)]*\\)/,\"\")+(parseInt(K)+\"\"==\"NaN\"?\"\":\"alpha(opacity=\"+K*100+\")\")}return J.filter&&J.filter.indexOf(\"opacity=\")>=0?(parseFloat(J.filter.match(/opacity=([^)]*)/)[1])/100)+\"\":\"\"}G=G.replace(/-([a-z])/ig,function(M,N){return N.toUpperCase()});if(L){J[G]=K}return J[G]},trim:function(E){return(E||\"\").replace(/^\\s+|\\s+$/g,\"\")},makeArray:function(G){var E=[];if(G!=null){var F=G.length;if(F==null||typeof G===\"string\"||o.isFunction(G)||G.setInterval){E[0]=G}else{while(F){E[--F]=G[F]}}}return E},inArray:function(G,H){for(var E=0,F=H.length;E<F;E++){if(H[E]===G){return E}}return -1},merge:function(H,E){var F=0,G,I=H.length;if(!o.support.getAll){while((G=E[F++])!=null){if(G.nodeType!=8){H[I++]=G}}}else{while((G=E[F++])!=null){H[I++]=G}}return H},unique:function(K){var F=[],E={};try{for(var G=0,H=K.length;G<H;G++){var J=o.data(K[G]);if(!E[J]){E[J]=true;F.push(K[G])}}}catch(I){F=K}return F},grep:function(F,J,E){var G=[];for(var H=0,I=F.length;H<I;H++){if(!E!=!J(F[H],H)){G.push(F[H])}}return G},map:function(E,J){var F=[];for(var G=0,H=E.length;G<H;G++){var I=J(E[G],G);if(I!=null){F[F.length]=I}}return F.concat.apply([],F)}});var C=navigator.userAgent.toLowerCase();o.browser={version:(C.match(/.+(?:rv|it|ra|ie)[\\/: ]([\\d.]+)/)||[0,\"0\"])[1],safari:/webkit/.test(C),opera:/opera/.test(C),msie:/msie/.test(C)&&!/opera/.test(C),mozilla:/mozilla/.test(C)&&!/(compatible|webkit)/.test(C)};o.each({parent:function(E){return E.parentNode},parents:function(E){return o.dir(E,\"parentNode\")},next:function(E){return o.nth(E,2,\"nextSibling\")},prev:function(E){return o.nth(E,2,\"previousSibling\")},nextAll:function(E){return o.dir(E,\"nextSibling\")},prevAll:function(E){return o.dir(E,\"previousSibling\")},siblings:function(E){return o.sibling(E.parentNode.firstChild,E)},children:function(E){return o.sibling(E.firstChild)},contents:function(E){return o.nodeName(E,\"iframe\")?E.contentDocument||E.contentWindow.document:o.makeArray(E.childNodes)}},function(E,F){o.fn[E]=function(G){var H=o.map(this,F);if(G&&typeof G==\"string\"){H=o.multiFilter(G,H)}return this.pushStack(o.unique(H),E,G)}});o.each({appendTo:\"append\",prependTo:\"prepend\",insertBefore:\"before\",insertAfter:\"after\",replaceAll:\"replaceWith\"},function(E,F){o.fn[E]=function(G){var J=[],L=o(G);for(var K=0,H=L.length;K<H;K++){var I=(K>0?this.clone(true):this).get();o.fn[F].apply(o(L[K]),I);J=J.concat(I)}return this.pushStack(J,E,G)}});o.each({removeAttr:function(E){o.attr(this,E,\"\");if(this.nodeType==1){this.removeAttribute(E)}},addClass:function(E){o.className.add(this,E)},removeClass:function(E){o.className.remove(this,E)},toggleClass:function(F,E){if(typeof E!==\"boolean\"){E=!o.className.has(this,F)}o.className[E?\"add\":\"remove\"](this,F)},remove:function(E){if(!E||o.filter(E,[this]).length){o(\"*\",this).add([this]).each(function(){o.event.remove(this);o.removeData(this)});if(this.parentNode){this.parentNode.removeChild(this)}}},empty:function(){o(this).children().remove();while(this.firstChild){this.removeChild(this.firstChild)}}},function(E,F){o.fn[E]=function(){return this.each(F,arguments)}});function j(E,F){return E[0]&&parseInt(o.curCSS(E[0],F,true),10)||0}var h=\"jQuery\"+e(),v=0,A={};o.extend({cache:{},data:function(F,E,G){F=F==l?A:F;var H=F[h];if(!H){H=F[h]=++v}if(E&&!o.cache[H]){o.cache[H]={}}if(G!==g){o.cache[H][E]=G}return E?o.cache[H][E]:H},removeData:function(F,E){F=F==l?A:F;var H=F[h];if(E){if(o.cache[H]){delete o.cache[H][E];E=\"\";for(E in o.cache[H]){break}if(!E){o.removeData(F)}}}else{try{delete F[h]}catch(G){if(F.removeAttribute){F.removeAttribute(h)}}delete o.cache[H]}},queue:function(F,E,H){if(F){E=(E||\"fx\")+\"queue\";var G=o.data(F,E);if(!G||o.isArray(H)){G=o.data(F,E,o.makeArray(H))}else{if(H){G.push(H)}}}return G},dequeue:function(H,G){var E=o.queue(H,G),F=E.shift();if(!G||G===\"fx\"){F=E[0]}if(F!==g){F.call(H)}}});o.fn.extend({data:function(E,G){var H=E.split(\".\");H[1]=H[1]?\".\"+H[1]:\"\";if(G===g){var F=this.triggerHandler(\"getData\"+H[1]+\"!\",[H[0]]);if(F===g&&this.length){F=o.data(this[0],E)}return F===g&&H[1]?this.data(H[0]):F}else{return this.trigger(\"setData\"+H[1]+\"!\",[H[0],G]).each(function(){o.data(this,E,G)})}},removeData:function(E){return this.each(function(){o.removeData(this,E)})},queue:function(E,F){if(typeof E!==\"string\"){F=E;E=\"fx\"}if(F===g){return o.queue(this[0],E)}return this.each(function(){var G=o.queue(this,E,F);if(E==\"fx\"&&G.length==1){G[0].call(this)}})},dequeue:function(E){return this.each(function(){o.dequeue(this,E)})}});\n"
"/*\n"
" * Sizzle CSS Selector Engine - v0.9.3\n"
" *  Copyright 2009, The Dojo Foundation\n"
" *  Released under the MIT, BSD, and GPL Licenses.\n"
" *  More information: http://sizzlejs.com/\n"
" */\n"
"(function(){var R=/((?:\\((?:\\([^()]+\\)|[^()]+)+\\)|\\[(?:\\[[^[\\]]*\\]|['\"][^'\"]*['\"]|[^[\\]'\"]+)+\\]|\\\\.|[^ >+~,(\\[\\\\]+)+|[>+~])(\\s*,\\s*)?/g,L=0,H=Object.prototype.toString;var F=function(Y,U,ab,ac){ab=ab||[];U=U||document;if(U.nodeType!==1&&U.nodeType!==9){return[]}if(!Y||typeof Y!==\"string\"){return ab}var Z=[],W,af,ai,T,ad,V,X=true;R.lastIndex=0;while((W=R.exec(Y))!==null){Z.push(W[1]);if(W[2]){V=RegExp.rightContext;break}}if(Z.length>1&&M.exec(Y)){if(Z.length===2&&I.relative[Z[0]]){af=J(Z[0]+Z[1],U)}else{af=I.relative[Z[0]]?[U]:F(Z.shift(),U);while(Z.length){Y=Z.shift();if(I.relative[Y]){Y+=Z.shift()}af=J(Y,af)}}}else{var ae=ac?{expr:Z.pop(),set:E(ac)}:F.find(Z.pop(),Z.length===1&&U.parentNode?U.parentNode:U,Q(U));af=F.filter(ae.expr,ae.set);if(Z.length>0){ai=E(af)}else{X=false}while(Z.length){var ah=Z.pop(),ag=ah;if(!I.relative[ah]){ah=\"\"}else{ag=Z.pop()}if(ag==null){ag=U}I.relative[ah](ai,ag,Q(U))}}if(!ai){ai=af}if(!ai){throw\"Syntax error, unrecognized expression: \"+(ah||Y)}if(H.call(ai)===\"[object Array]\"){if(!X){ab.push.apply(ab,ai)}else{if(U.nodeType===1){for(var aa=0;ai[aa]!=null;aa++){if(ai[aa]&&(ai[aa]===true||ai[aa].nodeType===1&&K(U,ai[aa]))){ab.push(af[aa])}}}else{for(var aa=0;ai[aa]!=null;aa++){if(ai[aa]&&ai[aa].nodeType===1){ab.push(af[aa])}}}}}else{E(ai,ab)}if(V){F(V,U,ab,ac);if(G){hasDuplicate=false;ab.sort(G);if(hasDuplicate){for(var aa=1;aa<ab.length;aa++){if(ab[aa]===ab[aa-1]){ab.splice(aa--,1)}}}}}return ab};F.matches=function(T,U){return F(T,null,null,U)};F.find=function(aa,T,ab){var Z,X;if(!aa){return[]}for(var W=0,V=I.order.length;W<V;W++){var Y=I.order[W],X;if((X=I.match[Y].exec(aa))){var U=RegExp.leftContext;if(U.substr(U.length-1)!==\"\\\\\"){X[1]=(X[1]||\"\").replace(/\\\\/g,\"\");Z=I.find[Y](X,T,ab);if(Z!=null){aa=aa.replace(I.match[Y],\"\");break}}}}if(!Z){Z=T.getElementsByTagName(\"*\")}return{set:Z,expr:aa}};F.filter=function(ad,ac,ag,W){var V=ad,ai=[],aa=ac,Y,T,Z=ac&&ac[0]&&Q(ac[0]);while(ad&&ac.length){for(var ab in I.filter){if((Y=I.match[ab].exec(ad))!=null){var U=I.filter[ab],ah,af;T=false;if(aa==ai){ai=[]}if(I.preFilter[ab]){Y=I.preFilter[ab](Y,aa,ag,ai,W,Z);if(!Y){T=ah=true}else{if(Y===true){continue}}}if(Y){for(var X=0;(af=aa[X])!=null;X++){if(af){ah=U(af,Y,X,aa);var ae=W^!!ah;if(ag&&ah!=null){if(ae){T=true}else{aa[X]=false}}else{if(ae){ai.push(af);T=true}}}}}if(ah!==g){if(!ag){aa=ai}ad=ad.replace(I.match[ab],\"\");if(!T){return[]}break}}}if(ad==V){if(T==null){throw\"Syntax error, unrecognized expression: \"+ad}else{break}}V=ad}return aa};var I=F.selectors={order:[\"ID\",\"NAME\",\"TAG\"],match:{ID:/#((?:[\\w\\u00c0-\\uFFFF_-]|\\\\.)+)/,CLASS:/\\.((?:[\\w\\u00c0-\\uFFFF_-]|\\\\.)+)/,NAME:/\\[name=['\"]*((?:[\\w\\u00c0-\\uFFFF_-]|\\\\.)+)['\"]*\\]/,ATTR:/\\[\\s*((?:[\\w\\u00c0-\\uFFFF_-]|\\\\.)+)\\s*(?:(\\S?=)\\s*(['\"]*)(.*?)\\3|)\\s*\\]/,TAG:/^((?:[\\w\\u00c0-\\uFFFF\\*_-]|\\\\.)+)/,CHILD:/:(only|nth|last|first)-child(?:\\((even|odd|[\\dn+-]*)\\))?/,POS:/:(nth|eq|gt|lt|first|last|even|odd)(?:\\((\\d*)\\))?(?=[^-]|$)/,PSEUDO:/:((?:[\\w\\u00c0-\\uFFFF_-]|\\\\.)+)(?:\\((['\"]*)((?:\\([^\\)]+\\)|[^\\2\\(\\)]*)+)\\2\\))?/},attrMap:{\"class\":\"className\",\"for\":\"htmlFor\"},attrHandle:{href:function(T){return T.getAttribute(\"href\")}},relative:{\"+\":function(aa,T,Z){var X=typeof T===\"string\",ab=X&&!/\\W/.test(T),Y=X&&!ab;if(ab&&!Z){T=T.toUpperCase()}for(var W=0,V=aa.length,U;W<V;W++){if((U=aa[W])){while((U=U.previousSibling)&&U.nodeType!==1){}aa[W]=Y||U&&U.nodeName===T?U||false:U===T}}if(Y){F.filter(T,aa,true)}},\">\":function(Z,U,aa){var X=typeof U===\"string\";if(X&&!/\\W/.test(U)){U=aa?U:U.toUpperCase();for(var V=0,T=Z.length;V<T;V++){var Y=Z[V];if(Y){var W=Y.parentNode;Z[V]=W.nodeName===U?W:false}}}else{for(var V=0,T=Z.length;V<T;V++){var Y=Z[V];if(Y){Z[V]=X?Y.parentNode:Y.parentNode===U}}if(X){F.filter(U,Z,true)}}},\"\":function(W,U,Y){var V=L++,T=S;if(!U.match(/\\W/)){var X=U=Y?U:U.toUpperCase();T=P}T(\"parentNode\",U,V,W,X,Y)},\"~\":function(W,U,Y){var V=L++,T=S;if(typeof U===\"string\"&&!U.match(/\\W/)){var X=U=Y?U:U.toUpperCase();T=P}T(\"previousSibling\",U,V,W,X,Y)}},find:{ID:function(U,V,W){if(typeof V.getElementById!==\"undefined\"&&!W){var T=V.getElementById(U[1]);return T?[T]:[]}},NAME:function(V,Y,Z){if(typeof Y.getElementsByName!==\"undefined\"){var U=[],X=Y.getElementsByName(V[1]);for(var W=0,T=X.length;W<T;W++){if(X[W].getAttribute(\"name\")===V[1]){U.push(X[W])}}return U.length===0?null:U}},TAG:function(T,U){return U.getElementsByTagName(T[1])}},preFilter:{CLASS:function(W,U,V,T,Z,aa){W=\" \"+W[1].replace(/\\\\/g,\"\")+\" \";if(aa){return W}for(var X=0,Y;(Y=U[X])!=null;X++){if(Y){if(Z^(Y.className&&(\" \"+Y.className+\" \").indexOf(W)>=0)){if(!V){T.push(Y)}}else{if(V){U[X]=false}}}}return false},ID:function(T){return T[1].replace(/\\\\/g,\"\")},TAG:function(U,T){for(var V=0;T[V]===false;V++){}return T[V]&&Q(T[V])?U[1]:U[1].toUpperCase()},CHILD:function(T){if(T[1]==\"nth\"){var U=/(-?)(\\d*)n((?:\\+|-)?\\d*)/.exec(T[2]==\"even\"&&\"2n\"||T[2]==\"odd\"&&\"2n+1\"||!/\\D/.test(T[2])&&\"0n+\"+T[2]||T[2]);T[2]=(U[1]+(U[2]||1))-0;T[3]=U[3]-0}T[0]=L++;return T},ATTR:function(X,U,V,T,Y,Z){var W=X[1].replace(/\\\\/g,\"\");if(!Z&&I.attrMap[W]){X[1]=I.attrMap[W]}if(X[2]===\"~=\"){X[4]=\" \"+X[4]+\" \"}return X},PSEUDO:function(X,U,V,T,Y){if(X[1]===\"not\"){if(X[3].match(R).length>1||/^\\w/.test(X[3])){X[3]=F(X[3],null,null,U)}else{var W=F.filter(X[3],U,V,true^Y);if(!V){T.push.apply(T,W)}return false}}else{if(I.match.POS.test(X[0])||I.match.CHILD.test(X[0])){return true}}return X},POS:function(T){T.unshift(true);return T}},filters:{enabled:function(T){return T.disabled===false&&T.type!==\"hidden\"},disabled:function(T){return T.disabled===true},checked:function(T){return T.checked===true},selected:function(T){T.parentNode.selectedIndex;return T.selected===true},parent:function(T){return !!T.firstChild},empty:function(T){return !T.firstChild},has:function(V,U,T){return !!F(T[3],V).length},header:function(T){return/h\\d/i.test(T.nodeName)},text:function(T){return\"text\"===T.type},radio:function(T){return\"radio\"===T.type},checkbox:function(T){return\"checkbox\"===T.type},file:function(T){return\"file\"===T.type},password:function(T){return\"password\"===T.type},submit:function(T){return\"submit\"===T.type},image:function(T){return\"image\"===T.type},reset:function(T){return\"reset\"===T.type},button:function(T){return\"button\"===T.type||T.nodeName.toUpperCase()===\"BUTTON\"},input:function(T){return/input|select|textarea|button/i.test(T.nodeName)}},setFilters:{first:function(U,T){return T===0},last:function(V,U,T,W){return U===W.length-1},even:function(U,T){return T%2===0},odd:function(U,T){return T%2===1},lt:function(V,U,T){return U<T[3]-0},gt:function(V,U,T){return U>T[3]-0},nth:function(V,U,T){return T[3]-0==U},eq:function(V,U,T){return T[3]-0==U}},filter:{PSEUDO:function(Z,V,W,aa){var U=V[1],X=I.filters[U];if(X){return X(Z,W,V,aa)}else{if(U===\"contains\"){return(Z.textContent||Z.innerText||\"\").indexOf(V[3])>=0}else{if(U===\"not\"){var Y=V[3];for(var W=0,T=Y.length;W<T;W++){if(Y[W]===Z){return false}}return true}}}},CHILD:function(T,W){var Z=W[1],U=T;switch(Z){case\"only\":case\"first\":while(U=U.previousSibling){if(U.nodeType===1){return false}}if(Z==\"first\"){return true}U=T;case\"last\":while(U=U.nextSibling){if(U.nodeType===1){return false}}return true;case\"nth\":var V=W[2],ac=W[3];if(V==1&&ac==0){return true}var Y=W[0],ab=T.parentNode;if(ab&&(ab.sizcache!==Y||!T.nodeIndex)){var X=0;for(U=ab.firstChild;U;U=U.nextSibling){if(U.nodeType===1){U.nodeIndex=++X}}ab.sizcache=Y}var aa=T.nodeIndex-ac;if(V==0){return aa==0}else{return(aa%V==0&&aa/V>=0)}}},ID:function(U,T){return U.nodeType===1&&U.getAttribute(\"id\")===T},TAG:function(U,T){return(T===\"*\"&&U.nodeType===1)||U.nodeName===T},CLASS:function(U,T){return(\" \"+(U.className||U.getAttribute(\"class\"))+\" \").indexOf(T)>-1},ATTR:function(Y,W){var V=W[1],T=I.attrHandle[V]?I.attrHandle[V](Y):Y[V]!=null?Y[V]:Y.getAttribute(V),Z=T+\"\",X=W[2],U=W[4];return T==null?X===\"!=\":X===\"=\"?Z===U:X===\"*=\"?Z.indexOf(U)>=0:X===\"~=\"?(\" \"+Z+\" \").indexOf(U)>=0:!U?Z&&T!==false:X===\"!=\"?Z!=U:X===\"^=\"?Z.indexOf(U)===0:X===\"$=\"?Z.substr(Z.length-U.length)===U:X===\"|=\"?Z===U||Z.substr(0,U.length+1)===U+\"-\":false},POS:function(X,U,V,Y){var T=U[2],W=I.setFilters[T];if(W){return W(X,V,U,Y)}}}};var M=I.match.POS;for(var O in I.match){I.match[O]=RegExp(I.match[O].source+/(?![^\\[]*\\])(?![^\\(]*\\))/.source)}var E=function(U,T){U=Array.prototype.slice.call(U);if(T){T.push.apply(T,U);return T}return U};try{Array.prototype.slice.call(document.documentElement.childNodes)}catch(N){E=function(X,W){var U=W||[];if(H.call(X)===\"[object Array]\"){Array.prototype.push.apply(U,X)}else{if(typeof X.length===\"number\"){for(var V=0,T=X.length;V<T;V++){U.push(X[V])}}else{for(var V=0;X[V];V++){U.push(X[V])}}}return U}}var G;if(document.documentElement.compareDocumentPosition){G=function(U,T){var V=U.compareDocumentPosition(T)&4?-1:U===T?0:1;if(V===0){hasDuplicate=true}return V}}else{if(\"sourceIndex\" in document.documentElement){G=function(U,T){var V=U.sourceIndex-T.sourceIndex;if(V===0){hasDuplicate=true}return V}}else{if(document.createRange){G=function(W,U){var V=W.ownerDocument.createRange(),T=U.ownerDocument.createRange();V.selectNode(W);V.collapse(true);T.selectNode(U);T.collapse(true);var X=V.compareBoundaryPoints(Range.START_TO_END,T);if(X===0){hasDuplicate=true}return X}}}}(function(){var U=document.createElement(\"form\"),V=\"script\"+(new Date).getTime();U.innerHTML=\"<input name='\"+V+\"'/>\";var T=document.documentElement;T.insertBefore(U,T.firstChild);if(!!document.getElementById(V)){I.find.ID=function(X,Y,Z){if(typeof Y.getElementById!==\"undefined\"&&!Z){var W=Y.getElementById(X[1]);return W?W.id===X[1]||typeof W.getAttributeNode!==\"undefined\"&&W.getAttributeNode(\"id\").nodeValue===X[1]?[W]:g:[]}};I.filter.ID=function(Y,W){var X=typeof Y.getAttributeNode!==\"undefined\"&&Y.getAttributeNode(\"id\");return Y.nodeType===1&&X&&X.nodeValue===W}}T.removeChild(U)})();(function(){var T=document.createElement(\"div\");T.appendChild(document.createComment(\"\"));if(T.getElementsByTagName(\"*\").length>0){I.find.TAG=function(U,Y){var X=Y.getElementsByTagName(U[1]);if(U[1]===\"*\"){var W=[];for(var V=0;X[V];V++){if(X[V].nodeType===1){W.push(X[V])}}X=W}return X}}T.innerHTML=\"<a href='#'></a>\";if(T.firstChild&&typeof T.firstChild.getAttribute!==\"undefined\"&&T.firstChild.getAttribute(\"href\")!==\"#\"){I.attrHandle.href=function(U){return U.getAttribute(\"href\",2)}}})();if(document.querySelectorAll){(function(){var T=F,U=document.createElement(\"div\");U.innerHTML=\"<p class='TEST'></p>\";if(U.querySelectorAll&&U.querySelectorAll(\".TEST\").length===0){return}F=function(Y,X,V,W){X=X||document;if(!W&&X.nodeType===9&&!Q(X)){try{return E(X.querySelectorAll(Y),V)}catch(Z){}}return T(Y,X,V,W)};F.find=T.find;F.filter=T.filter;F.selectors=T.selectors;F.matches=T.matches})()}if(document.getElementsByClassName&&document.documentElement.getElementsByClassName){(function(){var T=document.createElement(\"div\");T.innerHTML=\"<div class='test e'></div><div class='test'></div>\";if(T.getElementsByClassName(\"e\").length===0){return}T.lastChild.className=\"e\";if(T.getElementsByClassName(\"e\").length===1){return}I.order.splice(1,0,\"CLASS\");I.find.CLASS=function(U,V,W){if(typeof V.getElementsByClassName!==\"undefined\"&&!W){return V.getElementsByClassName(U[1])}}})()}function P(U,Z,Y,ad,aa,ac){var ab=U==\"previousSibling\"&&!ac;for(var W=0,V=ad.length;W<V;W++){var T=ad[W];if(T){if(ab&&T.nodeType===1){T.sizcache=Y;T.sizset=W}T=T[U];var X=false;while(T){if(T.sizcache===Y){X=ad[T.sizset];break}if(T.nodeType===1&&!ac){T.sizcache=Y;T.sizset=W}if(T.nodeName===Z){X=T;break}T=T[U]}ad[W]=X}}}function S(U,Z,Y,ad,aa,ac){var ab=U==\"previousSibling\"&&!ac;for(var W=0,V=ad.length;W<V;W++){var T=ad[W];if(T){if(ab&&T.nodeType===1){T.sizcache=Y;T.sizset=W}T=T[U];var X=false;while(T){if(T.sizcache===Y){X=ad[T.sizset];break}if(T.nodeType===1){if(!ac){T.sizcache=Y;T.sizset=W}if(typeof Z!==\"string\"){if(T===Z){X=true;break}}else{if(F.filter(Z,[T]).length>0){X=T;break}}}T=T[U]}ad[W]=X}}}var K=document.compareDocumentPosition?function(U,T){return U.compareDocumentPosition(T)&16}:function(U,T){return U!==T&&(U.contains?U.contains(T):true)};var Q=function(T){return T.nodeType===9&&T.documentElement.nodeName!==\"HTML\"||!!T.ownerDocument&&Q(T.ownerDocument)};var J=function(T,aa){var W=[],X=\"\",Y,V=aa.nodeType?[aa]:aa;while((Y=I.match.PSEUDO.exec(T))){X+=Y[0];T=T.replace(I.match.PSEUDO,\"\")}T=I.relative[T]?T+\"*\":T;for(var Z=0,U=V.length;Z<U;Z++){F(T,V[Z],W)}return F.filter(X,W)};o.find=F;o.filter=F.filter;o.expr=F.selectors;o.expr[\":\"]=o.expr.filters;F.selectors.filters.hidden=function(T){return T.offsetWidth===0||T.offsetHeight===0};F.selectors.filters.visible=function(T){return T.offsetWidth>0||T.offsetHeight>0};F.selectors.filters.animated=function(T){return o.grep(o.timers,function(U){return T===U.elem}).length};o.multiFilter=function(V,T,U){if(U){V=\":not(\"+V+\")\"}return F.matches(V,T)};o.dir=function(V,U){var T=[],W=V[U];while(W&&W!=document){if(W.nodeType==1){T.push(W)}W=W[U]}return T};o.nth=function(X,T,V,W){T=T||1;var U=0;for(;X;X=X[V]){if(X.nodeType==1&&++U==T){break}}return X};o.sibling=function(V,U){var T=[];for(;V;V=V.nextSibling){if(V.nodeType==1&&V!=U){T.push(V)}}return T};return;l.Sizzle=F})();o.event={add:function(I,F,H,K){if(I.nodeType==3||I.nodeType==8){return}if(I.setInterval&&I!=l){I=l}if(!H.guid){H.guid=this.guid++}if(K!==g){var G=H;H=this.proxy(G);H.data=K}var E=o.data(I,\"events\")||o.data(I,\"events\",{}),J=o.data(I,\"handle\")||o.data(I,\"handle\",function(){return typeof o!==\"undefined\"&&!o.event.triggered?o.event.handle.apply(arguments.callee.elem,arguments):g});J.elem=I;o.each(F.split(/\\s+/),function(M,N){var O=N.split(\".\");N=O.shift();H.type=O.slice().sort().join(\".\");var L=E[N];if(o.event.specialAll[N]){o.event.specialAll[N].setup.call(I,K,O)}if(!L){L=E[N]={};if(!o.event.special[N]||o.event.special[N].setup.call(I,K,O)===false){if(I.addEventListener){I.addEventListener(N,J,false)}else{if(I.attachEvent){I.attachEvent(\"on\"+N,J)}}}}L[H.guid]=H;o.event.global[N]=true});I=null},guid:1,global:{},remove:function(K,H,J){if(K.nodeType==3||K.nodeType==8){return}var G=o.data(K,\"events\"),F,E;if(G){if(H===g||(typeof H===\"string\"&&H.charAt(0)==\".\")){for(var I in G){this.remove(K,I+(H||\"\"))}}else{if(H.type){J=H.handler;H=H.type}o.each(H.split(/\\s+/),function(M,O){var Q=O.split(\".\");O=Q.shift();var N=RegExp(\"(^|\\\\.)\"+Q.slice().sort().join(\".*\\\\.\")+\"(\\\\.|$)\");if(G[O]){if(J){delete G[O][J.guid]}else{for(var P in G[O]){if(N.test(G[O][P].type)){delete G[O][P]}}}if(o.event.specialAll[O]){o.event.specialAll[O].teardown.call(K,Q)}for(F in G[O]){break}if(!F){if(!o.event.special[O]||o.event.special[O].teardown.call(K,Q)===false){if(K.removeEventListener){K.removeEventListener(O,o.data(K,\"handle\"),false)}else{if(K.detachEvent){K.detachEvent(\"on\"+O,o.data(K,\"handle\"))}}}F=null;delete G[O]}}})}for(F in G){break}if(!F){var L=o.data(K,\"handle\");if(L){L.elem=null}o.removeData(K,\"events\");o.removeData(K,\"handle\")}}},trigger:function(I,K,H,E){var G=I.type||I;if(!E){I=typeof I===\"object\"?I[h]?I:o.extend(o.Event(G),I):o.Event(G);if(G.indexOf(\"!\")>=0){I.type=G=G.slice(0,-1);I.exclusive=true}if(!H){I.stopPropagation();if(this.global[G]){o.each(o.cache,function(){if(this.events&&this.events[G]){o.event.trigger(I,K,this.handle.elem)}})}}if(!H||H.nodeType==3||H.nodeType==8){return g}I.result=g;I.target=H;K=o.makeArray(K);K.unshift(I)}I.currentTarget=H;var J=o.data(H,\"handle\");if(J){J.apply(H,K)}if((!H[G]||(o.nodeName(H,\"a\")&&G==\"click\"))&&H[\"on\"+G]&&H[\"on\"+G].apply(H,K)===false){I.result=false}if(!E&&H[G]&&!I.isDefaultPrevented()&&!(o.nodeName(H,\"a\")&&G==\"click\")){this.triggered=true;try{H[G]()}catch(L){}}this.triggered=false;if(!I.isPropagationStopped()){var F=H.parentNode||H.ownerDocument;if(F){o.event.trigger(I,K,F,true)}}},handle:function(K){var J,E;K=arguments[0]=o.event.fix(K||l.event);K.currentTarget=this;var L=K.type.split(\".\");K.type=L.shift();J=!L.length&&!K.exclusive;var I=RegExp(\"(^|\\\\.)\"+L.slice().sort().join(\".*\\\\.\")+\"(\\\\.|$)\");E=(o.data(this,\"events\")||{})[K.type];for(var G in E){var H=E[G];if(J||I.test(H.type)){K.handler=H;K.data=H.data;var F=H.apply(this,arguments);if(F!==g){K.result=F;if(F===false){K.preventDefault();K.stopPropagation()}}if(K.isImmediatePropagationStopped()){break}}}},props:\"altKey attrChange attrName bubbles button cancelable charCode clientX clientY ctrlKey currentTarget data detail eventPhase fromElement handler keyCode metaKey newValue originalTarget pageX pageY prevValue relatedNode relatedTarget screenX screenY shiftKey srcElement target toElement view wheelDelta which\".split(\" \"),fix:function(H){if(H[h]){return H}var F=H;H=o.Event(F);for(var G=this.props.length,J;G;){J=this.props[--G];H[J]=F[J]}if(!H.target){H.target=H.srcElement||document}if(H.target.nodeType==3){H.target=H.target.parentNode}if(!H.relatedTarget&&H.fromElement){H.relatedTarget=H.fromElement==H.target?H.toElement:H.fromElement}if(H.pageX==null&&H.clientX!=null){var I=document.documentElement,E=document.body;H.pageX=H.clientX+(I&&I.scrollLeft||E&&E.scrollLeft||0)-(I.clientLeft||0);H.pageY=H.clientY+(I&&I.scrollTop||E&&E.scrollTop||0)-(I.clientTop||0)}if(!H.which&&((H.charCode||H.charCode===0)?H.charCode:H.keyCode)){H.which=H.charCode||H.keyCode}if(!H.metaKey&&H.ctrlKey){H.metaKey=H.ctrlKey}if(!H.which&&H.button){H.which=(H.button&1?1:(H.button&2?3:(H.button&4?2:0)))}return H},proxy:function(F,E){E=E||function(){return F.apply(this,arguments)};E.guid=F.guid=F.guid||E.guid||this.guid++;return E},special:{ready:{setup:B,teardown:function(){}}},specialAll:{live:{setup:function(E,F){o.event.add(this,F[0],c)},teardown:function(G){if(G.length){var E=0,F=RegExp(\"(^|\\\\.)\"+G[0]+\"(\\\\.|$)\");o.each((o.data(this,\"events\").live||{}),function(){if(F.test(this.type)){E++}});if(E<1){o.event.remove(this,G[0],c)}}}}}};o.Event=function(E){if(!this.preventDefault){return new o.Event(E)}if(E&&E.type){this.originalEvent=E;this.type=E.type}else{this.type=E}this.timeStamp=e();this[h]=true};function k(){return false}function u(){return true}o.Event.prototype={preventDefault:function(){this.isDefaultPrevented=u;var E=this.originalEvent;if(!E){return}if(E.preventDefault){E.preventDefault()}E.returnValue=false},stopPropagation:function(){this.isPropagationStopped=u;var E=this.originalEvent;if(!E){return}if(E.stopPropagation){E.stopPropagation()}E.cancelBubble=true},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=u;this.stopPropagation()},isDefaultPrevented:k,isPropagationStopped:k,isImmediatePropagationStopped:k};var a=function(F){var E=F.relatedTarget;while(E&&E!=this){try{E=E.parentNode}catch(G){E=this}}if(E!=this){F.type=F.data;o.event.handle.apply(this,arguments)}};o.each({mouseover:\"mouseenter\",mouseout:\"mouseleave\"},function(F,E){o.event.special[E]={setup:function(){o.event.add(this,F,a,E)},teardown:function(){o.event.remove(this,F,a)}}});o.fn.extend({bind:function(F,G,E){return F==\"unload\"?this.one(F,G,E):this.each(function(){o.event.add(this,F,E||G,E&&G)})},one:function(G,H,F){var E=o.event.proxy(F||H,function(I){o(this).unbind(I,E);return(F||H).apply(this,arguments)});return this.each(function(){o.event.add(this,G,E,F&&H)})},unbind:function(F,E){return this.each(function(){o.event.remove(this,F,E)})},trigger:function(E,F){return this.each(function(){o.event.trigger(E,F,this)})},triggerHandler:function(E,G){if(this[0]){var F=o.Event(E);F.preventDefault();F.stopPropagation();o.event.trigger(F,G,this[0]);return F.result}},toggle:function(G){var E=arguments,F=1;while(F<E.length){o.event.proxy(G,E[F++])}return this.click(o.event.proxy(G,function(H){this.lastToggle=(this.lastToggle||0)%F;H.preventDefault();return E[this.lastToggle++].apply(this,arguments)||false}))},hover:function(E,F){return this.mouseenter(E).mouseleave(F)},ready:function(E){B();if(o.isReady){E.call(document,o)}else{o.readyList.push(E)}return this},live:function(G,F){var E=o.event.proxy(F);E.guid+=this.selector+G;o(document).bind(i(G,this.selector),this.selector,E);return this},die:function(F,E){o(document).unbind(i(F,this.selector),E?{guid:E.guid+this.selector+F}:null);return this}});function c(H){var E=RegExp(\"(^|\\\\.)\"+H.type+\"(\\\\.|$)\"),G=true,F=[];o.each(o.data(this,\"events\").live||[],function(I,J){if(E.test(J.type)){var K=o(H.target).closest(J.data)[0];if(K){F.push({elem:K,fn:J})}}});F.sort(function(J,I){return o.data(J.elem,\"closest\")-o.data(I.elem,\"closest\")});o.each(F,function(){if(this.fn.call(this.elem,H,this.fn.data)===false){return(G=false)}});return G}function i(F,E){return[\"live\",F,E.replace(/\\./g,\"`\").replace(/ /g,\"|\")].join(\".\")}o.extend({isReady:false,readyList:[],ready:function(){if(!o.isReady){o.isReady=true;if(o.readyList){o.each(o.readyList,function(){this.call(document,o)});o.readyList=null}o(document).triggerHandler(\"ready\")}}});var x=false;function B(){if(x){return}x=true;if(document.addEventListener){document.addEventListener(\"DOMContentLoaded\",function(){document.removeEventListener(\"DOMContentLoaded\",arguments.callee,false);o.ready()},false)}else{if(document.attachEvent){document.attachEvent(\"onreadystatechange\",function(){if(document.readyState===\"complete\"){document.detachEvent(\"onreadystatechange\",arguments.callee);o.ready()}});if(document.documentElement.doScroll&&l==l.top){(function(){if(o.isReady){return}try{document.documentElement.doScroll(\"left\")}catch(E){setTimeout(arguments.callee,0);return}o.ready()})()}}}o.event.add(l,\"load\",o.ready)}o.each((\"blur,focus,load,resize,scroll,unload,click,dblclick,mousedown,mouseup,mousemove,mouseover,mouseout,mouseenter,mouseleave,change,select,submit,keydown,keypress,keyup,error\").split(\",\"),function(F,E){o.fn[E]=function(G){return G?this.bind(E,G):this.trigger(E)}});o(l).bind(\"unload\",function(){for(var E in o.cache){if(E!=1&&o.cache[E].handle){o.event.remove(o.cache[E].handle.elem)}}});(function(){o.support={};var F=document.documentElement,G=document.createElement(\"script\"),K=document.createElement(\"div\"),J=\"script\"+(new Date).getTime();K.style.display=\"none\";K.innerHTML='   <link/><table></table><a href=\"/a\" style=\"color:red;float:left;opacity:.5;\">a</a><select><option>text</option></select><object><param/></object>';var H=K.getElementsByTagName(\"*\"),E=K.getElementsByTagName(\"a\")[0];if(!H||!H.length||!E){return}o.support={leadingWhitespace:K.firstChild.nodeType==3,tbody:!K.getElementsByTagName(\"tbody\").length,objectAll:!!K.getElementsByTagName(\"object\")[0].getElementsByTagName(\"*\").length,htmlSerialize:!!K.getElementsByTagName(\"link\").length,style:/red/.test(E.getAttribute(\"style\")),hrefNormalized:E.getAttribute(\"href\")===\"/a\",opacity:E.style.opacity===\"0.5\",cssFloat:!!E.style.cssFloat,scriptEval:false,noCloneEvent:true,boxModel:null};G.type=\"text/javascript\";try{G.appendChild(document.createTextNode(\"window.\"+J+\"=1;\"))}catch(I){}F.insertBefore(G,F.firstChild);if(l[J]){o.support.scriptEval=true;delete l[J]}F.removeChild(G);if(K.attachEvent&&K.fireEvent){K.attachEvent(\"onclick\",function(){o.support.noCloneEvent=false;K.detachEvent(\"onclick\",arguments.callee)});K.cloneNode(true).fireEvent(\"onclick\")}o(function(){var L=document.createElement(\"div\");L.style.width=L.style.paddingLeft=\"1px\";document.body.appendChild(L);o.boxModel=o.support.boxModel=L.offsetWidth===2;document.body.removeChild(L).style.display=\"none\"})})();var w=o.support.cssFloat?\"cssFloat\":\"styleFloat\";o.props={\"for\":\"htmlFor\",\"class\":\"className\",\"float\":w,cssFloat:w,styleFloat:w,readonly:\"readOnly\",maxlength:\"maxLength\",cellspacing:\"cellSpacing\",rowspan:\"rowSpan\",tabindex:\"tabIndex\"};o.fn.extend({_load:o.fn.load,load:function(G,J,K){if(typeof G!==\"string\"){return this._load(G)}var I=G.indexOf(\" \");if(I>=0){var E=G.slice(I,G.length);G=G.slice(0,I)}var H=\"GET\";if(J){if(o.isFunction(J)){K=J;J=null}else{if(typeof J===\"object\"){J=o.param(J);H=\"POST\"}}}var F=this;o.ajax({url:G,type:H,dataType:\"html\",data:J,complete:function(M,L){if(L==\"success\"||L==\"notmodified\"){F.html(E?o(\"<div/>\").append(M.responseText.replace(/<script(.|\\s)*?\\/script>/g,\"\")).find(E):M.responseText)}if(K){F.each(K,[M.responseText,L,M])}}});return this},serialize:function(){return o.param(this.serializeArray())},serializeArray:function(){return this.map(function(){return this.elements?o.makeArray(this.elements):this}).filter(function(){return this.name&&!this.disabled&&(this.checked||/select|textarea/i.test(this.nodeName)||/text|hidden|password|search/i.test(this.type))}).map(function(E,F){var G=o(this).val();return G==null?null:o.isArray(G)?o.map(G,function(I,H){return{name:F.name,value:I}}):{name:F.name,value:G}}).get()}});o.each(\"ajaxStart,ajaxStop,ajaxComplete,ajaxError,ajaxSuccess,ajaxSend\".split(\",\"),function(E,F){o.fn[F]=function(G){return this.bind(F,G)}});var r=e();o.extend({get:function(E,G,H,F){if(o.isFunction(G)){H=G;G=null}return o.ajax({type:\"GET\",url:E,data:G,success:H,dataType:F})},getScript:function(E,F){return o.get(E,null,F,\"script\")},getJSON:function(E,F,G){return o.get(E,F,G,\"json\")},post:function(E,G,H,F){if(o.isFunction(G)){H=G;G={}}return o.ajax({type:\"POST\",url:E,data:G,success:H,dataType:F})},ajaxSetup:function(E){o.extend(o.ajaxSettings,E)},ajaxSettings:{url:location.href,global:true,type:\"GET\",contentType:\"application/x-www-form-urlencoded\",processData:true,async:true,xhr:function(){return l.ActiveXObject?new ActiveXObject(\"Microsoft.XMLHTTP\"):new XMLHttpRequest()},accepts:{xml:\"application/xml, text/xml\",html:\"text/html\",script:\"text/javascript, application/javascript\",json:\"application/json, text/javascript\",text:\"text/plain\",_default:\"*/*\"}},lastModified:{},ajax:function(M){M=o.extend(true,M,o.extend(true,{},o.ajaxSettings,M));var W,F=/=\\?(&|$)/g,R,V,G=M.type.toUpperCase();if(M.data&&M.processData&&typeof M.data!==\"string\"){M.data=o.param(M.data)}if(M.dataType==\"jsonp\"){if(G==\"GET\"){if(!M.url.match(F)){M.url+=(M.url.match(/\\?/)?\"&\":\"?\")+(M.jsonp||\"callback\")+\"=?\"}}else{if(!M.data||!M.data.match(F)){M.data=(M.data?M.data+\"&\":\"\")+(M.jsonp||\"callback\")+\"=?\"}}M.dataType=\"json\"}if(M.dataType==\"json\"&&(M.data&&M.data.match(F)||M.url.match(F))){W=\"jsonp\"+r++;if(M.data){M.data=(M.data+\"\").replace(F,\"=\"+W+\"$1\")}M.url=M.url.replace(F,\"=\"+W+\"$1\");M.dataType=\"script\";l[W]=function(X){V=X;I();L();l[W]=g;try{delete l[W]}catch(Y){}if(H){H.removeChild(T)}}}if(M.dataType==\"script\"&&M.cache==null){M.cache=false}if(M.cache===false&&G==\"GET\"){var E=e();var U=M.url.replace(/(\\?|&)_=.*?(&|$)/,\"$1_=\"+E+\"$2\");M.url=U+((U==M.url)?(M.url.match(/\\?/)?\"&\":\"?\")+\"_=\"+E:\"\")}if(M.data&&G==\"GET\"){M.url+=(M.url.match(/\\?/)?\"&\":\"?\")+M.data;M.data=null}if(M.global&&!o.active++){o.event.trigger(\"ajaxStart\")}var Q=/^(\\w+:)?\\/\\/([^\\/?#]+)/.exec(M.url);if(M.dataType==\"script\"&&G==\"GET\"&&Q&&(Q[1]&&Q[1]!=location.protocol||Q[2]!=location.host)){var H=document.getElementsByTagName(\"head\")[0];var T=document.createElement(\"script\");T.src=M.url;if(M.scriptCharset){T.charset=M.scriptCharset}if(!W){var O=false;T.onload=T.onreadystatechange=function(){if(!O&&(!this.readyState||this.readyState==\"loaded\"||this.readyState==\"complete\")){O=true;I();L();T.onload=T.onreadystatechange=null;H.removeChild(T)}}}H.appendChild(T);return g}var K=false;var J=M.xhr();if(M.username){J.open(G,M.url,M.async,M.username,M.password)}else{J.open(G,M.url,M.async)}try{if(M.data){J.setRequestHeader(\"Content-Type\",M.contentType)}if(M.ifModified){J.setRequestHeader(\"If-Modified-Since\",o.lastModified[M.url]||\"Thu, 01 Jan 1970 00:00:00 GMT\")}J.setRequestHeader(\"X-Requested-With\",\"XMLHttpRequest\");J.setRequestHeader(\"Accept\",M.dataType&&M.accepts[M.dataType]?M.accepts[M.dataType]+\", */*\":M.accepts._default)}catch(S){}if(M.beforeSend&&M.beforeSend(J,M)===false){if(M.global&&!--o.active){o.event.trigger(\"ajaxStop\")}J.abort();return false}if(M.global){o.event.trigger(\"ajaxSend\",[J,M])}var N=function(X){if(J.readyState==0){if(P){clearInterval(P);P=null;if(M.global&&!--o.active){o.event.trigger(\"ajaxStop\")}}}else{if(!K&&J&&(J.readyState==4||X==\"timeout\")){K=true;if(P){clearInterval(P);P=null}R=X==\"timeout\"?\"timeout\":!o.httpSuccess(J)?\"error\":M.ifModified&&o.httpNotModified(J,M.url)?\"notmodified\":\"success\";if(R==\"success\"){try{V=o.httpData(J,M.dataType,M)}catch(Z){R=\"parsererror\"}}if(R==\"success\"){var Y;try{Y=J.getResponseHeader(\"Last-Modified\")}catch(Z){}if(M.ifModified&&Y){o.lastModified[M.url]=Y}if(!W){I()}}else{o.handleError(M,J,R)}L();if(X){J.abort()}if(M.async){J=null}}}};if(M.async){var P=setInterval(N,13);if(M.timeout>0){setTimeout(function(){if(J&&!K){N(\"timeout\")}},M.timeout)}}try{J.send(M.data)}catch(S){o.handleError(M,J,null,S)}if(!M.async){N()}function I(){if(M.success){M.success(V,R)}if(M.global){o.event.trigger(\"ajaxSuccess\",[J,M])}}function L(){if(M.complete){M.complete(J,R)}if(M.global){o.event.trigger(\"ajaxComplete\",[J,M])}if(M.global&&!--o.active){o.event.trigger(\"ajaxStop\")}}return J},handleError:function(F,H,E,G){if(F.error){F.error(H,E,G)}if(F.global){o.event.trigger(\"ajaxError\",[H,F,G])}},active:0,httpSuccess:function(F){try{return !F.status&&location.protocol==\"file:\"||(F.status>=200&&F.status<300)||F.status==304||F.status==1223}catch(E){}return false},httpNotModified:function(G,E){try{var H=G.getResponseHeader(\"Last-Modified\");return G.status==304||H==o.lastModified[E]}catch(F){}return false},httpData:function(J,H,G){var F=J.getResponseHeader(\"content-type\"),E=H==\"xml\"||!H&&F&&F.indexOf(\"xml\")>=0,I=E?J.responseXML:J.responseText;if(E&&I.documentElement.tagName==\"parsererror\"){throw\"parsererror\"}if(G&&G.dataFilter){I=G.dataFilter(I,H)}if(typeof I===\"string\"){if(H==\"script\"){o.globalEval(I)}if(H==\"json\"){I=l[\"eval\"](\"(\"+I+\")\")}}return I},param:function(E){var G=[];function H(I,J){G[G.length]=encodeURIComponent(I)+\"=\"+encodeURIComponent(J)}if(o.isArray(E)||E.jquery){o.each(E,function(){H(this.name,this.value)})}else{for(var F in E){if(o.isArray(E[F])){o.each(E[F],function(){H(F,this)})}else{H(F,o.isFunction(E[F])?E[F]():E[F])}}}return G.join(\"&\").replace(/%20/g,\"+\")}});var m={},n,d=[[\"height\",\"marginTop\",\"marginBottom\",\"paddingTop\",\"paddingBottom\"],[\"width\",\"marginLeft\",\"marginRight\",\"paddingLeft\",\"paddingRight\"],[\"opacity\"]];function t(F,E){var G={};o.each(d.concat.apply([],d.slice(0,E)),function(){G[this]=F});return G}o.fn.extend({show:function(J,L){if(J){return this.animate(t(\"show\",3),J,L)}else{for(var H=0,F=this.length;H<F;H++){var E=o.data(this[H],\"olddisplay\");this[H].style.display=E||\"\";if(o.css(this[H],\"display\")===\"none\"){var G=this[H].tagName,K;if(m[G]){K=m[G]}else{var I=o(\"<\"+G+\" />\").appendTo(\"body\");K=I.css(\"display\");if(K===\"none\"){K=\"block\"}I.remove();m[G]=K}o.data(this[H],\"olddisplay\",K)}}for(var H=0,F=this.length;H<F;H++){this[H].style.display=o.data(this[H],\"olddisplay\")||\"\"}return this}},hide:function(H,I){if(H){return this.animate(t(\"hide\",3),H,I)}else{for(var G=0,F=this.length;G<F;G++){var E=o.data(this[G],\"olddisplay\");if(!E&&E!==\"none\"){o.data(this[G],\"olddisplay\",o.css(this[G],\"display\"))}}for(var G=0,F=this.length;G<F;G++){this[G].style.display=\"none\"}return this}},_toggle:o.fn.toggle,toggle:function(G,F){var E=typeof G===\"boolean\";return o.isFunction(G)&&o.isFunction(F)?this._toggle.apply(this,arguments):G==null||E?this.each(function(){var H=E?G:o(this).is(\":hidden\");o(this)[H?\"show\":\"hide\"]()}):this.animate(t(\"toggle\",3),G,F)},fadeTo:function(E,G,F){return this.animate({opacity:G},E,F)},animate:function(I,F,H,G){var E=o.speed(F,H,G);return this[E.queue===false?\"each\":\"queue\"](function(){var K=o.extend({},E),M,L=this.nodeType==1&&o(this).is(\":hidden\"),J=this;for(M in I){if(I[M]==\"hide\"&&L||I[M]==\"show\"&&!L){return K.complete.call(this)}if((M==\"height\"||M==\"width\")&&this.style){K.display=o.css(this,\"display\");K.overflow=this.style.overflow}}if(K.overflow!=null){this.style.overflow=\"hidden\"}K.curAnim=o.extend({},I);o.each(I,function(O,S){var R=new o.fx(J,K,O);if(/toggle|show|hide/.test(S)){R[S==\"toggle\"?L?\"show\":\"hide\":S](I)}else{var Q=S.toString().match(/^([+-]=)?([\\d+-.]+)(.*)$/),T=R.cur(true)||0;if(Q){var N=parseFloat(Q[2]),P=Q[3]||\"px\";if(P!=\"px\"){J.style[O]=(N||1)+P;T=((N||1)/R.cur(true))*T;J.style[O]=T+P}if(Q[1]){N=((Q[1]==\"-=\"?-1:1)*N)+T}R.custom(T,N,P)}else{R.custom(T,S,\"\")}}});return true})},stop:function(F,E){var G=o.timers;if(F){this.queue([])}this.each(function(){for(var H=G.length-1;H>=0;H--){if(G[H].elem==this){if(E){G[H](true)}G.splice(H,1)}}});if(!E){this.dequeue()}return this}});o.each({slideDown:t(\"show\",1),slideUp:t(\"hide\",1),slideToggle:t(\"toggle\",1),fadeIn:{opacity:\"show\"},fadeOut:{opacity:\"hide\"}},function(E,F){o.fn[E]=function(G,H){return this.animate(F,G,H)}});o.extend({speed:function(G,H,F){var E=typeof G===\"object\"?G:{complete:F||!F&&H||o.isFunction(G)&&G,duration:G,easing:F&&H||H&&!o.isFunction(H)&&H};E.duration=o.fx.off?0:typeof E.duration===\"number\"?E.duration:o.fx.speeds[E.duration]||o.fx.speeds._default;E.old=E.complete;E.complete=function(){if(E.queue!==false){o(this).dequeue()}if(o.isFunction(E.old)){E.old.call(this)}};return E},easing:{linear:function(G,H,E,F){return E+F*G},swing:function(G,H,E,F){return((-Math.cos(G*Math.PI)/2)+0.5)*F+E}},timers:[],fx:function(F,E,G){this.options=E;this.elem=F;this.prop=G;if(!E.orig){E.orig={}}}});o.fx.prototype={update:function(){if(this.options.step){this.options.step.call(this.elem,this.now,this)}(o.fx.step[this.prop]||o.fx.step._default)(this);if((this.prop==\"height\"||this.prop==\"width\")&&this.elem.style){this.elem.style.display=\"block\"}},cur:function(F){if(this.elem[this.prop]!=null&&(!this.elem.style||this.elem.style[this.prop]==null)){return this.elem[this.prop]}var E=parseFloat(o.css(this.elem,this.prop,F));return E&&E>-10000?E:parseFloat(o.curCSS(this.elem,this.prop))||0},custom:function(I,H,G){this.startTime=e();this.start=I;this.end=H;this.unit=G||this.unit||\"px\";this.now=this.start;this.pos=this.state=0;var E=this;function F(J){return E.step(J)}F.elem=this.elem;if(F()&&o.timers.push(F)&&!n){n=setInterval(function(){var K=o.timers;for(var J=0;J<K.length;J++){if(!K[J]()){K.splice(J--,1)}}if(!K.length){clearInterval(n);n=g}},13)}},show:function(){this.options.orig[this.prop]=o.attr(this.elem.style,this.prop);this.options.show=true;this.custom(this.prop==\"width\"||this.prop==\"height\"?1:0,this.cur());o(this.elem).show()},hide:function(){this.options.orig[this.prop]=o.attr(this.elem.style,this.prop);this.options.hide=true;this.custom(this.cur(),0)},step:function(H){var G=e();if(H||G>=this.options.duration+this.startTime){this.now=this.end;this.pos=this.state=1;this.update();this.options.curAnim[this.prop]=true;var E=true;for(var F in this.options.curAnim){if(this.options.curAnim[F]!==true){E=false}}if(E){if(this.options.display!=null){this.elem.style.overflow=this.options.overflow;this.elem.style.display=this.options.display;if(o.css(this.elem,\"display\")==\"none\"){this.elem.style.display=\"block\"}}if(this.options.hide){o(this.elem).hide()}if(this.options.hide||this.options.show){for(var I in this.options.curAnim){o.attr(this.elem.style,I,this.options.orig[I])}}this.options.complete.call(this.elem)}return false}else{var J=G-this.startTime;this.state=J/this.options.duration;this.pos=o.easing[this.options.easing||(o.easing.swing?\"swing\":\"linear\")](this.state,J,0,1,this.options.duration);this.now=this.start+((this.end-this.start)*this.pos);this.update()}return true}};o.extend(o.fx,{speeds:{slow:600,fast:200,_default:400},step:{opacity:function(E){o.attr(E.elem.style,\"opacity\",E.now)},_default:function(E){if(E.elem.style&&E.elem.style[E.prop]!=null){E.elem.style[E.prop]=E.now+E.unit}else{E.elem[E.prop]=E.now}}}});if(document.documentElement.getBoundingClientRect){o.fn.offset=function(){if(!this[0]){return{top:0,left:0}}if(this[0]===this[0].ownerDocument.body){return o.offset.bodyOffset(this[0])}var G=this[0].getBoundingClientRect(),J=this[0].ownerDocument,F=J.body,E=J.documentElement,L=E.clientTop||F.clientTop||0,K=E.clientLeft||F.clientLeft||0,I=G.top+(self.pageYOffset||o.boxModel&&E.scrollTop||F.scrollTop)-L,H=G.left+(self.pageXOffset||o.boxModel&&E.scrollLeft||F.scrollLeft)-K;return{top:I,left:H}}}else{o.fn.offset=function(){if(!this[0]){return{top:0,left:0}}if(this[0]===this[0].ownerDocument.body){return o.offset.bodyOffset(this[0])}o.offset.initialized||o.offset.initialize();var J=this[0],G=J.offsetParent,F=J,O=J.ownerDocument,M,H=O.documentElement,K=O.body,L=O.defaultView,E=L.getComputedStyle(J,null),N=J.offsetTop,I=J.offsetLeft;while((J=J.parentNode)&&J!==K&&J!==H){M=L.getComputedStyle(J,null);N-=J.scrollTop,I-=J.scrollLeft;if(J===G){N+=J.offsetTop,I+=J.offsetLeft;if(o.offset.doesNotAddBorder&&!(o.offset.doesAddBorderForTableAndCells&&/^t(able|d|h)$/i.test(J.tagName))){N+=parseInt(M.borderTopWidth,10)||0,I+=parseInt(M.borderLeftWidth,10)||0}F=G,G=J.offsetParent}if(o.offset.subtractsBorderForOverflowNotVisible&&M.overflow!==\"visible\"){N+=parseInt(M.borderTopWidth,10)||0,I+=parseInt(M.borderLeftWidth,10)||0}E=M}if(E.position===\"relative\"||E.position===\"static\"){N+=K.offsetTop,I+=K.offsetLeft}if(E.position===\"fixed\"){N+=Math.max(H.scrollTop,K.scrollTop),I+=Math.max(H.scrollLeft,K.scrollLeft)}return{top:N,left:I}}}o.offset={initialize:function(){if(this.initialized){return}var L=document.body,F=document.createElement(\"div\"),H,G,N,I,M,E,J=L.style.marginTop,K='<div style=\"position:absolute;top:0;left:0;margin:0;border:5px solid #000;padding:0;width:1px;height:1px;\"><div></div></div><table style=\"position:absolute;top:0;left:0;margin:0;border:5px solid #000;padding:0;width:1px;height:1px;\" cellpadding=\"0\" cellspacing=\"0\"><tr><td></td></tr></table>';M={position:\"absolute\",top:0,left:0,margin:0,border:0,width:\"1px\",height:\"1px\",visibility:\"hidden\"};for(E in M){F.style[E]=M[E]}F.innerHTML=K;L.insertBefore(F,L.firstChild);H=F.firstChild,G=H.firstChild,I=H.nextSibling.firstChild.firstChild;this.doesNotAddBorder=(G.offsetTop!==5);this.doesAddBorderForTableAndCells=(I.offsetTop===5);H.style.overflow=\"hidden\",H.style.position=\"relative\";this.subtractsBorderForOverflowNotVisible=(G.offsetTop===-5);L.style.marginTop=\"1px\";this.doesNotIncludeMarginInBodyOffset=(L.offsetTop===0);L.style.marginTop=J;L.removeChild(F);this.initialized=true},bodyOffset:function(E){o.offset.initialized||o.offset.initialize();var G=E.offsetTop,F=E.offsetLeft;if(o.offset.doesNotIncludeMarginInBodyOffset){G+=parseInt(o.curCSS(E,\"marginTop\",true),10)||0,F+=parseInt(o.curCSS(E,\"marginLeft\",true),10)||0}return{top:G,left:F}}};o.fn.extend({position:function(){var I=0,H=0,F;if(this[0]){var G=this.offsetParent(),J=this.offset(),E=/^body|html$/i.test(G[0].tagName)?{top:0,left:0}:G.offset();J.top-=j(this,\"marginTop\");J.left-=j(this,\"marginLeft\");E.top+=j(G,\"borderTopWidth\");E.left+=j(G,\"borderLeftWidth\");F={top:J.top-E.top,left:J.left-E.left}}return F},offsetParent:function(){var E=this[0].offsetParent||document.body;while(E&&(!/^body|html$/i.test(E.tagName)&&o.css(E,\"position\")==\"static\")){E=E.offsetParent}return o(E)}});o.each([\"Left\",\"Top\"],function(F,E){var G=\"scroll\"+E;o.fn[G]=function(H){if(!this[0]){return null}return H!==g?this.each(function(){this==l||this==document?l.scrollTo(!F?H:o(l).scrollLeft(),F?H:o(l).scrollTop()):this[G]=H}):this[0]==l||this[0]==document?self[F?\"pageYOffset\":\"pageXOffset\"]||o.boxModel&&document.documentElement[G]||document.body[G]:this[0][G]}});o.each([\"Height\",\"Width\"],function(I,G){var E=I?\"Left\":\"Top\",H=I?\"Right\":\"Bottom\",F=G.toLowerCase();o.fn[\"inner\"+G]=function(){return this[0]?o.css(this[0],F,false,\"padding\"):null};o.fn[\"outer\"+G]=function(K){return this[0]?o.css(this[0],F,false,K?\"margin\":\"border\"):null};var J=G.toLowerCase();o.fn[J]=function(K){return this[0]==l?document.compatMode==\"CSS1Compat\"&&document.documentElement[\"client\"+G]||document.body[\"client\"+G]:this[0]==document?Math.max(document.documentElement[\"client\"+G],document.body[\"scroll\"+G],document.documentElement[\"scroll\"+G],document.body[\"offset\"+G],document.documentElement[\"offset\"+G]):K===g?(this.length?o.css(this[0],J):null):this.css(J,typeof K===\"string\"?K:K+\"px\")}})})();\n"
"//]]>\n"
"</script>\n"
"<script id=\"jqueryArea\" type=\"text/javascript\">\n"
"//<![CDATA[\n"
"/*\n"
"jQuery.encoding.digests.sha1.js\n"
"\n"
"SHA-1 digest and associated utility functions\n"
"\n"
"Copyright (c) UnaMesa Association 2009\n"
"\n"
"Dual licensed under the MIT and GPL licenses:\n"
"  http://www.opensource.org/licenses/mit-license.php\n"
"  http://www.gnu.org/licenses/gpl.html\n"
"*/\n"
"\n"
"(function($) {\n"
"\n"
"if(!$.encoding)\n"
"	$.encoding = {};\n"
"	$.extend($.encoding,{\n"
"		strToBe32s: function(str) {\n"
"			// Convert a string to an array of big-endian 32-bit words\n"
"			var be=[];\n"
"			var len=Math.floor(str.length/4);\n"
"			var i, j;\n"
"			for(i=0, j=0; i<len; i++, j+=4) {\n"
"				be[i]=((str.charCodeAt(j)&0xff) << 24)|((str.charCodeAt(j+1)&0xff) << 16)|((str.charCodeAt(j+2)&0xff) << 8)|(str.charCodeAt(j+3)&0xff);\n"
"			}\n"
"			while(j<str.length) {\n"
"				be[j>>2] |= (str.charCodeAt(j)&0xff)<<(24-(j*8)%32);\n"
"				j++;\n"
"			}\n"
"			return be;\n"
"		},\n"
"		be32sToStr: function(be) {\n"
"			// Convert an array of big-endian 32-bit words to a string\n"
"			var str='';\n"
"			for(var i=0;i<be.length*32;i+=8) {\n"
"				str += String.fromCharCode((be[i>>5]>>>(24-i%32)) & 0xff);\n"
"			}\n"
"			return str;\n"
"		},\n"
"		be32sToHex: function(be) {\n"
"			// Convert an array of big-endian 32-bit words to a hex string\n"
"			var hex='0123456789ABCDEF';\n"
"			var str='';\n"
"			for(var i=0;i<be.length*4;i++) {\n"
"				str += hex.charAt((be[i>>2]>>((3-i%4)*8+4))&0xF) + hex.charAt((be[i>>2]>>((3-i%4)*8))&0xF);\n"
"			}\n"
"			return str;\n"
"		}\n"
"	});\n"
"})(jQuery);\n"
"\n"
"\n"
"(function($) {\n"
"\n"
"if(!$.encoding.digests)\n"
"	$.encoding.digests = {};\n"
"	$.extend($.encoding.digests,{\n"
"		hexSha1Str: function(str) {\n"
"			// Return, in hex, the SHA-1 hash of a string\n"
"			return $.encoding.be32sToHex($.encoding.digests.sha1Str(str));\n"
"		},\n"
"		sha1Str: function(str) {\n"
"			// Return the SHA-1 hash of a string\n"
"			return sha1($.encoding.strToBe32s(str),str.length);\n"
"		},\n"
"		sha1: function(x,blen) {\n"
"			// Calculate the SHA-1 hash of an array of blen bytes of big-endian 32-bit words\n"
"			return sha1($.encoding.strToBe32s(str),str.length);\n"
"		}\n"
"	});\n"
"\n"
"	// Private functions.\n"
"	function sha1(x,blen) {\n"
"		// Calculate the SHA-1 hash of an array of blen bytes of big-endian 32-bit words\n"
"		function add32(a,b) {\n"
"			// Add 32-bit integers, wrapping at 32 bits\n"
"			// Uses 16-bit operations internally to work around bugs in some JavaScript interpreters.\n"
"			var lsw=(a&0xFFFF)+(b&0xFFFF);\n"
"			var msw=(a>>16)+(b>>16)+(lsw>>16);\n"
"			return (msw<<16)|(lsw&0xFFFF);\n"
"		}\n"
"		function AA(a,b,c,d,e) {\n"
"			// Cryptographic round helper function. Add five 32-bit integers, wrapping at 32 bits, second parameter is rotated left 5 bits before the addition\n"
"			// Uses 16-bit operations internally to work around bugs in some JavaScript interpreters.\n"
"			b=(b>>>27)|(b<<5);\n"
"			var lsw=(a&0xFFFF)+(b&0xFFFF)+(c&0xFFFF)+(d&0xFFFF)+(e&0xFFFF);\n"
"			var msw=(a>>16)+(b>>16)+(c>>16)+(d>>16)+(e>>16)+(lsw>>16);\n"
"			return (msw<<16)|(lsw&0xFFFF);\n"
"		}\n"
"		function RR(w,j) {\n"
"			// Cryptographic round helper function.\n"
"			var n=w[j-3]^w[j-8]^w[j-14]^w[j-16];\n"
"			return (n>>>31)|(n<<1);\n"
"		}\n"
"\n"
"		var len=blen*8;\n"
"		x[len>>5] |= 0x80 << (24-len%32);\n"
"		x[((len+64>>9)<<4)+15]=len;\n"
"		var w=new Array(80);\n"
"\n"
"		var k1=0x5A827999;\n"
"		var k2=0x6ED9EBA1;\n"
"		var k3=0x8F1BBCDC;\n"
"		var k4=0xCA62C1D6;\n"
"\n"
"		var h0=0x67452301;\n"
"		var h1=0xEFCDAB89;\n"
"		var h2=0x98BADCFE;\n"
"		var h3=0x10325476;\n"
"		var h4=0xC3D2E1F0;\n"
"\n"
"		for(var i=0;i<x.length;i+=16) {\n"
"			var j=0;\n"
"			var t;\n"
"			var a=h0;\n"
"			var b=h1;\n"
"			var c=h2;\n"
"			var d=h3;\n"
"			var e=h4;\n"
"			while(j<16) {\n"
"				w[j]=x[i+j];\n"
"				t=AA(e,a,d^(b&(c^d)),w[j],k1);\n"
"				e=d; d=c; c=(b>>>2)|(b<<30); b=a; a=t; j++;\n"
"			}\n"
"			while(j<20) {\n"
"				w[j]=RR(w,j);\n"
"				t=AA(e,a,d^(b&(c^d)),w[j],k1);\n"
"				e=d; d=c; c=(b>>>2)|(b<<30); b=a; a=t; j++;\n"
"			}\n"
"			while(j<40) {\n"
"				w[j]=RR(w,j);\n"
"				t=AA(e,a,b^c^d,w[j],k2);\n"
"				e=d; d=c; c=(b>>>2)|(b<<30); b=a; a=t; j++;\n"
"			}\n"
"			while(j<60) {\n"
"				w[j]=RR(w,j);\n"
"				t=AA(e,a,(b&c)|(d&(b|c)),w[j],k3);\n"
"				e=d; d=c; c=(b>>>2)|(b<<30); b=a; a=t; j++;\n"
"			}\n"
"			while(j<80) {\n"
"				w[j]=RR(w,j);\n"
"				t=AA(e,a,b^c^d,w[j],k4);\n"
"				e=d; d=c; c=(b>>>2)|(b<<30); b=a; a=t; j++;\n"
"			}\n"
"			h0=add32(h0,a);\n"
"			h1=add32(h1,b);\n"
"			h2=add32(h2,c);\n"
"			h3=add32(h3,d);\n"
"			h4=add32(h4,e);\n"
"		}\n"
"		return [h0,h1,h2,h3,h4];\n"
"	}\n"
"})(jQuery);\n"
"/*\n"
"jQuery.twStylesheet.js\n"
"\n"
"jQuery plugin to dynamically insert CSS rules into a document\n"
"\n"
"Usage:\n"
"  jQuery.twStylesheet applies style definitions\n"
"  jQuery.twStylesheet.remove neutralizes style definitions\n"
"\n"
"Copyright (c) UnaMesa Association 2009\n"
"\n"
"Triple licensed under the BSD, MIT and GPL licenses:\n"
"  http://www.opensource.org/licenses/bsd-license.php\n"
"  http://www.opensource.org/licenses/mit-license.php\n"
"  http://www.gnu.org/licenses/gpl.html\n"
"*/\n"
"\n"
"(function($) {\n"
"\n"
"var defaultId = \"customStyleSheet\"; // XXX: rename to dynamicStyleSheet?\n"
"\n"
"// Add or replace a style sheet\n"
"// css argument is a string of CSS rule sets\n"
"// options.id is an optional name identifying the style sheet\n"
"// options.doc is an optional document reference\n"
"// N.B.: Uses DOM methods instead of jQuery to ensure cross-browser comaptibility.\n"
"$.twStylesheet = function(css, options) {\n"
"	options = options || {};\n"
"	var id = options.id || defaultId;\n"
"	var doc = options.doc || document;\n"
"	var el = doc.getElementById(id);\n"
"	if(doc.createStyleSheet) { // IE-specific handling\n"
"		if(el) {\n"
"			el.parentNode.removeChild(el);\n"
"		}\n"
"		doc.getElementsByTagName(\"head\")[0].insertAdjacentHTML(\"beforeEnd\",\n"
"			\"&nbsp;<style id='\" + id + \"'>\" + css + \"</style>\"); // fails without &nbsp;\n"
"	} else { // modern browsers\n"
"		if(el) {\n"
"			el.replaceChild(doc.createTextNode(css), el.firstChild);\n"
"		} else {\n"
"			el = doc.createElement(\"style\");\n"
"			el.type = \"text/css\";\n"
"			el.id = id;\n"
"			el.appendChild(doc.createTextNode(css));\n"
"			doc.getElementsByTagName(\"head\")[0].appendChild(el);\n"
"		}\n"
"	}\n"
"};\n"
"\n"
"// Remove existing style sheet\n"
"// options.id is an optional name identifying the style sheet\n"
"// options.doc is an optional document reference\n"
"$.twStylesheet.remove = function(options) {\n"
"	options = options || {};\n"
"	var id = options.id || defaultId;\n"
"	var doc = options.doc || document;\n"
"	var el = doc.getElementById(id);\n"
"	if(el) {\n"
"		el.parentNode.removeChild(el);\n"
"	}\n"
"};\n"
"\n"
"})(jQuery);\n"
"//]]>\n"
"</script>\n"
"<script type=\"text/javascript\">\n"
"//<![CDATA[\n"
"if(useJavaSaver)\n"
"	document.write(\"<applet style='position:absolute;left:-1px' name='TiddlySaver' code='TiddlySaver.class' archive='TiddlySaver.jar' width='1' height='1'></applet>\");\n"
"//]]>\n"
"</script>\n"
"<!--POST-SCRIPT-START-->\n"
"<!--POST-SCRIPT-END-->\n"
"</body>\n"
"</html>\n";

char* g_twTemplate = "<div id=\"storeArea\">\n"
"</div>\n";
